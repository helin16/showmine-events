!function(){"use strict";var e,t,n,a,i,r,o,c,s,m=function(e){return r=e,{request:function(e){return e.headers["default-lang"]=s.localStorage.getItem("language"),e.headers["Wechat-Browser-Acc"]=o.getAuthString(),e||r.when(e)},response:function(e){return e},responseError:function(e){return 401===e.status&&(a.logout(),n.transitionTo("auth.login")),r.reject(e)}}},u=function(e){i=e,i.tokenType="X-Auth-Token",i.storageType="localStorage"},l=function(e,i){t.$on("$stateChangeStart",function(e,t,i,r,o){"auth.login"===t.name&&a.isAuthenticated()&&(n.transitionTo("mixAuth.itemList"),e.preventDefault()),!0!==t.needsAuth||a.isAuthenticated()||(n.transitionTo("auth.login"),e.preventDefault())}),t.$on("$stateChangeSuccess",function(n,a,r,o,s){t.previousState={state:o,params:s},"function"==typeof e.loadWeChatJsConf&&c(function(){switch(e.openInIphone()?e.loadWeChatJsConf(i.getCurrentUrl()):e.loadWeChatJsConf(i.getCurrentUrlFromPageState(a)),a.name){case"mixAuth.itemEdit":case"mixAuth.voucherCheckIn":case"auth.login":case"auth.getWechatUser":case"auth.getWechatWebUser":case"mixAuth.bannerManage":case"auth":case"auth.getWechatUser":case"auth.getWechatWebUser":case"auth.getUserFromToken":wx.hideAllNonBaseMenuItem();break;default:wx.showAllNonBaseMenuItem()}},1e3)})},p=function(i,r,m,u,p,d,g,f,h,y){return t=i,n=r,a=m,o=p,c=h,s=y,e=this,t.appConf=u,d.changeLocale(u.default.momentJs.locale),l(g,f),String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return this.substr(!t||t<0?0:+t,e.length)===e}),e};angular.module("shmApp.config",[]),angular.module("shmApp.controllers",[]),angular.module("shmApp.services",[]),angular.module("shmApp.directives",[]),angular.module("shmApp.filters",[]),angular.module("shmApp.languages",[]),angular.module("shmApp.routes",[]),angular.module("shmApp.templates",[]),e=angular.module("shmApp",["oc.lazyLoad","angular-ladda","angular.filter","satellizer","ui.bootstrap","angular-loading-bar","ngSanitize","angularMoment","ngFileUpload","angular-md5","ngFilesizeFilter","ng-currency","timer","ngMessages","ui.sortable","angular-flexslider","base64","angular-google-analytics","ngTagsInput","ui.bootstrap.datetimepicker","ui.dateTimeInput","infinite-scroll","angularLazyImg","angular-google-adsense","shmApp.config","shmApp.services","shmApp.controllers","shmApp.directives","shmApp.filters","shmApp.languages","shmApp.routes","shmApp.templates"]).factory("myInterceptor",["$q",m]).config(["$authProvider",u]).config(["$httpProvider",function(e){e.interceptors.push("myInterceptor")}]).run(["$rootScope","$state","$auth","appConf","AuthService","amMoment","WeChatService","UtilsService","$timeout","$window",p])}(),function(){"use strict";var e,t,n,a,i,r=function(){return a.otherwise("/"),n.state("home",{url:"/",templateUrl:t+"cms/home.html",controller:"HomeController as ctrl",resolve:{appUser:["AuthService",function(e){return e.getMe()}]}}).state("cms",{abstract:!0,url:"/cms",templateUrl:t+"cms/cms.html",controller:"CmsController as ctrl"}).state("cms.contactUs",{url:"/contact",parent:"cms",templateUrl:t+"cms/contact_us.html"}).state("cms.termsOfUse",{url:"/terms-of-use",parent:"cms",templateUrl:t+"cms/terms-of-use.html"}).state("cms.userPrivacy",{url:"/privacy",parent:"cms",templateUrl:t+"cms/user-privacy.html"}).state("auth",{abstract:!0,url:"/a",templateUrl:t+"auth/auth.html",controller:"AuthController as authCtrl"}).state("auth.login",{url:"/l",parent:"auth",templateUrl:t+"auth/login.html"}).state("auth.getWechatUser",{url:"/wu?domain&origurl",parent:"auth",templateUrl:t+"auth/wechat.user.html"}).state("auth.getWechatWebUser",{url:"/wwu?domain&origurl",parent:"auth",templateUrl:t+"auth/wechat.user.html"}).state("auth.getUserFromToken",{url:"/tk?token&origurl",parent:"auth",template:"<loading-bar></loading-bar>"}).state("mixAuth",{abstract:!0,url:"/ma",templateUrl:t+"mixAuth/common/mixAuth.html",resolve:{appUser:["AuthService",function(e){return e.getMe()}],isOverseas:["ItemService",function(e){return e.getPlacesOverseas()}],isFromChina:["ItemService",function(e){return e.getIsFromChina()}]},controller:"MixAuthController as maCtrl"}).state("mixAuth.itemList",{url:"/il/:userId?/:typeId?",templateUrl:t+"mixAuth/item/itemList.html",controller:"ItemController as ctrl"}).state("mixAuth.itemDetails",{url:"/i/:itemId?itemCommentId?from",templateUrl:t+"mixAuth/itemDetails/details.html",controller:"ItemDetailsController as ctrl"}).state("mixAuth.itemDetailsSEO",{url:"/i/:itemId/:itemTitle?itemCommentId?from",templateUrl:t+"mixAuth/itemDetails/details.html",controller:"ItemDetailsController as ctrl"}).state("mixAuth.community",{url:"/cm",templateUrl:t+"mixAuth/community/home.html",controller:"CommunityController as ctrl"}).state("mixAuth.itemCreate",{url:"/ic?communityName",templateUrl:t+"mixAuth/item/itemSave.html",controller:"ItemController as ctrl",resolve:{store:["$ocLazyLoad",function(e){return e.load({serie:!0,name:"ui.tinymce",files:["./node_modules/tinymce/tinymce.min.js","./node_modules/angular-ui-tinymce/dist/tinymce.min.js"]})}]}}).state("mixAuth.itemEdit",{url:"/ie/:itemId",templateUrl:t+"mixAuth/item/itemSave.html",controller:"ItemController as ctrl",resolve:{store:["$ocLazyLoad",function(e){return e.load({serie:!0,name:"ui.tinymce",files:["./node_modules/tinymce/tinymce.min.js","./node_modules/angular-ui-tinymce/dist/tinymce.min.js"]})}]}}).state("mixAuth.jieLongResult",{url:"/jl/:itemId",templateUrl:t+"mixAuth/item/jielongResult.html",controller:"ItemController as ctrl"}).state("mixAuth.jieLongCheckIn",{url:"/jl/ci/:itemId",templateUrl:t+"mixAuth/item/jielongCheckin.html",controller:"ItemController as ctrl"}).state("mixAuth.voucherCheckIn",{url:"/jl/vci/:voucherId",templateUrl:t+"mixAuth/item/voucherCheckIn.html",controller:"ItemController as ctrl"}).state("mixAuth.communityItemSearch",{url:"/is/:keyWord?predefinedTagId&state&country&TypeId&isincludeJielong&suburb&amount&type&bed&bath&gender&car&expand&pet&propertyType",templateUrl:t+"mixAuth/item/itemSearch.html",controller:"ItemController as ctrl"}).state("mixAuth.companyItemSearchSEO",{url:"/cpis/:companyId/:companyTitle?keyWord?messageId",templateUrl:t+"mixAuth/item/companyItemSearch.html",controller:"ItemController as ctrl"}).state("mixAuth.companyItemSearch",{url:"/cpis/:keyWord?companyId",templateUrl:t+"mixAuth/item/companyItemSearch.html",controller:"ItemController as ctrl"}).state("mixAuth.templateCompanyItemSearch",{url:"/cpis/search/:companyId/:keyWord?",template:"<company-template-search app-user='appUser'></company-template-search>"}).state("mixAuth.companyCreate",{url:"/cc",templateUrl:t+"mixAuth/company/companySave.html",controller:"CompanyController as ctrl"}).state("mixAuth.companyPaymentClearance",{url:"/cpc",template:'<company-payment-clearance-mobile app-user="appUser"></company-payment-clearance-mobile>'}).state("mixAuth.oneCompanyPaymentClearance",{url:"/cpc/:companyId",template:'<one-company-payment-clearance-mobile app-user="appUser"></one-company-payment-clearance-mobile>'}).state("mixAuth.companyEdit",{url:"/ce/:companyId",templateUrl:t+"mixAuth/company/companySave.html",controller:"CompanyController as ctrl",resolve:{store:["$ocLazyLoad",function(e){return e.load({serie:!0,name:"ui.tinymce",files:["./node_modules/tinymce/tinymce.min.js","./node_modules/angular-ui-tinymce/dist/tinymce.min.js"]})}]}}).state("mixAuth.companyUserManage",{url:"/cu/:companyId",templateUrl:t+"mixAuth/company/userManage.html",controller:"CompanyController as ctrl"}).state("mixAuth.companyVoucherGroup",{url:"/cvg/:companyId",resolve:{store:["$ocLazyLoad",function(e){return e.load({serie:!0,name:"ui.tinymce",files:["./node_modules/tinymce/tinymce.min.js","./node_modules/angular-ui-tinymce/dist/tinymce.min.js"]})}]},template:'<company-voucher-group app-user="appUser"></company-voucher-group>'}).state("mixAuth.companyVoucherReleased",{url:"/cvr/:voucherGroupId?showShareTips?from",template:'<company-voucher-released app-user="appUser"></company-voucher-released>'}).state("mixAuth.companyVoucherCampaign",{url:"/cvc/:campaignId?from",template:'<company-voucher-campaign app-user="appUser"></company-voucher-campaign>'}).state("mixAuth.companyVoucherRedirect",{url:"/cvredir?card_id&encrypt_code&openid",template:"<company-voucher-redirect></company-voucher-redirect>"}).state("mixAuth.companyVoucherCampaignList",{url:"/cvcl?companyId",template:'<company-voucher-campaign-list app-user="appUser"></company-voucher-campaign-list>'}).state("mixAuth.companyVoucherCampaignDetails",{url:"/cvcd?companyId&campaignId",template:'<company-voucher-campaign-details app-user="appUser"></company-voucher-campaign-details>'}).state("mixAuth.visitHistory",{url:"/h",templateUrl:t+"mixAuth/item/history.html",controller:"ItemController as ctrl"}).state("mixAuth.favItemList",{url:"/fav",templateUrl:t+"mixAuth/item/favList.html",controller:"ItemController as ctrl"}).state("mixAuth.voucherList",{url:"/vl/?voucherType",templateUrl:t+"mixAuth/item/voucherList.html",controller:"ItemController as ctrl"}).state("mixAuth.blackList",{url:"/bl/?companyId",templateUrl:t+"mixAuth/item/blackList.html",controller:"ItemController as ctrl"}).state("mixAuth.bannerManage",{url:"/bm",templateUrl:t+"mixAuth/banner/manage.html",controller:"CommunityController as ctrl"}).state("mixAuth.companyList",{url:"/cl",templateUrl:t+"mixAuth/company/companyList.html",controller:"CompanyController as ctrl"}).state("mixAuth.alipayWithQR",{url:"/alipayQR/:itemId?alipay_qr_url",template:"<pay-with-alipay-qr></pay-with-alipay-qr>"}).state("mixAuth.completePaypal",{url:"/paypal/validation/?token&PayerID",template:"<paypal-validation-url></paypal-validation-url>"}).state("mixAuth.consultationExpiredPage",{url:"/iex/:itemId",template:"<consultation-item-expired-page></consultation-item-expired-page>"}).state("mixAuth.bindCompanyWithAppId",{url:"/op/bindCompany/:companyId?auth_code",template:"<open-platform-bind-company></open-platform-bind-company>"}).state("mixAuth.companySyncWechatArticle",{url:"/csa/:companyId",template:"<company-sync-wechat-article></company-sync-wechat-article>"}).state("mixAuth.packageSelection",{url:"/packageSelection",templateUrl:t+"mixAuth/community/packageSelection.html"}).state("mixAuth.paymentValidation",{url:"/paymentValidation/:payment_method_name?token&PayerID&checkoutId&referenceId&transactionId",template:"<payment-validation-page></payment-validation-page>"}).state("mixAuth.packagePaymentList",{url:"/packagePaymentList",template:"<package-payment-list></package-payment-list>"}).state("mixAuth.socialCallback",{url:"/socialCallback/:name?code",template:"<social-callback></social-callback>"}).state("mixAuth.userCenter",{url:"/userCenter",template:"<user-center app-user='appUser'></user-center>"}).state("mixAuth.facebookPageCallback",{url:"/facebookPageCallback/:name?code&state",template:"<facebook-page-callback app-user='appUser'></facebook-page-callback>"}).state("mixAuth.companyPackageExtend",{url:"/packageExtend/:companyId",template:"<company-package-extend app-user='appUser'></company-package-extend>"}).state("mixAuth.userQrCode",{url:"/userCenter/qr",template:"<user-qr-code app-user='appUser'></user-qr-code>"}).state("mixAuth.rentFilter",{url:"/is/rentFilter",template:"<rent-filter app-user='appUser'></rent-filter>"}).state("mixAuth.userPreference",{url:"/userCenter/preference?disable",template:"<user-preference app-user='appUser'></user-preference>"}).state("mixAuth.publicVoucherList",{url:"/voucherList",template:"<public-voucher-list app-user='appUser'></public-voucher-list>"}),e},o=function(o,c,s,m){return n=o,a=c,i=s,t=m.viewRootDir,e=this,i.html5Mode(!0),r(),e};angular.module("shmApp.routes",["ui.router","shmApp.config"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","appConf",o])}(),function(){"use strict";var e,t,n,a=function(a,i,r){e=a,t=i,n=r,t.addPart(n.languageRootDir),e.useLoader("$translatePartialLoader",{urlTemplate:"{part}{lang}.json"}),e.useLoaderCache("$translationCache"),e.fallbackLanguage(n.default.language),e.preferredLanguage(n.default.language),e.useSanitizeValueStrategy("escapeParameters")};angular.module("shmApp.languages",["pascalprecht.translate"]).config(["$translateProvider","$translatePartialLoaderProvider","appConf",a])}(),function(){"use strict";angular.module("shmApp.config",[]).constant("appConf",function(){return{appName:"ShowMine",author:{name:"Sysbox Pty Ltd",URL:"http://sysbox.com.au"},viewRootDir:"app/views/",imagesRootDir:"app/images/",languageRootDir:"app/languages/",apiUrl:"https://api.showmine.com.au/",apiUrlEN:"https://api.showmine.com.au/",apiUrlCN:"https://cnapi.showmine.com/api/",webMainUrl:"https://www.showmine66.com",localStorageKeyPrefix:"SHM_",default:{momentJs:{locale:"zh-cn"},language:"simplified-chinese"},google_location_url:"https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d12593.574534849551!2d145.134216!3d-37.897861!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0xb39cfb4e1989c1cf!2sShowMine+Pty+Ltd!5e0!3m2!1sen!2sau!4v1527144542084"}}())}(),function(){var e,t,n,a,i,r,o,c,s,m,u,l,p=function(){return i.loadingWechatLoginUrl=!0,i.loadingWechatLoginUrlErr=void 0,a.getWechatLoginUrl({redirect_uri:n.appConf.webMainUrl+e.href("auth.getWechatWebUser",{domain:encodeURIComponent(location.origin),origurl:encodeURIComponent(location.href)},{absolute:!1}),state_redirect_obj:n.previousState}).then(function(e){e.data&&e.data.url&&(i.wechatLoginUrl=t.trustAsResourceUrl(e.data.url),u.openInGoogleChrome()&&n.appConf.webMainUrl!==location.origin&&(m.location.href=i.wechatLoginUrl))},function(e){i.loadingWechatLoginUrlErr=e.data}).finally(function(){i.loadingWechatLoginUrl=!1}),i},d=function(t,n,r){if(!n)return void e.go("auth.login",{reload:!0,inherit:!1});var c={};return c.isFromWeb=r||!1,i.gettingWeChatUser=!0,i.gettingWeChatUserErr=void 0,c.getUserFunc=!0===c.isFromWeb?a.getWechatWebUserFromCode(t,n):a.getWechatUserFromCode(t,n),c.getUserFunc.then(function(t){if(o.setToken(t.data.token),a.setAuthString(t.data.auth_string),i.appUser=t.data.user,e.params.domain&&location.origin!==decodeURIComponent(e.params.domain)){var n=decodeURIComponent(e.params.domain),r=e.href("auth.getUserFromToken",{token:t.data.token,origurl:e.params.origurl},{absolute:!1}),u=n+r;m.location.href=u}t.data.state&&t.data.state.parameters?(c.stateParams=t.data.state.parameters,c.stateParams.ajaxAction?(c.previousAjaxAction=c.stateParams.ajaxAction,c.requestType=c.previousAjaxAction.type.toLowerCase(),"get"===c.requestType&&(c.previousAjaxAction.params={params:c.previousAjaxAction.params}),s[c.requestType](c.previousAjaxAction.url,c.previousAjaxAction.params).finally(function(){c.stateParams.state_redirect_obj&&e.go(c.stateParams.state_redirect_obj.name,c.stateParams.state_redirect_obj.params)})):c.stateParams.state_redirect_obj&&e.go(c.stateParams.state_redirect_obj.name,c.stateParams.state_redirect_obj.params)):e.go("auth.login",{},{reload:!0})},function(e){i.gettingWeChatUserErr=e.data,i.gettingWeChatUser=!1}).finally(function(){}),i},g=function(){switch(wx.hideAllNonBaseMenuItem(),e.current.name){case"auth.login":i.getWechatLoginUrl(),i.isFromFacebook=l.isFromFacebook();break;case"auth.getWechatUser":i.getWechatUser(c.search().code,c.search().state,!1);break;case"auth.getWechatWebUser":i.getWechatUser(c.search().code,c.search().state,!0);break;case"auth.getUserFromToken":o.setToken(e.params.token),e.params.origurl?m.location.href=decodeURIComponent(e.params.origurl):e.go("mixAuth.itemList",{},{reload:!0})}return i},f=function(f,h,y,v,I,C,A,S,_,b,U,E){return a=y,n=h,n.isAuthPage=!0,n.appConf=f,r=I,e=C,o=A,c=S,s=_,t=b,m=U,u=v,l=E,i=this,i.initPage=g,i.getWechatLoginUrl=p,i.getWechatUser=d,i.openInDesktop=u.openInDesktop(),i};angular.module("shmApp.controllers").controller("AuthController",["appConf","$rootScope","AuthService","WeChatService","$translate","$state","$auth","$location","$http","$sce","$window","UtilsService",f])}(),function(){var e,t,n=function(){return e.utilsService.scrollToTop(),t},a=function(a,i){return e=a,e.utilsService=i,t=this,t.initPage=n,t};angular.module("shmApp.controllers").controller("CmsController",["$scope","UtilsService",a])}(),function(){var e,t,n,a,i=function(i,r,o,c){return e=i,n=o,a=c,e.utilsService=r,t=this};angular.module("shmApp.controllers").controller("CommunityController",["$scope","UtilsService","$state","$window",i])}(),function(){var e,t,n,a,i,r,o,c,s,m,u,l,p=function(){switch(e.pageLoading(),u.hideContactUsQr=!0,e.utilsService.scrollToTop(),!0===e.weChatService.openedInWeChat()&&e.weChatService.loginAndRedirect(a.current),a.current.name){case"mixAuth.companyCreate":t.currentCompany={},t.currentCompany.logo_img={},t.currentCompany.qr_img={},t.currentCompany.logoImgArray=[],t.currentCompany.qrImgArray=[],t.item_number=30,t.member_number=10,e.pageLoaded();break;case"mixAuth.companyEdit":t.getCompanyDetails(a.params.companyId),t.getCompanyPickupLocations(a.params.companyId),t.existingCompanyId=a.params.companyId;break;case"mixAuth.companyUserManage":t.companyId=a.params.companyId,t.getCompanyUsers();break;case"mixAuth.companyList":c.isAuthenticated()||!0===e.weChatService.openedInWeChat()&&e.weChatService.loginAndRedirect(a.current),e.pageLoaded()}return t},d=function(i){return t.gettingCompanyDetails=!0,t.gettingCompanyDetailsErr=void 0,n.getCompanyDetails(i).then(function(e){if(t.currentCompany=e.data,"mixAuth.companyEdit"===a.current.name&&(t.ifActivatedSynWechat=o.ifCompanyCanCreateFeaturedItem(t.currentCompany,"SYNC TO WECHAT").ifCanCreate,t.ifActivatedMultiPickup=o.ifCompanyCanCreateFeaturedItem(t.currentCompany,"MULTIPLE PICKUP").ifCanCreate),t.currentCompany.config){var n=JSON.parse(t.currentCompany.config);t.ifChangeToGrid=n.ifChangeToGrid,t.filterOfItemsDisplay=n.filterOfItemsDisplay,t.ifShowAvatar=n.ifShowAvatar,t.slogan=n.slogan,t.address=n.address,t.defaultContact=n.defaultContact,t.defaultRedeemDesc=n.defaultRedeemDesc;var i=n.account_info;i&&(t.bsb_number=i.bsb,t.account_number=i.account_number,t.user_name=i.account_name)}if(t.currentCompany.admin_config){var r=JSON.parse(t.currentCompany.admin_config);t.item_number=parseInt(r.itemLimit),t.member_number=parseInt(r.userLimit),t.ifOnlinePayment=r.ifOnlinePayment,t.ifNotifySeller=r.notify_seller_when_jielong_in,t.ifAvoidBoardcastDaily=r.avoid_boardcast_daily,t.wechatAppId=r.wechat_app_id,t.facebookPageId=r.facebookPageId,t.facebookPageToken=r.facebookPageToken,t.wpUrl=r.wpUrl,t.wpLoginName=r.wpLoginName,t.origPassword=r.wpPassword,t.wpPassword=r.wpPassword,t.ifSyncTextOnlyToWP=r.ifSyncTextOnlyToWP,t.fbId=r.fbId,t.fbSecret=r.fbSecret,r.currentPackageExpireDate||(r.currentPackageExpireDate="2016-12-31 00:00:00"),r.currentPackage||(r.currentPackage="none"),t.currentPackageExpireDate_local=moment(moment.utc(r.currentPackageExpireDate)).local().format("YYYY-MM-DD HH:mm:ss"),t.currentPackage=r.currentPackage,void 0===r.display_jielong&&t.ifDisplayJielong,t.ifDisplayJielong=!0===r.display_jielong&&r.display_jielong,void 0===r.display_contactUs&&t.ifDisplayContactUs,t.ifDisplayContactUs=!1!==r.display_contactUs||r.display_contactUs,void 0===r.ifJumpToHomePage&&(t.ifJumpToHomePage=!0),t.ifJumpToHomePage=0!=r.ifJumpToHomePage||r.ifJumpToHomePage,t.ifUseCompanyTemplate=!!r.ifUseCompanyTemplate&&r.ifUseCompanyTemplate,t.isAllowCreateJielong=!!r.is_allow_create_jielong&&r.is_allow_create_jielong,t.isAllowCreateVoucher=!!r.is_allow_create_voucher&&r.is_allow_create_voucher,t.isAllowCreateNews=!!r.is_allow_create_news&&r.is_allow_create_news,t.isAllowSynToWechat=!!r.is_allow_syn_to_wechat&&r.is_allow_syn_to_wechat,t.isAllowMultiPickup=!!r.is_allow_multi_pickup&&r.is_allow_multi_pickup,t.isReceiveVoucherNotification=!!r.isReceiveVoucherNotification&&r.isReceiveVoucherNotification}t.currentCompany.tags&&t.currentCompany.tags.length>0&&(t.currentCompany.tagNames=[],angular.forEach(t.currentCompany.tags,function(e){t.currentCompany.tagNames.push(e.name)})),t.currentCompany.logoImgArray=""!==t.currentCompany.logo_img?t.currentCompany.logoImgArray=[t.currentCompany.logo_img]:[],t.currentCompany.qrImgArray=""!==t.currentCompany.qr_img?[t.currentCompany.qr_img]:[]},function(e){t.gettingCompanyDetailsErr=e.data}).finally(function(){t.gettingCompanyDetails=!1,e.pageLoaded()}),t},g=function(e){n.getCompanyPickupLocations(e).then(function(e){t.locations=e.data},function(e){t.gettingPickupLocationsError=e.data})},f=function(e,a){n.deleteCompanyPickupLocation(e,a).then(function(n){t.getCompanyPickupLocations(e)},function(e){t.gettingPickupLocationsError=e.data})},h=function(){n.getUserList(t.companyId).then(function(e){t.originalUserArray=e.data;var n=y(t.originalUserArray.list);t.userList=n},function(e){t.addingUserErr=e.data}).finally(function(){t.addingUser=!1,t.searchingUser=!1,e.pageLoaded()})},y=function(e){return angular.forEach(e,function(e){e.avatarImgSrc=o.getUserAvatarImageUrl(e),e.isAdmin="1"==e.role_id}),e},v=function(i){if(i.$submitted=!0,void 0===t.currentCompany.name&&(i.$invalid=!0,t.showError=!0),!0===i.$invalid)return t;var r={},o="";o=t.currentCompany.id,t.currentCompany.logo_img=t.currentCompany.logoImgArray[0],t.currentCompany.qr_img=t.currentCompany.qrImgArray[0],t.ifChangeToGrid=!!t.ifChangeToGrid&&t.ifChangeToGrid,t.ifShowAvatar=!!t.ifShowAvatar&&t.ifShowAvatar,t.ifNotifySeller=!!t.ifNotifySeller&&t.ifNotifySeller,t.ifAvoidBoardcastDaily=!!t.ifAvoidBoardcastDaily&&t.ifAvoidBoardcastDaily,t.ifDisplayJielong=!!t.ifDisplayJielong&&t.ifDisplayJielong,t.ifDisplayContactUs=!!t.ifDisplayContactUs&&t.ifDisplayContactUs,t.isAllowCreateJielong=!!t.isAllowCreateJielong&&t.isAllowCreateJielong,t.isAllowCreateVoucher=!!t.isAllowCreateVoucher&&t.isAllowCreateVoucher,t.isAllowCreateNews=!!t.isAllowCreateNews&&t.isAllowCreateNews,t.isAllowSynToWechat=!!t.isAllowSynToWechat&&t.isAllowSynToWechat,t.isAllowMultiPickup=!!t.isAllowMultiPickup&&t.isAllowMultiPickup,t.isReceiveVoucherNotification=!!t.isReceiveVoucherNotification&&t.isReceiveVoucherNotification,t.currentPackageExpireDate=moment(moment(t.currentPackageExpireDate_local)).utc().format("YYYY-MM-DD HH:mm:ss");var c={ifChangeToGrid:t.ifChangeToGrid,ifShowAvatar:t.ifShowAvatar,account_info:{bsb:t.bsb_number,account_number:t.account_number,account_name:t.user_name},slogan:t.slogan,address:t.address,defaultContact:t.defaultContact,defaultRedeemDesc:t.defaultRedeemDesc};t.existingCompanyId||(t.currentPackageExpireDate="2016-12-31 00:00:00",t.currentPackage="none");var s={itemLimit:t.item_number,userLimit:t.member_number,ifOnlinePayment:t.ifOnlinePayment,notify_seller_when_jielong_in:t.ifNotifySeller,ifJumpToHomePage:t.ifJumpToHomePage,ifUseCompanyTemplate:t.ifUseCompanyTemplate,wechat_app_id:t.wechatAppId,facebookPageId:t.facebookPageId,facebookPageToken:t.facebookPageToken,currentPackageExpireDate:t.currentPackageExpireDate,currentPackage:t.currentPackage,wpUrl:t.wpUrl,wpLoginName:t.wpLoginName,avoid_boardcast_daily:t.ifAvoidBoardcastDaily,display_jielong:t.ifDisplayJielong,display_contactUs:t.ifDisplayContactUs,ifSyncTextOnlyToWP:t.ifSyncTextOnlyToWP,is_allow_create_jielong:t.isAllowCreateJielong,is_allow_create_voucher:t.isAllowCreateVoucher,is_allow_create_news:t.isAllowCreateNews,is_allow_syn_to_wechat:t.isAllowSynToWechat,is_allow_multi_pickup:t.isAllowMultiPickup,isReceiveVoucherNotification:t.isReceiveVoucherNotification};return t.fbId&&t.fbSecret&&(s.fbId=t.fbId,s.fbSecret=t.fbSecret),t.origPassword&&t.origPassword===t.wpPassword||(s.wpPassword=t.wpPassword),t.currentCompany.config=JSON.stringify(c),t.currentCompany.admin_config=JSON.stringify(s),r.savingCompanyFunc=o?n.updateInfo(o,t.currentCompany):n.createInfo(t.currentCompany),t.savingCompany=!0,t.savingCompanyErr=void 0,r.savingCompanyFunc.then(function(e){a.go("mixAuth.companyUserManage",{companyId:e.data.id},{reload:!0})},function(n){t.savingCompanyErr=n.data,e.utilsService.scrollTo("saving-Company-err")}).finally(function(){t.savingCompany=!1}),t},I=function(e){var n={};if(n.pageNo=e||1,""!=t.keyword&&void 0!=t.keyword)return t.searchingUser=!0,t.searchingUserErr=void 0,t.userSuggestionList=[],i.searchUser(t.keyword,{page:n.pageNo,companyId:t.companyId}).then(function(e){return t.totalItems=e.data.total,t.currentPage=e.data.current_page,t.userSuggestionList=e.data.data,t.userSuggestionList},function(e){t.searchingUserErr=e.data}).finally(function(){t.searchingUser=!1})},C=function(e){t.selectedUser=void 0,t.keyword="",t.userSuggestionList=[]},A=function(){t.addingUser=!0,t.addingUserErr=void 0,n.createNewCompanyUser(t.companyId,t.selectedUser.id).then(function(e){t.selectedUser=void 0,t.getCompanyUsers()},function(e){t.addingUserErr=e.data}).finally(function(){t.addingUser=!1,t.userSuggestionList=[]})},S=function(){var e={};e.params={user_id:t.selectedUser.id},t.selectedUser=void 0,n.addSales(t.currentCompany.id,e.params).then(function(e){t.userSuggestionList=[]}).finally(function(){t.getCompanyDetails(t.currentCompany.id)})},_=function(e,a,i){n.updateCompanyUser(e,a,{is_admin:i}).then(function(e){t.getCompanyUsers()},function(e){t.setCompanyUserAsAdminErr=e.data})},b=function(e){var a=l.instant("COMPANY.VOUCHER.DELETE.PENDING.DELETE");weui.confirm(a,function(){n.deleteCompanyUser(t.companyId,e).then(function(e){weui.toast("Success",1500),h()},function(e){t.deleteCompanyUserErr=e.data})},function(){})},U=function(e){weui.confirm("ç¡®è®¤é€šè¿‡å®¡æ ¸å—?",function(){var a={};a.params={user_id:e},n.approveCompanyStaff(t.companyId,a.params).then(function(e){weui.toast("Success",1500),h()})},function(){})},E=function(){var e=a.params.companyId,t={company_id:e,company_bind_appid_url:a.href("mixAuth.bindCompanyWithAppId",{companyId:e},{absolute:!0})};r.getPreAuthorizationUrl(t).then(function(e){s.location.href=e.data.url})},w=function(e){var t={};t.params={companyId:e},m.companyFacebookRedirect(t.params).then(function(e){s.location.href=e.data},{}).finally(function(){scope.generatingFacebookLink=!1})},T=function(){o.displaySubscribeModal("PAID FEATURE")},L=function(L,M,D,k,P,M,R,N,O,x,$,G){return e=L,n=D,i=k,r=P,o=M,m=x,u=$,l=G,e.utilsService=M,a=R,c=N,s=O,t=this,t.initPage=p,t.saveCompanyInfo=v,t.getCompanyDetails=d,t.selectedUser=void 0,t.searchUser=I,t.selectUser=C,t.setNewCompanyUser=A,t.getCompanyUsers=h,t.setCompanySales=S,t.getUserAvatarImageUrlIsAdmin=y,t.deleteUser=b,t.adminApprove=U,t.setAdmin=_,t.navToWechatAuthPage=E,t.navToFacebookAuthPage=w,t.getCompanyPickupLocations=g,t.deleteLocation=f,t.showPaidFeatureModal=T,t};angular.module("shmApp.controllers").controller("CompanyController",["$scope","UtilsService","CompanyService","UserService","WeChatService","UtilsService","$state","$auth","$window","AuthService","$rootScope","$translate",L])}(),function(){var e,t,n,a=function(t){return n.gettingCompanyByDomain=!0,n.gettingCompanyByDomainErr=void 0,e.companyService.getByDomain(t).then(function(t){n.company=t.data,e.utilsService.setWebTitle(n.company.name),e.weChatService.runWhenWXReady(function(){wx.onMenuShareAppMessage({title:n.company.name,desc:n.company.description,link:n.company.website,imgUrl:n.company.logo_img.url}),wx.onMenuShareTimeline({title:n.company.name,link:n.company.website,imgUrl:n.company.logo_img.url})})},function(e){n.gettingCompanyByDomainErr=e.data}).finally(function(){n.gettingCompanyByDomain=void 0,e.pageLoaded()}),n},i=function(){switch(e.utilsService.scrollToTop(),t.current.name){case"home":a(location.host)}return n},r=function(a,r,o,c,s,m){return e=a,t=r,e.companyService=c,e.utilsService=o,e.weChatService=s,m.data&&m.data.id&&(e.appUser=m.data),n=this,n.initPage=i,n};angular.module("shmApp.controllers").controller("HomeController",["$scope","$state","UtilsService","CompanyService","WeChatService","appUser",r])}(),function(){var e,t,n,a,i,r,o,c,s,m,u,l,p,d,g,f,h,y=[{state:"XINJIANG",cn:"æ–°ç–†ç»´å¾å°”è‡ªæ²»åŒº",country:"CHINA",suburb:""},{state:"XIZANG",cn:"è¥¿è—è‡ªæ²»åŒº",country:"CHINA",suburb:""},{state:"NEIMENG",cn:"å†…è’™å¤è‡ªæ²»åŒº",country:"CHINA",suburb:""},{state:"QINGHAI",cn:"é’æµ·çœ",country:"CHINA",suburb:""},{state:"SICHUAN",cn:"å››å·çœ",country:"CHINA",suburb:""},{state:"HEILONGJIANG",cn:"é»‘é¾™æ±Ÿçœ",country:"CHINA",suburb:""},{state:"GANSU",cn:"ç”˜è‚ƒçœ",country:"CHINA",suburb:""},{state:"YUNNAN",cn:"äº‘å—çœ",country:"CHINA",suburb:""},{state:"HUNAN",cn:"æ¹–å—çœ",country:"CHINA",suburb:""},{state:"SHANXI3",cn:"é™•è¥¿çœ",country:"CHINA",suburb:""},{state:"HEBEI",cn:"æ²³åŒ—çœ",country:"CHINA",suburb:""},{state:"JILING",cn:"å‰æž—çœ",country:"CHINA",suburb:""},{state:"HUBEI",cn:"æ¹–åŒ—çœ",country:"CHINA",suburb:""},{state:"GUANGDONG",cn:"å¹¿ä¸œçœ",country:"CHINA",suburb:""},{state:"GUIZHOU",cn:"è´µå·žçœ",country:"CHINA",suburb:""},{state:"HENAN",cn:"æ²³å—çœ",country:"CHINA",suburb:""},{state:"JIANGXI",cn:"æ±Ÿè¥¿çœ",country:"CHINA",suburb:""},{state:"SHANDONG",cn:"å±±ä¸œçœ",country:"CHINA",suburb:""},{state:"SHANXI1",cn:"å±±è¥¿çœ",country:"CHINA",suburb:""},{state:"LIAONING",cn:"è¾½å®çœ",country:"CHINA",suburb:""},{state:"ANHUI",cn:"å®‰å¾½çœ",country:"CHINA",suburb:""},{state:"FUJIAN",cn:"ç¦å»ºçœ",country:"CHINA",suburb:""},{state:"ZHEJIANG",cn:"æµ™æ±Ÿçœ",country:"CHINA",suburb:""},{state:"JIANGSU",cn:"æ±Ÿè‹çœ",country:"CHINA",suburb:""},{state:"CHONGQING",cn:"é‡åº†å¸‚",country:"CHINA",suburb:""},{state:"NINGXIA",cn:"å®å¤å›žæ—è‡ªæ²»åŒº",country:"CHINA",suburb:""},{state:"TAIWAN",cn:"å°æ¹¾çœ",country:"CHINA",suburb:""},{state:"HAINAN",cn:"æµ·å—çœ",country:"CHINA",suburb:""},{state:"BEIJING",cn:"åŒ—äº¬å¸‚",country:"CHINA",suburb:""},{state:"TIANJIN",cn:"å¤©æ´¥å¸‚",country:"CHINA",suburb:""},{state:"SHANGHAI",cn:"ä¸Šæµ·å¸‚",country:"CHINA",suburb:""},{state:"HONG KONG",cn:"é¦™æ¸¯ç‰¹åˆ«è¡Œæ”¿åŒº",country:"CHINA",suburb:""},{state:"MACAU",cn:"æ¾³é—¨ç‰¹åˆ«è¡Œæ”¿åŒº",country:"CHINA",suburb:""},{state:"VICTORIA",cn:"ç»´å¤šåˆ©äºš",country:"AUSTRALIA",suburb:"Melbourne"},{state:"NEW SOUTH WALES",cn:"æ–°å—å¨å°”æ–¯å·ž",country:"AUSTRALIA",suburb:"Sydney"},{state:"QUEENSLAND",cn:"æ˜†å£«å…°",country:"AUSTRALIA",suburb:"Brisbane"}],v={"SHOW MALL":"/app/images/community_mall.png","ITEM ADS":"/app/images/community_shopping.png","PROPERTY SELLING":"/app/images/community_house.png","HUO DONG":"/app/images/community_huodong.png","SERVICE ADS":"/app/images/community_service.png","CARS ADS":"/app/images/community_car.png","PROPERTY RENTING":"/app/images/community_rental.png","BOOK ADS":"/app/images/community_textbook.png","JOB ADS":"/app/images/community_job.png","WISH LIST":"/app/images/community_request.png","JIE LONG":"/app/images/community_jielong.png","TU CAO":"/app/images/community_tucao.png",CONSULTATION:"/app/images/community_consultation.png","VOUCHER GROUP":"/app/images/voucher_community_logo.jpeg","VOUCHER CAMPAIGN":"/app/images/voucher_community_logo.jpeg"},I=[{order:1,name:"JIE LONG",isPaidFeature:!0},{order:2,name:"CONSULTATION",isPaidFeature:!0},{order:3,name:"ITEM ADS",isPaidFeature:!1},{order:4,name:"WISH LIST",isPaidFeature:!1},{order:5,name:"PROPERTY SELLING",isPaidFeature:!1},{order:6,name:"PROPERTY RENTING",isPaidFeature:!1},{order:7,name:"SERVICE ADS",isPaidFeature:!1},{order:8,name:"CARS ADS",isPaidFeature:!1},{order:9,name:"JOB ADS",isPaidFeature:!1},{order:10,name:"HUO DONG",isPaidFeature:!1},{order:11,name:"SHOW MALL",isPaidFeature:!1},{order:12,name:"VOUCHER GROUP",isPaidFeature:!0},{order:13,name:"VOUCHER CAMPAIGN",isPaidFeature:!0}],C={voucher_group:"App\\Modules\\Platform\\Models\\CompanyVoucherGroup",voucher_campaign:"App\\Modules\\Platform\\Models\\VoucherCampaign"},A=function(e,n){return t.gettingSellerInfo=!0,t.gettingSellerInfoErr=void 0,a.getUser(e).then(function(e){t.seller=e.data,"function"==typeof n&&n(t.seller)},function(e){t.gettingSellerInfoErr=e.data}).finally(function(){t.gettingSellerInfo=!1}),t},S=function(a){var i={};return i.pageNo=a||1,1===i.pageNo?(t.gettingItems=!0,t.gettingItemsErr=void 0):(t.gettingMoreItems=!0,t.gettingMoreItemsErr=void 0),i.params=t.itemSearchStatus,i.params.page=i.pageNo,n.getItemsForASeller(t.seller.id,i.params).then(function(e){i.pageNo>1&&(i.previousData=t.itemList.data),t.itemList=e.data,i.pageNo>1&&(t.itemList.data=i.previousData.concat(t.itemList.data)),t.itemList.hasMore=t.itemList.current_page<t.itemList.last_page},function(n){i.pageNo>1?t.gettingItemsErr=n.data:t.gettingMoreItemsErr=n.data,1===i.pageNo&&e.setPageLoadingErr(t.gettingItemsErr)}).finally(function(){
    t.gettingItems=!1,t.gettingMoreItems=!1,e.pageLoaded()}),t},b=function(e){return n.getRentSuburbs(e).then(function(e){return e.data})},U=function(e){var a={};return a.pageNo=e||1,a.params={"key-word":t.searchKeyWord,"order-by":t.searchItemOrderBy,page:a.pageNo,state:t.state,country:t.country},t.urlHouseFilter&&(a.params=Object.assign(a.params,t.urlHouseFilter)),t.isincludeJielong&&(a.params.isincludeJielong=t.isincludeJielong),t.itemSearchStatus&&(a.params.published=t.itemSearchStatus.published,a.params.expired=t.itemSearchStatus.expired,a.params.sold=t.itemSearchStatus.sold),t.searchByPreDefinedTags&&(a.params.tags=t.searchByPreDefinedTags),t.searchingItems=!0,a.func=t.predefinedTagId?n.searchItemsUnderCommunity(t.predefinedTagId,a.params):n.searchItems(a.params),a.func.then(function(e){1!==a.pageNo&&(a.previousData=t.itemList.data),t.itemList=e.data,1!==a.pageNo&&(t.itemList.data=a.previousData.concat(t.itemList.data)),t.itemList.hasMore=t.itemList.current_page<t.itemList.last_page,"mixAuth.communityItemSearch"===o.current.name&&s.localStorage.setItem("oldSearchData",JSON.stringify(t))},function(e){t.searchItemErr=e.data}).finally(function(){t.searchingItems=!1}),t},E=function(e){var a={};return a.pageNo=e||1,a.params={"key-word":t.searchKeyWord,"order-by":t.searchItemOrderBy,page:a.pageNo,"page-size":9},t.itemSearchStatus&&(a.params.published=t.itemSearchStatus.published,a.params.expired=t.itemSearchStatus.expired,a.params.sold=t.itemSearchStatus.sold,a.params.is_draft=!1),1===a.pageNo?(t.searchingItems=!0,t.searchingItemsErr=void 0):(t.searchingMoreItems=!0,t.searchingMoreItemsErr=void 0),n.searchItemsUnderCompany(t.companyId,a.params).then(function(e){a.pageNo>1&&(a.previousData=t.itemList.data),t.itemList=e.data,a.pageNo>1&&(t.itemList.data=a.previousData.concat(t.itemList.data)),t.itemList.hasMore=t.itemList.current_page<t.itemList.last_page},function(e){1===a.pageNo?t.searchItemErr=e.data:t.searchingMoreItemsErr=e.data}).finally(function(){t.searchingItems=!1,t.searchingMoreItems=!1}),t},w=function(a,i){return t.gettingItemDetails=!0,t.gettingItemDetailsErr=void 0,n.getItemDetails(a).then(function(n){if(t.currentItem=n.data,t.currentItem.price=!0===t.currentItem.online_payment?parseFloat(t.currentItem.price):t.currentItem.price,t.online_payment_flag=!0===t.currentItem.online_payment,t.notConvertableToMeiPianStyleHtml=!e.utilsService.isConvertableToMeiPianStyleHtml(t.currentItem.description),t.useSimpleEditor=!0!==t.notConvertableToMeiPianStyleHtml,t.currentItem.sliderImgArray=e.utilsService.getImgArray(t.currentItem.images_in_diff_sizes,"MID"),t.currentItem.isJielong=!(!t.currentItem.type||!t.currentItem.type.name||"Jie Long"!==t.currentItem.type.name),t.currentItem.is_notify_user=!!t.currentItem.isJielong,t.currentItem.notify_seller_when_jielong_in=!(!t.currentItem.isJielong||!t.currentItem.notify_seller_when_jielong_in),t.getSellerInfo(t.currentItem.seller_id),t.currentItem.config){var a=JSON.parse(t.currentItem.config);t.writer=a&&a.writer?a.writer:"",t.ifShowCompanyContact=!(!a||!a.ifShowCompanyContact)&&a.ifShowCompanyContact}"PROPERTY RENTING"==t.currentItem.predefinedTags[1]&&(t.currentItem.suburb=a.suburb,t.currentItem.rent=a.amount_range,t.currentItem.type=a.rent_type,t.currentItem.gender=a.gender_prefer,t.currentItem.bedroom=a.bed_num,t.currentItem.bathroom=a.bath_num,t.currentItem.car=a.park_num,t.currentItem.pet=a.allow_pet,t.currentItem.propertyType=a.property_type),t.currentItem.isSameCompany=!1,e.appUser&&t.currentItem.company&&t.currentItem.company.id&&(t.currentItem.isSameCompany=e.utilsService.adminOfCompany(e.appUser.adminOfCompanyIds,t.currentItem.company_id,e.appUser.is_admin)),t.currentItem.isSellerItem=e.appUser&&e.appUser.id===t.currentItem.seller_id,t.currentItem.isCompanyAdminItem=e.appUser&&_.contains(e.appUser.adminOfCompanyIds,t.currentItem.company_id),"function"==typeof i&&i(t.currentItem)},function(e){t.gettingItemDetailsErr=e.data}).finally(function(){t.gettingItemDetails=!1,e.pageLoaded()}),t},T=function(a,i){if(t.currentItem.is_draft=i,!t.currentItem.is_draft&&(a.$submitted=!0,!0===a.$invalid))return t;if(t.currentItem.company_id&&t.valiItem&&t.valiItem.company_upp_limit&&t.valiItem.company_upp_limit<=t.valiItem.total_items)return a.$invalid=!0,t;if(!0===a.$invalid)return t;if(t.currentItem.predefinedTags&&angular.forEach(t.currentItem.predefinedTags,function(e){t.currentItem.tagNames||(t.currentItem.tagNames=[]),0!=e&&t.currentItem.tagNames.push(e)}),t.currentItem.date_expiry=moment(moment(t.currentItem.date_expiry_local)).utc().format("YYYY-MM-DD HH:mm:ss"),t.currentItem.date_publish=moment(moment(t.currentItem.date_publish_local)).utc().format("YYYY-MM-DD HH:mm:ss"),t.currentItem.state_redirect_obj=t.currentStateObj,t.currentItem.wechat_auth_url=e.weChatService.getAuthPageUrl(),!t.currentItem.is_in_cn&&t.googleAddressObj&&(t.currentItem.address=e.utilsService.mapGoogleMapToAddressObj(t.googleAddressObj)),t.ifShowAvatar=!!t.ifShowAvatar&&t.ifShowAvatar,t.participator_name=!!t.participator_name&&t.participator_name,t.participator_phone=!!t.participator_phone&&t.participator_phone,t.participator_email=!!t.participator_email&&t.participator_email,t.participator_address=!!t.participator_address&&t.participator_address,t.participator_company=!!t.participator_company&&t.participator_company,t.ifUseSignupTpl=!!t.ifUseSignupTpl&&t.ifUseSignupTpl,t.ifShowCompanyContact=t.ifShowCompanyContact,"JIE LONG"==t.currentItem.predefinedTags[1]&&(t.currentItem.jielong_success_entities_name=t.jielongVoucherEntityMap.voucher_group,t.currentItem.wxshare_success_entities_name=t.jielongVoucherEntityMap.voucher_group,t.currentItem.jielong_wxshare_success_entities_name=t.jielongVoucherEntityMap.voucher_group,t.currentItem.jielong_success_entities&&t.currentItem.jielong_success_entities[0]&&(t.currentItem.jielong_success_entities[0]={entity_name:t.currentItem.jielong_success_entities_name,entity_id:t.currentItem.jielong_success_entities[0].id}),t.currentItem.wxshare_success_entities&&t.currentItem.wxshare_success_entities[0]&&(t.currentItem.wxshare_success_entities[0]={entity_name:t.currentItem.wxshare_success_entities_name,entity_id:t.currentItem.wxshare_success_entities[0].id}),t.currentItem.jielong_wxshare_success_entities&&t.currentItem.jielong_wxshare_success_entities[0]&&(t.currentItem.jielong_wxshare_success_entities[0]={entity_name:t.currentItem.jielong_wxshare_success_entities_name,entity_id:t.currentItem.jielong_wxshare_success_entities[0].id})),"PROPERTY RENTING"==t.currentItem.predefinedTags[1]){t.currentItem.suburb=t.currentItem.suburb?t.currentItem.suburb:"",t.currentItem.rent=t.currentItem.rent?t.currentItem.rent:"",t.currentItem.type=t.currentItem.type?t.currentItem.type:"",t.currentItem.gender=t.currentItem.gender?t.currentItem.gender:"",t.currentItem.bedroom=t.currentItem.bedroom?t.currentItem.bedroom:"",t.currentItem.bathroom=t.currentItem.bathroom?t.currentItem.bathroom:"",t.currentItem.car=t.currentItem.car?t.currentItem.car:"",t.currentItem.pet=t.currentItem.pet?t.currentItem.pet:"",t.currentItem.propertyType=t.currentItem.propertyType?t.currentItem.propertyType:"";var r={ifShowAvatar:t.ifShowAvatar,writer:t.writer,name:t.participator_name,phone:t.participator_phone,email:t.participator_email,address:t.participator_address,company:t.participator_company,ifUseSignupTpl:t.ifUseSignupTpl,ifHideCheckinNumber:t.ifHideCheckinNumber,suburb:t.currentItem.suburb,amount_range:t.currentItem.rent,rent_type:t.currentItem.type,gender_prefer:t.currentItem.gender,bed_num:t.currentItem.bedroom,bath_num:t.currentItem.bathroom,park_num:t.currentItem.car,allow_pet:t.currentItem.pet,property_type:t.currentItem.propertyType}}else var r={ifShowAvatar:t.ifShowAvatar,writer:t.writer,name:t.participator_name,phone:t.participator_phone,email:t.participator_email,address:t.participator_address,company:t.participator_company,ifUseSignupTpl:t.ifUseSignupTpl,ifHideCheckinNumber:t.ifHideCheckinNumber,ifShowCompanyContact:t.ifShowCompanyContact};var c={};if(t.currentItem.item_url=o.href("mixAuth.itemDetails",{itemId:t.currentItem.id},{absolute:!0}),t.currentItem.children&&t.currentItem.children.length>0){var m=[];angular.forEach(t.currentItem.children,function(e,t){var n={order:t};n.origPrice=e.origPrice>0?e.origPrice:"";var a=e.origPrice>0?(e.origPrice-e.price)/e.origPrice:"";m.push(a),e.config=JSON.stringify(n)});var u=_.max(m,function(e){return e});r.max_discount=u?u.toFixed(2):""}return t.currentItem.config=JSON.stringify(r),c.savingItemFunc=t.currentItem.id?n.updateItem(t.currentItem.id,t.currentItem):n.createItem(t.currentItem),t.savingItem=!0,t.savingItemErr=void 0,c.savingItemFunc.then(function(n){if(n.data.auth_url)return void(s.location.href=n.data.auth_url);o.go("mixAuth.itemDetails",{itemId:n.data.id},{reload:!0}),t.clearTmpItemDetails(),e.appUser.id&&void 0!==e.appUser.wechat_is_subscriber&&1!==parseInt(e.appUser.wechat_is_subscriber)&&e.utilsService.displaySubscribeModal()},function(n){t.savingItemErr=n.data,e.utilsService.scrollTo("saving-item-err")}).finally(function(){t.savingItem=!1}),t},L=function(n){var a={};return t.itemCommentsList&&t.itemCommentsList.data||(t.itemCommentsList.data=[]),""==n.parent_id?(t.itemCommentsList.data.unshift(n),t.itemCommentsList.total=1*t.itemCommentsList.total+1,e.utilsService.scrollTo("comments-list")):(angular.forEach(t.itemCommentsList.data,function(e,i){e.id===n.root_id&&(t.itemCommentsList.data[i].replys||(t.itemCommentsList.data[i].replys=[]),a.index=i,t.itemCommentsList.data[i].replys.unshift(n))}),a.index&&a.index>0&&t.itemCommentsList.data.splice(0,0,t.itemCommentsList.data.splice(a.index,1)[0]),e.utilsService.scrollTo("item-comment-"+n.root_id)),t},M=function(e){var n={};n.isUpdateComment=!1,t.getItemDetails(e.item_id),e&&e.totalQuantity&&(t.itemCommentsList.totalQuantity=e.totalQuantity,t.itemCommentsList.totalIsReceived=e.totalIsReceived),angular.forEach(t.itemCommentsList.data,function(a,i){a.id===e.id&&(t.itemCommentsList.data[i].quantity=e.quantity,t.itemCommentsList.data[i].updated_at=e.updated_at,t.itemCommentsList.data[i].comments=e.comments,n.isUpdateComment=!0)}),!1===n.isUpdateComment&&t.itemCommentsList.data.push(e),t.itemCommentsList.currentUserJieLong=e},D=function(e){var a={};return a.pageNo=e||1,t.gettingItemCommentsErr=void 0,t.gettingMoreItemCommentsErr=void 0,1===a.pageNo?t.gettingItemComments=!0:t.gettingMoreItemComments=!0,n.getCommentsForAnItem(o.params.itemId,{page:a.pageNo}).then(function(e){1!==a.pageNo&&(a.previousData=t.itemCommentsList.data),t.itemCommentsList=e.data,1!==a.pageNo&&(t.itemCommentsList.data=a.previousData.concat(t.itemCommentsList.data)),t.itemCommentsList.hasMore=t.itemCommentsList.current_page<t.itemCommentsList.last_page},function(e){1===a.pageNo?t.gettingItemCommentsErr=e.data:t.gettingMoreItemCommentsErr=e.data}).finally(function(){t.gettingItemComments=!1,t.gettingMoreItemComments=!1,t.itemCommentsList.sum=t.itemCommentsList.totalQuantity,t.itemCommentsList.isReceivedSum=t.itemCommentsList.totalIsReceived}),t},k=function(){n.getIsInJielong(t.itemId).then(function(e){e.data.currentUserJieLong?(t.isInJielong=!0,t.currentUserJieLong=e.data.currentUserJieLong,de(t.currentUserJieLong),t.remainingChkInQty=t.currentUserJieLong.quantity-t.currentUserJieLong.checkinNum,t.jieLongCheckinQuantity=t.remainingChkInQty):t.isInJielong=!1},function(e){t.gettingIsinJielongErr=e.data}).finally(function(){})},P=function(){var e=t.currentUserJieLong.id;t.updatingJieLongReceived=!0,t.JielongCheckinSucc=!1,n.addCommentToAnItem(t.itemId,{quantity:t.jieLongCheckinQuantity,comments:t.jieLongCheckinComments,item_url:o.href("mixAuth.itemDetails",{itemId:t.itemId},{absolute:!0}),reply_to_comment_id:e,is_private:0}).then(function(e){t.updatingJieLongReceived=!1,t.JielongCheckinSucc=!0},function(e){t.JielongCheckinSucc=!1,t.updatingJieLongReceivedErr=e.data}).finally(function(){})},R=function(e,a){t.deactivatingJielong=!0,n.setCommentsDeactivate(e,{item_url:o.href("mixAuth.itemDetails",{itemId:a},{absolute:!0})}).then(function(e){t.getItemComments()},function(e){t.deactivateCommentErr=e.data}).finally(function(){t.deactivatingJielong=!1})},N=function(e){switch(t.itemListType=e||0,t.itemSearchStatus={published:1,draft:0},parseInt(t.itemListType)){case 1:t.itemSearchStatus={expired:1,sold:0};break;case 2:t.itemSearchStatus={expired:0,sold:1};break;case 3:t.itemSearchStatus={published:0,expired:0,sold:0};break;case 4:t.itemSearchStatus={published:1,expired:0,sold:0,draft:1}}},O=function(e,n){var a={};return a.newOrderBy={},t.searchItemOrderBy[e]&&"asc"==t.searchItemOrderBy[e]?a.newOrderBy[e]="desc":a.newOrderBy[e]="asc",t.searchItemOrderBy=a.newOrderBy,!0===n?t.searchItemsUnderCompany():t.searchItemsUnderCommunity(),t},x=function(n){if(!0===e.weChatService.openedInWeChat()){var a={};a.index=n||0,a.imgs=[],angular.forEach(t.currentItem.images,function(e){a.imgs.push(e.url)}),WeixinJSBridge.invoke("imagePreview",{current:a.imgs[a.index],urls:a.imgs})}else window.open(t.currentItem.images[n].url)},$=function(t,n){if(!0===e.weChatService.openedInWeChat()){var a={};a.index=n||0,a.imgs=[],angular.forEach(t.midImages,function(e){a.imgs.push(e.url)}),WeixinJSBridge.invoke("imagePreview",{current:a.imgs[a.index],urls:a.imgs})}else window.open(t.origImages[n].url)},G=function(e){return t.currentItem.images[e]&&t.currentItem.images.splice(e,1),t},W=function(e){return t.gettingPredefinedTags=!0,t.gettingPredefinedTagsErr=void 0,n.getPredefinedTags().then(function(n){t.predefinedTagsMap=n.data,angular.forEach(t.predefinedTagsMap,function(e,n){e&&e.type&&"Item Condition"===e.type.name&&(t.conditionTagMap=e),e&&e.type&&"Item Type"===e.type.name&&(t.typeTagMap=e)}),"function"==typeof e&&e(n.data)},function(e){t.gettingPredefinedTagsErr=e.data}).finally(function(){t.gettingPredefinedTags=!1}),t},B=function(){return t.gettingAllCompanies=!0,t.gettingAllCompaniesErr=void 0,r.getAllCompanies().then(function(e){t.allCompaniesMap=e.data},function(e){t.gettingAllCompaniesErr=e.data}).finally(function(){t.gettingAllCompanies=!1}),t},F=function(e,n){return t.searchByPreDefinedTags||(t.searchByPreDefinedTags={}),t.searchByPreDefinedTags[e]=n,t.searchItemsUnderCommunity(),t},V=function(e){return t.itemSearchStatus=void 0,t.typeId=e,void 0!=e&&t.changeItemListType(e),t.searchItemsUnderCommunity(),t},j=function(n){var a={};return a.pageNo=n||1,1===a.pageNo&&e.utilsService.scrollToTop(),t.itemSearchStatus=void 0,t.typeId=t.searchTypeId,void 0!==t.typeId&&t.changeItemListType(t.typeId),t.searchItemsUnderCompany(a.pageNo),t},J=function(){var e={};return e.maxTitleLength=100,""!=t.currentItem.title&&void 0!=t.currentItem.title&&t.currentItem.title.length>e.maxTitleLength&&(""==t.currentItem.description||void 0==t.currentItem.description)&&(t.currentItem.description="<p>"+t.currentItem.title+"</p>",t.firstTextInMeiPianStyle=t.currentItem.title,t.currentItem.title=t.currentItem.title.substring(0,e.maxTitleLength)),t},H=function(){t.titleLength=t.currentItem.title?t.currentItem.title.length:0},Y=function(){return y},z=function(e){e&&(t.currentItem.address={},t.currentItem.address.suburb=e.suburb?e.suburb:"",t.currentItem.address.state=e.state?e.state:"",t.currentItem.address.country=e.country?e.country:"",t.currentItem.address.postcode="",t.currentItem.address.street="")},Q=function(a){var i={};return i.page=a||1,1===i.page?(t.gettingItems=!0,t.gettingItemsErr=void 0):(t.gettingMoreItems=!0,t.gettingMoreItemsErr=void 0),n.getMyHistory({page:a||1,"page-size":20}).then(function(n){n.data&&n.data.auth_url?e.weChatService.loginAndRedirect(o.current):(i.page>1&&(i.previousData=t.historyItems.data),t.historyItems=n.data,i.page>1&&(t.historyItems.data=i.previousData.concat(t.historyItems.data)),t.historyItems.data=q(t.historyItems.data,"id"))},function(e){1===i.page?t.gettingItemsErr=e.data:t.gettingMoreItemsErr=e.data}).finally(function(){t.gettingItems=!1,t.gettingMoreItems=!1}),t},q=function(e,t){var n=[],a={};for(var i in e)a[e[i][t]]=e[i];for(i in a)n.push(a[i]);return n},K=function(e){t.sliderIndex=e.element.currentSlide},X=function(e,t,n){o.go("mixAuth.communityItemSearch",{keyWord:e,state:t,country:n},{reload:!0})},Z=function(){!0===t.currentItem.is_company&&e.appUser&&e.appUser.userCompany&&e.appUser.userCompany.length>0&&(t.currentItem.company_id=e.appUser.userCompany[0].id,t.checkIfItemUppLimit())},ee=function(){t.currentItem.company_id&&r.getCompanyDetails(t.currentItem.company_id).then(function(e){var n=e.data;if(n.admin_config){var a=JSON.parse(n.admin_config);t.ifOnlinePayment=a.ifOnlinePayment,t.ifShowNotifySeller=a.notify_seller_when_jielong_in}if(n.config){var i=JSON.parse(n.config);t.ifShowAvatarSwitch=i.ifShowAvatar}},function(e){})},te=function(){t.currentItem.company_id=null},ne=function(){d(function(){t.currentItem&&s.localStorage.setItem("tmpItemJson",JSON.stringify(t.currentItem))},1e3)},ae=function(){t.writer&&s.localStorage.setItem("writer",JSON.stringify(t.writer))},ie=function(){t.currentItem.price=null,t.online_payment_flag=!0},re=function(){t.online_payment_flag=!1},oe=function(){n.checkIfComanyUpperTheItemLimit(t.currentItem.company_id).then(function(e){t.valiItem=e.data},function(e){})},ce=function(){t.currentItem.online_payment=!1},se=function(){s.localStorage.removeItem("tmpItemJson")},me=function(){t.currentItem=t.tmpItem,t.writer=t.tmpWriter},ue=function(){n.getPropertyTypes().then(function(e){t.propertyTypes=e.data},function(e){t.errLoadingPropertyTypes=e.data})},le=function(){o.go("mixAuth.itemDetails",{itemId:o.params.itemId},{reload:!0,inherit:!1})},pe=function(a){t.voucherDetailsLoaded=!1,t.voucherDetailsFailed=!1,n.getVoucherDetails(a).then(function(n){var a=n.data;if(t.voucherDetail=a,t.isDiscountVoucher=!!(t.voucherDetail&&t.voucherDetail.entityName&&t.voucherDetail.entityName.includes("CompanyVoucherGroup")),t.isDiscountVoucher){if(!h.adminOfCompany(e.appUser.adminOfCompanyIds,t.voucherDetail.entity.company_id,e.appUser.is_admin))return void o.go("mixAuth.companyVoucherReleased",{voucherGroupId:t.voucherDetail.entityId,showShareTips:!1},{reload:!0})}if(a.jielong&&a.jielong.id){var i=a.jielong.item;i.company_id&&i.company&&(t.companyInfor=i.company);var r=i.company&&i.company.id,c=r&&_.findLastIndex(e.appUser.userCompany,{id:i.company.id})>=0,s=!0===e.appUser.is_admin||e.appUser.id===i.created_by_id;if(r&&!c&&!s||!r&&!s)return void o.go("mixAuth.itemDetails",{itemId:a.jielong.item.id},{reload:!0});t.voucherDetailsLoaded=!0,de(t.voucherDetail.jielong),t.itemFirstImgUrl=t.voucherDetail.jielong.item.images_in_diff_sizes.smallImages.length>0?Object.values(t.voucherDetail.jielong.item.images_in_diff_sizes.smallImages)[0].url:""}else a.companyVoucherGroup&&(t.voucherDetailsLoaded=!0)},function(e){t.gettingVoucherErr=e.data,t.voucherDetailsFailed=!0})},de=function(e){if(e.children.length>0){var t=0;e.children.forEach(function(e){e.price=e.quantity*e.item.price,t+=e.price}),e.totalPrice=t}0===e.children.length&&(e.totalPrice=scope.item.price*e.quantity)},ge=function(e,a,i,r){if(!0===confirm(f.instant("ITEM.PAGE.DETAILS.COMMENTS.JIELONG.VOUCHER.CHECKIN.CONFIRM.AGAIN"))){(!0===i?n.checkinVoucherWithSubItems(e,{item_url:o.href("mixAuth.jieLongResult",{itemId:a},{absolute:!0}),comments:r}):n.checkinVoucher(e,{item_url:o.href("mixAuth.jieLongResult",{itemId:a},{absolute:!0}),comments:r})).then(function(e){t.isCheckedVoucher=!0},function(e){t.gettingVoucherErr=e.data,t.voucherDetailsFailed=!0})}},fe=function(e){s.localStorage.setItem("showManagSection",JSON.stringify(e))},he=function(e){return t.gettingCompanyDetails=!0,r.getCompanyDetails(e).then(function(e){if(t.currentCompany=e.data,t.currentCompany.config){var n=JSON.parse(t.currentCompany.config);t.filterOfItemsDisplay=n.filterOfItemsDisplay}else t.filterOfItemsDisplay=!1},function(e){t.gettingCompanyDetailsErr=e.data}).finally(function(){t.gettingCompanyDetails=!1}),t},ye=function(n,a){if(t.checkIfUserCanAccessFeatureItem(t.tagArrayInCreation[n].name,a),e.isPaidFeature&&e.accessibleCompanies.length>0&&!t.currentItem.company_id&&(t.currentItem.is_company=!0,t.currentItem.company_id=e.accessibleCompanies[0].id),"mixAuth.itemCreate"===o.current.name){var i=e.translate.instant("CREATE"),r=f.instant(t.tagArrayInCreation[n].name),c=o.href(o.current.name,{communityName:t.tagArrayInCreation[n].name},{absolute:!0}),s=e.utilsService.getAppAbsUrlRoot()+t.tagMapArray[t.tagArrayInCreation[n].name];e.weChatService.runWhenWXReady(function(){wx.onMenuShareAppMessage({title:i,desc:r,link:c,imgUrl:s}),wx.onMenuShareTimeline({title:i,link:c,imgUrl:s})})}},ve=function(){t.currentItem.predefinedTags[t.typeTagMap.type.const]=0},Ie=function(){!1===t.ifExtraUserInfor&&(t.participator_name=!1,t.participator_phone=!1,t.participator_email=!1,t.participator_address=!1,t.participator_company=!1)},Ce=function(e){e.children&&e.children.length>0?(e.isEditable=!0,angular.forEach(e.children,function(t){t.isEditable=!(t.totalNum>0),t.totalNum>0&&(e.isEditable=!1)})):e.isEditable=!(e.totalQuantity>0)},Ae=function(n,a){a&&a.id&&(e.accessibleCompanies=e.utilsService.getAccessibleCompanies(n,t.tagArrayInCreation,a)),e.isPaidFeature=_.findWhere(t.tagArrayInCreation,{name:n})?_.findWhere(t.tagArrayInCreation,{name:n}).isPaidFeature:void 0,e.accessibleCompanies&&e.accessibleCompanies.length>0||a&&a.id&&a.is_admin||!1===e.isPaidFeature?t.currentItem.predefinedTags[t.typeTagMap.type.const]=n:(e.utilsService.displaySubscribeModal("PAID FEATURE"),t.currentItem.predefinedTags[t.typeTagMap.type.const]="0")},Se=function(){t.currentItem.jielong_success_entities=[],t.currentItem.wxshare_success_entities=[]},_e=function(){if(e.globalData.preventExecution){var c=JSON.parse(s.localStorage.getItem("oldSearchData"),!0);if(c)return angular.forEach(c,function(e,n){t[n]=e}),t.searchingItems=!1,void e.utilsService.scrollToWithOffset(e.globalData.itemId,150)}e.utilsService.scrollToTop();var m={};switch(t.currentStateObj=o.current,t.currentStateObj.params=o.params,t.dateNow=moment().format(),t.dateMax=moment().add(1,"years"),e.pageLoading(),void 0===e.initUrl&&(e.initUrl=document.location.href.split("#")[0]),o.current.name){case"mixAuth.itemList":l.isAuthenticated()||!0===e.weChatService.openedInWeChat()&&e.weChatService.loginAndRedirect(o.current),o.params.userId?(m.sellerId=o.params.userId,t.getSellerInfo(m.sellerId,function(n){e.utilsService.setWebTitle("ShowMine - "+e.translate.instant("ITEM.PAGE.LIST.SELLER.TITLE",{seller_name:n.nick_name})),e.utilsService.setWebDescription(e.translate.instant("ITEM.PAGE.LIST.SELLER.TITLE",{seller_name:n.nick_name})),t.changeItemListType(o.params.typeId),t.getItemsForASeller(),t.sellerImgSrc=e.utilsService.getUserAvatarImageUrl(n),t.sellerTitle=e.translate.instant("ITEM.PAGE.LIST.SELLER.TITLE",{seller_name:n.nick_name}),t.listUrl=o.href(o.current.name,{userId:o.params.userId,typeId:o.params.typeId},{absolute:!0}),e.weChatService.runWhenWXReady(function(){wx.onMenuShareAppMessage({title:t.sellerTitle,desc:t.sellerTitle,link:t.listUrl,imgUrl:t.sellerImgSrc}),wx.onMenuShareTimeline({title:t.sellerTitle,link:t.listUrl,imgUrl:t.sellerImgSrc})})})):e.appUser&&e.appUser.id?o.go(o.current.name,{userId:e.appUser.id},{reload:!0}):(l.isAuthenticated()&&l.logout(),o.go("auth.login",{},{reload:!0}));break;case"mixAuth.itemCreate":l.isAuthenticated()||!0===e.weChatService.openedInWeChat()&&e.weChatService.loginAndRedirect(o.current),t.titleLength=0,t.consultation=n.returnConsultation(),t.creatingItem=!0,t.useSimpleEditor=!1,t.isShowDetails=!1,t.pageUrl=o.href(o.current.name,{},{absolute:!0}),t.isSubitemsMode=!0,t.hideSubProductSwitch=!0,t.ifShowCompanyContact=!0,t.hideTypeSelection=function(){t.isShowItemTypeSelector=!1},e.weChatService.openInIphone()&&(t.pageUrl=e.initUrl),t.currentItem={date_expiry_local:moment().add(6,"months"),date_publish_local:moment(),tagNames:[],special_tags:[],images:[],predefinedTags:{},is_sync_to_market:!0,multi_participations:!1,online_payment:!1,notify_seller_when_jielong_in:!0,children:[{}]},e.appUser&&e.appUser.userCompany&&e.appUser.userCompany.length>0&&(t.currentItem.is_company=!0,t.currentItem.company_id=e.appUser.userCompany[0].id),t.currentItem.company_id&&(t.checkIfItemUppLimit(),t.checkIfCompanyCanOpenOnlinePaymentAndShowAvatarAndNotifySeller()),t.ifSHowVoucherCreate=!!(e.appUser&&e.appUser.adminOfCompanyIds&&e.appUser.adminOfCompanyIds.length>0||e.appUser&&e.appUser.is_admin&&!0===e.appUser.is_admin),t.showVoucherContactModal=!1;var p=s.localStorage.getItem("tmpItemJson"),d=s.localStorage.getItem("writer");p&&(t.tmpItem=JSON.parse(p)),d&&(t.tmpWriter=JSON.parse(d)),e.appUser&&e.appUser.is_admin&&B(),W(function(n){angular.forEach(n,function(n,a){o.params.communityName&&n&&n.type&&"Item Type"===n.type.name?t.checkIfUserCanAccessFeatureItem(o.params.communityName,e.appUser):t.currentItem.predefinedTags[a]="0"})}),ue();var f=u.getItem("appUser_state_and_country");t.currentItem.address={suburb:"",state:f&&f.state?f.state:"Victoria",country:f&&f.country?f.country:"Australia"},n.getIsFromChina().then(function(n){n.data.is_from?(t.currentItem.is_in_cn=!0,t.currentItem.address=_.filter(y,function(e){return-1!==e.state.indexOf(t.currentItem.address.state.toUpperCase())})[0]):(t.currentItem.is_in_cn=!1,t.googleAddressObj=e.utilsService.buildGooglePlacesResult(t.currentItem.address),t.addressString=t.googleAddressObj.formatted_address)}),t.ifAddChildren=!1;var h=e.translate.instant("CREATE"),I=t.communityTitle,C=o.href(o.current.name,o.current.params,{absolute:!0}),A=t.communityImgSrc?t.communityImgSrc:e.utilsService.getAppAbsUrlRoot()+"/app/images/logo.png";e.weChatService.runWhenWXReady(function(){wx.onMenuShareAppMessage({title:h,desc:I,link:C,imgUrl:A}),wx.onMenuShareTimeline({title:h,link:C,imgUrl:A})}),e.utilsService.setWebTitle("ShowMine - "+e.translate.instant("ITEM.PAGE.CREATE.TITLE")),e.utilsService.setWebDescription(e.translate.instant("ITEM.PAGE.CREATE.DESCRIPTION")),e.pageLoaded();break;case"mixAuth.itemEdit":t.useSimpleEditor=!1,t.isEditMode=!0,l.isAuthenticated()||!0===e.weChatService.openedInWeChat()&&e.weChatService.loginAndRedirect(o.current),t.ifAddChildren=!0,t.consultation=n.returnConsultation(),t.pageUrl=o.href(o.current.name,{},{absolute:!0}),e.weChatService.openInIphone()&&(t.pageUrl=e.initUrl),e.appUser&&e.appUser.is_admin&&B(),W(),t.getItemDetails(o.params.itemId,function(a){if(a.jielong_success_entities&&a.jielong_success_entities.length>0){var i=a.jielong_success_entities[0].entity;t.currentItem.jielong_success_entities_name=a.jielong_success_entities[0].entity_name,t.currentItem.jielong_success_entities=[],t.currentItem.jielong_success_entities.push(i)}if(a.wxshare_success_entities&&a.wxshare_success_entities.length>0){var i=a.wxshare_success_entities[0].entity;t.currentItem.wxshare_success_entities_name=a.wxshare_success_entities[0].entity_name,t.currentItem.wxshare_success_entities=[],t.currentItem.wxshare_success_entities.push(i)}if(a.jielong_wxshare_success_entities&&a.jielong_wxshare_success_entities.length>0){var i=a.jielong_wxshare_success_entities[0].entity;t.currentItem.jielong_wxshare_success_entities_name=a.jielong_wxshare_success_entities[0].entity_name,t.currentItem.jielong_wxshare_success_entities=[],t.currentItem.jielong_wxshare_success_entities.push(i)}if(e.appUser&&e.appUser.id){var r=a.predefinedTags[1];e.accessibleCompanies=e.utilsService.getAccessibleCompanies(r,t.tagArrayInCreation,e.appUser),e.isPaidFeature=_.findWhere(t.tagArrayInCreation,{name:r})?_.findWhere(t.tagArrayInCreation,{name:r}).isPaidFeature:void 0}var c=!(!e.appUser||!e.appUser.is_admin);if(t.currentItem.isSellerItem||t.currentItem.isCompanyAdminItem||c||o.go("mixAuth.itemDetails",{itemId:a.id},{reload:!0}),0===a.active&&o.go("mixAuth.itemDetails",{itemId:a.id},{reload:!0}),n.getIsFromChina().then(function(n){ue();var a=s.localStorage.getItem("tmpItemJson");if(a){var i=JSON.parse(a);t.tmpItem=i.id===t.currentItem.id?i:void 0}n.data.is_from?t.currentItem.is_in_cn=!0:(t.currentItem.is_in_cn=!1,t.googleAddressObj=e.utilsService.buildGooglePlacesResult(t.currentItem.address),t.addressString=t.googleAddressObj.formatted_address)}),t.currentItem.title&&(t.titleLength=t.currentItem.title.length),1==t.currentItem.isJielong&&Ce(t.currentItem),t.currentItem.company_id&&(t.currentItem.is_company=!0,t.checkIfItemUppLimit(),t.checkIfCompanyCanOpenOnlinePaymentAndShowAvatarAndNotifySeller(),t.currentItem.config)){var m=JSON.parse(t.currentItem.config);t.ifShowAvatar=!(!m||!m.ifShowAvatar)&&m.ifShowAvatar,t.ifHideCheckinNumber=!(!m||!m.ifHideCheckinNumber)&&m.ifHideCheckinNumber,t.participator_name=!(!m||!m.name)&&m.name,t.participator_phone=!(!m||!m.phone)&&m.phone,t.participator_email=!(!m||!m.email)&&m.email,t.participator_address=!(!m||!m.address)&&m.address,t.participator_company=!(!m||!m.company)&&m.company}if(t.currentItem.config){var m=JSON.parse(t.currentItem.config);t.participator_name=!(!m||!m.name)&&m.name,t.participator_phone=!(!m||!m.phone)&&m.phone,t.participator_email=!(!m||!m.email)&&m.email,t.participator_address=!(!m||!m.address)&&m.address,t.participator_company=!(!m||!m.company)&&m.company,t.ifUseSignupTpl=!(!m||!m.ifUseSignupTpl)&&m.ifUseSignupTpl,(t.participator_name||t.participator_phone||t.participator_email||t.participator_address||t.participator_company)&&(t.ifExtraUserInfor=!0)}t.currentItem.date_expiry_local=moment(moment.utc(t.currentItem.date_expiry)).local(),t.currentItem.date_publish_local=moment(moment.utc(t.currentItem.date_publish)).local(),t.currentItem.is_sync_to_market=!0===t.currentItem.is_sync_to_market,t.currentItem.multi_participations=!0===t.currentItem.multi_participations,t.currentItem.online_payment=!0===t.currentItem.online_payment,t.isSubitemsMode=t.currentItem.children.length>0,t.currentItem.is_in_cn||(t.addressString=(t.currentItem.address.suburb?t.currentItem.address.suburb+", ":"")+(t.currentItem.address.state?t.currentItem.address.state+", ":"")+(t.currentItem.address.country?t.currentItem.address.country:"")),e.utilsService.setWebTitle("ShowMine - "+e.translate.instant("ITEM.PAGE.EDIT.TITLE",{item:a.title})),e.utilsService.setWebDescription(e.translate.instant("ITEM.PAGE.EDIT.DESCRIPTION",{item:a.description}))});break;case"mixAuth.jieLongResult":l.isAuthenticated()||!0===e.weChatService.openedInWeChat()&&e.weChatService.loginAndRedirect(o.current),t.pageUrl=o.href(o.current.name,{},{absolute:!0}),e.weChatService.openInIphone()&&(t.pageUrl=e.initUrl),t.currentItemId=o.params.itemId,t.getItemDetails(o.params.itemId,function(){(!e.appUser||!e.appUser.id||e.appUser&&e.appUser.id&&!e.appUser.is_admin&&e.appUser.id!==t.currentItem.seller_id&&!0!==t.currentItem.isSameCompany)&&o.go("mixAuth.itemDetails",{itemId:t.currentItemId},{reload:!0})}),e.pageLoaded();break;case"mixAuth.communityItemSearch":t.urlHouseFilter={suburb:o.params.suburb?o.params.suburb:"",amount_range:o.params.amount?o.params.amount:"",rent_type:o.params.type?o.params.type:"",bed_num:o.params.bed?o.params.bed:"",bath_num:o.params.bath?o.params.bath:"",gender_prefer:o.params.gender?o.params.gender:"",park_num:o.params.car?o.params.car:"",allow_pet:o.params.pet?o.params.pet:"",property_type:o.params.propertyType?o.params.propertyType:"",expand:o.params.expand?o.params.expand:""},i.getCommunityTagList().then(function(n){if(t.tagList=n.data,_.map(t.tagList,function(e){return v[e.name]&&(e.icon=v[e.name]),e}),t.communityTag=_.where(t.tagList,{id:o.params.predefinedTagId}),t.listUrl=o.href(o.current.name,o.current.params,{absolute:!0}),t.communityImgSrc=t.communityTitle="",t.communityTag[0].id===_.where(t.tagList,{name:"PROPERTY RENTING"})[0].id&&(t.ifShowHouseFilter=!0),t.communityTag[0])t.communityImgSrc=e.utilsService.getAppAbsUrlRoot()+t.communityTag[0].icon,t.communityTitle=e.translate.instant(t.communityTag[0].name?t.communityTag[0].name:""),e.utilsService.setWebTitle("ShowMine - "+t.communityTitle),t.communityTag[0].id===_.where(t.tagList,{name:"PROPERTY RENTING"})[0].id?(t.communityDesc="",angular.forEach(o.current.params,function(n,a){
    "suburb"===a&&n&&(t.descSuburb=e.translate.instant("COMPANY.PAGE.CREATE.PICKUP.SUBURB"),t.communityDescSuburb=n+t.descSuburb+" ",t.communityDesc=t.communityDesc+t.communityDescSuburb),"amount"===a&&n&&(t.amountTranslation="150less"===n?e.translate.instant("ITEM.PAGE.LIST.RENT.AMOUNT.150"):"900more"===n?e.translate.instant("ITEM.PAGE.LIST.RENT.AMOUNT.MORE.THAN.900"):n,t.communityDescAmount=t.amountTranslation+"$ ",t.communityDesc=t.communityDesc+t.communityDescAmount),"propertyType"===a&&n&&(t.descPropertyType=e.translate.instant("ITEM.PAGE.LIST.RENT.PROPERTY.TYPE"),t.propertyTypesTranslation="apartment"===n?e.translate.instant("ITEM.PAGE.LIST.RENT.PROPERTY.TYPE.APARTMENT"):e.translate.instant("ITEM.PAGE.LIST.RENT.PROPERTY.TYPE.HOUSE"),t.communityDescPropertyType=t.descPropertyType+":"+t.propertyTypesTranslation+" ",t.communityDesc=t.communityDesc+t.communityDescPropertyType),"type"===a&&n&&(t.typeTranslation="single"===n?e.translate.instant("ITEM.PAGE.LIST.RENT.TYPE.SINGLE"):e.translate.instant("ITEM.PAGE.LIST.RENT.TYPE.WHOLE"),t.communityDescType=t.typeTranslation+" ",t.communityDesc=t.communityDesc+t.communityDescType),"bed"===a&&n&&(t.descBed=e.translate.instant("ITEM.PAGE.LIST.RENT.BEDROOM"),t.communityDescBed=n+t.descBed+" ",t.communityDesc=t.communityDesc+t.communityDescBed),"bath"===a&&n&&(t.descBath=e.translate.instant("ITEM.PAGE.LIST.RENT.BATHROOM"),t.communityDescBath=n+t.descBath+" ",t.communityDesc=t.communityDesc+t.communityDescBath),"gender"===a&&n&&(t.genderTranslation="male"===n?e.translate.instant("ITEM.PAGE.LIST.RENT.GENDER.MALE"):e.translate.instant("ITEM.PAGE.LIST.RENT.GENDER.FEMALE"),t.descGender=e.translate.instant("ITEM.PAGE.LIST.RENT.GENDER"),t.communityDescGender=t.descGender+":"+t.genderTranslation+" ",t.communityDesc=t.communityDesc+t.communityDescGender),"car"===a&&n&&(t.descCar=e.translate.instant("ITEM.PAGE.LIST.RENT.CARPORT"),t.communityDescCar=n+t.descCar,t.communityDesc=t.communityDesc+t.communityDescCar+" "),"pet"===a&&n&&(t.petTranslation="yes"===n?e.translate.instant("ITEM.PAGE.LIST.RENT.ALLOW.PET"):e.translate.instant("ITEM.PAGE.LIST.RENT.NOT.ALLOW.PET"),t.descPet=e.translate.instant("ITEM.PAGE.LIST.RENT.PET"),t.communityDescPet=t.descPet+":"+t.petTranslation+" ",t.communityDesc=t.communityDesc+t.communityDescPet)})):t.communityDesc=e.translate.instant("ITEM.PAGE.POSTER.SLOGAN"),e.weChatService.runWhenWXReady(function(){wx.onMenuShareAppMessage({title:t.communityTitle,desc:t.communityDesc,link:t.listUrl,imgUrl:t.communityImgSrc}),wx.onMenuShareTimeline({title:t.communityTitle,link:t.listUrl,imgUrl:t.communityImgSrc})});else{var a="ShowMine - "+t.searchKeyWord;t.pageTitle=a,e.utilsService.setWebTitle(a),t.communityDesc=e.translate.instant("ITEM.PAGE.POSTER.SLOGAN"),t.listUrl=o.href(o.current.name,{keyWord:t.searchKeyWord},{absolute:!0}),t.pageImgUrl=e.utilsService.getAppAbsUrlRoot()+"/app/images/search_logo.png",e.weChatService.runWhenWXReady(function(){wx.onMenuShareAppMessage({title:t.pageTitle,desc:t.communityDesc,link:t.listUrl,imgUrl:t.pageImgUrl}),wx.onMenuShareTimeline({title:t.pageTitle,link:t.listUrl,imgUrl:t.pageImgUrl})})}t.pageUrl=o.href(o.current.name,{},{absolute:!0}),e.weChatService.openInIphone()&&(t.pageUrl=e.initUrl)},function(e){t.loadTagListErr=e.data}),e.pageLoaded(),t.state=o.params.state,t.isincludeJielong=o.params.isincludeJielong,t.country=o.params.country,t.predefinedTagId=o.params.predefinedTagId,t.origFromCommunity=!!t.predefinedTagId,t.searchKeyWord=o.params.keyWord||"",t.searchItemOrderBy={"items.date_start":"desc"},W(),t.searchByPreDefinedTags=o.params.predefinedTag||{},e.utilsService.setWebTitle("ShowMine - "+e.translate.instant("ITEM.PAGE.SEARCH.TITLE")),e.utilsService.setWebDescription(e.translate.instant("ITEM.PAGE.SEARCH.DESCRIPTION")),t.searchTypeId=o.params.TypeId||0,V(t.searchTypeId),jQuery(document).on("scroll",function(e){jQuery(document).scrollTop()>5?jQuery(".item-list-wrapper .top-menu").addClass("page-float top"):jQuery(".item-list-wrapper .top-menu").removeClass("page-float top")}),e.utilsService.scrollTo("pageTop");break;case"mixAuth.companyItemSearch":case"mixAuth.companyItemSearchSEO":e.pageLoaded(),g.hideContactUsQr=!0,t.msgId=o.params.messageId;var S=s.localStorage.getItem("showManagSection");if(t.showManageSection=!0===S||"true"===S,o.params.companyId)t.companyId=o.params.companyId;else{if(!e.appUser||!e.appUser.id){o.go("auth.login",{},{reload:!0});break}if(!(e.appUser.userCompany&&e.appUser.userCompany.length>0)){o.go("mixAuth.itemList",{userId:e.appUser.id},{reload:!0});break}t.companyId=e.appUser.userCompany[0].id}r.getCompanyDetails(t.companyId).then(function(n){if(t.currentCompany=n.data,t.currentCompany.isCompanyAdmin=!(!e.appUser||!e.appUser.id)&&e.utilsService.adminOfCompany(e.appUser.adminOfCompanyIds,t.currentCompany.id,e.appUser.is_admin),t.currentCompany.config){var i=JSON.parse(t.currentCompany.config);t.filterOfItemsDisplay=i.filterOfItemsDisplay,t.currentCompany.configArray=i,t.currentCompany.googleMapUrl="https://www.google.com/maps/place/"+encodeURIComponent(i.address);t.currentCompany.trustAddressUrl=i.address?"https://www.google.com/maps/embed/v1/place?key=AIzaSyC54M7x-ybIYncE4hLfAMIzkDAiCKhfQ6M&q="+i.address:""}else t.filterOfItemsDisplay=!1;if(t.currentCompany.admin_config){var r=JSON.parse(t.currentCompany.admin_config);void 0===r.ifJumpToHomePage&&(t.ifJumpToHomePage=!0),t.useCompanyTemplate=!1,g.detectIfUseTemplate(t.useCompanyTemplate),r.ifUseCompanyTemplate&&!0===r.ifUseCompanyTemplate&&(t.useCompanyTemplate=!0,g.detectIfUseTemplate(t.useCompanyTemplate)),t.ifJumpToHomePage=0!=r.ifJumpToHomePage||r.ifJumpToHomePage}if(e.appUser&&e.appUser.id){var c={},s=o.href("mixAuth.companyItemSearch",{companyId:t.currentCompany.id},{absolute:!0}),m=e.utilsService.getCompanyDefaultImageUrl(t.currentCompany);c.param={current_state:s,img_url:m,title:t.currentCompany.name,model_name:"Company",model_id:t.currentCompany.id},a.storeCurrentState(c.param)}},function(e){t.gettingCompanyDetailsErr=e.data}).finally(function(){t.gettingCompanyDetails=!1,t.listUrl=o.href(o.current.name,{},{absolute:!0}),e.utilsService.setWebTitle(t.currentCompany&&t.currentCompany.id?t.currentCompany.name:e.utilsService.stripHtmlTags(t.currentCompany)),e.weChatService.runWhenWXReady(function(){wx.onMenuShareAppMessage({title:t.currentCompany.name,desc:t.currentCompany.description,link:t.listUrl,imgUrl:t.currentCompany.logo_img.url}),wx.onMenuShareTimeline({title:t.currentCompany.name,link:t.listUrl,imgUrl:t.currentCompany.logo_img.url})})}),t.searchKeyWord=o.params.keyWord||"",t.searchItemOrderBy={"items.date_start":"desc"},t.searchTypeId=o.params.TypeId||0,j(),jQuery(document).on("scroll",function(e){jQuery(document).scrollTop()>5?jQuery(".item-list-wrapper .top-menu").addClass("page-float top"):jQuery(".item-list-wrapper .top-menu").removeClass("page-float top")}),e.utilsService.scrollTo("pageTop");break;case"mixAuth.community":e.pageLoaded();break;case"mixAuth.visitHistory":l.isAuthenticated()||!0===e.weChatService.openedInWeChat()&&e.weChatService.loginAndRedirect(o.current),e.pageLoaded(),t.getVisitHistory();break;case"mixAuth.favItemList":l.isAuthenticated()||!0===e.weChatService.openedInWeChat()&&e.weChatService.loginAndRedirect(o.current),e.pageLoaded();break;case"mixAuth.jieLongCheckIn":l.isAuthenticated()||!0===e.weChatService.openedInWeChat()&&e.weChatService.loginAndRedirect(o.current),t.itemId=o.params.itemId,t.getIsInJielong(),t.getItemDetails(t.itemId,function(){}),e.pageLoaded();break;case"mixAuth.voucherCheckIn":l.isAuthenticated()||(!0===e.weChatService.openedInWeChat()?e.weChatService.loginAndRedirect(o.current):n.validateVoucherWhenNoUser(o.current.params.voucherId).then(function(e){if(e.data.entityName.includes("Item")){var t=e.data.item.id;o.go("mixAuth.itemDetails",{itemId:t},{reload:!0})}else e.data.entityName.includes("CompanyVoucherGroup")&&o.go("mixAuth.companyVoucherReleased",{voucherGroupId:e.data.entityId},{reload:!0})},function(e){})),t.isCheckedVoucher=!1,l.isAuthenticated()&&(g.hideContactUsQr=!0,t.getVoucherDetails(o.params.voucherId)),e.pageLoaded();break;case"mixAuth.voucherList":l.isAuthenticated()||!0===e.weChatService.openedInWeChat()&&e.weChatService.loginAndRedirect(o.current),e.pageLoaded();break;case"mixAuth.blackList":if(!0===e.weChatService.openedInWeChat()&&e.weChatService.loginAndRedirect(o.current),e.companyId=o.params.companyId,e.companyId){if(!(e.appUser&&_.contains(e.appUser.adminOfCompanyIds,e.companyId))&&e.appUser&&!1===e.appUser.is_admin)return void o.go("mixAuth.companyItemSearch",{companyId:e.companyId},{reload:!0})}e.pageLoaded()}return t},be=function(n){var a=o.current.params;a.expand=n,t.listUrl=o.href(o.current.name,a,{absolute:!0}),e.weChatService.runWhenWXReady(function(){wx.onMenuShareAppMessage({title:t.communityTitle,desc:t.communityDesc,link:t.listUrl,imgUrl:t.communityImgSrc}),wx.onMenuShareTimeline({title:t.communityTitle,link:t.listUrl,imgUrl:t.communityImgSrc})})},Ue=function(y,_,W,B,q,ue,de,Ce,Ue,Ee,we,Te,Le,Me,De){return e=y,e.searchByPreDefinedTags=F,e.searchByTypeId=V,n=_,a=W,i=B,r=q,l=Ue,c=ue,s=de,u=we,m=Ce,o=e.state,p=Ee,d=Te,g=Le,f=Me,h=De,t=this,t.isOverseas=e.isOverseas,t.tagMapArray=v,t.tagArrayInCreation=I,t.jielongVoucherEntityMap=C,t.item={},t.currentStateObj={},t.initPage=_e,t.getItemsForASeller=S,t.getRentSuburbs=b,t.searchCompanyItemsByTypeId=j,t.searchItemsUnderCommunity=U,t.searchItemsUnderCompany=E,t.changeItemListType=N,t.getSellerInfo=A,t.getItemDetails=w,t.saveItem=T,t.getItemComments=D,t.addItemComment=L,t.addJielongComment=M,t.changeOrderByAndSearch=O,t.showItemImgs=x,t.showItemCommentImgs=$,t.removeItemImage=G,t.swapTitleAndDescription=J,t.getAreaList=Y,t.assignAreaToAddress=z,t.JielongCheckin=P,t.deactivateJieLong=R,t.getVisitHistory=Q,t.sliderIndexChange=K,t.navToSearch=X,t.getIsInJielong=k,t.selectDefaultCompany=Z,t.clearCompanyForItem=te,t.itemToLocalStorage=ne,t.checkIfItemUppLimit=oe,t.clearTmpItemDetails=se,t.retoreItemFromTmpItem=me,t.freshItemDetails=le,t.getVoucherDetails=pe,t.checkinVoucher=ge,t.monitorTitleChange=H,t.toStorage=fe,t.getCompanyDetails=he,t.chooseCommunity=ye,t.changePriceToEmpty=ie,t.changeOnlinePaymentFlag=re,t.checkIfCompanyCanOpenOnlinePaymentAndShowAvatarAndNotifySeller=ee,t.switchOnlinePayment=ce,t.rechooseCommunity=ve,t.changeIfExtraUserInfor=Ie,t.setWriterToLocalStorage=ae,t.updateWeChatShare=be,t.checkIfUserCanAccessFeatureItem=Ae,t.clearVoucherGroups=Se,t};angular.module("shmApp.controllers").controller("ItemController",["$scope","ItemService","UserService","CommunityService","CompanyService","$q","$window","$location","$auth","$sce","StorageService","$timeout","$rootScope","$translate","UtilsService",Ue])}(),function(){var e,t,n,a,i,r,o,c,s,m,u=function(){if(e.utilsService.scrollToTop(),r.from&&r.itemId){var n={};n.params={source_type:r.from,id:r.itemId,target_type:"ITEM",user_id:e.appUser&&e.appUser.id?e.appUser.id:""},s.saveWeChatVisitSource(n.params)}return e.itemService.getItemDetails(r.itemId).then(function(n){if(t.formatItemDetails(n.data),"CONSULTATION"!==t.item.tagNames[0]&&!e.$auth.isAuthenticated()&&!0===e.weChatService.openedInWeChat()){var a=e.state.current;a.params=e.state.params,e.weChatService.loginAndRedirect(a)}d(t.item),o.loadPreAnimation(),e.appUser&&e.appUser.id&&l(n.data,e.utilsService.getItemDefaultImageUrl(n.data))},function(e){a.go("mixAuth.community",{},{reload:!0})}),t},l=function(e,t){var n={},i=a.href("mixAuth.itemDetails",{itemId:e.id},{absolute:!0});n.param={current_state:i,img_url:t,title:e.title,model_name:"Item",model_id:e.id},s.storeCurrentState(n.param)},p=function(){if(!0===e.weChatService.openedInWeChat()){var n=e.state.current;n.params=e.state.params,e.weChatService.loginAndRedirect(n)}else e.utilsService.storeRedirectUrl("mixAuth.itemDetails",{itemId:t.item.id},{reload:!0}),e.state.go("auth.login",{reload:!0,inherit:!1})},d=function(){var n={};n.isJielong=!(!t.item||!t.item.type||e.itemTypeService.TYPE_CONSTS.JIE_LONG!==t.item.type.const),n.isJielong&&t.item.id&&g();n.jielongTitle=!0===n.isJielong&&t.item.totalQuantity>=10?e.$translate.instant("ITEM.PAGE.DETAILS.JIELONG_USER_IN",{qty:t.item.totalQuantity}):"",n.title=n.jielongTitle+e.utilsService.stripHtmlTags(t.item.title),n.desc=e.utilsService.stripHtmlTags(t.item.description),n.itemUrl=e.utilsService.getCurrentUrlFromPageState(e.state),n.imgUrl=e.utilsService.getItemDefaultThumbnailUrl(t.item,"SMALL"),e.weChatService.runWhenWXReady(function(){var a={};a.params={user_id:e.appUser&&e.appUser.id?e.appUser.id:"",share_source_type:"ITEM",share_source_id:r.itemId},wx.onMenuShareAppMessage({title:n.title,desc:n.desc,link:n.itemUrl,imgUrl:n.imgUrl,success:function(){a.params.share_target_type="message",s.saveWeChatShareSource(a.params),!0===t.item.isJielong&&!1===t.isInJielong&&e.utilsService.checkJielongBonusStatus(t.item,e.appUser,"TYPE_SHARE"),!0===t.item.isJielong&&!0===t.isInJielong&&e.utilsService.checkJielongBonusStatus(t.item,e.appUser,"TYPE_JIELONG_SHARE")}}),wx.onMenuShareTimeline({title:n.title,link:n.itemUrl,imgUrl:n.imgUrl,success:function(){a.params.share_target_type="timeline",s.saveWeChatShareSource(a.params),!0===t.item.isJielong&&!1===t.isInJielong&&e.utilsService.checkJielongBonusStatus(t.item,e.appUser,"TYPE_SHARE"),!0===t.item.isJielong&&!0===t.isInJielong&&e.utilsService.checkJielongBonusStatus(t.item,e.appUser,"TYPE_JIELONG_SHARE")}})})},g=function(){e.itemService.getIsInJielong(t.item.id).then(function(e){t.isInJielong=!!e.data.currentUserJieLong},function(e){t.gettingIsinJielongErr=e.data}).finally(function(){})};processGoogleMap=function(e){var t=jQuery(e),n=jQuery("<p>").append(t);n.find("#google-map").remove();var a=n.html();return!0===c?a:e};var f=function(n){n&&0===n.active&&a.go("home",{},{}),n.description=processGoogleMap(n.description),t.item=n,t.datePublish=moment(moment.utc(t.item.date_publish)).local().format("YYYY-MM-DD"),t.item.author&&(t.trustAuthor=i.trustAsHtml(t.item.author));var r=Object.keys(t.item.predefinedTags).map(function(e){return t.item.predefinedTags[e]});if(t.item.isConsultationPage=!(!t.item||!t.item.predefinedTags)&&r[0]===e.itemService.returnConsultation(),!0!==t.item.isConsultationPage||!0!==t.item.is_expired||e.appUser&&(!0===e.appUser.is_admin||e.appUser.id===t.item.seller_id)||a.go("mixAuth.consultationExpiredPage",{itemId:t.item.id},{}),t.item.isSameCompany=!1,e.appUser&&t.item.company&&t.item.company.id&&(t.item.isSameCompany=e.utilsService.adminOfCompany(e.appUser.adminOfCompanyIds,t.item.company_id,e.appUser.is_admin)),t.item.isSellerItem=e.appUser&&e.appUser.id===t.item.seller_id,t.item.isCompanyAdminItem=e.appUser&&_.contains(e.appUser.adminOfCompanyIds,t.item.company_id),!t.item.is_draft||t.item.isSellerItem||t.item.isCompanyAdminItem||e.appUser&&e.appUser.is_admin||a.go("home",{},{reload:!0}),t.item.itemStatusName=e.itemService.getItemStatusName(t.item).toLowerCase(),t.ifShowAvatar=!1,t.item.company_id&&t.item.company&&t.item.config){var c=JSON.parse(t.item.company.config),s=JSON.parse(t.item.config);c&&c.defaultContact&&(t.defaultContact=c.defaultContact),c&&c.ifShowAvatar&&!0===c.ifShowAvatar&&!0===s.ifShowAvatar&&(t.ifShowAvatar=!0)}if(t.useCompanyTemplate=!1,o.detectIfUseTemplate(t.useCompanyTemplate),t.item.company_id&&t.item.company&&t.item.company.admin_config){var m=JSON.parse(t.item.company.admin_config);0==m.display_contactUs&&(o.hideContactUsQr=!0),m.ifUseCompanyTemplate&&!0===m.ifUseCompanyTemplate&&(t.useCompanyTemplate=!0,o.detectIfUseTemplate(t.useCompanyTemplate))}if(t.item.config){var s=JSON.parse(t.item.config);s&&!s.posted_by_cmd&&(s.amount_range||s.bath_num||s.bed_num||s.gender_prefer||s.park_num||s.rent_type||s.suburb)&&(t.isRentType=!0,t.item.description=e.utilsService.addInfoForRent(s,t.item.description)),t.writer=s&&s.writer?s.writer:"",t.ifShowCompanyContact=!(!s||!s.ifShowCompanyContact)&&s.ifShowCompanyContact,t.item.ifUseSignupTpl=!(!s||!s.ifUseSignupTpl)&&s.ifUseSignupTpl}else t.item.ifUseSignupTpl=!1;e.utilsService.setWebTitle(t.item.company&&t.item.company.id?t.item.company.name:e.utilsService.stripHtmlTags(t.item.title)),e.utilsService.setWebDescription(e.utilsService.stripHtmlTags(t.item.description)),angular.forEach(t.item.special_tags,function(e,t){parseInt(e)}),angular.forEach(t.item.predefinedTags,function(e){0!==parseInt(e)&&(void 0===t.item.tagNames&&(t.item.tagNames=[]),"JIE LONG"!==e&&t.item.tagNames.unshift(e),"JIE LONG"===e?(o.hideContactUsQr=!0,t.item.isJielong=!0):"PROPERTY SELLING"===e?(o.hideContactUsQr=!0,t.item.isPropertySelling=!0):"CONSULTATION"===e?o.hideContactUsQr=!0:"HUO DONG"===e?(o.hideContactUsQr=!0,t.item.isHuoDong=!0):o.hideContactUsQr=!1)})},h=function(){t.currentUserAllJielong={},e.itemService.getAllJielong(t.item.id).then(function(e){t.currentUserAllJielong=e.data})},y=function(){return e.state.go("mixAuth.itemDetails",{itemId:e.state.params.itemId},{reload:!0,inherit:!1}),t},v=function(e){t.currentUserJieLongCommentsOjb=e,h()},I=function(l,d,g,I,C,A,S,_,b,U,E){return e=l,e.itemTypeService=d,e.itemService=g,n=I,a=C,i=A,r=S,o=_,c=b.data.is_from,s=U,m=E,t=this,t.gettingItemDetailsErr=void 0,t.initPage=u,t.loginAndRedirect=p,t.formatItemDetails=f,t.getCurrentUserAllJielong=h,t.freshItemDetails=y,t.showManageSection=!1,t.toStorage=function(){n.localStorage.setItem("showManagSection",JSON.stringify(t.showManageSection))},t.getCurrentUserJieLong=v,t};angular.module("shmApp.controllers").controller("ItemDetailsController",["$scope","ItemTypeService","ItemService","$window","$state","$sce","$stateParams","$rootScope","isFromChina","UserService","$uibModal",I])}(),function(){var e,t,n,a,i=function(){return t.pageLoading=!0,t},r=function(){return t.pageLoading=!1,t},o=function(e){return t.pageLoadingErr=e,t},c=function(){return t.pageLoadingErr=void 0,t},s=function(){return t.pageLoadingErr},m=function(){!0!==e.isCustomPreloadAnimation?(n.fadingPreloading=!1,n.hidePreloading=!1,e.$timeout(function(){n.fadingPreloading=!0},850),e.$timeout(function(){n.hidePreloading=!0},950)):(n.fadingPreloading=!0,n.hidePreloading=!0),e.isCustomPreloadAnimation=!1},u=function(e){t.useCompanyTemplate=e},l=function(l,p,d,g,f,h,y,v,I,C,A,S,_,b,U,E,w,T){return t=this,e=g,!0===T.data.is_from?e.appConf.apiUrl=e.appConf.apiUrlCN:e.appConf.apiUrl=e.appConf.apiUrlEN,e.state=C,e.$filter=U,e.appConf=d,e.stateParams=A,e.translate=I,e.location=_,e.utilsService=y,e.weChatService=v,e.$window=b,e.$auth=S,e.authService=f,e.$rootScope=E,e.$timeout=w,e.LanguageService=h,e.pageLoading=i,e.pageLoaded=r,e.setPageLoadingErr=o,e.clearPageLoadingErr=c,e.getPageLoadingErr=s,a=v,n=E,n.loadPreAnimation=m,n.detectIfUseTemplate=u,n.globalData={preventExecution:!1},n.$on("$stateChangeStart",function(n,a,i,r){t.useCompanyTemplate=!1,e.globalData.preventExecution=!1,"mixAuth.companyItemSearch"!=r.name&&"mixAuth.companyItemSearchSEO"!=r.name||"mixAuth.itemDetails"!=a.name&&"mixAuth.itemDetailsSEO"!=a.name||(t.useCompanyTemplate=!0),"mixAuth.itemDetails"!=r.name&&"mixAuth.itemDetailsSEO"!=r.name||"mixAuth.itemDetails"!=a.name&&"mixAuth.itemDetailsSEO"!=a.name||(t.useCompanyTemplate=!0),"mixAuth.itemDetailsSEO"==r.name&&"mixAuth.communityItemSearch"==a.name&&(e.globalData.preventExecution=!0),"mixAuth.itemDetailsSEO"==r.name&&"mixAuth.community"==a.name&&(e.isCustomPreloadAnimation=!0,e.globalData.preventExecution=!0),"mixAuth.communityItemSearch"==r.name&&"mixAuth.community"==a.name&&(e.globalData.preventExecution=!0),"mixAuth.communityItemSearch"==r.name&&"mixAuth.itemDetailsSEO"==a.name&&(e.globalData.itemId=i.itemId),"mixAuth.community"==r.name&&"mixAuth.itemDetailsSEO"==a.name&&(e.globalData.itemId=i.itemId),"mixAuth.itemDetails"!=a.name&&"mixAuth.itemDetailsSEO"!=a.name||(e.isCustomPreloadAnimation=!0)}),n.$on("$viewContentLoaded",function(){e.loadPreAnimation()}),l.data&&l.data.id&&(e.appUser=l.data),p.data&&(e.isOverseas=1==p.data.isoverseas),n.openInWechat=a.openedInWeChat(),e.authService.getMe().then(function(t){var n=t.data;n&&n.id&&e.LanguageService.getLanguageById(n.language_id).then(function(t){var n=angular.lowercase(t.data.name);e.translate.use(n),e.$window.localStorage.setItem("language",n)})}),n.hideContactUsQr=!1,t};angular.module("shmApp.controllers").controller("MixAuthController",["appUser","isOverseas","appConf","$scope","AuthService","LanguageService","UtilsService","WeChatService","$translate","$state","$stateParams","$auth","$location","$window","$filter","$rootScope","$timeout","isFromChina",l])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s,m=function(m,u,l,p,d,g,f,h,y){return e=m,n=u,r=d,a=l,i=p,o=g,i=p,c=f,s=h,{restrict:"AE",scope:{appUser:"="},templateUrl:e.viewRootDir+"directives/community/home/home.html",link:function(n,m,u){t=n,t.appConf=e,t.preSaved={},t.successCallBack=function(e){var n=Object.keys(e)[0],i=e[n];t.preSaved||(t.preSaved={}),t.preSaved[n]=i,a.localStorage.setItem("oldCommunityData",JSON.stringify(t.preSaved))},t.initParamsForOnGoingJieLong=function(){return t.params_ongoing_jie_long={"order-by":{"items.date_start":"desc"},page:1,"page-size":6,published:1,expired:0,sold:0,draft:0},t},t.initParamsForInComingJieLong=function(){return t.params_incoming_jie_long={"order-by":{"items.date_start":"desc"},page:1,"page-size":3,published:0,expired:0,sold:0,draft:0},t},t.loadWeChatShare=function(){var t={};t.title=""+o.instant("COMMUNITY.TITLE"),t.shareTitle=""+o.instant("COMMUNITY.SHARE_TITLE"),r.setWebTitle(t.title),t.desc=""+o.instant("COMMUNITY.DESC"),t.listUrl=i.href(i.current.name,{},{absolute:!0}),t.imgUrl=r.getAppAbsUrlRoot(e.imagesRootDir+"community_logo.png"),c.runWhenWXReady(function(){wx.onMenuShareAppMessage({title:t.shareTitle,desc:t.desc,link:t.listUrl,imgUrl:t.imgUrl}),wx.onMenuShareTimeline({title:t.shareTitle,link:t.listUrl,imgUrl:t.imgUrl})})},t.initHomeVoucherDraw=function(){c.openedInWeChat()&&s.getHomeVoucherTarget().then(function(e){!1===e.data.is_all_sent&&s.showTodayDrawLeft().then(function(t){t.data.remainLimit>0&&r.displayOverlayModal('<voucher-home-reward-modal target-model-id="'+e.data.id+'"></voucher-home-reward-modal>')})})},t.getTagList=function(){t.tagList=[],s.getTagsList().then(function(e){angular.forEach(e.data,function(e){t.tagList.push({name:e,selected:!1})})})},t.getRecommendCompany=function(){s.getRecommendCompany().then(function(e){t.recommendCompany=e.data})},t.showIconsLayer=function(){r.displayOverlayModal('<community-icon-layer></community-icon-layer><div class="community-wrapper"><section class="top-margin daily-recommendation"><div class="container"><community-recommendation-section></community-recommendation-section><div class="section-divider"></div></div></section></div>')},t.init=function(){if(t.globalData&&t.globalData.preventExecution)return t.preSaved=JSON.parse(a.localStorage.getItem("oldCommunityData"),!0),r.scrollToWithOffset(t.globalData.itemId,150),t;t.loadWeChatShare(),t.jie_long_community_tag_id="552a8c864c2628440e4d85d935b669af",t.initParamsForOnGoingJieLong().initParamsForInComingJieLong(),t.initHomeVoucherDraw(),t.getTagList(),t.getRecommendCompany()},t.init()}}};angular.module("shmApp.directives").directive("communityHome",["appConf","CommunityService","$window","$state","UtilsService","$translate","WeChatService","CompanyService",m])}(),function(){"use strict";var e,t,n,a,i,r,o=function(e,t,n){var a=0;return void 0===e&&t?angular.forEach(n,function(e,n){e.country===t&&(a=n)}):e&&t&&angular.forEach(n,function(n,i){n.state===e&&n.country===t&&(a=i)}),a},c=function(c,s,m,u,l){return e=c,n=s,a=m,i=u,r=l,{restrict:"AE",scope:{appUser:"<",data:"<ngModel",callback:"&?"},templateUrl:e.viewRootDir+"directives/community/home/header.html",link:function(e,c,s){if(t=e,t.getAreaList=function(){var e={};e.localSelectedStateAndCountry=a.getItem("appUser_state_and_country"),n.getAreaList().then(function(n){t.areaList=n.data,t.targetIndex=o(e.localSelectedStateAndCountry&&e.localSelectedStateAndCountry.state?e.localSelectedStateAndCountry.state:void 0,e.localSelectedStateAndCountry&&e.localSelectedStateAndCountry.country?e.localSelectedStateAndCountry.country:void 0,t.areaList),t.callback&&"function"==typeof t.callback()&&t.callback()({areas:t.areaList})},function(e){t.loadAreaListErr=e.data})},t.selectArea=function(e,n){var i={};t.targetIndex=o(e,n,t.areaList),i.localSelectedStateAndCountry={state:e,country:n},a.setItem("appUser_state_and_country",i.localSelectedStateAndCountry)},t.navToSearch=function(e,t,n){i.go("mixAuth.communityItemSearch",{keyWord:e,state:t,country:n})},t.data)return void(t.areaList=t.data);t.selectLanguage=function(e){t.language=e},t.getAreaList(),t.language=r.use()}}};angular.module("shmApp.directives").directive("communityHomeHeader",["appConf","CommunityService","StorageService","$state","$translate",c])}(),function(){"use strict";var e,t,n,a,i=function(){t.gettingBanners=!0,t.gettingBannersErr=void 0,a.getBanners().then(function(e){t.banners=e.data,t.callback&&"function"==typeof t.callback&&t.callback()({banners:t.banners})},function(e){t.gettingBannersErr=e.data}).finally(function(){t.gettingBanners=!1})},r=function(r,o,c){return e=r,n=o,a=c,{restrict:"AE",scope:{data:"<ngModel",callback:"&?"},templateUrl:e.viewRootDir+"directives/community/home/slider.html",link:function(n,a,r){if(t=n,t.appConf=e,t.data)return void(t.banners=t.data);i()}}};angular.module("shmApp.directives").directive("communityHomeSlider",["appConf","CommunityService","BannerService",r])}(),function(){"use strict";var e,t,n,a,i,r={"SHOW MALL":"/app/images/community_mall.png","ITEM ADS":"/app/images/community_shopping.png","PROPERTY SELLING":"/app/images/community_house.png","HUO DONG":"/app/images/community_huodong.png","CARS ADS":"/app/images/community_car.png","SERVICE ADS":"/app/images/community_service.png","PROPERTY RENTING":"/app/images/community_rental.png","BOOK ADS":"/app/images/community_textbook.png","WISH LIST":"/app/images/community_request.png","TU CAO":"/app/images/community_tucao.png",CONSULTATION:"/app/images/community_consultation.png"},o=function(o,c,s,m,u){return e=o,t=c,n=s,a=m,i=u,{restrict:"AE",scope:{data:"<ngModel",showDesc:"<?",callback:"&?"},templateUrl:e.viewRootDir+"directives/community/home/icons.html",link:function(o,c,s){if(o.appConf=e,o.targetIndex=0,o.openInDesktop=i.openInDesktop(),o.navToCommunity=function(e){var t={};t.appUserSelectedStateAndCountry=n.getItem("appUser_state_and_country",t.localSelectedStateAndCountry),a.go("mixAuth.communityItemSearch",{predefinedTagId:e,state:t.appUserSelectedStateAndCountry&&t.appUserSelectedStateAndCountry.state?t.appUserSelectedStateAndCountry.state:void 0,country:t.appUserSelectedStateAndCountry&&t.appUserSelectedStateAndCountry.country?t.appUserSelectedStateAndCountry.country:void 0})},o.sliderStart=function(e){e.element.flexAnimate(parseFloat(o.targetIndex))},o.sliderIndexChange=function(e){o.targetIndex=e.element.currentSlide},o.getCommunityTagList=function(){t.getCommunityTagList().then(function(e){o.tagList=[],angular.forEach(e.data,function(e){if(r[e.name]){var t={icon:r[e.name],id:e.id,name:e.name};e.icon=r[e.name],o.tagList.push(t)}}),o.callback&&"function"==typeof o.callback&&o.callback()({communityIcons:o.tagList})},function(e){o.loadTagListErr=e.data})},o.data)return void(o.tagList=o.data);o.getCommunityTagList()}}};angular.module("shmApp.directives").directive("communityIconSection",["appConf","CommunityService","StorageService","$state","WeChatService",o])}(),function(){"use strict";var e,t,n,a,i,r={"SHOW MALL":"/app/images/community_mall.png","ITEM ADS":"/app/images/community_shopping.png","PROPERTY SELLING":"/app/images/community_house.png","HUO DONG":"/app/images/community_huodong.png","CARS ADS":"/app/images/community_car.png","SERVICE ADS":"/app/images/community_service.png","PROPERTY RENTING":"/app/images/community_rental.png","BOOK ADS":"/app/images/community_textbook.png","WISH LIST":"/app/images/community_request.png","JIE LONG":"/app/images/community_jielong.png","TU CAO":"/app/images/community_tucao.png",CONSULTATION:"/app/images/community_consultation.png"},o=function(o,c,s,m,u){return e=o,t=c,n=s,a=m,i=u,{restrict:"AE",scope:!0,require:"^overlayModalCustom",templateUrl:e.viewRootDir+"directives/community/home/iconLayer.html",link:function(e,i,o,c){e.navToCommunity=function(e){var t={};t.appUserSelectedStateAndCountry=n.getItem("appUser_state_and_country",t.localSelectedStateAndCountry),a.go("mixAuth.communityItemSearch",{predefinedTagId:e,state:t.appUserSelectedStateAndCountry&&t.appUserSelectedStateAndCountry.state?t.appUserSelectedStateAndCountry.state:void 0,country:t.appUserSelectedStateAndCountry&&t.appUserSelectedStateAndCountry.country?t.appUserSelectedStateAndCountry.country:void 0})},e.getCommunityTagList=function(){t.getCommunityTagList().then(function(t){e.tagList=[],angular.forEach(t.data,function(t){if(r[t.name]){var n={icon:r[t.name],id:t.id,name:t.name};t.icon=r[t.name],e.tagList.push(n)}})},function(t){e.loadTagListErr=t.data})},e.close=c.close,c.showTopCloseBtn(),e.getCommunityTagList()}}};angular.module("shmApp.directives").directive("communityIconLayer",["appConf","CommunityService","StorageService","$state","WeChatService",o])}(),function(){"use strict";var e,t,n=function(n,a){return e=n,t=a,{restrict:"AE",scope:{data:"<ngModel",callback:"&?"},templateUrl:e.viewRootDir+"directives/item/communityRecommendation.html",link:function(e,n,a){if(e.getItems=function(n){var a={};a.pageNo=n||1,1===a.pageNo?(e.gettingItems=!0,e.gettingItemsErr=void 0):(e.gettingMoreItems=!0,e.gettingMoreItemsErr=void 0),e.excludeItemIds=1===a.pageNo&&!0===e.init?[]:e.excludeItemIds,a.params={"order-by":{"items.date_start":"desc"},isincludeJielong:!0,isCompanyOnly:!1,"page-size":(1===a.pageNo&&e.init,12),page:2===a.pageNo&&!0===e.init?a.pageNo-1:a.pageNo,"exclude-item-ids":JSON.stringify(e.excludeItemIds)},2===a.pageNo&&!0===e.init&&(e.init=!1),a.params.expired=!1,a.params.sold=!1,t.searchItems(a.params).then(function(t){a.pageNo>1&&(a.previousData=e.itemList.data),e.itemList=t.data,1===a.pageNo&&!0===e.init&&angular.forEach(e.itemList.data,function(t){e.excludeItemIds.push(t.id)}),a.pageNo>1&&(e.itemList.data=a.previousData.concat(e.itemList.data)),e.callback&&"function"==typeof e.callback&&e.callback()({communityRecommendationSections:e.itemList})},function(t){1===a.pageNo?e.gettingItemsErr=t.data:e.gettingMoreItemsErr=t.data}).finally(function(){e.gettingItems=!1,e.gettingMoreItems=!1})},e.data&&e.data.data)return void(e.itemList=e.data);e.init=!0,e.getItems()}}};angular.module("shmApp.directives").directive("communityRecommendationSection",["appConf","ItemService",n])}(),function(){"use strict";var e,t,n,a=function(a,i,r){return e=a,t=i,n=r,{restrict:"AE",templateUrl:e.viewRootDir+"directives/item/getTopVisitItemsList.html",scope:{data:"<ngModel",callback:"&?"},link:function(e,t,a){if(e.formatItemsStatsArrToItemArr=function(e){var t={return:[]};return angular.forEach(e,function(e,n){t.item=e.item,t.item.visited_qty=e.value,t.return.push(t.item)}),t.return},e.switchTarget=function(t){switch(t){case"NOW":e.toNow=!0,e.toPast=!1;break;case"PAST":e.toNow=!1,e.toPast=!0}e.init=!0,e.getItems(1)},e.getItems=function(t){var a={};a.pageNo=t||1,1===a.pageNo?(e.gettingItems=!0,e.gettingItemsErr=void 0):(e.gettingMoreItems=!0,e.gettingMoreItemsErr=void 0),e.excludeItemIds=1===a.pageNo&&!0===e.init?[]:e.excludeItemIds,a.params={page:2===a.pageNo&&!0===e.init?a.pageNo-1:a.pageNo,"page-size":1===a.pageNo&&!0===e.init?3:6,"exclude-item-ids":JSON.stringify(e.excludeItemIds)},2===a.pageNo&&!0===e.init&&(e.init=!1),!0===e.toPast&&(a.finished_before=moment().subtract(7,"d").format("YYYY-MM-DD"),a.params.finished_before=a.finished_before),n.getTopVisitItemsList(a.params).then(function(t){a.pageNo>1&&(a.previousData=e.itemList.data),e.itemList=t.data,e.itemList.data=e.formatItemsStatsArrToItemArr(e.itemList.data),1===a.pageNo&&!0===e.init&&angular.forEach(e.itemList.data,function(t){e.excludeItemIds.push(t.id)}),
    a.pageNo>1&&(e.itemList.data=a.previousData.concat(e.itemList.data)),e.callback&&"function"==typeof e.callback&&e.callback()({topVisitItemList:e.itemList})},function(t){1===a.pageNo?e.gettingItemsErr=t.data:e.gettingMoreItemsErr=t.data}).finally(function(){e.gettingItems=!1,e.gettingMoreItems=!1})},e.data&&e.data.data)return void(e.itemList=e.data);e.switchTarget("PAST")}}};angular.module("shmApp.directives").directive("getTopVisitItemsList",["appConf","$translate","ItemService",a])}(),function(){"use strict";var e,t,n=function(e){t.go("mixAuth.communityItemSearch",{predefinedTagId:e},{reload:!0})},a=function(){var t={};return t.map=[{community_id:"552a8c864c2628440e4d85d935b669af",img:"popular_community_jielong.jpg"},{community_id:"ce6fc582c9b74340515018f186cbcf7d",img:"popular_community_rent_property.jpg"},{community_id:"ab177535b397a2b9e899631f196cac16",img:"popular_community_request.jpg"},{community_id:"5d4074718bbed2c47a83bbbb2469b15a",img:"popular_community_shopping.jpg"}],t.return=[],angular.forEach(t.map,function(n){t.return.push({community_id:n.id,img:e.imagesRootDir+n.img})}),t.return},i=function(i,r){return e=i,t=r,{restrict:"AE",scope:{},templateUrl:e.viewRootDir+"directives/community/popular.html",link:function(e,t,i){e.popularLinks=a(),e.goTo=n}}};angular.module("shmApp.directives").directive("popularCommunityLinkList",["appConf","$state",i])}(),function(){"use strict";var e,t,n,a,i=function(i,r,o,c){return e=i,t=r,n=o,a=c,{restrict:"AE",scope:{appUser:"<?",data:"<ngModel",callback:"&?"},templateUrl:e.viewRootDir+"directives/item/specialTagsSection.html",link:function(e,t,n){if(e.getSpecialTags=function(){c.getSpecialTags().then(function(t){e.taglist=t.data,e.callback&&"function"==typeof e.callback&&e.callback()({specialTagSections:e.taglist})},function(e){}).finally(function(){})},e.updateTagSectionCallback=function(t,n){angular.forEach(e.taglist,function(e){if(e.id===t.id)return void(e.speicalSectionItems=n)}),e.callback&&"function"==typeof e.callback&&e.callback()({specialTagSections:e.taglist})},e.data&&e.data.length>0)return void(e.taglist=e.data);e.getSpecialTags()}}};angular.module("shmApp.directives").directive("specialTagsSection",["appConf","$translate","ItemService","TagsSectionService",i])}(),function(){"use strict";var e,t,n,a,i=function(i,r,o,c){return e=i,t=r,n=o,a=c,{restrict:"AE",scope:{appUser:"<?",item:"<?",length:"=",data:"=ngModel",callback:"&",tagList:"<"},templateUrl:e.viewRootDir+"directives/item/specialTagsSectionItem.html",link:function(e,t,a){if(e.getItems=function(t){var a={};a.pageNo=t||1,1===a.pageNo?(e.gettingItems=!0,e.gettingItemsErr=void 0):(e.gettingMoreItems=!0,e.gettingMoreItemsErr=void 0),e.item.column_number=e.item.column_number?e.item.column_number:2,e.item.first_page_size=e.item.first_page_size?e.item.first_page_size:2,a.params={specialTags:e.item.name,"page-size":e.item.first_page_size,page:a.pageNo},n.getItemsWithSpeicalTags(a.params).then(function(t){a.pageNo>1&&(a.previousData=e.itemList.data),e.itemList=t.data,a.pageNo>1&&(e.itemList.data=a.previousData.concat(e.itemList.data)),e.data=e.itemList,e.callback&&"function"==typeof e.callback&&e.callback()(e.item,e.itemList)},function(t){1===a.pageNo?e.gettingItemsErr=t.data:e.gettingMoreItemsErr=t.data}).finally(function(){e.gettingItems=!1,e.gettingMoreItems=!1,e.length=e.itemList.data.length})},e.data&&e.data.data)return void(e.itemList=e.data);e.getItems()}}};angular.module("shmApp.directives").directive("specialTagsSectionItem",["appConf","$translate","ItemService","TagsSectionService",i])}(),function(){"use strict";var e,t,n,a,i,r=function(r,o,c,s,m){return e=r,t=o,n=c,a=s,i=m,{restrict:"AE",templateUrl:e.viewRootDir+"directives/item/specialTagsAdminManage.html",link:function(e,t,n){e.add=function(){e.sections.push({link_to:"",title:"",asset:"",column_number:2,first_page_size:2,load_page_size:2,adminDefinedTags:[]})},e.addEachImg=function(t){e.sections.push({link_to:"",title:"",adminDefinedTags:[],asset:"",column_number:2,first_page_size:2,load_page_size:2,imgArray:[t]})},e.delete=function(t){e.sections.splice(t,1)},e.moveUp=function(t){if(t>0){var n=e.sections[t];e.sections[t]=e.sections[t-1],e.sections[t-1]=n}},e.moveDown=function(t){if(t<e.sections.length-1){var n=e.sections[t];e.sections[t]=e.sections[t+1],e.sections[t+1]=n}},e.save=function(){a.createSpecialTags(e.sections).then(function(t){e.itemList=t.data},function(e){}).finally(function(){i.go("mixAuth.community",{},{reload:!0})})},e.getSpecialTags=function(){e.gettingSpecialTags=!0,a.getSpecialTags().then(function(t){e.sections=t.data,angular.forEach(t.data,function(e){e.adminDefinedTags=""===e.name?[]:e.name.split(" ")})},function(e){}).finally(function(){e.gettingSpecialTags=!1})},e.getSpecialTags()}}};angular.module("shmApp.directives").directive("specialTagsAdminManage",["appConf","$translate","ItemService","TagsSectionService","$state",r])}(),function(){"use strict";var e,t,n,a,i,r=function(e,t){i=this,i.$uibModalInstance=e,i.cancel=function(){i.$uibModalInstance.dismiss("cancel")}},o=function(i,o,c,s){return e=i,t=o,n=c,a=s,{restrict:"AE",scope:{tagList:"=ngModel",appUser:"<?"},template:'  <a  class="btn btn-default btn-sm special-tags-edit-btn" ng-if="(appUser && appUser.id && appUser.is_admin === true)" ng-click="showSpecialTagsEdit($event)"><i class="fa fa-pencil-square-o"></i></a>',link:function(e,t,n){e.showSpecialTagsEdit=function(){a.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",template:"<special-tags-admin-manage></special-tags-admin-manage>",controller:["$uibModalInstance","$state",r],controllerAs:"mdCtrl",size:"lg",appendTo:void 0})}}}};angular.module("shmApp.directives").directive("adminManageSpecialTagsModal",["appConf","$translate","ItemService","$uibModal",o])}(),function(){"use strict";var e,t,n,a,i=function(){var t={};return t.map=[{community_id:"5d4074718bbed2c47a83bbbb2469b15a",img:"budgetPC-logo.png"},{community_id:"552a8c864c2628440e4d85d935b669af",img:"xinjinshan-logo.png"},{community_id:"ab177535b397a2b9e899631f196cac16",img:"greenLand-logo.png"}],t.return=[],angular.forEach(t.map,function(n){t.return.push({community_id:n.id,img:e.imagesRootDir+n.img})}),t.return},r=function(r,o,c,s){return e=r,t=o,n=c,a=s,{restrict:"AE",scope:{},templateUrl:e.viewRootDir+"directives/community/companyPartner.html",link:function(e,t,r){e.popularLinks=i(),e.getPaidCompanies=function(){n.getPaidCompanies().then(function(t){e.companyList=t.data,angular.forEach(e.companyList,function(e){e.safeName=a.removeWhitespaceFromAString(e.name)})})},e.getPaidCompanies()}}};angular.module("shmApp.directives").directive("companyPartner",["appConf","$state","CompanyService","UtilsService",r])}(),function(){"use strict";var e,t,n,a,i,r,o,c=function(c,s,m,u,l,p,d){return e=c,t=s,n=m,a=u,i=l,r=p,o=d,{restrict:"AE",scope:{appUser:"<"},templateUrl:e.viewRootDir+"directives/userCenter/userCenterHome.html",link:function(e,a,o){"object"!=typeof e.appUser?i.loginAndRedirect(t.current):(r.setWebTitle(n.instant("USER_CENTER")),e.avatar=e.appUser.avatar_img,e.nickName=e.appUser.nick_name,e.listUrl=t.href(t.current.name,{},{absolute:!0}),e.sharImg=r.getAppAbsUrlRoot()+"/"+c.imagesRootDir+"jielong_waiting.png",i.runWhenWXReady(function(){wx.onMenuShareAppMessage({title:n.instant("USER_CENTER"),link:e.listUrl,imgUrl:e.sharImg}),wx.onMenuShareTimeline({title:n.instant("USER_CENTER"),link:e.listUrl,imgUrl:e.sharImg})}))}}};angular.module("shmApp.directives").directive("userCenter",["appConf","$state","$translate","ItemService","WeChatService","UtilsService","UserService",c])}(),function(){"use strict";var e,t,n,a,i,r,o,c=function(c,s,m,u,l,p,d){return e=c,t=s,n=m,a=u,i=l,r=p,o=d,{restrict:"AE",scope:{appUser:"<"},templateUrl:e.viewRootDir+"directives/userCenter/userQrCode.html",link:function(e,a,c){"object"!=typeof e.appUser?i.loginAndRedirect(t.current):(r.setWebTitle(n.instant("USER_CENTER")),e.avatar=e.appUser.avatar_img,e.nickName=e.appUser.nick_name,o.getUser(e.appUser.id).then(function(t){var n=t.data;""!==n.qr_img||n.qr_img?e.userQrArray=[n.qr_img]:e.userQrArray=[]})),e.saveUserQr=function(n){if(n.$submitted=!0,e.userQrArray[0])var a=e.userQrArray[0];else var a="";o.updateMe({"user-qr":a}).then(function(n){e.newQrImg=n.data.asset,null==n.data.asset&&(e.newQrImg=""),t.go("mixAuth.userCenter",{reload:!0})},function(e){})}}}};angular.module("shmApp.directives").directive("userQrCode",["appConf","$state","$translate","ItemService","WeChatService","UtilsService","UserService",c])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s,m,u,l=function(e,t,n){u=this,u.$uibModalInstance=e,u.UserService=t,u.updateSwitchOffCallback=n,u.confirm=function(){u.UserService.updateMe({isReceiveRental:!1}).then(function(e){weui.toast("Success",1500),u.updateSwitchOffCallback()},function(e){weui.toast("Fail",1500)}).finally(function(){u.cancel()})},u.cancel=function(){u.$uibModalInstance.dismiss("cancel")}},p=function(t){m.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/user/confirmCancelRentModel.html",controller:"displayConfirmModalCtrl",controllerAs:"modalCtrl",resolve:{updateSwitchOffCallback:function(){return t}}})},d=function(u,l,d,g,f,h,y,v,I,C){return e=u,t=l,n=d,a=g,i=f,r=h,o=y,c=v,s=I,m=C,{restrict:"AE",scope:{appUser:"<"},templateUrl:e.viewRootDir+"directives/userCenter/userPreference.html",link:function(e,m,u){e.updateSwitchOff=function(){e.isReceiveRental&&(e.isReceiveRental=!1)},e.anyType=n.instant("SELECTION.DEFAULT.NO_LIMIT"),e.appUser?(r.setWebTitle(n.instant("USER.PREFERENCE.BTN")),e.avatar=e.appUser.avatar_img,e.nickName=e.appUser.nick_name,s.getCommunityTagList().then(function(t){e.tagList=t.data,e.communityTag=_.where(e.tagList,{name:"PROPERTY RENTING"}),e.communityTag[0]&&(e.rentTag=e.communityTag[0].id)})):i.loginAndRedirect(t.current),c.getMe().then(function(n){var a=n.data;if(""==a.config)e.isReceiveRental=!1;else{var i=JSON.parse(a.config);e.isReceiveRental=i.isReceiveRental}t.params&&t.params.disable&&"true"==t.params.disable&&1==e.isReceiveRental&&p(e.updateSwitchOff),a&&a.houseFilter&&!a.houseFilter.id?(e.houseFilter={},e.houseFilter={suburb:"",amount_range:"",rent_type:"",gender_prefer:"",bed_num:"",bath_num:"",park_num:"",allow_pet:"",property_type:""},e.isReceiveRental=!1):(e.houseFilter=a.houseFilter,angular.forEach(e.houseFilter,function(t,n){e.houseFilter[n]=t}))}),e.setRentNotification=function(t){o.updateMe({isReceiveRental:t}).then(function(n){1==t&&void 0!==e.appUser.wechat_is_subscriber&&1!==parseInt(e.appUser.wechat_is_subscriber)&&r.displaySubscribeModal("RENTING PROPERTY")},function(e){})},e.saveHouseFilter=function(){var t=e.houseFilter;o.updateMe({houseFilter:t}).then(function(t){weui.toast(n.instant("ITEM.PAGE.LIST.RENT.SAVE.NOTIFICATION"),1500),e.appUser.wechat_is_subscriber||r.displaySubscribeModal("RENTING PROPERTY")},function(e){})},e.getRentSuburbs=function(e){return a.getRentSuburbs(e).then(function(e){return e.data})},e.clearFilter=function(){e.houseFilter={suburb:"",amount_range:"",rent_type:"",gender_prefer:"",bed_num:"",bath_num:"",park_num:"",allow_pet:"",property_type:""},e.isReceiveRental,e.setRentNotification(!1)}}}};angular.module("shmApp.directives").controller("displayConfirmModalCtrl",["$uibModalInstance","UserService","updateSwitchOffCallback",l]).directive("userPreference",["appConf","$state","$translate","ItemService","WeChatService","UtilsService","UserService","AuthService","CommunityService","$uibModal",d])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s,m=function(m,u,l,p,d,g,f,h){return e=m,t=u,o=d,n=l,a=p,c=g,i=f,s=h,{restrict:"AE",scope:{companyId:"=?",companyObj:"=?",appUser:"<",previewMode:"<?"},templateUrl:e.viewRootDir+"directives/company/info.html",link:function(e,c,m){e.showVoucherBtns=!1,e.isSameCompany=!1,e.appUser&&e.companyId&&(e.isSameCompany=o.adminOfCompany(e.appUser.adminOfCompanyIds,e.companyId,e.appUser.is_admin)),m.companyId&&t.getCompanyDetails(e.companyId).then(function(t){if(e.companyObj=t.data,e.isActivatedSyncToWechat=o.ifCompanyCanCreateFeaturedItem(e.companyObj,"SYNC TO WECHAT").ifCanCreate,e.companyObj.admin_config){var i=JSON.parse(e.companyObj.admin_config);switch(i.currentPackage||(i.currentPackage="none",e.currentPackage=i.currentPackage),i.currentPackageExpireDate?e.currentPackageExpireDate_local=moment(moment.utc(i.currentPackageExpireDate)).local().format("YYYY-MM-DD HH:mm:ss"):e.currentPackageExpireDate_local=s.instant("COMPANY.CURRENT.PACKAGE.EXPIRE.DATE.NONE"),e.ifOnlinePayment=i.ifOnlinePayment,e.wechatAppId=i.wechat_app_id,i.currentPackage){case"normal":e.currentPackage=s.instant("COMPANY.PAYMENT.APPLY.NORMAL");break;case"recommendation":e.currentPackage=s.instant("COMPANY.PAYMENT.APPLY.RECOMMENDATION");break;case"professional":e.currentPackage=s.instant("COMPANY.PAYMENT.APPLY.PROFESSIONAL");break;case"none":default:e.currentPackage="none"}}e.companyObj.safeTitle=o.getUrlSafeString(e.companyObj.name),e.listUrl=n.href(n.current.name,{},{absolute:!0}),e.companyObj.logo_img.url?e.sellerImgSrc=e.companyObj.logo_img.url:e.sellerImgSrc=o.getAppAbsUrlRoot()+"/app/images/default-avatar.png",e.sellerTitle=e.companyObj.name,o.setWebTitle(e.sellerTitle),e.sellerDesc=e.companyObj.description,e.pageUrl=n.href(n.current.name,{},{absolute:!0}),void 0===r&&(r=document.location.href.split("#")[0]),a.openInIphone()&&(e.pageUrl=r),a.loadWeChatJsConf(e.pageUrl,{menuShareAppMessage:{title:e.sellerTitle,desc:e.sellerDesc,link:e.listUrl,imgUrl:e.sellerImgSrc},menuShareTimeline:{title:e.sellerTitle,link:e.listUrl,imgUrl:e.sellerImgSrc}})},function(t){e.gettingCompanyInfoErr=t.data}),e.displayExtendSection=function(){var e=document.getElementById("extendSection"),t=document.getElementById("extendBtn");"none"==e.style.display?(e.style.display="block",t.innerHTML=s.instant("CANCEL")):(e.style.display="none",t.innerHTML=s.instant("COMPANY.PAGE.EXTEND.PACKAGE"))},e.navToWechatAuthPage=function(){e.generatingOpenplatformLink=!0;var t=e.companyId,r={company_id:t,company_bind_appid_url:n.href("mixAuth.bindCompanyWithAppId",{companyId:t},{absolute:!0})};a.getPreAuthorizationUrl(r).then(function(e){i.location.href=e.data.url},{}).finally(function(){e.generatingOpenplatformLink=!1})},e.displayPaidFeatureModal=function(){o.displaySubscribeModal("PAID FEATURE")},e.showVoucherDetails=function(){e.showVoucherBtns=!e.showVoucherBtns}}}};angular.module("shmApp.directives").directive("companyInfo",["appConf","CompanyService","$state","WeChatService","UtilsService","AuthService","$window","$translate",m])}(),function(){"use strict";var e,t,n=function(n,a){return e=n,t=a,{restrict:"AE",scope:{companyObj:"<",pageSize:"<?",ifConsultation:"<",appUser:"<"},templateUrl:e.viewRootDir+"directives/company/itemList.html",link:function(e,n,a){e.getItems=function(n){var a={};return a.page=n||1,a.pageSize=e.pageSize||6,1==e.ifConsultation&&(a.pageSize=5),1===a.page?(e.gettingItems=!0,e.gettingItemsErr=void 0):(e.gettingMoreItems=!0,e.gettingMoreItemsErr=void 0),t.searchItemsUnderCompany(e.companyObj.id,{page:a.page,"page-size":a.pageSize,published:1}).then(function(t){a.page>1&&(a.previousData=e.itemList.data),e.itemList=t.data,a.page>1&&(e.itemList.data=a.previousData.concat(e.itemList.data))},function(t){1===a.page?e.gettingItemsErr=t.data:e.gettingMoreItemsErr=t.data}).finally(function(){e.gettingItems=!1,e.gettingMoreItems=!1}),e},e.getItems()}}};angular.module("shmApp.directives").directive("companyItemList",["appConf","ItemService",n])}(),function(){"use strict";var e,t,n,a=function(a,i,r){return e=a,t=i,n=r,{restrict:"AE",scope:{companyId:"<",hideTitle:"<?",appUser:"<?",hideManageBtn:"<?"},templateUrl:e.viewRootDir+"directives/company/userList.html",link:function(e,a,i){e.utilsService=n,e.getUsers=function(){return e.gettingUsers=!0,e.gettingUsersErr=void 0,t.getUserList(e.companyId).then(function(t){e.userList=t.data},function(t){e.gettingUsersErr=t.data}).finally(function(){e.gettingUsers=void 0}),e},e.$watch("companyId",function(t){t>""&&e.getUsers()})}}};angular.module("shmApp.directives").directive("companyUserList",["appConf","CompanyService","UtilsService",a])}(),function(){"use strict";var e,t,n,a=function(a,i,r){return e=a,t=i,n=r,{restrict:"AE",scope:{companyId:"<",hideTitle:"<?",appUser:"<?",hideManageBtn:"<?"},templateUrl:e.viewRootDir+"directives/company/userListNew.html",link:function(e,a,i){e.utilsService=n,e.getUsers=function(){return e.gettingUsers=!0,e.gettingUsersErr=void 0,t.getUserList(e.companyId).then(function(t){e.userList=t.data},function(t){e.gettingUsersErr=t.data}).finally(function(){e.gettingUsers=void 0}),e},e.$watch("companyId",function(t){t>""&&e.getUsers()}),e.navToLeft=function(){$("div#staff-list").animate({scrollLeft:"-=180"},300)},e.navToRight=function(){$("div#staff-list").animate({scrollLeft:"+=180"},300)}}}};angular.module("shmApp.directives").directive("companyUserListNew",["appConf","CompanyService","UtilsService",a])}(),function(){"use strict";var e,t,n=function(n,a){return e=n,t=a,{restrict:"AE",scope:{companyId:"<?",canEditSection:"<?"},templateUrl:e.viewRootDir+"directives/company/companySection.html",link:function(e,n,a){e.getCompanyTags=function(){t.getCompanySections(e.companyId).then(function(t){e.taglist=t.data,angular.forEach(e.taglist,function(e){e.tags=""===e.name?[]:e.name.split(" ")})},function(e){}).finally(function(){})},e.getCompanyTags()}}};angular.module("shmApp.directives").directive("companySection",["appConf","CompanyService",n])}(),function(){"use strict";var e,t,n,a=function(a,i,r){return e=a,t=i,n=r,{restrict:"AE",scope:{callback:"&?",id:"<?"},templateUrl:e.viewRootDir+"directives/company/companySectionManage.html",link:function(e,a,i){e.addTag=function(){e.sections.push({title:"",asset:"",column_number:2,first_page_size:2,load_page_size:2,tags:[]})},e.addEachImg=function(t){e.sections.push({title:"",tags:[],asset:"",column_number:2,first_page_size:2,load_page_size:2,imgArray:[t]})},e.delete=function(t){e.sections.splice(t,1)},e.moveUp=function(t){if(t>0){var n=e.sections[t];e.sections[t]=e.sections[t-1],e.sections[t-1]=n}},e.moveDown=function(t){if(t<e.sections.length-1){var n=e.sections[t];e.sections[t]=e.sections[t+1],e.sections[t+1]=n}},e.save=function(){t.createCompanySections(e.id,e.sections).then(function(t){e.itemList=t.data},function(e){}).finally(function(){n.go("mixAuth.companyItemSearch",{companyId:e.id},{reload:!0})})},e.getCompanyTags=function(){e.gettingSpecialTags=!0,t.getCompanySections(e.id).then(function(t){e.sections=t.data,angular.forEach(t.data,function(e){e.tags=""===e.name?[]:e.name.split(" ")})},function(e){}).finally(function(){e.gettingSpecialTags=!1})},e.getCompanyTags()}}};angular.module("shmApp.directives").directive("companySectionManage",["appConf","CompanyService","$state",a])}(),function(){"use strict";var e,t,n,a=function(a,i,r){return e=a,t=i,n=r,{restrict:"AE",scope:{item:"=ngModel",companyId:"<?"},templateUrl:e.viewRootDir+"directives/company/companySectionItem.html",link:function(e,t,a){e.getItems=function(t){var a={};a.pageNo=t||1,1===a.pageNo?(e.gettingItems=!0,e.gettingItemsErr=void 0):(e.gettingMoreItems=!0,e.gettingMoreItemsErr=void 0),e.item.column_number=e.item.column_number?e.item.column_number:2,e.item.first_page_size=e.item.first_page_size?e.item.first_page_size:2,a.params={tags:e.item.name,"page-size":e.item.first_page_size,page:a.pageNo},n.getItemsWithCompanyTags(e.companyId,a.params).then(function(t){a.pageNo>1&&(a.previousData=e.itemList.data),e.itemList=t.data,a.pageNo>1&&(e.itemList.data=a.previousData.concat(e.itemList.data)),e.data=e.itemList,e.callback&&"function"==typeof e.callback&&e.callback()(e.item,e.itemList)},function(t){1===a.pageNo?e.gettingItemsErr=t.data:e.gettingMoreItemsErr=t.data}).finally(function(){e.gettingItems=!1,e.gettingMoreItems=!1,e.length=e.itemList.data.length})},e.getItems()}}};angular.module("shmApp.directives").directive("companySectionItem",["appConf","CompanyService","ItemService",a])}(),function(){"use strict";var e,t,n,a,i=function(e,t,n){a=this,a.$uibModalInstance=e,a.cancel=function(){a.$uibModalInstance.dismiss("cancel")},a.companyId=n},r=function(a,r,o){return e=a,t=r,n=o,{restrict:"AE",scope:{companyId:"<?",canEditSection:"<?"},template:'<a ng-if="canEditSection === true" class="btn btn-default btn-sm company-section-edit-btn"  ng-click="showCompanyTagsEdit(companyId)"><i class="fa fa-pencil-square-o"></i></a>',link:function(e,t,a){e.showCompanyTagsEdit=function(e){n.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",template:'<company-section-manage callback="mdCtrl.cancel()" id="mdCtrl.companyId"></company-section-manage>',controller:["$uibModalInstance","$state","companyId",i],controllerAs:"mdCtrl",size:"lg",appendTo:void 0,resolve:{companyId:function(){return e}}})}}}};angular.module("shmApp.directives").directive("companySectionManageModal",["appConf","CompanyService","$uibModal",r])}(),function(){"use strict";var e,t,n=function(n,a,i){return e=n,t=a,{restrict:"AE",scope:{companyId:"<",appUser:"<",ifJumpToHomePage:"<?",callBackFunc:"&?"},templateUrl:e.viewRootDir+"directives/company/companyNavBtns.html",link:function(e,n,a){e.UtilsService=i,a.companyId&&t.getCompanyDetails(e.companyId).then(function(t){e.companyObj=t.data},function(t){e.gettingCompanyInfoErr=t.data})}}};angular.module("shmApp.directives").directive("companyNavBtns",["appConf","CompanyService","UtilsService",n])}(),function(){"use strict";var e,t,n,a,i,r=function(r,o,c,s,m){return e=r,t=o,n=c,a=s,i=m,{restrict:"A",scope:{appUser:"<?",company:"<"},template:'<div class="mark-fav-btn-wrapper"><i class="fa fa-2x ng-class:{\'text-muted fa-star-o\': company.is_fav_by_current_user !== true, \'faved-by-user fa-star\': company.is_fav_by_current_user === true}"></i><div class="text" ng-bind-html="(\'ITEM_FAVOURITE\' | translate)"></div></div>',link:function(e,r,o){r.on("click",function(){var r={};r.asFav=!e.company.is_fav_by_current_user,e.submitting=!0,e.submittingErr=void 0,r.serviceFunc=!0===r.asFav?t.markAsFavourite(e.company.id):t.removeAsFavourite(e.company.id),r.serviceFunc.then(function(t){t.data&&t.data.auth_url?i.loginAndRedirect(a.current):t.data&&t.data.id&&(e.company.is_fav_by_current_user=t.data.is_fav_by_current_user,e.company.followers=t.data.followers,"mixAuth.companyItemSearch"===a.current.name&&a.go("mixAuth.companyItemSearch",{companyId:e.company.id},{reload:!0,inherit:!1}))},function(t){e.submittingErr=t.data}).finally(function(){e.submitting=!1}),e.appUser&&e.appUser.id&&void 0!==e.appUser.wechat_is_subscriber&&1!==parseInt(e.appUser.wechat_is_subscriber)&&n.displaySubscribeModal()})}}};angular.module("shmApp.directives").directive("companyMarkAsFavouriteBtn",["appConf","CompanyService","UtilsService","$state","WeChatService",r])}(),function(){"use strict";var e,t,n,a,i=function(i,r,o,c){return e=i,t=r,n=o,a=c,{restrict:"AE",templateUrl:e.viewRootDir+"directives/company/favCompanyList.html",scope:{appUser:"<"},controller:["$scope",function(e){e.getCompanies=function(t){var n={};n.page=t||1,1===n.page?(e.gettingItems=!0,e.gettingItemsErr=void 0):(e.gettingMoreItems=!0,e.gettingMoreItemsErr=void 0),o.getFavCompanies({page:n.page}).then(function(t){n.page>1&&(n.previousData=e.companyList.data),e.companyList=t.data,n.page>1&&(e.companyList.data=n.previousData.concat(e.companyList.data))},function(t){1===n.page?e.gettingItemsErr=t.data:e.gettingMoreItemsErr=t.data}).finally(function(){angular.forEach(e.companyList.data,function(e){e.safeTitle=a.getUrlSafeString(e.name)}),e.gettingItems=void 0,e.gettingMoreItems=void 0})},e.getCompanies()}]}};angular.module("shmApp.directives").directive("favCompanyListPanel",["appConf","$translate","CompanyService","UtilsService",i])}(),function(){"use strict";var e,t,n=function(n,a){return e=n,t=a,{restrict:"AE",scope:{company:"<"},templateUrl:e.viewRootDir+"directives/company/companyThumbnail.html",link:function(e,n,a){e.company&&(e.imgSrc=t.getCompanyDefaultImageUrl(e.company))}}};angular.module("shmApp.directives").directive("companyThumbnail",["appConf","UtilsService",n])}(),function(){"use strict";var e,t,n,a,i,r,o,c=function(t){i.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/company/comments/addCompanyComment.html",controller:"CompanyAddCommentModalCtrl",controllerAs:"ctrl",size:void 0,appendTo:void 0,resolve:{companyId:function(){return t}}})},s=function(e,i,r){var c={};n=this,n.companyId=i,n.$uibModalInstance=e,n.currentComment={},n.save=function(){c.params={company_id:a.companyId,comments:n.currentComment.newComment,company_url:o.href("mixAuth.companyItemSearch",{companyId:a.companyId},{absolute:!0,inherit:!1})},n.sendingCompanyComment=!0,n.sendingCompanyCommentErr=void 0,t.addCommentToAnCompany(a.companyId,c.params).then(function(e){n.sendingCompanyComment=!1,n.cancel(),o.go("mixAuth.companyItemSearch",{companyId:a.companyId},{reload:!0,inherit:!1})},function(e){n.sendingCompanyCommentErr=e.data,n.sendingCompanyComment=!1}).finally(function(){n.sendingCompanyComment=!1})},n.cancel=function(){n.$uibModalInstance.dismiss("cancel")}},m=function(e,t){a=e},u=function(n,a,s,u,l){return e=n,i=s,t=a,r=u,o=l,{restrict:"A",scope:{companyId:"<"},template:"",controller:["$scope","$state",m],link:function(e,t,n){angular.element(t).click(function(){c(e.companyId)})}}};angular.module("shmApp.directives").controller("CompanyAddCommentModalCtrl",["$uibModalInstance",s]).directive("companyAddCommentBtn",["appConf","CompanyService","$uibModal","$window","$state",u])}(),function(){"use strict";var e,t,n,a,i=function(e,t){},r=function(r,o,c,s){return e=r,t=o,n=c,a=s,{restrict:"AE",templateUrl:e.viewRootDir+"directives/company/comments/announcement_list.html",scope:{companyId:"=",appUser:"<",pageSize:"<?",isCompanyAdmin:"=",companyObj:"=?",hideTitle:"<?",hasRecords:"=?"},controller:["$scope","$state",i],link:function(e,n,a){e.getCompanyAnnouncements=function(n){var a={};a.pageNo=n||1,e.gettingCompanyAnnouncementsErr=void 0,e.gettingMoreCompanyAnnouncementsErr=void 0,1===a.pageNo?e.gettingCompanyAnnouncements=!0:e.gettingMoreCompanyAnnouncements=!0,t.getCompanyComments(e.companyId,{page:a.pageNo,"page-size":3}).then(function(t){1!==a.pageNo&&(a.previousData=e.companyAnounList.data),e.companyAnounList=t.data,1!==a.pageNo&&(e.companyAnounList.data=a.previousData.concat(e.companyAnounList.data)),e.hasRecords=0!=e.companyAnounList.data.length},function(t){1===a.pageNo?e.gettingCompanyAnnouncementsErr=t.data:e.gettingMoreCompanyAnnouncementsErr=t.data}).finally(function(){e.gettingCompanyAnnouncements=!1,e.gettingMoreCompanyAnnouncements=!1})},e.getCompanyAnnouncements()}}};angular.module("shmApp.directives").directive("companyAnounList",["appConf","CompanyService","$state","UtilsService",r])}(),function(){"use strict";var e,t=function(t,n){return e=t,{restrict:"AE",templateUrl:e.viewRootDir+"directives/company/comments/announcementListItem.html",scope:{itemCommentsObj:"=",pageSize:"<?",refreshCallback:"&",cbForCommentsAdded:"&?",isCompanyAdmin:"="},link:function(e,t,n){e.addedCompanyCommentsObj=function(t){"function"==typeof e.cbForCommentsAdded&&"function"==typeof e.cbForCommentsAdded()&&e.cbForCommentsAdded()(t)}}}};angular.module("shmApp.directives").directive("companyAnounListItem",["appConf","$state",t])}(),function(){"use strict";var e,t,n,a,i=function(e,n,i,r){a=this,a.$uibModalInstance=e,a.messageObj=n,a.isCompanyAdmin=r,a.cancel=function(){a.$uibModalInstance.close("cancel")},a.delete=function(e){a.deletingCompanyComment=!0,t.deleteCompanyComment(e,{id:e}).then(function(){a.deletingCompanyComment=!1,a.cancel(),i.go("mixAuth.companyItemSearch",{companyId:n.company_id},{reload:!0,inherit:!1})})}},r=function(t,a){n.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/company/comments/showCompanyComment.html",controller:["$uibModalInstance","messageObj","$state","isCompanyAdmin",i],controllerAs:"mdCtrl",size:void 0,appendTo:void 0,resolve:{messageObj:function(){return t},isCompanyAdmin:function(){return a}}})},o=function(a,i,o){return e=a,t=i,n=o,{restrict:"AE",scope:{messageObj:"<?",msgId:"<?",isCompanyAdmin:"="},link:function(e,n,a){n.on("click",function(){r(e.messageObj,e.isCompanyAdmin)}),e.msgId&&t.getACompanyComment(e.msgId).then(function(e){r(e.data)},function(t){e.gettingCommentErr=t.data}).finally(function(){})}}};angular.module("shmApp.directives").directive("companyShowComment",["appConf","CompanyService","$uibModal",o])}(),function(){"use strict";var e,t,n,a,i=function(n){t.gettingBanners=!0,t.gettingBannersErr=void 0,a.getCompanyBanners(n).then(function(n){if(t.banners=n.data,0===t.banners.length){var a=e.imagesRootDir+"company-default.jpg",i={asset:{url:a}};t.banners.unshift(i)}},function(e){t.gettingBannersErr=e.data}).finally(function(){t.gettingBanners=!1})},r=function(r,o,c){return e=r,n=o,a=c,{restrict:"AE",scope:{companyId:"=",canEditBanner:"="},templateUrl:e.viewRootDir+"directives/company/home/companyHomeSlider.html",link:function(n,a,r){t=n,t.appConf=e,i(t.companyId)}}};angular.module("shmApp.directives").directive("companyHomeSlider",["appConf","CompanyService","BannerService",r])}(),function(){"use strict";var e,t,n,a,i,r=function(e,n,a,r,o){i=this,i.$uibModalInstance=e,i.company=n,i.callback=r,i.location=a,i.editMode=!1,void 0!==i.location&&(i.editMode=!0),i.location&&(i.title=i.location.title,i.address=i.location.address,i.description=i.location.description),i.cancel=function(){i.$uibModalInstance.close("cancel")},i.save=function(){if(i.title&&i.address&&i.description){i.loading=!0;var e={title:i.title,address:i.address,description:i.description};i.editMode?t.updateCompanyPickupLocation(i.company.id,i.location.id,e).then(function(e){i.loading=!1,i.$uibModalInstance.close("cancel"),i.callback()(i.company.id)},function(e){i.gettingPickupLocationsError=e.data}):t.createCompanyPickupLocation(i.company.id,e).then(function(e){i.loading=!1,i.$uibModalInstance.close("cancel"),i.callback()(i.company.id)},function(e){i.gettingPickupLocationsError=e.data})}}},o=function(t,n,i){a.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/company/home/companyPickupLocation.html",controller:["$uibModalInstance","company","location","callback","$state",r],controllerAs:"mdCtrl",size:void 0,appendTo:void 0,resolve:{company:function(){return t},location:function(){return n},callback:function(){return i}}})},c=function(i,r,c,s){return e=i,t=r,n=c,a=s,{restrict:"AE",scope:{company:"<",location:"<?",callback:"&?"},link:function(e,t,n){angular.element(t).click(function(){o(e.company,e.location,e.callback)})}}};angular.module("shmApp.directives").directive("companyPickupLocation",["appConf","CompanyService","BannerService","$uibModal",c])}(),function(){"use strict";var e,t,n,a,i,r=function(e,t,n){i=this,i.$uibModalInstance=e,i.companyId=t,i.cancel=function(){i.$uibModalInstance.close("cancel")}},o=function(t){a.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"mixAuth/banner/manage.html",controller:["$uibModalInstance","companyId","$state",r],controllerAs:"mdCtrl",size:void 0,appendTo:void 0,resolve:{companyId:function(){return t}}})},c=function(i,r,c,s){return e=i,t=r,n=c,a=s,{restrict:"AE",scope:{companyId:"="},link:function(e,t,n){angular.element(t).click(function(){o(e.companyId)})}}};angular.module("shmApp.directives").directive("companyBannerManage",["appConf","CompanyService","BannerService","$uibModal",c])}(),function(){"use strict";var e,t,n,a,i=function(i,r,o,c){return e=i,t=r,n=o,a=c,{restrict:"AE",templateUrl:e.viewRootDir+"directives/company/list.html",scope:{userCompany:"<?",isAdmin:"<"},link:function(e,t,i){e.switchTab=function(t){angular.forEach(e.tabs,function(e){e.selected=!1}),e.tabs[t].selected=!0,e.getCompanies()},e.getCompanies=function(t,n){
        var i={};if(i.page=t||1,1===i.page?(e.gettingItems=!0,e.gettingItemsErr=void 0):(e.exclude_id=e.companyList.data[0].id,e.gettingMoreItems=!0,e.gettingMoreItemsErr=void 0),!0===e.isAdmin){var r=_.findWhere(e.tabs,{selected:!0}).name;i.params={page:i.page,keyword:n,filterSandbox:!0,tagName:r,"page-size":8},e.exclude_id&&(i.params.exclude_id=e.exclude_id),o.getAllCompanies(i.params).then(function(t){1!==i.page?(i.previousData=e.companyList.data,e.companyList=t.data,e.companyList.data=i.previousData.concat(e.companyList.data)):e.companyList=t.data,e.companyList.hasMore=e.companyList.to<e.companyList.total},function(t){1===i.page?e.gettingItemsErr=t.data:e.gettingMoreItemsErr=t.data}).finally(function(){angular.forEach(e.companyList.data,function(e){e.safeTitle=a.getUrlSafeString(e.name)}),e.gettingItems=void 0,e.gettingMoreItems=void 0})}else e.companyList={data:[]},e.companyList.data=e.userCompany,e.companyList.hasMore=!1,angular.forEach(e.companyList.data,function(e){e.safeTitle=a.getUrlSafeString(e.name)})},e.getTags=function(){n.getTagsList().then(function(t){t.data.length>0&&(e.tabs=[],angular.forEach(t.data,function(t,n){var a=0===n,i={name:t,selected:a};e.tabs.push(i)}),e.getCompanies())})},e.getTags()}}};angular.module("shmApp.directives").directive("companyList",["appConf","$translate","CompanyService","UtilsService",i])}(),function(){"use strict";var e,t,n,a,i=function(i,r,o,c){return e=i,t=r,n=o,a=c,{restrict:"AE",scope:{pageSize:"<?",companyId:"<?",gridListSwitchBar:"<?",itemListOut:"<?",getItemsOut:"<?",gettingItemsOut:"<?",gettingItemsErrOut:"<?",gettingMoreItemsOut:"<?",gettingMoreItemsErrOut:"<?",appUser:"="},templateUrl:e.viewRootDir+"directives/company/gridOrList.html",link:function(e,t,i){e.getCompanyInfor=function(){n.getCompanyDetails(e.companyId).then(function(t){if(t.data.config){var n=JSON.parse(t.data.config);e.ifChangeToGrid=n.ifChangeToGrid,e.filterOfItemsDisplay=n.filterOfItemsDisplay}},function(e){}).finally(function(){})},e.getCompanyInfor(),e.setDisplay=function(t,i){var r={ifChangeToGrid:t,filterOfItemsDisplay:i},o=JSON.stringify(r);n.displayCompanyItems(e.companyId,{config:o}).then(function(t){var n=JSON.parse(t.data.config);e.ifChangeToGrid=n.ifChangeToGrid,e.filterOfItemsDisplay=n.filterOfItemsDisplay,a.go("mixAuth.companyItemSearch",{companyId:e.companyId},{reload:!0,inherit:!1})},function(e){})}}}};angular.module("shmApp.directives").directive("companyItemGridOrList",["appConf","ItemService","CompanyService","$state",i])}(),function(){"use strict";var e,t,n,a,i,r,o,c=function(c,s,m,u,l,p,d){return e=c,n=m,a=u,t=s,i=l,r=p,o=d,{restrict:"AE",scope:{appUser:"<"},templateUrl:e.viewRootDir+"directives/company/companyPaymentClearance.html",link:function(e,t,n){e.appUser||i.go("mixAuth.community",{},{reload:!1}),e.appUser&&0==e.appUser.is_admin&&i.go("mixAuth.community",{},{reload:!1}),e.fetechClearedVendorsPayments=function(t){e.gettingItems=!0,o.getPaidCompanyReceipts().then(function(t){var n=t.data;e.vendorPayments=r.processVendorPaymentWithGroupId(n)},function(e){}).finally(function(){e.gettingItems=!1})},e.fetechUnclearedCompaniesReceipts=function(t){e.gettingReceipts=!0,o.getUnpaidCompanyReceipts().then(function(t){var n=t.data;e.receiptList=r.processAllReceiptAllCompanies(n)},function(e){}).finally(function(){e.gettingReceipts=!1})},e.fetechClearedVendorsPayments(),e.fetechUnclearedCompaniesReceipts()}}};angular.module("shmApp.directives").directive("companyPaymentClearance",["appConf","$translate","CompanyService","WeChatService","$state","UtilsService","PaymentService",c])}(),function(){"use strict";var e,t,n,a,i,r,o,c=function(c,s,m,u,l,p,d){return e=c,n=m,a=u,t=s,i=l,r=p,o=d,{restrict:"AE",scope:{appUser:"<"},templateUrl:e.viewRootDir+"directives/company/companyPaymentClearanceMobile.html",link:function(e,t,n){e.appUser||i.go("mixAuth.community",{},{reload:!1}),e.appUser&&0==e.appUser.is_admin&&i.go("mixAuth.community",{},{reload:!1}),e.currentTab="UNPAID",e.switchTabs=function(t){switch(e.currentTab=t,t){case"UNPAID":e.fetechUnclearedCompaniesReceipts();break;case"PAID":e.fetechClearedVendorsPayments()}},e.cancelPreview=function(){e.ifPreview=!1,e.pageUrl="",e.switchTabs(e.currentTab)},e.preview=function(){e.previewList={},angular.forEach(e.receiptList,function(t){angular.forEach(t.companies,function(t,n){1==t.flag&&(e.previewList[n]||(e.previewList[n]=_.omit(t,"items")),e.previewList[n].items||(e.previewList[n].items={}),angular.forEach(t.items,function(t,a){e.previewList[n].items[a]||(e.previewList[n].items[a]=_.omit(t,"receipts")),e.previewList[n].items[a].receipts||(e.previewList[n].items[a].receipts={}),angular.forEach(t.receipts,function(t,i){e.previewList[n].items[a].receipts[i]||(e.previewList[n].items[a].receipts[i]=t)})}))})}),e.ifPreview=!0},e.price=0,e.companyChange=function(){e.price=0,angular.forEach(e.receiptList,function(t){angular.forEach(t.companies,function(t){1==t.flag&&angular.forEach(t.items,function(t){angular.forEach(t.receipts,function(t){e.price+=t.amount})})})})},e.submit=function(){var t={company_receipt_ids:{}};angular.forEach(e.receiptList,function(e){angular.forEach(e.companies,function(e){1==e.flag&&angular.forEach(e.items,function(n){angular.forEach(n.receipts,function(a){t.company_receipt_ids[n.company.id]||(t.company_receipt_ids[n.company.id]=[]),t.company_receipt_ids[e.id].push(a.id)})})})}),e.fetching=!0,o.generateABA(t).then(function(t){t.data&&(e.pageUrl=t.data.aba_file_url)},function(t){e.gettingItemsErr=t.data}).finally(function(){e.fetching=!1})},e.dateStart=new Date,e.dateStart=e.dateStart.setDate(e.dateStart.getDate()-7),e.dateEnd=new Date,e.fetechUnclearedCompaniesReceipts=function(){e.gettingReceipts=!0;var t={start_date:moment(moment(e.dateStart)).utc().format("YYYY-MM-DD HH:mm:ss"),end_date:moment(moment(e.dateEnd)).utc().format("YYYY-MM-DD HH:mm:ss"),keyword:e.keyword};o.getUnpaidCompanyReceipts(t).then(function(t){var n=t.data;e.receiptList=r.processAllReceiptAllCompanies(n),e.receiptListEmpty=_.isEmpty(e.receiptList)},function(e){}).finally(function(){e.gettingReceipts=!1})},e.fetechClearedVendorsPayments=function(){e.gettingVendorPayments=!0;var t={start_date:moment(moment(e.dateStart)).utc().format("YYYY-MM-DD HH:mm:ss"),end_date:moment(moment(e.dateEnd)).utc().format("YYYY-MM-DD HH:mm:ss"),keyword:e.keyword};o.getPaidCompanyReceipts(t).then(function(t){var n=t.data;e.vendorPayments=r.processVendorPaymentWithGroupId(n),e.vendorPaymentsEmpty=_.isEmpty(e.vendorPayments)},function(e){}).finally(function(){e.gettingVendorPayments=!1})},e.reGenerateABA=function(t){var n={vendor_payment_id:{},payment_group_id:t};angular.forEach(e.vendorPayments,function(e){angular.forEach(e.payments,function(e){angular.forEach(e.vendors,function(e){e.vendor_payment_group_id==t&&(n.vendor_payment_id[e.company.id]||(n.vendor_payment_id[e.company.id]=[]),n.vendor_payment_id[e.company.id].push(e.id))})})}),e.fetching=!0,o.reGenerateABA(n).then(function(t){t.data&&(e.pageUrl=t.data.aba_file_url)},function(t){e.gettingItemsErr=t.data}).finally(function(){e.fetching=!1})},e.switchTabs(e.currentTab)}}};angular.module("shmApp.directives").directive("companyPaymentClearanceMobile",["appConf","$translate","CompanyService","WeChatService","$state","UtilsService","PaymentService",c])}(),function(){"use strict";var e,t,n,a,i,r=function(r,o,c,s,m){return e=r,t=o,n=c,a=s,i=m,{restrict:"AE",scope:{appUser:"<"},templateUrl:e.viewRootDir+"directives/company/oneCompanyPaymentClearance.html",link:function(e,r,o){e.companyId=a.params.companyId,e.getCompanyInfo=function(){i.getCompanyDetails(e.companyId).then(function(t){e.companyName=t.data.name},function(e){})},e.fetechUnclearedReceipts=function(){e.gettingReceipts=!0,t.getUnpaidReceiptsForACompany(e.companyId).then(function(t){var a=t.data;e.unpaidReceipts=n.processAllReceiptAllCompanies(a)},function(t){e.loadingErr=t.data}).finally(function(){e.gettingReceipts=!1})},e.fetechClearedVendorPayments=function(){e.gettingItems=!0,t.getPaidVendorPaymentsForACompany(e.companyId).then(function(t){var a=t.data;e.vendorPayments=n.processMulvendorPayment(a)},function(t){e.loadingErr=t.data}).finally(function(){e.gettingItems=!1})},e.getCompanyInfo(),e.fetechUnclearedReceipts(),e.fetechClearedVendorPayments()}}};angular.module("shmApp.directives").directive("oneCompanyPaymentClearance",["appConf","PaymentService","UtilsService","$state","CompanyService",r])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s,m=function(m,u,l,p,d,g,f,h,y){return e=m,t=u,n=l,a=p,i=d,r=g,o=f,c=h,s=y,{restrict:"AE",scope:{companyId:"<",appUser:"<"},templateUrl:e.viewRootDir+"directives/company/template/companyPageTemplate.html",link:function(e,n,a){s.hideContactUsQr=!0;var r=o.localStorage.getItem("showManagSection");e.previewMode=!0===r||"true"===r,e.utilsService=i,e.isSameCompany=!(!e.appUser||!e.appUser.id)&&i.adminOfCompany(e.appUser.adminOfCompanyIds,e.companyId,e.appUser.is_admin),e.getCompanyInfor=function(){t.getCompanyDetails(e.companyId).then(function(t){if(e.company=t.data,t.data.admin_config){var n=JSON.parse(t.data.admin_config);e.ifOnlinePayment=!0===n.ifOnlinePayment}if(t.data.config){var a=JSON.parse(t.data.config);e.trustAddressUrl=a.address?c.trustAsResourceUrl("https://www.google.com/maps/embed/v1/place?key=AIzaSyC54M7x-ybIYncE4hLfAMIzkDAiCKhfQ6M&q="+a.address):"",e.address=a.address?a.address:"",e.slogan=a.slogan?a.slogan:""}})},e.getShortListOfAnnoucement=function(){t.getCompanyComments(e.companyId,{page:1,"page-size":3}).then(function(t){e.companyAnounList=t.data})},e.toStorage=function(){o.localStorage.setItem("showManagSection",JSON.stringify(e.previewMode))},e.getShortListOfAnnoucement(),e.getCompanyInfor()}}};angular.module("shmApp.directives").directive("companyPageTemplate",["appConf","CompanyService","ItemService","AuthService","UtilsService","$state","$window","$sce","$rootScope",m])}(),function(){"use strict";var e,t,n,a=function(a,i,r){return e=a,t=i,n=r,{restrict:"AE",scope:{modelList:"=",gettingItems:"=?",gettingItemsErr:"=?",gettingMoreItems:"=?",gettingMoreItemsErr:"=?",itemsPerRow:"<?",showMoreBtn:"<?",topRightFieldName:"@?",getItemsFunc:"&?",isInfiniteScroll:"<?"},templateUrl:e.viewRootDir+"directives/company/template/companyItemGrid.html",link:function(e,a,i){e.itemsPerRow=angular.isDefined(e.itemsPerRow)?e.itemsPerRow:2,e.showMoreBtn=!0===e.showMoreBtn,e.refreshLazyImg=function(){t(function(){n.$emit("lazyImg:refresh")},100)},e.refreshLazyImg(),e.getGridCssClass=function(){return"grid-column-"+e.itemsPerRow},e.hasGetItemsFunc="function"==typeof e.getItemsFunc&&"function"==typeof e.getItemsFunc()}}};angular.module("shmApp.directives").directive("companyItemGrid",["appConf","$timeout","$rootScope",a])}(),function(){"use strict";var e,t,n,a=function(a,i,r){return e=a,t=i,n=r,{restrict:"AE",scope:{companyId:"<",company:"<?"},templateUrl:e.viewRootDir+"directives/company/template/companyTemplateFooter.html",link:function(e,t,a){e.searchItemsUnderCompany=function(t){var a={};a.pageNo=t||1,a.params={"key-word":e.searchKeyWord,"order-by":e.searchItemOrderBy,page:a.pageNo,"page-size":5},e.itemSearchStatus&&(a.params.published=e.itemSearchStatus.published,a.params.expired=e.itemSearchStatus.expired,a.params.sold=e.itemSearchStatus.sold),n.searchItemsUnderCompany(e.companyId,a.params).then(function(t){e.itemList=t.data},function(t){1===a.pageNo?e.searchItemErr=t.data:e.searchingMoreItemsErr=t.data}).finally(function(){e.searchingItems=!1,e.searchingMoreItems=!1})},e.searchItemsUnderCompany()}}};angular.module("shmApp.directives").directive("companyTemplateFooter",["appConf","CompanyService","ItemService",a])}(),function(){"use strict";var e,t,n,a,i=function(i,r,o,c){return e=i,t=r,n=o,a=c,{restrict:"AE",scope:{companyId:"<",appUser:"<?"},templateUrl:e.viewRootDir+"directives/company/template/companyTemplateConsultation.html",link:function(e,t,i){e.utilsService=a,e.searchConsultationsUnderCompany=function(t){var i={};i.pageNo=t||1,i.params={"key-word":e.searchKeyWord,"order-by":e.searchItemOrderBy,page:i.pageNo,"page-size":4},e.itemSearchStatus&&(i.params.published=e.itemSearchStatus.published,i.params.expired=e.itemSearchStatus.expired,i.params.sold=e.itemSearchStatus.sold),1===i.pageNo?(e.searchingItems=!0,e.searchingItemsErr=void 0):(e.searchingMoreItems=!0,e.searchingMoreItemsErr=void 0),n.searchItemsUnderCompanyOnlyForConsultation(e.companyId,i.params).then(function(t){i.pageNo>1&&(i.previousData=e.itemList.data),e.itemList=t.data,angular.forEach(e.itemList.data,function(e){e&&e.images_in_diff_sizes&&(e.imgSrc=a.getItemDefaultThumbnailUrl(e))}),i.pageNo>1&&(e.itemList.data=i.previousData.concat(e.itemList.data)),e.itemList.hasMore=e.itemList.current_page<e.itemList.last_page},function(t){1===i.pageNo?e.searchItemErr=t.data:e.searchingMoreItemsErr=t.data}).finally(function(){e.searchingItems=!1,e.searchingMoreItems=!1})},e.searchConsultationsUnderCompany()}}};angular.module("shmApp.directives").directive("companyTemplateConsultation",["appConf","CompanyService","ItemService","UtilsService",i])}(),function(){"use strict";var e,t,n,a,i,r=function(r,o,c,s,m){return e=r,t=o,n=c,a=s,i=m,{restrict:"AE",scope:{companyId:"<",appUser:"<?",previewMode:"<?"},templateUrl:e.viewRootDir+"directives/company/template/companyTemplateConsultationNew.html",link:function(e,t,r){e.utilsService=a,e.searchConsultationsUnderCompany=function(t){var r={};r.pageNo=t||1,r.params={"key-word":e.searchKeyWord,"order-by":e.searchItemOrderBy,page:r.pageNo,"page-size":7},e.itemSearchStatus&&(r.params.published=e.itemSearchStatus.published,r.params.expired=e.itemSearchStatus.expired,r.params.sold=e.itemSearchStatus.sold),1===r.pageNo?(e.searchingItems=!0,e.searchingItemsErr=void 0):(e.searchingMoreItems=!0,e.searchingMoreItemsErr=void 0),n.searchItemsUnderCompanyOnlyForConsultation(e.companyId,r.params).then(function(t){r.pageNo>1&&(r.previousData=e.itemList.data),e.itemList=t.data;var n=moment().subtract(1,"day").local().format();angular.forEach(e.itemList.data,function(e){var t=moment(moment.utc(e.date_publish)).local().format();e.latest_post=n<t,e&&e.images&&e.images.length>0?e.imgSrc=a.getItemDefaultThumbnailUrl(e):e.imgSrc=""}),r.pageNo>1&&(e.itemList.data=r.previousData.concat(e.itemList.data)),e.itemRowArray=[];angular.forEach(e.itemList.data,function(t){var n=e.itemRowArray.length;0===n&&(e.itemRowArray.push({items:[]}),n+=1);var a=e.itemRowArray[e.itemRowArray.length-1],r=!1;(n+1)%3==0&&(r=!0);var o=!1;r&&3===a.items.length?o=!0:r||2!==a.items.length||(o=!0),!0===o&&(e.itemRowArray.push({items:[]}),n+=1),i(function(){t.isShowBlock=!0},50),e.itemRowArray[e.itemRowArray.length-1].items.push(t)}),e.itemList.hasMore=e.itemList.current_page<e.itemList.last_page},function(t){1===r.pageNo?e.searchItemErr=t.data:e.searchingMoreItemsErr=t.data}).finally(function(){e.searchingItems=!1,e.searchingMoreItems=!1})},e.searchConsultationsUnderCompany()}}};angular.module("shmApp.directives").directive("companyTemplateConsultationNew",["appConf","CompanyService","ItemService","UtilsService","$timeout",r])}(),function(){"use strict";var e,t,n,a,i,r,o,c=function(c,s,m,u,l,p,d){return e=c,t=s,n=m,a=u,i=l,r=p,o=d,{restrict:"AE",scope:{companyId:"<",appUser:"<",company:"<?",ifOnlinePayment:"<?",previewMode:"<"},templateUrl:e.viewRootDir+"directives/company/template/companyTemplateHeader.html",link:function(e,t,n){e.showToggle=!1,e.toggle=function(){e.showToggle=!1===e.showToggle},i.onscroll=function(){e.showNav=!1,i.scrollY>100&&(e.showNav=!0),e.$apply()},e.utilsService=a,e.loginAndRedirect=function(){r.loginAndRedirect(o.current)}}}};angular.module("shmApp.directives").directive("companyTemplateHeader",["appConf","CompanyService","ItemService","UtilsService","$window","WeChatService","$state",c])}(),function(){"use strict";var e,t,n,a,i=function(i,r,o,c){return e=i,t=r,n=o,a=c,{restrict:"AE",scope:{companyId:"<",appUser:"<?",previewMode:"<?"},templateUrl:e.viewRootDir+"directives/company/template/companyTemplateProduct.html",link:function(i,r,o){i.utilsService=a,i.getUsers=function(){return i.gettingUsers=!0,i.gettingUsersErr=void 0,t.getUserList(i.companyId).then(function(e){i.userList=e.data},function(e){i.gettingUsersErr=e.data}).finally(function(){i.gettingUsers=void 0}),i},i.img=e.imagesRootDir+"banner_properta.jpeg",i.image=e.imagesRootDir+"xinjinshan-logo.png",i.searchItemsUnderCompany=function(e){var t={};t.pageNo=e||1,t.params={"key-word":i.searchKeyWord,"order-by":i.searchItemOrderBy,page:t.pageNo,"page-size":4},i.itemSearchStatus&&(t.params.published=i.itemSearchStatus.published,t.params.expired=i.itemSearchStatus.expired,t.params.sold=i.itemSearchStatus.sold),1===t.pageNo?(i.searchingItems=!0,i.searchingItemsErr=void 0):(i.searchingMoreItems=!0,i.searchingMoreItemsErr=void 0),n.searchItemsUnderCompanyOnlyForProduct(i.companyId,t.params).then(function(e){t.pageNo>1&&(t.previousData=i.itemList.data),i.itemList=e.data,t.pageNo>1&&(i.itemList.data=t.previousData.concat(i.itemList.data)),i.itemList.hasMore=i.itemList.current_page<i.itemList.last_page},function(e){1===t.pageNo?i.searchItemErr=e.data:i.searchingMoreItemsErr=e.data}).finally(function(){i.searchingItems=!1,i.searchingMoreItems=!1})},i.searchItemsUnderCompany()}}};angular.module("shmApp.directives").directive("companyTemplateProduct",["appConf","CompanyService","ItemService","UtilsService",i])}(),function(){"use strict";var e,t,n,a,i,r,o,c=function(c,s,m,u,l,p,d){return e=c,t=s,n=m,a=u,i=l,r=p,o=d,{restrict:"AE",scope:{appUser:"<?"},templateUrl:e.viewRootDir+"directives/company/template/companyTemplateSearch.html",link:function(e,c,s){e.keyWord=i.params.keyWord,e.companyId=i.params.companyId,e.utilsService=a;var m=o.localStorage.getItem("showManagSection");e.previewMode=!0===m||"true"===m;r.detectIfUseTemplate(!0),e.getCompanyInfor=function(){t.getCompanyDetails(e.companyId).then(function(t){if(e.company=t.data,t.data.admin_config){var n=JSON.parse(t.data.admin_config);e.ifOnlinePayment=!0===n.ifOnlinePayment}})},e.searchItemsUnderCompany=function(t){var a={};a.pageNo=t||1,a.params={"key-word":e.keyWord,page:a.pageNo,"page-size":8},e.itemSearchStatus&&(a.params.published=e.itemSearchStatus.published,a.params.expired=e.itemSearchStatus.expired,a.params.sold=e.itemSearchStatus.sold),1===a.pageNo?(e.searchingItems=!0,e.searchingItemsErr=void 0):(e.searchingMoreItems=!0,e.searchingMoreItemsErr=void 0),n.searchItemsUnderCompany(e.companyId,a.params).then(function(t){a.pageNo>1&&(a.previousData=e.itemList.data),e.itemList=t.data,a.pageNo>1&&(e.itemList.data=a.previousData.concat(e.itemList.data)),e.itemList.hasMore=e.itemList.current_page<e.itemList.last_page},function(t){1===a.pageNo?e.searchItemErr=t.data:e.searchingMoreItemsErr=t.data}).finally(function(){e.searchingItems=!1,e.searchingMoreItems=!1})},e.searchItemsUnderCompany(),e.getCompanyInfor()}}};angular.module("shmApp.directives").directive("companyTemplateSearch",["appConf","CompanyService","ItemService","UtilsService","$state","$rootScope","$window",c])}(),function(){"use strict";var e,t,n,a,i,r=function(r,o,c,s,m){return e=r,t=o,n=c,a=s,i=m,{restrict:"AE",scope:{slogan:"<",company:"<"},templateUrl:e.viewRootDir+"directives/company/template/companyTemplateSlogan.html",link:function(e,t,n){}}};angular.module("shmApp.directives").directive("companyTemplateSlogan",["appConf","CompanyService","ItemService","UtilsService","$window",r])}(),function(){"use strict";var e,t,n,a,i=function(e,t){},r=function(r,o,c,s){return e=r,t=o,n=c,a=s,{restrict:"AE",templateUrl:e.viewRootDir+"directives/company/template/companyTemplateAnnouncement.html",scope:{companyId:"=",appUser:"<",pageSize:"<?",isCompanyAdmin:"=",companyObj:"=?",previewMode:"<?"},controller:["$scope","$state",i],link:function(e,n,i){e.getCompanyAnnouncements=function(n){e.utilsService=a;var i={};i.pageNo=n||1,e.gettingCompanyAnnouncementsErr=void 0,e.gettingMoreCompanyAnnouncementsErr=void 0,1===i.pageNo?e.gettingCompanyAnnouncements=!0:e.gettingMoreCompanyAnnouncements=!0,t.getCompanyComments(e.companyId,{page:i.pageNo,"page-size":3}).then(function(t){1!==i.pageNo&&(i.previousData=e.companyAnounList.data),e.companyAnounList=t.data,1!==i.pageNo&&(e.companyAnounList.data=i.previousData.concat(e.companyAnounList.data))},function(t){1===i.pageNo?e.gettingCompanyAnnouncementsErr=t.data:e.gettingMoreCompanyAnnouncementsErr=t.data}).finally(function(){e.gettingCompanyAnnouncements=!1,e.gettingMoreCompanyAnnouncements=!1})},e.getCompanyAnnouncements()}}};angular.module("shmApp.directives").directive("companyTemplateAnnouncement",["appConf","CompanyService","$state","UtilsService",r])}(),function(){"use strict";var e,t,n,a,i,r=function(r,o,c,s,m){return e=r,t=o,n=c,a=s,i=m,{restrict:"AE",scope:{companyId:"<",address:"<",trustAddressUrl:"<"},templateUrl:e.viewRootDir+"directives/company/template/companyTemplateMap.html",link:function(e,n,a){e.submit=function(){e.returnErrors="";var n={};n.params={name:e.name,email:e.email,message:e.message,captcha:e.captcha,key:e.captchatObj.key},e.loading=!0,t.sendMessageToCompany(e.companyId,n.params).then(function(e){weui.toast(i.instant("COMPANY.TEMPLATE.FORM.SUCCESS"),3e3)},function(t){e.returnErrors=t.data}).finally(function(t){e.loading=!1,e.createCaptcha()})},e.createCaptcha=function(){t.createCaptcha(e.companyId).then(function(t){e.captchatObj=t.data,e.img=e.captchatObj.img})},e.createCaptcha()}}};angular.module("shmApp.directives").directive("companyTemplateMap",["appConf","CompanyService","ItemService","$timeout","$translate",r])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s=function(s,m,u,l,p,d,g,f){return e=s,t=m,n=u,a=l,i=p,r=d,o=g,c=f,{restrict:"AE",scope:{itemId:"<?",appUser:"<"},templateUrl:e.viewRootDir+"directives/company/template/product/productPageTemplate.html",link:function(e,t,a){var r=o.localStorage.getItem("showManagSection");e.previewMode=!0===r||"true"===r,e.utilsService=i,e.getCompanyInfor=function(){n.getItemDetails(e.itemId).then(function(t){e.item=t.data})},e.toStorage=function(){o.localStorage.setItem("showManagSection",JSON.stringify(e.previewMode))},e.openedInWeChat=c.openedInWeChat(),e.getCompanyInfor()}}};angular.module("shmApp.directives").directive("productPageTemplate",["appConf","CompanyService","ItemService","AuthService","UtilsService","$state","$window","WeChatService",s])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s,m=function(m,u,l,p,d,g,f,h,y){return e=m,t=u,n=l,a=p,i=d,r=g,o=f,c=h,s=y,{restrict:"AE",scope:{item:"=",appUser:"<",previewMode:"<",isCompanyAdmin:"<?"},templateUrl:e.viewRootDir+"directives/company/template/product/productContent.html",link:function(e,m,u){e.openedInWeChat=s.openedInWeChat(),e.itemId=r.params.itemId,a.getMe().then(function(t){e.appUser=t.data}),e.utilsService=i,e.itemTypeService=c,e.getItemInfor=function(){n.getItemDetails(e.itemId).then(function(t){if(e.item=t.data,e.item.config){var a=JSON.parse(e.item.config);e.writer=a.writer?a.writer:""}if(e.datePublish=moment(moment.utc(e.item.date_publish)).local().format("YYYY-MM-DD"),e.item.itemStatusName=n.getItemStatusName(e.item).toLowerCase(),e.item.author&&(e.trustAuthor=o.trustAsHtml(e.item.author)),e.item.company_id&&e.item.company&&(e.item.company.safeTitle=i.getUrlSafeString(e.item.company.name),e.item.company.config)){var r=JSON.parse(e.item.company.config);r.defaultContact&&(e.defaultContact=r.defaultContact)}if(e.predefinedTagsArray=Object.keys(e.item.predefinedTags).map(function(t){return e.item.predefinedTags[t]}),e.isConsultationPage=!(!e.item||!e.item.predefinedTags)&&e.predefinedTagsArray[0]==n.returnConsultation(),e.item.config){var a=JSON.parse(e.item.config);e.ifShowAvatar=!(!a||!a.ifShowAvatar)&&a.ifShowAvatar,e.ifHideCheckinNumber=!(!a||!a.ifHideCheckinNumber)&&a.ifHideCheckinNumber,e.participator_name=!(!a||!a.name)&&a.name,e.participator_phone=!(!a||!a.phone)&&a.phone,e.participator_email=!(!a||!a.email)&&a.email,e.participator_address=!(!a||!a.address)&&a.address,e.participator_company=!(!a||!a.company)&&a.company,e.ifShowCompanyContact=!(!a||!0!==a.ifShowCompanyContact)&&a.ifShowCompanyContact}angular.forEach(e.item.special_tags,function(t,n){0!==parseInt(t)&&e.item.tagNames.unshift(t)}),angular.forEach(e.item.predefinedTags,function(t){0!==parseInt(t)&&(void 0===e.item.tagNames&&(e.item.tagNames=[]),"JIE LONG"!=t&&e.item.tagNames.unshift(t))}),e.item.isSameCompany=!1,e.appUser&&e.item.company&&e.item.company.id&&(e.item.isSameCompany=i.adminOfCompany(e.appUser.adminOfCompanyIds,e.item.company_id,e.appUser.is_admin))})},e.getCurrentUserAllJielong=function(){n.getAllJielong(e.item.id).then(function(t){e.currentUserAllJielong=t.data})},e.getCurrentUserJieLong=function(t){e.currentUserJieLongCommentsOjb=t,e.getCurrentUserAllJielong()},e.freshItemDetails=function(){r.go("mixAuth.itemDetails",{itemId:e.item.id},{reload:!0,inherit:!1})},e.getCompanyAnnouncements=function(n){var a={};a.pageNo=n||1,t.getCompanyComments(e.item.company_id,{page:a.pageNo,"page-size":3}).then(function(t){e.companyAnounList=t.data.data,angular.forEach(e.companyAnounList,function(e){e.local_time=moment(moment.utc(e.created_at)).local().format("MMMM Do YYYY")})},function(e){})},e.navToSearch=function(t){r.go("mixAuth.templateCompanyItemSearch",{companyId:e.item.company.id,keyWord:t})},e.getCompanyAnnouncements(),e.getItemInfor()}}};angular.module("shmApp.directives").directive("productContent",["appConf","CompanyService","ItemService","AuthService","UtilsService","$state","$sce","ItemTypeService","WeChatService",m])}(),function(){"use strict";var e,t,n,a,i,r,o,c=function(c,s,m,u,l,p,d){e=c,t=s,n=m,a=u,i=l,r=p,o=d;var g=angular.element(i);return{restrict:"AE",scope:{appUser:"<?",company:"<?",previewMode:"<?"},templateUrl:e.viewRootDir+"directives/company/template/product/productTemplateHeader.html",link:function(e,t,n){if(e.company&&(e.company.safeTitle=a.getUrlSafeString(e.company.name)),e.company&&e.company.admin_config){var i=JSON.parse(e.company.admin_config);e.ifOnlinePayment=!0===i.ifOnlinePayment}e.showToggle=!1,e.toggle=function(){e.showToggle=!1===e.showToggle},e.utilsService=a,e.productNav=!1,g.on("scroll",function(t){e.productNav=!1,g.scrollTop()>=100&&(e.productNav=!0),e.$apply()}),e.loginAndRedirect=function(){r.loginAndRedirect(o.current)}}}};angular.module("shmApp.directives").directive("productTemplateHeader",["appConf","CompanyService","ItemService","UtilsService","$window","WeChatService","$state",c])}(),function(){"use strict";var e,t,n,a,i,r=function(r,o,c,s,m){return e=r,t=o,n=c,a=s,i=m,{restrict:"AE",scope:{appUser:"<"},templateUrl:e.viewRootDir+"directives/company/oneCompanyPaymentClearanceMobile.html",link:function(e,r,o){e.currentTab="UNPAID",e.switchTabs=function(t){switch(e.currentTab=t,t){case"UNPAID":e.fetechUnclearedReceipts();break;case"PAID":e.fetechClearedVendorPayments()}},e.dateStart=new Date,e.dateStart=e.dateStart.setDate(e.dateStart.getDate()-7),e.dateEnd=new Date,e.companyId=a.params.companyId,e.getCompanyInfo=function(){i.getCompanyDetails(e.companyId).then(function(t){e.companyName=t.data.name},function(e){})},e.fetechUnclearedReceipts=function(){e.gettingReceipts=!0;var a={start_date:moment(moment(e.dateStart)).utc().format("YYYY-MM-DD HH:mm:ss"),end_date:moment(moment(e.dateEnd)).utc().format("YYYY-MM-DD HH:mm:ss"),keyword:e.keyword};t.getUnpaidReceiptsForACompany(e.companyId,a).then(function(t){var a=t.data;e.receiptList=n.processAllReceiptAllCompanies(a),e.receiptListEmpty=_.isEmpty(e.receiptList)},function(t){e.loadingErr=t.data}).finally(function(){e.gettingReceipts=!1})},e.fetechClearedVendorPayments=function(){e.gettingVendorPayments=!0;var a={start_date:moment(moment(e.dateStart)).utc().format("YYYY-MM-DD HH:mm:ss"),end_date:moment(moment(e.dateEnd)).utc().format("YYYY-MM-DD HH:mm:ss"),keyword:e.keyword};t.getPaidVendorPaymentsForACompany(e.companyId,a).then(function(t){var a=t.data;e.vendorPayments=n.processMulvendorPayment(a),e.vendorPaymentsEmpty=_.isEmpty(e.vendorPayments)},function(t){e.loadingErr=t.data}).finally(function(){e.gettingVendorPayments=!1})},e.getCompanyInfo(),e.switchTabs(e.currentTab)}}};angular.module("shmApp.directives").directive("oneCompanyPaymentClearanceMobile",["appConf","PaymentService","UtilsService","$state","CompanyService",r])}(),function(){"use strict";var e,t,n,a,i,r,o,c=function(c,s,m,u,l,p,d){return e=c,t=s,n=m,a=u,i=l,r=p,o=d,{restrict:"AE",scope:{appUser:"<"},templateUrl:e.viewRootDir+"directives/company/companySyncWechatArticle.html",link:function(e,c,s){r.hideContactUsQr=!0,e.companyId=t.params.companyId,e.previewList=[],e.previewMode=!1,e.searchItemsUnderCompany=function(t){var a={};a.pageNo=t||1,a.params={"key-word":e.searchKeyWord,"order-by":e.searchItemOrderBy,page:a.pageNo,"page-size":9},1===a.pageNo?(e.searchingItems=!0,e.searchingItemsErr=void 0):(e.searchingMoreItems=!0,e.searchingMoreItemsErr=void 0),n.searchItemsUnderCompany(e.companyId,a.params).then(function(t){a.pageNo>1&&(a.previousData=e.itemList.data),e.itemList=t.data,angular.forEach(e.itemList.data,function(e){e.chosen=!1,e.defaultImgUrl=i.getItemDefaultThumbnailUrl(e,"MID")}),a.pageNo>1&&(e.itemList.data=a.previousData.concat(e.itemList.data)),e.itemList.hasMore=e.itemList.current_page<e.itemList.last_page},function(t){1===a.pageNo?e.searchItemErr=t.data:e.searchingMoreItemsErr=t.data}).finally(function(){e.searchingItems=!1,e.searchingMoreItems=!1})},e.selectItem=function(t){var n=_.contains(e.previewList,t),a=8==e.previewList.length;!n&&a?weui.toast(o.instant("COMPANY.SYN.REVIEW.MAX_ITEMS_REACHED"),3e3):(e.previewList=[],t.chosen=!n,angular.forEach(e.itemList.data,function(t){!0===t.chosen&&e.previewList.push(t)}))},e.searchItemsUnderCompany(),e.switchToChooseMode=function(){e.chooseMode=!0,e.previewMode=!1,e.submitedMode=!1},e.switchToPreviewMode=function(){e.chooseMode=!1,e.previewMode=!0,e.submitedMode=!1},e.switchToResultMode=function(){e.chooseMode=!1,e.previewMode=!1,e.submitedMode=!0},e.preSubmit=function(t){var n=t?o.instant("COMPANY.SYN.REVIEW.SYNC_AND_BROADCAST.DESC"):o.instant("COMPANY.SYN.REVIEW.SYNC.DESC");weui.confirm(n,function(){e.submit(t)},function(){})},e.submit=function(t){!0!==t&&(t=!1),e.submittingBroadcast=!0,e.submitedResult=!1;var n=[];angular.forEach(e.previewList,function(e){n.push(e.id)});var i={item_ids:n,is_broadcast:t};a.broadcastItemsToWechat(e.companyId,i).then(function(t){e.broadcastSucc=!0},function(t){e.broadcastSucc=!1}).finally(function(){e.submittingBroadcast=!1,e.switchToResultMode()})},e.switchToChooseMode()}}};angular.module("shmApp.directives").directive("companySyncWechatArticle",["appConf","$state","ItemService","CompanyService","UtilsService","$rootScope","$translate",c])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s,m=function(m,u,l,p,d,g,f,h,y){return e=m,t=u,r=d,n=l,a=p,i=g,o=f,c=h,s=y,{restrict:"AE",scope:{},templateUrl:e.viewRootDir+"directives/company/package_selection.html",link:function(i,o,m){i.activeDuration=1,i.activePayment=1,i.activePackage=2,i.price=199,i.packageName=s.instant("COMPANY.PAYMENT.APPLY.RECOMMENDATION"),i.showConfirm=!1,i.price=199,i.duration=6,i.method="PAYPAL",i.paypalImg=e.imagesRootDir+"paypal_method_new.png",i.squareImg=e.imagesRootDir+"square_method_new.png",a.runWhenWXReady(function(){wx.onMenuShareAppMessage({title:s.instant("COMPANY.PAYMENT.PACKAGE.SELECTION"),desc:s.instant("COMMUNITY.DESC"),link:n.href(n.current.name,{},{absolute:!0}),imgUrl:r.getAppAbsUrlRoot(e.imagesRootDir+"community_logo.png")}),wx.onMenuShareTimeline({title:s.instant("COMPANY.PAYMENT.PACKAGE.SELECTION"),link:n.href(n.current.name,{},{absolute:!0}),imgUrl:r.getAppAbsUrlRoot(e.imagesRootDir+"community_logo.png")})}),r.setWebTitle(s.instant("COMPANY.PAYMENT.PACKAGE.SELECTION")),r.setWebDescription(s.instant("COMMUNITY.DESC"));c.detectIfUseTemplate(!0),i.choose=function(e){switch(i.activePackage=e,i.activePackage){case 1:i.price=19.9,i.packageName=s.instant("COMPANY.PAYMENT.APPLY.NORMAL");break;case 2:i.price=199,i.packageName=s.instant("COMPANY.PAYMENT.APPLY.RECOMMENDATION");break;case 3:i.price=799,
        i.packageName=s.instant("COMPANY.PAYMENT.APPLY.PROFESSIONAL")}r.scrollTo("user-input"),i.showConfirm=!1},i.chooseDuration=function(e){switch(i.activeDuration=e,i.activeDuration){case 1:i.duration=6;break;case 2:i.duration=12;break;case 3:i.duration=24}i.showConfirm=!1},i.choosePayment=function(e){switch(i.activePayment=e,i.activePayment){case 1:i.method="PAYPAL";break;case 2:i.method="SQUARE"}i.showConfirm=!1},i.submit=function(){i.totalPrice=(i.price*i.duration).toFixed(2);var e={},n={company_name:i.company_name,email:i.email,phone:i.phone,wechat:i.wechat,source:"new_company"};i.config=JSON.stringify(n),e.params={companyName:i.company_name,email:i.email,mobile:i.phone,wechatId:i.wechat,packageName:i.packageName},i.uploading=!0,t.applyCompany(e.params).then(function(e){!0===e.data.success&&(weui.toast("å‘é€æˆåŠŸ",3e3),i.success_notice=!0,i.applyId=e.data.applyId)},function(e){}).finally(function(e){i.showConfirm=!1,i.uploading=!1})}}}};angular.module("shmApp.directives").directive("packageSelection",["appConf","CompanyService","$state","WeChatService","UtilsService","$window","PaymentService","$rootScope","$translate",m])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s,m=function(m,u,l,p,d,g,f,h,y){return e=m,t=u,r=d,n=l,a=p,i=g,o=f,c=h,s=y,{restrict:"AE",scope:{},templateUrl:e.viewRootDir+"directives/company/packagePaymentList.html",link:function(t,i,m){a.runWhenWXReady(function(){wx.onMenuShareAppMessage({title:s.instant("COMPANY.PAYMENT.PACKAGE.PAYMENT.LIST"),desc:s.instant("COMMUNITY.DESC"),link:n.href(n.current.name,{},{absolute:!0}),imgUrl:r.getAppAbsUrlRoot(e.imagesRootDir+"community_logo.png")}),wx.onMenuShareTimeline({title:s.instant("COMPANY.PAYMENT.PACKAGE.PAYMENT.LIST"),link:n.href(n.current.name,{},{absolute:!0}),imgUrl:r.getAppAbsUrlRoot(e.imagesRootDir+"community_logo.png")})}),r.setWebTitle(s.instant("COMPANY.PAYMENT.PACKAGE.PAYMENT.LIST")),r.setWebDescription(s.instant("COMMUNITY.DESC"));c.detectIfUseTemplate(!0),t.getPackagePaymentList=function(e){var n={};n.pageNo=e||1,1===n.pageNo?(t.gettingTransactions=!0,t.gettingTransactionsErr=void 0):(t.gettingMoreTransactions=!0,t.gettingMoreTransactionsErr=void 0),n.params={"page-size":5,page:n.pageNo},o.packagePaymentList(n.params).then(function(e){n.pageNo>1&&(n.previousData=t.transactions.data),t.transactions=e.data,t.formatData(t.transactions),n.pageNo>1&&(t.transactions.data=n.previousData.concat(t.transactions.data))},function(e){1===n.pageNo?t.gettingItemsErr=fail.data:t.gettingMoreTransactionsErr=fail.data}).finally(function(e){t.gettingTransactions=!1,t.gettingMoreTransactions=!1})},t.formatData=function(e){angular.forEach(e.data,function(e){var t=moment.utc(e.created_at).toDate();if(e.created_at_local=moment(t).local().format("YYYY-MM-DD HH:mm:ss"),e.config){var n=JSON.parse(e.config);e.company_name=n.company_name,e.email=n.email,e.phone=n.phone,e.wechat=n.wechat}})},t.toggle=function(e){angular.forEach(t.transactions.data,function(t,n){t.id==e&&(t.showDetails=1!=t.showDetails)})},t.getPackagePaymentList(1)}}};angular.module("shmApp.directives").directive("packagePaymentList",["appConf","CompanyService","$state","WeChatService","UtilsService","$window","PaymentService","$rootScope","$translate",m])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s,m,u=function(u,l,p,d,g,f,h,y,v){return e=u,t=l,o=g,n=p,a=d,i=f,c=h,s=y,m=v,{restrict:"AE",scope:{appUser:"<"},templateUrl:e.viewRootDir+"directives/company/companyPackageExtend.html",link:function(u,l,p){u.activeDuration=1,u.activePayment=1,u.price=199,u.showConfirm=!1,u.price=199,u.duration=6,u.method="PAYPAL",u.paypalImg=e.imagesRootDir+"paypal_method_new.png",u.squareImg=e.imagesRootDir+"square_method_new.png",u.companyId=n.params.companyId,u.utilsService=g,t.getCompanyDetails(u.companyId).then(function(e){if(u.companyObj=e.data,u.companyObj.admin_config){var t=JSON.parse(u.companyObj.admin_config);switch(u.ifOnlinePayment=t.ifOnlinePayment,u.wechatAppId=t.wechat_app_id,u.packageName=t.currentPackage,t.currentPackage){case"normal":u.currentPackage=m.instant("COMPANY.PAYMENT.APPLY.NORMAL"),u.price=19.9;break;case"recommendation":u.currentPackage=m.instant("COMPANY.PAYMENT.APPLY.RECOMMENDATION"),u.price=199;break;case"professional":u.currentPackage=m.instant("COMPANY.PAYMENT.APPLY.PROFESSIONAL"),u.price=799;break;case"none":default:u.currentPackage="none"}u.showConfirm=!1}u.companyObj.logo_img.url?u.companyLogo=u.companyObj.logo_img.url:u.companyLogo=o.getAppAbsUrlRoot()+"/app/images/default-avatar.png",u.companyName=u.companyObj.name,o.setWebTitle(u.sellerTitle),u.sellerDesc=u.companyObj.description,u.pageUrl=n.href(n.current.name,{},{absolute:!0}),void 0===r&&(r=document.location.href.split("#")[0]),a.openInIphone()&&(u.pageUrl=r),a.loadWeChatJsConf(u.pageUrl,{menuShareAppMessage:{title:u.companyName,desc:u.sellerDesc,link:u.listUrl,imgUrl:u.companyLogo},menuShareTimeline:{title:u.companyName,link:u.listUrl,imgUrl:u.companyLogo}})},function(e){u.gettingCompanyInfoErr=e.data});s.detectIfUseTemplate(!0),u.chooseDuration=function(e){switch(u.activeDuration=e,u.activeDuration){case 1:u.duration=6;break;case 2:u.duration=12;break;case 3:u.duration=24}u.showConfirm=!1},u.choosePayment=function(e){switch(u.activePayment=e,u.activePayment){case 1:u.method="PAYPAL";break;case 2:u.method="SQUARE"}u.showConfirm=!1},u.submit=function(){u.totalPrice=(u.price*u.duration).toFixed(2);var e={},t={source:"existing_company",companyId:u.companyId,extendDuration:u.duration};u.config=JSON.stringify(t),e.params={title:"("+u.packageName+") AUD "+u.price+" X"+u.duration,amount:u.totalPrice,qty:1,payment_method_name:u.method,validation_url:n.href("mixAuth.paymentValidation",{payment_method_name:u.method},{absolute:!0}),cancel_url:n.href("mixAuth.companyItemSearch",{companyId:u.companyId},{absolute:!0}),config:u.config},u.uploading=!0,c.generalpaymentUrl(e.params).then(function(e){e.data.redirect_url&&(i.location.href=e.data.redirect_url)},function(e){}).finally(function(e){u.showConfirm=!1,u.uploading=!1})}}}};angular.module("shmApp.directives").directive("companyPackageExtend",["appConf","CompanyService","$state","WeChatService","UtilsService","$window","PaymentService","$rootScope","$translate",u])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s=function(e,t,n,a,i){c=this,c.$uibModalInstance=e,c.appUser=t,c.voucherGroup=n?Object.assign({},n,{}):void 0,c.messageType=a||void 0,c.cancel=function(){c.$uibModalInstance.close("cancel")},c.callBackDelete=i},m=function(c,m,u,l,p,d,g){return e=c,t=m,n=u,a=l,i=p,r=d,o=g,{restrict:"AE",scope:{appUser:"<"},templateUrl:e.viewRootDir+"directives/company/companyVoucherGroup.html",link:function(e,c,m){e.showShareTips=!0,e.keyword="",n.params.companyId||n.transitionTo("home"),e.companyId=n.params.companyId,e.appUser&&a.adminOfCompany(e.appUser.adminOfCompanyIds,e.companyId,e.appUser.is_admin)||n.go("home",{},{reload:!1}),e.appUser&&e.appUser.id&&t.getCompanyDetails(e.companyId).then(function(t){var o={},c=n.href("mixAuth.companyVoucherGroup",{companyId:e.companyId},{absolute:!0}),s=a.getCompanyDefaultImageUrl(t.data);o.param={current_state:c,img_url:s,title:r.instant("COMPANY.VOUCHER.LIST"),model_name:"Company",model_id:e.companyId},i.storeCurrentState(o.param)}),e.openMessageModal=function(t){o.open({animation:!0,template:'<company-voucher-message-modal app-user="vgCtrl.appUser" call-back-close="vgCtrl.cancel()" call-back-delete="vgCtrl.callBackDelete()" voucher-group="vgCtrl.voucherGroup" message-type="vgCtrl.messageType">',controller:["$uibModalInstance","appUser","voucherGroup","messageType","callBackDelete",s],controllerAs:"vgCtrl",size:"lg",appendTo:void 0,resolve:{appUser:function(){return e.appUser},voucherGroup:function(){return e.pendingDeleteGroup},messageType:function(){return t},callBackDelete:function(){return e.cancelVoucherGroup}}})},e.getVoucherGroupsUnderCompany=function(n,a){var i={};switch(i.params={},e.currentFilter=n||"available",n){case"available":i.params.available=1;break;case"unavailable":i.params.unavailable=1;break;case"deleted":i.params.deleted=1;break;case"all":i.params.all=1}e.keyword&&(i.params["key-word"]=e.keyword),i.params.page=a||1,1===i.params.page?e.gettingData=!0:e.gettingMoreData=!0,t.getVoucherGroupsUnderCompany(e.companyId,i.params).then(function(t){a&&a>1?e.voucherGroupsWithPagination.data=e.voucherGroupsWithPagination.data.concat(t.data.data):(e.voucherGroupsWithPagination=t.data,e.totalPageNo=t.data.last_page),e.gettingData=!1,e.gettingMoreData=!1,e.currentPageNo=t.data.current_page})},e.callCancelModalBox=function(t){e.pendingDeleteGroup=t,0===t.sent_num&&!0===confirm(r.instant("COMPANY.VOUCHER.CANCEL.GROUP.CONFIRMATION"))&&e.cancelVoucherGroup(),0!==t.sent_num&&e.openMessageModal("DELETE_GROUP")},e.cancelVoucherGroup=function(){t.cancelCompanyVoucherGroup(e.companyId,e.pendingDeleteGroup.id).then(function(){e.getVoucherGroupsUnderCompany("available",1),weui.toast(r.instant("VOUCHER.LIST.DELETED"),1500)})},e.getVoucherGroupsUnderCompany("available",1)}}};angular.module("shmApp.directives").directive("companyVoucherGroup",["appConf","CompanyService","$state","UtilsService","UserService","$translate","$uibModal",m])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s,m,u,l=function(e,t,n,a){u=this,u.$uibModalInstance=e,u.appUser=t,u.voucherGroup=n?Object.assign({},n,{}):void 0,u.messageType=a||void 0,u.cancel=function(){u.$uibModalInstance.close("cancel")}},p=function(u,p,d,g,f,h,y,v,I,C){return e=u,t=p,n=d,a=g,i=f,r=h,o=y,c=v,s=I,m=C,{restrict:"AE",scope:{appUser:"<",voucherGroupId:"<"},templateUrl:e.viewRootDir+"directives/company/companyVoucherReleased.html",link:function(u,p,d){if(u.isOpenInDesktop=i.openInDesktop(),u.isOpenInWeChat=i.openedInWeChat(),u.showFullTitle=!1,u.isSubscribed=u.appUser&&u.appUser.wechat_is_subscriber,u.groupId=n.params.voucherGroupId,u.show=!1,u.isDrawing=!1,"string"==typeof n.params.showShareTips&&"true"===n.params.showShareTips?u.showShareTips=!0:u.showShareTips=!1,n.params.from&&n.params.voucherGroupId){var g={};g.params={source_type:n.params.from,id:n.params.voucherGroupId,target_type:"VOUCHER GROUP",user_id:u.appUser&&u.appUser.id?u.appUser.id:""},s.saveWeChatVisitSource(g.params)}if(u.appUser||!0!==u.isOpenInWeChat)u.appUser||i.loginAndRedirect(n.current);else{var f=n.current;f.params=n.params,i.loginAndRedirect(f)}n.params.voucherGroupId||n.transitionTo("home"),c.hideContactUsQr=!0,u.openMessageModal=function(e){m.open({animation:!0,template:'<company-voucher-message-modal app-user="vgCtrl.appUser" call-back-close="vgCtrl.cancel()" voucher-group="vgCtrl.voucherGroup" message-type="vgCtrl.messageType">',controller:["$uibModalInstance","appUser","voucherGroup","messageType",l],controllerAs:"vgCtrl",size:"lg",appendTo:void 0,resolve:{appUser:function(){return u.appUser},voucherGroup:function(){return u.voucherGroup},messageType:function(){return e}}})},t.getVoucherGroupById(u.groupId).then(function(t){if(u.voucherGroup=t.data,u.isOpenInDesktop&&u.openMessageModal("DESKTOP"),u.isEnded=!(!u.voucherGroup.is_expired&&!u.voucherGroup.is_all_sent),u.voucherGroup&&u.voucherGroup.sentUsers&&u.voucherGroup.sentUsers.length>0){var n=jQuery("#avatar-row-layout").width(),a=0,r=u.voucherGroup.sentUsers.length/n*650;angular.forEach(u.voucherGroup.sentUsers,function(e){e.cssStyle="position:relative;right:"+a+"px",a+=r})}u.company=u.voucherGroup.company,o.setWebTitle(u.voucherGroup.title),u.companySafeTitle=u.voucherGroup.company&&u.voucherGroup.company.id?o.getUrlSafeString(u.voucherGroup.company.name):void 0,u.isAdmin=o.adminOfCompany(u.appUser.adminOfCompanyIds,u.company.id,u.appUser.is_admin),u.endDateLocal=moment(moment.utc(u.voucherGroup.end_date)).local().format("YYYY-MM-DD HH:mm:ss"),u.sentPercent=Math.round(u.voucherGroup.sentNum/u.voucherGroup.quantity*100)+"%",u.sentProgressBar="width:"+u.sentPercent,u.voucherGroup.currentUserVoucher&&u.voucherGroup.currentUserVoucher[0]&&u.voucherGroup.currentUserVoucher[0].img_url?u.voucherImg=u.voucherGroup.currentUserVoucher[0].img_url:u.voucherImg=void 0,u.voucherGroup&&u.voucherGroup.card_id&&u.voucherGroup.currentUserVoucher&&u.voucherGroup.currentUserVoucher[0]&&!u.voucherGroup.currentUserVoucher[0].card_code&&i.getUserCardByCardId(u.voucherGroup.card_id).then(function(e){e.data.card_list&&0===e.data.card_list.length&&(u.showGetCardModel=!0)}),u.itemImg=u.voucherGroup.images&&u.voucherGroup.images[0]?u.voucherGroup.images[0].url:o.getAppAbsUrlRoot(e.imagesRootDir+"default_voucher_logo.png"),u.storeCurrentState(u.voucherGroup,u.itemImg),u.weChatShare()},function(e){n.transitionTo("home")}),u.storeCurrentState=function(e,t){var a={},i=n.href("mixAuth.companyVoucherReleased",{voucherGroupId:n.params.voucherGroupId},{absolute:!0});a.param={current_state:i,img_url:t,title:e.title,model_name:"CompanyVoucherGroup",model_id:n.params.voucherGroupId},s.storeCurrentState(a.param)},u.weChatShare=function(){var e="";e=u.voucherGroup.sentNum/u.voucherGroup.quantity==0?a.instant("COMPANY.VOUCHER.SHARE.DESC.ZERO"):u.voucherGroup.sentNum/u.voucherGroup.quantity>=.8?a.instant("COMPANY.VOUCHER.SHARE.DESC.NEARLY.GONE"):a.instant("COMPANY.VOUCHER.SHARE.DESC.NORMAL.ONE")+u.voucherGroup.sentNum+a.instant("COMPANY.VOUCHER.SHARE.DESC.NORMAL.TWO")+u.sentPercent+a.instant("COMPANY.VOUCHER.SHARE.DESC.NORMAL.THREE"),i.runWhenWXReady(function(){var t=n.href(n.current.name,{voucherGroupId:u.groupId,showShareTips:!1},{absolute:!0}),i={};i.params={user_id:u.appUser&&u.appUser.id?u.appUser.id:"",share_source_type:"VOUCHER GROUP",share_source_id:n.params.voucherGroupId},wx.onMenuShareAppMessage({title:"ã€"+a.instant("DISCOUNT.VOUCHER")+"ã€‘"+u.voucherGroup.title,desc:e,link:t,imgUrl:u.itemImg,success:function(){i.params.share_target_type="message",s.saveWeChatShareSource(i.params),u.showShareTips=!1}}),wx.onMenuShareTimeline({title:u.voucherGroup.title,link:t,imgUrl:u.itemImg,success:function(){i.params.share_target_type="timeline",s.saveWeChatShareSource(i.params),u.showShareTips=!1}})})},u.assignCard=function(){i.runWhenWXReady(function(){t.assignCard(u.voucherGroup.card_id).then(function(e){wx.addCard({cardList:e.data,success:function(e){}})})})},u.drawVoucher=function(){u.isDrawing=!0,u.isSubscribed?t.obtainVoucherOwnership(u.groupId).then(function(e){e.data;u.voucherGroup.card_id&&i.runWhenWXReady(function(){t.assignCard(u.voucherGroup.card_id).then(function(e){wx.addCard({cardList:e.data,success:function(e){}})})}),u.refreshVoucherGroup(),weui.toast(a.instant("COMPANY.VOUCHER.DRAWN.SUCCESS.TOAST"),1e3)},function(e){u.refreshVoucherGroup(),u.gettingVoucherErr=e.data}):(u.isDrawing=!1,o.displaySubscribeModal())},u.showVoucher=function(e){if(!0===u.isOpenInWeChat){var t={};t.imgs=[e],WeixinJSBridge.invoke("imagePreview",{current:t.imgs[0],urls:t.imgs})}else r.open(e)},u.titleDisplayToggle=function(){u.showFullTitle=!u.showFullTitle},u.refreshVoucherGroup=function(){t.getVoucherGroupById(u.groupId).then(function(e){if(u.isDrawing=!1,u.voucherGroup=e.data,u.isEnded=!(!u.voucherGroup.is_expired&&!u.voucherGroup.is_all_sent),u.voucherGroup&&u.voucherGroup.sentUsers&&u.voucherGroup.sentUsers.length>0){var t=0,n=0;u.voucherGroup.sentUsers.length<4&&(n=10),u.voucherGroup.sentUsers.length>=4&&u.voucherGroup.sentUsers.length<=8&&(n=20),u.voucherGroup.sentUsers.length>8&&(n=30),angular.forEach(u.voucherGroup.sentUsers,function(e){e.cssStyle="position:relative;right:"+t+"px",t+=n})}u.sentPercent=Math.round(u.voucherGroup.sentNum/u.voucherGroup.quantity*100)+"%",u.sentProgressBar="width:"+u.sentPercent,u.voucherGroup.currentUserVoucher&&u.voucherGroup.currentUserVoucher[0]&&u.voucherGroup.currentUserVoucher[0].img_url?u.voucherImg=u.voucherGroup.currentUserVoucher[0].img_url:u.voucherImg=void 0,u.weChatShare()})}}}};angular.module("shmApp.directives").directive("companyVoucherReleased",["appConf","CompanyService","$state","$translate","WeChatService","$window","UtilsService","$rootScope","UserService","$uibModal",p])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s,m=function(m,u,l,p,d,g,f,h,y){return e=m,t=u,n=l,a=p,i=d,r=g,o=f,c=h,s=y,{restrict:"AE",scope:{appUser:"<"},templateUrl:e.viewRootDir+"directives/company/companyVoucherCampaign.html",link:function(m,u,l){if(n.params.from&&n.params.campaignId){var p={};p.params={source_type:n.params.from,id:n.params.campaignId,target_type:"VOUCHER CAMPAIGN",user_id:m.appUser&&m.appUser.id?m.appUser.id:""},s.saveWeChatVisitSource(p.params)}if(m.appUser||!0!==i.openedInWeChat())m.appUser||i.loginAndRedirect(n.current);else{var d=n.current;d.params=n.params,i.loginAndRedirect(d)}n.params.campaignId||n.transitionTo("home"),o.hideContactUsQr=!0,m.isSubscribed=m.appUser&&m.appUser.wechat_is_subscriber,m.campaignId=!!n.params.campaignId&&n.params.campaignId,m.itemImg=a.getAppAbsUrlRoot(e.imagesRootDir+"default_voucher_logo.png"),m.isDrawing=!1,m.getCampaignUsers=function(e){var n={};n.page=e||1,t.getCampaignUsersLists(m.campaignId,n).then(function(t){e&&e>1?m.sentVouchers=m.sentVouchers.concat(t.data.data):(m.sentVouchers=t.data.data,m.totalPageNo=t.data.last_page,m.ifHasUser=!!m.sentVouchers[0]),m.currentPageNo=t.data.current_page})},m.getLocalDrawnDate=function(e){return m.localDrawnDate=moment(moment.utc(e)).local().format("MM-DD HH:mm"),m.localDrawnDate},m.assignCard=function(){m.currentCampaign&&m.currentCampaign.currentUserVouchers&&m.currentCampaign.currentUserVouchers.length>0&&m.currentCampaign.currentUserVouchers[0].card_id&&!m.currentCampaign.currentUserVouchers[0].card_code&&i.runWhenWXReady(function(){t.assignCard(m.currentCampaign.currentUserVouchers[0].card_id).then(function(e){wx.addCard({cardList:e.data,success:function(e){}})})})},m.drawRandomVoucher=function(){m.isDrawing=!0,m.isSubscribed?t.obtainRandomVoucherUnderCampaign(m.campaignId).then(function(e){var n=e.data.voucher;n&&n.sourceName.contains("VoucherCampaign")&&n.entity&&n.entity.card_id&&i.runWhenWXReady(function(){t.assignCard(n.entity.card_id).then(function(e){wx.addCard({cardList:e.data,success:function(e){}})})}),m.getCampaignUsers(),m.refreshCurrentCampaignDetails(),weui.toast(r.instant("COMPANY.VOUCHER.DRAWN.SUCCESS.TOAST"),1e3)},function(e){m.getCampaignUsers(),m.isDrawing=!1,m.gettingDrawErr=e.data}):a.displaySubscribeModal()},m.refreshCurrentCampaignDetails=function(){t.getCompanyVoucherCampaignDetails(m.campaignId).then(function(e){m.currentCampaign=e.data,m.isDrawing=!1,m.isEnded=!(!m.currentCampaign.is_expired&&!m.currentCampaign.is_all_sent&&(m.currentCampaign.is_expired||m.currentCampaign.is_all_sent||m.currentCampaign.is_participated||m.currentCampaign.allow_participated))})},m.showVoucher=function(e){if(!0===i.openedInWeChat()){var t={};t.imgs=[e],WeixinJSBridge.invoke("imagePreview",{current:t.imgs[0],urls:t.imgs})}else c.open(e)},m.getCurrentCampaignDetails=function(){t.getCompanyVoucherCampaignDetails(m.campaignId).then(function(t){if(m.currentCampaign=t.data,m.hasImages=!!(m.currentCampaign.images&&m.currentCampaign.images.length>=1),m.hasOneImage=!(!m.hasImages||1!==m.currentCampaign.images.length),!m.hasImages){for(var o=[],c=0;c<m.currentCampaign.voucherGroups.length;c++)m.currentCampaign.voucherGroups[c].images&&m.currentCampaign.voucherGroups[c].images[0]&&(m.currentCampaign.voucherGroups[c].images[0].title=m.currentCampaign.voucherGroups[c].title,o.push(m.currentCampaign.voucherGroups[c].images[0]));m.voucherGroupsImgs=0!==o.length?o:void 0}m.companySafeTitle=m.currentCampaign.company&&m.currentCampaign.company.id?a.getUrlSafeString(m.currentCampaign.company.name):void 0,m.isAdmin=!!m.appUser&&a.adminOfCompany(m.appUser.adminOfCompanyIds,m.currentCampaign.company.id,m.appUser.is_admin),m.listUrl=n.href(n.current.name,{campaignId:m.campaignId},{absolute:!0}),m.currentCampaign.images&&m.currentCampaign.images[0]?m.imgUrl=m.currentCampaign.images[0].url:m.currentCampaign.company&&m.currentCampaign.company.id?m.imgUrl=m.currentCampaign.company.logo_img.url:(m.imgUrl=m.itemImg,m.defaultLogo=a.getAppAbsUrlRoot(e.imagesRootDir+"logo.png")),m.currentCampaign&&m.currentCampaign.currentUserVouchers&&m.currentCampaign.currentUserVouchers.length>0&&m.currentCampaign.currentUserVouchers[0].card_id&&!m.currentCampaign.currentUserVouchers[0].card_code&&i.getUserCardByCardId(m.currentCampaign.currentUserVouchers[0].card_id).then(function(e){e.data.card_list&&0===e.data.card_list.length&&(m.showGetCardModel=!0)}),m.storeCurrentState(m.currentCampaign,m.imgUrl),i.runWhenWXReady(function(){var e={};e.params={user_id:m.appUser&&m.appUser.id?m.appUser.id:"",share_source_type:"VOUCHER CAMPAIGN",share_source_id:n.params.campaignId},wx.onMenuShareAppMessage({title:m.currentCampaign.title,desc:r.instant("COMPANY.VOUCHER.CAMPAIGN.SHARE.DESCRIPTION"),link:m.listUrl,imgUrl:m.imgUrl,success:function(){e.params.share_target_type="message",s.saveWeChatShareSource(e.params)}}),wx.onMenuShareTimeline({title:m.currentCampaign.title,link:m.listUrl,imgUrl:m.imgUrl,success:function(){e.params.share_target_type="timeline",s.saveWeChatShareSource(e.params)}})})}),m.getCampaignUsers()},m.storeCurrentState=function(e,t){var a={},i=n.href("mixAuth.companyVoucherCampaign",{campaignId:n.params.campaignId},{absolute:!0});a.param={current_state:i,img_url:t,title:e.title,model_name:"VoucherCampaign",model_id:e.id},s.storeCurrentState(a.param)},m.getCurrentCampaignDetails()}}};angular.module("shmApp.directives").directive("companyVoucherCampaign",["appConf","CompanyService","$state","UtilsService","WeChatService","$translate","$rootScope","$window","UserService",m])}(),function(){"use strict";var e,t,n,a,i=function(i,r,o,c){return e=i,t=r,n=o,a=c,{restrict:"AE",scope:{appUser:"<"},templateUrl:e.viewRootDir+"directives/company/companyVoucherCampaignList.html",link:function(e){e.gettingDetails=!1,e.showMixed=!1,e.companyId=!!n.params.companyId&&n.params.companyId,e.isBelongCompany=!!n.params.companyId,(!e.appUser||!a.adminOfCompany(e.appUser.adminOfCompanyIds,e.companyId,e.appUser.is_admin)||a.adminOfCompany(e.appUser.adminOfCompanyIds,e.companyId,e.appUser.is_admin)&&!0!==e.appUser.is_admin&&!1===e.companyId)&&n.go("home",{},{reload:!1}),!1===e.isBelongCompany&&e.appUser.is_admin&&!0===e.appUser.is_admin&&t.getAllCompanies().then(function(t){e.allCompaniesMap=t.data}),e.getAllCampaignList=function(n,a){var i={};i.page=a||1,!0===n&&(i.mixed=!0),t.getAllCampaignList(i).then(function(t){a&&a>1?e.campaignList=e.campaignList.concat(t.data.data):(e.campaignList=t.data.data,e.totalPageNo=t.data.last_page),e.currentPageNo=t.data.current_page})},e.getCompanyCampaignList=function(n,a){var i={};i.page=a||1,t.getCompanyCampaignList(n,i).then(function(t){a&&a>1?e.campaignList=e.campaignList.concat(t.data.data):(e.campaignList=t.data.data,e.totalPageNo=t.data.last_page),e.currentPageNo=t.data.current_page})},e.getCompanyDetails=function(){t.getCompanyDetails(e.companyId).then(function(t){e.companyObj=t.data,e.companyObj.safeTitle=a.getUrlSafeString(e.companyObj.name)})},e.getCurrentCampaignDetails=function(n,a){!0===a&&(e.gettingDetails=!0,t.getCompanyVoucherCampaignDetails(n).then(function(t){e.openedCampaign=t.data,e.gettingDetails=!1}))},!1===e.isBelongCompany?e.getAllCampaignList(e.showMixed,1):(e.getCompanyCampaignList(e.companyId),e.getCompanyDetails())}}};angular.module("shmApp.directives").directive("companyVoucherCampaignList",["appConf","CompanyService","$state","UtilsService",i])}(),function(){"use strict";var e,t,n,a,i,r,o=function(o,c,s,m,u,l){return e=o,t=c,n=s,a=m,i=u,r=l,{restrict:"AE",scope:{appUser:"<",isCommunityEntry:"<?",callBackHideSelector:"&?"},templateUrl:e.viewRootDir+"directives/company/companyVoucherCampaignDetails.html",link:function(e,a,o){e.expand=!1,e.currentCampaign={},e.currentCampaign.company_id=n.params.companyId?n.params.companyId:void 0,e.isCommunityEntry||(!e.appUser||!i.adminOfCompany(e.appUser.adminOfCompanyIds,e.currentCampaign.company_id,e.appUser.is_admin)||i.adminOfCompany(e.appUser.adminOfCompanyIds,e.currentCampaign.company_id,e.appUser.is_admin)&&!0!==e.appUser.is_admin&&!1===e.currentCampaign.company_id)&&n.go("home",{},{reload:!1}),e.campaignId=!!n.params.campaignId&&n.params.campaignId,e.currentCampaign.voucherGroups=n.params.campaignId?void 0:[],e.isCreateNewCampaign=!n.params.campaignId,e.isBelongCompany=!!n.params.companyId,e.getVoucherGroupsUnderCompany=function(n,a){e.selectedCompanyId=n;var i={};i.page=a||1,i.available=1,n&&t.getVoucherGroupsUnderCompany(n,i).then(function(t){a&&a>1?e.tmpVoucherGroups=e.voucherGroups.concat(t.data.data):(e.tmpVoucherGroups=t.data.data,e.totalPageNo=t.data.last_page),e.currentPageNo=t.data.current_page,e.gettingData=!1,e.voucherGroups=_.filter(e.tmpVoucherGroups,function(t){return!_.findWhere(e.currentCampaign.voucherGroups,{id:t.id})})})},e.getCurrentCampaignDetails=function(){t.getCompanyVoucherCampaignDetails(e.campaignId).then(function(t){e.currentCampaign=t.data})},e.getCampaignDetails=function(){!1!==e.campaignId&&e.getCurrentCampaignDetails(),!1===e.isBelongCompany||e.appUser.is_admin&&!0===e.appUser.is_admin?t.getCompaniesWithVoucherGroups().then(function(t){if(e.allCompaniesMap=t.data,!e.appUser.is_admin&&e.appUser.adminOfCompanyIds&&e.appUser.adminOfCompanyIds.length>0){var n=[];angular.forEach(e.appUser.adminOfCompanyIds,function(t){angular.forEach(e.allCompaniesMap,function(e){e.id===t&&n.push(e)})}),e.allCompaniesMap=n}!0===e.isBelongCompany?e.getVoucherGroupsUnderCompany(e.currentCampaign.company_id):e.getVoucherGroupsUnderCompany(e.allCompaniesMap[0].id)}):e.getVoucherGroupsUnderCompany(e.currentCampaign.company_id)},e.addGroupToCampaign=function(t){e.currentCampaign.voucherGroups.push(t),e.voucherGroups=_.without(e.voucherGroups,t),e.ifNoneSelected=!1,e.isCommunityEntry&&e.callBackHideSelector()},e.deleteGroupFromCampaign=function(t){(t&&t.company_id)===e.selectedCompanyId&&e.voucherGroups.push(t),e.currentCampaign.voucherGroups=_.without(e.currentCampaign.voucherGroups,t)},e.clearSelectedGroups=function(){e.currentCampaign.voucherGroups=[]},e.ifBelongSameCompany=function(e){for(var t=1;t<e.length;t++)if(e[t].company_id!==e[0].company_id)return!1;return!0},e.saveCurrentCampaign=function(n){if(e.ifNoneSelected=!e.currentCampaign.voucherGroups[0],n.$submitted=!0,!0===n.$invalid||!0===e.ifNoneSelected)return!1;e.currentCampaign.company_id=e.ifBelongSameCompany(e.currentCampaign.voucherGroups)?e.currentCampaign.voucherGroups[0].company_id:null;var a={};a={title:e.currentCampaign.title,company_id:e.currentCampaign.company_id,voucherGroupIds:_.pluck(e.currentCampaign.voucherGroups,"id"),campaign_imgs:e.currentCampaign.images},e.isCreateNewCampaign?t.createCompanyVoucherCampaign(a).then(function(t){e.isSubmitted=!0,e.campaignId=t.data.id,weui.toast(r.instant("COMPANY.VOUCHER.CAMPAIGN.CREATE.SUCCESS.NOTIFICATION"),1e3)}):t.updateCompanyVoucherCampaignDetails(e.campaignId,a).then(function(t){e.isSubmitted=!0,weui.toast(r.instant("ITEM.PAGE.LIST.RENT.SAVE.NOTIFICATION"),1e3)})},e.expandCompanyVoucherList=function(){e.expand=!e.expand},e.getCampaignDetails()}}};angular.module("shmApp.directives").directive("companyVoucherCampaignDetails",["appConf","CompanyService","$state","WeChatService","UtilsService","$translate",o])}(),function(){"use strict";var e,t,n,a,i,r,o=function(e,t,n,a,i,o){r=this,r.$uibModalInstance=e,r.appUser=t,r.voucherGroup=n?Object.assign({},n,{}):void 0,r.companyId=a,r.isClone=!!i,r.callBackRefresh=o,r.cancel=function(){r.$uibModalInstance.close("cancel")}},c=function(r,c,s,m,u){return e=r,t=c,n=s,a=m,i=u,{restrict:"AE",scope:{appUser:"<",voucherGroup:"<?",companyId:"<",isClone:"<",callBackRefresh:"&?"},link:function(e,t,r){e.callBackRefreshTrigger=function(){e.callBackRefresh()},angular.element(t).click(function(){n.getCompanyDetails(e.companyId).then(function(t){e.company=t.data;var n=a.ifCompanyCanCreateFeaturedItem(e.company,"VOUCHER GROUP");n.ifCanCreate||e.appUser&&e.appUser.id&&1==e.appUser.is_admin?e.openModalBox():a.displaySubscribeModal("PAID FEATURE",n.message)}),e.openModalBox=function(){i.open({animation:!0,template:'<company-voucher-save-modal  app-user="vgCtrl.appUser" call-back-refresh="vgCtrl.callBackRefresh" call-back-close="vgCtrl.cancel()" voucher-group="vgCtrl.voucherGroup" is-clone="vgCtrl.isClone" company-id="vgCtrl.companyId">',controller:["$uibModalInstance","appUser","voucherGroup","companyId","isClone","callBackRefresh",o],controllerAs:"vgCtrl",size:"lg",appendTo:void 0,resolve:{appUser:function(){return e.appUser},voucherGroup:function(){return e.voucherGroup},companyId:function(){return e.companyId},isClone:function(){return e.isClone},callBackRefresh:function(){return e.callBackRefreshTrigger}}})}})}}};angular.module("shmApp.directives").directive("companyVoucherSave",["appConf","$state","CompanyService","UtilsService","$uibModal",c])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s=function(s,m,u,l,p,d,g,f){return e=s,t=m,n=u,a=l,i=p,r=d,o=g,c=f,{restrict:"AE",scope:{appUser:"<",voucherGroup:"<?",companyId:"<",isClone:"<",callBackRefresh:"&?",callBackClose:"&?",isCommunityEntry:"<",callBackHideSelector:"&?",accessibleCompanies:"<?"},templateUrl:e.viewRootDir+"directives/company/companyVoucherGroupSave.html",link:function(a,s,m){a.getCurrentCompanyDetails=function(e){t.getCompanyDetails(e).then(function(e){a.getCompanyRedeemDesc(e.data)})},a.getAllCompaniesForSuperAdmin=function(){t.getAllCompanies().then(function(e){a.allCompaniesMap=e.data,a.companyId=a.appUser.adminOfCompanyIds&&a.appUser.adminOfCompanyIds.length>0?a.appUser.adminOfCompanyIds[0]:a.allCompaniesMap[0].id,a.getCompanyRedeemDesc(a.getCurrentCompany(a.companyId))},function(e){a.gettingAllCompaniesErr=e.data}).finally(function(){a.gettingAllCompanies=!1})},a.getCurrentCompany=function(e){return a.companyId=e,a.appUser.is_admin?_.findWhere(a.allCompaniesMap,{id:a.companyId}):_.findWhere(a.adminCompanyList,{id:e})},a.getCompanyRedeemDesc=function(e){var t=e&&e.config?JSON.parse(e.config):{};a.voucherGroup.redeem_desc=t&&t.defaultRedeemDesc?t.defaultRedeemDesc:"",a.showDesc=""===a.voucherGroup.redeem_desc,a.ifSaveDescToCompany=a.showDesc},a.confirmSwitch=function(){a.isConfirmed=!a.isConfirmed},a.displayTextarea=function(){a.showDesc=!a.showDesc},a.showVoucher=function(e){if(!0===o.openedInWeChat()){var t={};t.imgs=[e],WeixinJSBridge.invoke("imagePreview",{current:t.imgs[0],urls:t.imgs})}else c.open(e)},a.validateForm=function(t){t.$submitted=!0;var n=moment().format("YYYY-MM-DD HH:mm");if(a.isValidDate=moment(a.voucherGroup.end_date).isAfter(n),a.isLessThanSent=!a.isCreating&&a.voucherGroup.quantity<a.voucherGroup.sent_num&&0!==a.voucherGroup.quantity,a.isValidQuantity=a.voucherGroup.quantity>0,!0===t.$invalid||!1===a.isValidDate||!1===a.isValidQuantity||!0===a.isLessThanSent)return!1;a.voucherImg=a.voucherGroup.images[0]?a.voucherGroup.images[0].url:i.getAppAbsUrlRoot(e.imagesRootDir+"default_voucher_logo.png"),a.confirmSwitch(),a.isCommunityEntry&&a.callBackHideSelector()},a.getVoucherGroupParams=function(){var e=a.voucherGroup.images[0]?a.voucherGroup.images[0]:"";return{company_id:a.companyId,quantity:a.voucherGroup.quantity,title:a.voucherGroup.title,voucher_img:e,end_date:moment(moment(a.voucherGroup.end_date)).utc().format("YYYY-MM-DD HH:mm:ss"),redeem_desc:a.voucherGroup.redeem_desc,tagNames:a.voucherGroup.tagNames}},a.openPreview=function(){a.previewImg?a.showVoucher(a.previewImg):(a.isGeneratingPreview=!0,a.isLoadding=!0,t.previewVoucher(a.getVoucherGroupParams()).then(function(e){a.previewImg=e.data.url,a.isLoadding=!1,a.isGeneratingPreview=!1,a.showVoucher(a.previewImg)},function(e){a.isLoadding=!1,a.isGeneratingPreview=!1,a.updateErr=e.data}))},a.createCompanyVoucher=function(){a.isLoadding=!0,t.createCompanyVoucherGroup(a.getVoucherGroupParams()).then(function(e){a.ifSaveDescToCompany&&a.updateCompanyDefaultRedeemDesc(a.companyId,a.voucherGroup.redeem_desc),a.isLoadding=!1,a.isSaved=!0,a.voucherGroup.id=e.data.id,a.isClone?weui.toast(r.instant("COMPANY.VOUCHER.CLONE.TITLE.SUCCESS"),2e3):weui.toast(r.instant("COMPANY.VOUCHER.CREATE.SUCCESS.NOTIFICATION"),2e3),
    "mixAuth.companyVoucherGroup"===a.currentState&&a.callBackRefresh&&"function"==typeof a.callBackRefresh&&a.callBackRefresh()()},function(e){a.isLoadding=!1,a.createErr=e.data})},a.updateCompanyVoucher=function(){a.isLoadding=!0,t.updateCompanyVoucherGroup(a.voucherGroup.id,a.getVoucherGroupParams()).then(function(e){a.isLoadding=!1,a.isSaved=!0,weui.toast(r.instant("COMPANY.VOUCHER.EDIT.TITLE.SUCCESS"),2e3),"mixAuth.companyVoucherGroup"===a.currentState&&a.callBackRefresh&&"function"==typeof a.callBackRefresh&&a.callBackRefresh()()},function(e){a.isLoadding=!1,a.updateErr=e.data})},a.updateCompanyDefaultRedeemDesc=function(e,n){var a={};a.params={redeem_desc:n},t.setRedeemDesc(e,a.params).then(function(e){})},a.startDateBeforeRender=function(e,t){var n,a=moment().utc().local().startOf("day").valueOf(),i=moment().add(1,"hour").utc().local().startOf("hour").valueOf(),r=moment().utc().local().startOf("minute").valueOf(),o=moment().utc().local().startOf("month").valueOf(),c=moment().utc().local().startOf("year").valueOf();"day"==e?n=a:"hour"==e?n=i:"minute"==e?n=r:"month"==e?n=o:"year"==e&&(n=c),angular.forEach(t,function(e){e.localDateValue()<n&&(e.selectable=!1)})},a.currentState=n.current.name,a.isCreating=!!(!a.voucherGroup||a.voucherGroup&&a.isClone),a.voucherGroup=a.voucherGroup?a.voucherGroup:{},a.voucherGroup.tagNames=[],a.voucherGroup&&a.voucherGroup.tags&&angular.forEach(a.voucherGroup.tags,function(e){a.voucherGroup.tagNames.push(e.name)}),a.isCommunityEntry?a.appUser&&a.appUser.is_admin?a.getAllCompaniesForSuperAdmin():(a.accessibleCompanies&&a.accessibleCompanies.length>0&&(a.adminCompanyList=a.accessibleCompanies),a.companyId=a.adminCompanyList[0].id,a.getCompanyRedeemDesc(a.getCurrentCompany(a.companyId))):a.isCreating?a.getCurrentCompanyDetails(a.companyId):a.voucherGroup.end_date=moment(moment.utc(a.voucherGroup.end_date)).local().format("YYYY-MM-DD HH:mm:ss")}}};angular.module("shmApp.directives").directive("companyVoucherSaveModal",["appConf","CompanyService","$state","$uibModal","UtilsService","$translate","WeChatService","$window",s])}(),function(){"use strict";var e,t,n,a,i=function(i,r,o,c){return e=i,t=r,n=o,a=c,{restrict:"AE",scope:{appUser:"<",voucherGroup:"<",messageType:"<",callBackClose:"&?",callBackDelete:"&?"},templateUrl:e.viewRootDir+"directives/company/companyVoucherMessageModal.html",link:function(e,t,i){e.isSending=!1,e.isDeleted=!1,e.sendShareNews=function(){e.isSending=!0,n.sendWeChatNewsOfVoucherGroup(e.voucherGroup.id).then(function(t){e.isSending=!1,weui.toast(a.instant("COMPANY.VOUCHER.OPEN.IN.DESKTOP.SUCCESS"),1500),e.callBackClose()})}}}};angular.module("shmApp.directives").directive("companyVoucherMessageModal",["appConf","$state","CompanyService","$translate",i])}(),function(){"use strict";var e,t,n=function(n,a){return e=n,t=a,{restrict:"AE",scope:{},link:function(n,a,i){e.params&&e.params.card_id&&e.params.encrypt_code&&e.params.openid?t.getVoucherFromCardRedirection(e.params).then(function(t){var n=t.data;n&&n.entityName?n.sourceName.includes("CompanyVoucherGroup")?e.go("mixAuth.companyVoucherReleased",{voucherGroupId:n.sourceId,showShareTips:!1},{reload:!0}):n.sourceName.includes("VoucherCampaign")&&e.go("mixAuth.companyVoucherCampaign",{campaignId:n.sourceId},{reload:!0}):e.go("home",{},{reload:!0})}):e.go("home",{},{reload:!0})}}};angular.module("shmApp.directives").directive("companyVoucherRedirect",["$state","ItemService",n])}(),function(){"use strict";var e,t,n,a,i=function(t){a.open({animation:!0,templateUrl:e.viewRootDir+"directives/company/companyChooser.html",controllerAs:"ctrl",controller:["$uibModalInstance","userCompanies","$state",function(e,t,n){var a=this;return a.companies=t,a.$uibModalInstance=e,a.cancel=function(){a.$uibModalInstance.dismiss("cancel")},a.navToCompanyDiscountVouchers=function(e){n.go("mixAuth.companyVoucherGroup",{companyId:e.id},{reload:!0}),a.cancel()},a}],resolve:{userCompanies:function(){return t}}})},r=function(r,o,c,s){return e=r,t=o,n=c,a=s,{restrict:"A",scope:{companies:"<"},link:function(e,t,a){t.on("click",function(){e.companies&&1===e.companies.length?n.go("mixAuth.companyVoucherGroup",{companyId:e.companies[0].id},{reload:!0}):e.companies&&e.companies.length>1&&i(e.companies)})}}};angular.module("shmApp.directives").directive("navToCompanyDiscountVoucherList",["appConf","$translate","$state","$uibModal",r])}(),function(){"use strict";var e,t,n,a,i=function(n){t.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/company/companyGenQrCodeBtn.html",controller:["$state","$translate","$uibModalInstance","companyId",r],controllerAs:"mdCtrl",size:void 0,appendTo:void 0,resolve:{companyId:function(){return n}}})},r=function(e,t,n,i){var r=this;return r.genQRCode=function(){r.generatingImg=!0,a.genAddUserQRCode(i).then(function(e){r.qrCodeUrl=e.data},function(e){}).finally(function(){r.generatingImg=!1}),a.getCompanyDetails(i).then(function(e){r.company=e.data})},r.genQRCode(),r.cancel=function(){n.dismiss("cancel")},r},o=function(r,o,c,s){return e=r,t=o,n=c,a=s,{restrict:"A",scope:{companyId:"<?"},link:function(e,t,n){angular.element(t).click(function(){i(e.companyId)})}}};angular.module("shmApp.directives").directive("companyGenQrCodeBtn",["appConf","$uibModal","ItemService","CompanyService",o])}(),function(){"use strict";var e,t,n=function(n,a){return e=n,t=a,{restrict:"AE",scope:{companyId:"<",hasRecords:"=?"},template:'<div class="visible-xs horizontal-scrollable-container"><div class="inline-item" ng-repeat="jielong in jielongItems.data"><a ui-sref="mixAuth.itemDetails({itemId: jielong.id})"><div class="image"><item-default-image item="jielong"/><div class="image-desc"><i class="fa fa-heart-o"></i> <span class="custom-font">{{ jielong.fav_count }}</span></div></div><div class="desc"><div class="custom-font">{{ jielong.title }}</div></div></a></div></div><div class="hidden-xs"><jielong-grid-item ng-model="item" ng-repeat="item in jielongItems.data"></jielong-grid-item></div>',link:function(e,n,a){e.fetchCompanyJielongList=function(n){var a={};a.pageNo=n||1,a.params={page:a.pageNo,"page-size":6,is_draft:!1,is_expired:!1,is_sold:!1},e.gettingData=!0,t.searchItemsUnderCompanyOnlyForJielong(e.companyId,a.params).then(function(t){a.pageNo>1&&(a.previousData=e.jielongItems.data),e.jielongItems=t.data,a.pageNo>1&&(e.jielongItems.data=a.previousData.concat(e.jielongItems.data)),e.gettingData=!1,e.hasRecords=0!=e.jielongItems.data.length})},e.fetchCompanyJielongList()}}};angular.module("shmApp.directives").directive("companyJielongHorizontalList",["appConf","ItemService",n])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s,m,u,l=function(t,n,a,i,r,c,s,m,u,l,p,d){o.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/addItemCommentModal.html",controller:"ItemAddCommentModalCtrl",controllerAs:"ctrl",size:void 0,appendTo:void 0,resolve:{replyToComment:function(){return t},updateComment:function(){return n},isBoardcast:function(){return a},succCallbackFunc:function(){return i},typeName:function(){return r},infoDesc:function(){return c},isHidePrivate:function(){return s},pageUrl:function(){return m},ifQrExist:function(){return u},seller_qr_url:function(){return l},isShowQr:function(){return p},communityName:function(){return d}}})},p=function(e,o,l,p,d,g,f,h,y,v,I,C,A){var S={};i=this,i.$uibModalInstance=e,i.replyToComment=o,i.typeName=g,i.infoDesc=f,i.currentComment={},i.isUpdate=!!l,i.isUpdate&&(i.updateComment=l,i.currentComment.newComment=i.updateComment.comments),i.isHidePrivate=h,i.pageUrl=y,i.isBoardcast=p,i.ifQrExist=v,i.seller_qr_url=I,i.isShowQr=C,i.communityName=A,i.replyToComment?i.placeHolder=a.instant("ITEM_ADD_COMMENT_MODAL.PLACEHOLDER.ANSWER"):i.placeHolder=p?a.instant("ITEM_ADD_COMMENT_MODAL.PLACEHOLDER.NEW_BOARDCAST"):a.instant("ITEM_ADD_COMMENT_MODAL.PLACEHOLDER.NEW_COMMENTS");var _=m.localStorage.getItem("tmpCommentJson");_&&(i.tmpItem=JSON.parse(_)),!0===s.openedInWeChat()&&s.loginAndRedirect(u.current),i.save=function(e){S.params={comments:i.currentComment.newComment,state_redirect_obj:r.stateRedirectObj,wechat_auth_url:s.getAuthPageUrl(),item_url:u.href("mixAuth.itemDetails",{itemId:r.item.id},{absolute:!0,inherit:!1}),is_private:void 0===e||e,is_broadcast:!!i.isBoardcast&&i.isBoardcast,images:i.currentComment.images},i.replyToComment&&i.replyToComment.id&&(S.params.reply_to_comment_id=i.replyToComment.id),i.sendingItemComment=!0,i.sendingItemCommentErr=void 0,(i.isUpdate?c.updateComment(i.updateComment.id,S.params):c.addCommentToAnItem(r.item.id,S.params)).then(function(e){if(e.data.auth_url)return void(m.location.href=e.data.auth_url);"function"==typeof d()&&d()(e.data),i.sendingItemComment=!1,i.$uibModalInstance.dismiss("cancel"),i.clearTmpItemDetails(),t.id&&void 0!==t.wechat_is_subscriber&&1!==parseInt(t.wechat_is_subscriber)&&n.displaySubscribeModal(i.typeName)},function(e){i.sendingItemCommentErr=e.data,i.sendingItemComment=!1}).finally(function(){})},i.itemCommentToLocalStorage=function(){i.currentComment&&m.localStorage.setItem("tmpCommentJson",JSON.stringify(i.currentComment))},i.clearTmpItemDetails=function(){m.localStorage.removeItem("tmpCommentJson")},i.retoreItemFromTmpItem=function(){i.currentComment=i.tmpItem},i.cancel=function(){i.$uibModalInstance.dismiss("cancel")}},d=function(e,t){r=e,r.item=e.item,r.stateRedirectObj=t.current,r.stateRedirectObj.params=t.params,r.succCallbackFunc=e.succCallbackFunc},g=function(i,r,p,g,f,h,y,v){return e=i,n=r,c=f,s=h,a=p,o=g,m=y,u=v,{restrict:"A",scope:{item:"=",communityName:"<",succCallbackFunc:"&?",appUser:"=?",replyToComment:"=?",replyToCommentId:"=?",updateComment:"=?",isBoardcast:"=?",infoDesc:"=?",isHidePrivate:"=?",isShowQr:"<?"},template:"",controller:["$scope","$state",d],link:function(e,a,i){t=e.appUser,e.item.company&&""!=e.item.company.qr_img&&(e.company_qr_url=e.item.company.qr_img.url),e.item.seller.qr_img&&""!=e.item.seller.qr_img&&(e.personal_qr_url=e.item.seller.qr_img.url),e.personal_qr_url||e.company_qr_url?e.company_qr_url?(e.seller_qr_url=e.company_qr_url,e.ifQrExist=!0):(e.seller_qr_url=e.personal_qr_url,e.ifQrExist=!0):e.ifQrExist=!1,e.pageUrl=n.getCurrentUrl(),e.stateRedirectObj=u.current,e.stateRedirectObj.params=u.params;var r=e.item&&e.item.type&&e.item.type.id?e.item.type.name:"DEFAULT ITEM TYPE";angular.element(a).click(function(){l(e.replyToComment,e.updateComment,e.isBoardcast,e.succCallbackFunc,r,e.infoDesc,e.isHidePrivate,e.pageUrl,e.ifQrExist,e.seller_qr_url,e.isShowQr,e.communityName)}),e.replyToCommentId&&(!0===s.openedInWeChat()&&s.loginAndRedirect(u.current),c.getComment(e.replyToCommentId).then(function(t){var n=!1;e.item&&e.item.id===t.data.item_id&&(n=!1===t.data.isReplied),!0===n&&l(t.data,e.updateComment,e.isBoardcast,e.succCallbackFunc,r,e.infoDesc,t.data.isHidePrivate,e.pageUrl,e.ifQrExist,e.seller_qr_url,e.isShowQr,e.communityName)},function(t){e.gettingCommentErr=t.data}).finally(function(){}))}}};angular.module("shmApp.directives").controller("ItemAddCommentModalCtrl",["$uibModalInstance","replyToComment","updateComment","isBoardcast","succCallbackFunc","typeName","infoDesc","isHidePrivate","pageUrl","ifQrExist","seller_qr_url","isShowQr","communityName",p]).directive("itemAddCommentBtn",["appConf","UtilsService","$translate","$uibModal","ItemService","WeChatService","$window","$state",g])}(),function(){"use strict";var e,t,n,a=function(n){t.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/confirmClone.html",controller:["$state","$translate","$uibModalInstance","cloneFromItem",i],controllerAs:"ctrl",size:void 0,appendTo:void 0,resolve:{cloneFromItem:function(){return n}}})},i=function(e,t,a,i){var r=this;return r.$uibModalInstance=a,r.cancel=function(){r.$uibModalInstance.dismiss("cancel")},r.clone=function(){r.submitting=!0,r.submittingErr=void 0,n.cloneItem(i.id).then(function(t){t.data.id&&(r.cancel(),e.go("mixAuth.itemDetails",{itemId:t.data.id},{reload:!0}))},function(e){r.submittingErr=e.data}).finally(function(){r.submitting=!1})},r},r=function(i,r,o){return e=i,t=r,n=o,{restrict:"A",scope:{item:"="},link:function(e,t,n){angular.element(t).click(function(){a(e.item)})}}};angular.module("shmApp.directives").directive("itemCloneBtn",["appConf","$uibModal","ItemService",r])}(),function(){"use strict";var e,t,n,a,i,r,o=function(o,c,s,m,u,l){return e=o,t=c,n=s,a=m,i=u,r=l,{restrict:"A",scope:{item:"<",appUser:"<?",lottery:"<?"},template:'<div class="mark-fav-btn-wrapper" ng-click="click()"><a ladda="submitting === true" data-spinner-color="#777"><i class="fa fa-2x ng-class:{\'text-muted fa-star-o\': item.is_fav_by_current_user !== true, \'faved-by-user fa-star\': item.is_fav_by_current_user === true}"></i></a><div class="text" ng-if="!lottery" ng-bind-html="(\'ITEM_FAVOURITE\' | translate)"></div><div class="text" ng-if="lottery" ng-bind-html="(\'ITEM_FAVOURITE_LOTTERY\' | translate)"></div></div>',link:function(e,r,o){e.click=function(){var r={};r.asFav=!e.item.is_fav_by_current_user,e.stateRedirectObj=i.current,e.stateRedirectObj.params=i.params,r.params={state_redirect_obj:e.stateRedirectObj,wechat_auth_url:a.getAuthPageUrl(),item_url:i.href("mixAuth.itemDetails",{itemId:e.item.id},{absolute:!0,inherit:!1})},e.submitting=!0,e.submittingErr=void 0,r.serviceFunc=!0===r.asFav?t.markAsFavourite(e.item.id,r.params):t.removeAsFavourite(e.item.id,r.params),r.serviceFunc.then(function(t){t.data&&t.data.auth_url&&a.loginAndRedirect(i.current),t.data&&t.data.id&&(e.item.is_fav_by_current_user=t.data.is_fav_by_current_user)},function(t){e.submittingErr=t.data}).finally(function(){e.submitting=!1}),e.appUser&&e.appUser.id&&void 0!==e.appUser.wechat_is_subscriber&&1!==parseInt(e.appUser.wechat_is_subscriber)&&n.displaySubscribeModal()}}}};angular.module("shmApp.directives").directive("itemMarkAsFavouriteBtn",["appConf","ItemService","UtilsService","WeChatService","$state","$window",o])}(),function(){"use strict";var e,t,n,a=function(n){t.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/confirmDeactivate.html",controller:["$state","$translate","$uibModalInstance","item",i],controllerAs:"ctrl",size:void 0,appendTo:void 0,resolve:{item:function(){return n}}})},i=function(e,t,a,i){var r=this;return r.$uibModalInstance=a,r.cancel=function(){r.$uibModalInstance.dismiss("cancel")},r.markAsDeactivated=function(){r.submitting=!0,r.submittingErr=void 0,n.markItemDeactivate(i.id).then(function(t){t.data.id&&(r.cancel(),e.go("mixAuth.itemList",{},{reload:!0}))},function(e){r.submittingErr=e.data}).finally(function(){r.submitting=!1})},r},r=function(i,r,o){return e=i,t=r,n=o,{restrict:"A",scope:{item:"="},link:function(e,t,n){angular.element(t).click(function(){a(e.item)})}}};angular.module("shmApp.directives").directive("itemMarkDeactivateBtn",["appConf","$uibModal","ItemService",r])}(),function(){"use strict";var e,t,n,a=function(n){t.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/confirmExpiry.html",controller:["$state","$translate","$uibModalInstance","item",i],controllerAs:"ctrl",size:void 0,appendTo:void 0,resolve:{item:function(){return n}}})},i=function(e,t,a,i){var r=this;return r.$uibModalInstance=a,r.cancel=function(){r.$uibModalInstance.dismiss("cancel")},r.comments=t.instant("ITEM.PAGE.DETAILS.MARK_AS_EXPIRE.REASON_INITIALVALUE"),r.report=function(){r.submitting=!0,r.submittingErr=void 0,n.markItemEnd(i.id,{comments:r.comments,item_url:e.href("mixAuth.itemDetails",{itemId:i.id},{absolute:!0})}).then(function(t){t.data.id&&(r.cancel(),e.go("mixAuth.itemDetails",{itemId:i.id},{reload:!0}))},function(e){r.submittingErr=e.data}).finally(function(){r.submitting=!1})},r},r=function(i,r,o){return e=i,t=r,n=o,{restrict:"A",scope:{item:"="},link:function(e,t,n){angular.element(t).click(function(){a(e.item)})}}};angular.module("shmApp.directives").directive("itemMarkExpireBtn",["appConf","$uibModal","ItemService",r])}(),function(){"use strict";var e,t,n,a=function(n){t.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/confirmSold.html",controller:["$state","$translate","$uibModalInstance","item",i],controllerAs:"ctrl",size:void 0,appendTo:void 0,resolve:{item:function(){return n}}})},i=function(e,t,a,i){var r=this;return r.$uibModalInstance=a,r.cancel=function(){r.$uibModalInstance.dismiss("cancel")},r.markAsSold=function(){r.submitting=!0,r.submittingErr=void 0,n.markItemSold(i.id).then(function(t){!0===t.data.success&&(r.cancel(),e.go("mixAuth.itemDetails",{itemId:i.id},{reload:!0}))},function(e){r.submittingErr=e.data}).finally(function(){r.submitting=!1})},r},r=function(i,r,o){return e=i,t=r,n=o,{restrict:"A",scope:{item:"="},link:function(e,t,n){angular.element(t).click(function(){a(e.item)})}}};angular.module("shmApp.directives").directive("itemMarkSoldBtn",["appConf","$uibModal","ItemService",r])}(),function(){"use strict";var e,t,n,a=function(n){t.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/confirmPushToFacebook.html",controller:["$state","$translate","$uibModalInstance","item",i],controllerAs:"ctrl",size:void 0,appendTo:void 0,resolve:{item:function(){return n}}})},i=function(e,t,a,i){var r=this;return r.$uibModalInstance=a,r.cancel=function(){r.$uibModalInstance.dismiss("cancel")},r.pushToFacebook=function(){r.submitting=!0,r.submittingErr=void 0,r.submitSuccess=!1,n.pushToFacebook(i.id).then(function(e){r.submitSuccess=!0},function(e){r.submittingErr=e.data}).finally(function(){r.submitting=!1})},r},r=function(i,r,o){return e=i,t=r,n=o,{restrict:"A",scope:{item:"="},link:function(e,t,n){angular.element(t).click(function(){a(e.item)})}}};angular.module("shmApp.directives").directive("itemPushFacebookBtn",["appConf","$uibModal","ItemService",r])}(),function(){"use strict";var e,t,n,a=function(n){t.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/confirmPushToWordpress.html",controller:["$state","$translate","$uibModalInstance","item",i],controllerAs:"ctrl",size:void 0,appendTo:void 0,resolve:{item:function(){return n}}})},i=function(e,t,a,i){var r=this;return r.$uibModalInstance=a,r.cancel=function(){r.$uibModalInstance.dismiss("cancel")},r.pushToFacebook=function(){r.submitting=!0,r.submittingErr=void 0,r.submitSuccess=!1,n.pushToWordpress(i.id).then(function(e){r.submitSuccess=!0},function(e){r.submittingErr=e.data}).finally(function(){r.submitting=!1})},r},r=function(i,r,o){return e=i,t=r,n=o,{restrict:"A",scope:{item:"="},link:function(e,t,n){angular.element(t).click(function(){a(e.item)})}}};angular.module("shmApp.directives").directive("itemPushWordpressBtn",["appConf","$uibModal","ItemService",r])}(),function(){"use strict";var e,t,n,a=function(n){t.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/confirmPush.html",controller:["$state","$translate","$uibModalInstance","item",i],controllerAs:"ctrl",size:void 0,appendTo:void 0,resolve:{item:function(){return n}}})},i=function(e,t,a,i){var r=this;return r.$uibModalInstance=a,r.cancel=function(){r.$uibModalInstance.dismiss("cancel")},n.getLeftPushTimes(i.id).then(function(e){r.leftPushTimes=e.data.leftPushTimes},function(e){r.gettingLeftPushTimeErr=e.data}),r.pushItemUp=function(){r.submitting=!0,r.submittingErr=void 0,n.pushItem(i.id).then(function(t){r.cancel(),e.go("mixAuth.itemDetails",{itemId:i.id},{reload:!0})},function(e){r.submittingErr=e.data}).finally(function(){r.submitting=!1})},r},r=function(i,r,o){return e=i,t=r,n=o,{restrict:"A",scope:{item:"="},link:function(e,t,n){angular.element(t).click(function(){a(e.item)})}}};angular.module("shmApp.directives").directive("itemPushBtn",["appConf","$uibModal","ItemService",r])}(),function(){"use strict";var e,t,n,a,i,r=function(e){var t=this;return t.submited_successfully=void 0,t.abort=function(){e.dismiss("cancel")},t.report=function(){t.reporting=!0,t.reportingErr=void 0,"object"==typeof t.abuse&&(t.abuse.item_url=i.href("mixAuth.itemDetails",{itemId:n.item.id},{absolute:!0})),a.reportItemAbuse(n.item.id,t.abuse).then(function(e){!0===e.data.success&&(t.submited_successfully=!0)},function(e){t.reportingErr=e.data}).finally(function(){t.reporting=!1})},t},o=function(o,c,s,m){return t=c,e=o,a=s,i=m,{restrict:"A",scope:{item:"<"},template:"",link:function(a,i,o){n=a,i.on("click",function(){t.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/confirmAbuse.html",controller:["$uibModalInstance",r],controllerAs:"mdCtrl",size:void 0,appendTo:void 0})})}}};angular.module("shmApp.directives").directive("itemReportAbuseBtn",["appConf","$uibModal","ItemService","$state",o])}(),function(){"use strict";var e,t,n,a,i,r=function(e,t){var n=this;return n.submited_successfully=void 0,n.isJielong=t,n},o=function(o,c,s,m){return t=c,e=o,a=s,i=m,{restrict:"A",scope:{isJielong:"<?",showVoucherContactModal:"<?"},template:"",link:function(a,i,o){n=a,i.on("click",function(){t.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/createJielong.html",controller:["$uibModalInstance","isJielong",r],controllerAs:"mdCtrl",size:void 0,appendTo:void 0,resolve:{isJielong:function(){return a.isJielong}}})}),a.$watch("showVoucherContactModal",function(n){!0===n&&t.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/createJielong.html",controller:["$uibModalInstance","isJielong",r],controllerAs:"mdCtrl",size:void 0,appendTo:void 0,resolve:{isJielong:function(){return a.isJielong}}})})}}};angular.module("shmApp.directives").directive("userNotAllowJielong",["appConf","$uibModal","ItemService","$state",o])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s=function(e,t){var n=this;return n.submited_successfully=void 0,n.$uibModalInstance=e,n.cancel=function(){n.$uibModalInstance.dismiss("cancel")},n.save=function(){n.creating=!0;var e={};e.params={name:n.name,source:"VOUCHER"},r.createCompanyByNormalUser(e.params).then(function(n){if(t.wechat_is_subscriber)i.go("mixAuth.itemCreate",{communityName:"VOUCHER GROUP"},{reload:!0});else{var a=c.instant("COMPANY.PAGE.NORMAL.USER.CREATION.TOAST");o.displaySubscribeModal("DEFAULT",a),e.newParams={source_name:"VOUCHER"},r.recordCreationSource(e.newParams)}},function(e){n.creatingErr=e.data}).finally(function(){n.creating=!1,n.$uibModalInstance.dismiss("cancel")})},n},m=function(m,u,l,p,d,g,f){return t=u,e=m,a=l,r=d,i=p,o=g,c=f,{restrict:"A",scope:{appUser:"<?"},template:"",link:function(a,i,r){n=a,i.on("click",function(){t.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/company/userCreateCompany.html",controller:["$uibModalInstance","appUser",s],controllerAs:"mdCtrl",size:void 0,appendTo:void 0,resolve:{appUser:function(){return a.appUser}}})})}}};angular.module("shmApp.directives").directive("userCreateCompany",["appConf","$uibModal","ItemService","$state","CompanyService","UtilsService","$translate",m])}(),function(){"use strict";var e,t,n,a,i,r,o,c=function(e){var t={};if(t.pageNo=e||1,""!=i.keyword&&void 0!=i.keyword)return i.searchingUser=!0,i.searchingUserErr=void 0,i.userSuggestionList=[],r.searchUser(i.keyword,{page:t.pageNo}).then(function(e){return i.totalItems=e.data.total,i.currentPage=e.data.current_page,i.userSuggestionList=e.data.data,i.userSuggestionList},function(e){i.searchingUserErr=e.data}).finally(function(){i.searchingUser=!1})},s=function(e){i.selectedUser=e},m=function(){i.selectedUser&&a.item.id&&(i.updatingSeller=!0,i.updatingSellerErr=void 0,e.updateSeller(a.item.id,i.selectedUser.id).then(function(e){e.data.id&&(i.abort(),o.go("mixAuth.itemDetails",{itemId:e.data.id},{reload:!0}))},function(e){i.updatingSellerErr=e.data}).finally(function(){i.updatingSeller=!1}))},u=function(e){return i=this,i.selectedUser=void 0,i.$uibModalInstance=e,i.searchUser=c,i.selectUser=s,i.setNewSeller=m,i.abort=function(){i.keyword=void 0,i.selectedUser=void 0,i.$uibModalInstance.dismiss("cancel")},i},l=function(i,c,s,m,l){return t=i,o=l,e=c,r=m,n=s,{restrict:"A",scope:{item:"="},link:function(e,i,r){a=e,i.on("click",function(){n.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:t.viewRootDir+"directives/item/changeSeller.html",controller:["$uibModalInstance",u],controllerAs:"mdCtrl",size:void 0,appendTo:void 0})})}}};angular.module("shmApp.directives").directive("pushingItemToSomeOneElseBtn",["appConf","ItemService","$uibModal","UserService","$state",l])}(),function(){"use strict";var e=function(e,t,n){return{restrict:"AE",templateUrl:e.viewRootDir+"directives/item/comments/assetsList.html",scope:{itemCommentsObj:"<",appUser:"<?"},link:function(e,a,i){e.showItemCommentImgs=function(e,a){if(!0===t.openedInWeChat()){var i={};i.index=a||0,i.imgs=[],angular.forEach(e.origImages,function(e){i.imgs.push(e.url)}),WeixinJSBridge.invoke("imagePreview",{current:i.imgs[i.index],urls:i.imgs})}else n.open(e.origImages[a].url)}}}};angular.module("shmApp.directives").directive("itemCommentsAssetList",["appConf","WeChatService","$window",e])}(),function(){"use strict";var e=function(e,t){e.itemCommentId=t.params.itemCommentId},t=function(t,n){return{restrict:"AE",templateUrl:t.viewRootDir+"directives/item/comments/list.html",scope:{item:"=",appUser:"<",pageSize:"<?"},controller:["$scope","$state",e],link:function(e,t,a){e.getItemComments=function(t){var a={};a.pageNo=t||1,e.gettingItemCommentsErr=void 0,e.gettingMoreItemCommentsErr=void 0,1===a.pageNo?e.gettingItemComments=!0:e.gettingMoreItemComments=!0,n.getCommentsForAnItem(e.item.id,{page:a.pageNo,"page-size":5}).then(function(t){1!==a.pageNo&&(a.previousData=e.itemCommentsList.data),e.itemCommentsList=t.data,1!==a.pageNo&&(e.itemCommentsList.data=a.previousData.concat(e.itemCommentsList.data))},function(t){1===a.pageNo?e.gettingItemCommentsErr=t.data:e.gettingMoreItemCommentsErr=t.data}).finally(function(){e.gettingItemComments=!1,e.gettingMoreItemComments=!1})},e.addedItemCommentsObj=function(t){if(""===t.parent_id)e.itemCommentsList.data.unshift(t),e.itemCommentsList.total=1*e.itemCommentsList.total+1;else{var n={};angular.forEach(e.itemCommentsList.data,function(a,i){a.id===t.root_id&&(e.itemCommentsList.data[i].replys||(e.itemCommentsList.data[i].replys=[]),n.index=i,e.itemCommentsList.data[i].replys.unshift(t))}),n.index&&n.index>0&&e.itemCommentsList.data.splice(0,0,e.itemCommentsList.data.splice(n.index,1)[0])}},e.canCreateComments=!1,e.item&&e.item.id&&(e.canCreateComments=1!==parseInt(e.item.is_expired)&&1!==parseInt(e.item.is_sold)&&1===parseInt(e.item.active),e.getItemComments())}}};angular.module("shmApp.directives").directive("itemCommentsList",["appConf","ItemService","$state",t])}(),function(){"use strict";var e,t,n=function(n,a,i){return e=n,t=i,{restrict:"AE",templateUrl:e.viewRootDir+"directives/item/comments/item.html",scope:{itemCommentsObj:"=",item:"=",appUser:"<",pageSize:"<?",showReplys:"<?",showQty:"<?",showControlBtns:"<?",showIcon:"<?",cbForCommentsAdded:"&?",refreshCallback:"&",rootItem:"<?"},link:function(e,n,a){e.maxItemCommentSize=3,e.addedItemCommentsObj=function(t){"function"==typeof e.cbForCommentsAdded&&"function"==typeof e.cbForCommentsAdded()&&e.cbForCommentsAdded()(t)},e.deactivateCommentsOjb=function(n){t.setCommentsDeactivate(n,{item_url:"fake_url"}).then(function(){e.refreshCallback()})},e.showReplys=void 0!==e.showReplys&&e.showReplys,e.showIcon=void 0===e.showIcon||e.showIcon,e.canReply=!1,e.itemCommentsObj&&e.itemCommentsObj.id&&e.item&&e.item.id&&(e.canReply=!0),e.quantity=0,e.itemCommentsObj.children.length>0&&angular.forEach(e.itemCommentsObj.children,function(t,n){if(e.quantity+=t.quantity,t.checkinComment&&(e.checkinComment=!0),t.item.config){var a=JSON.parse(t.item.config);t.order=a.order?a.order:0}})}}};angular.module("shmApp.directives").directive("itemCommentsListItem",["appConf","$state","ItemService",n])}(),function(){"use strict";var e=function(e,t){e.itemCommentId=t.params.itemCommentId},t=function(t,n,a,i){return{restrict:"AE",templateUrl:t.viewRootDir+"directives/item/comments/jieLongList.html",scope:{item:"=",appUser:"<",pageSize:"<?",previewBtn:"<?"},controller:["$scope","$state",e],link:function(e,r,o){if(e.location="",e.item.children&&e.item.children.length>=1&&(e.ifShowChildrenList=!0,angular.forEach(e.item.children,function(e){e.display=!0,e.showFullTitle=!1})),e.item.config){var c=JSON.parse(e.item.config);e.ifHideCheckinNumber=!(!c||!c.ifHideCheckinNumber)&&c.ifHideCheckinNumber}e.defaultItemImageUrl=t.imagesRootDir+"item_default.png",e.setChildrenOrder=function(){angular.forEach(e.item.children,function(e){if(e.config){var t=JSON.parse(e.config);e.order=t.order?t.order:0}})},e.setChildrenOrder(),e.getPickupLocations=function(){e.item.company_id&&e.item.company&&a.getCompanyPickupLocations(e.item.company_id).then(function(t){e.locations=t.data})},e.changeLocation=function(t){e.location=t,""===t?angular.forEach(e.item.children,function(e){e.display=!0}):angular.forEach(e.item.children,function(e){e.display=!1;var n=!1;e.locations&&e.locations.length>0&&angular.forEach(e.locations,function(e){t===e.id&&(n=!0)}),!0===n&&(e.display=!0)})},e.getPickupLocations(),e.getItemComments=function(t){var a={};a.pageNo=t||1,e.gettingItemCommentsErr=void 0,e.gettingMoreItemCommentsErr=void 0,1===a.pageNo?e.gettingItemComments=!0:e.gettingMoreItemComments=!0,n.getCommentsForAnItem(e.item.id,{page:a.pageNo,"page-size":5}).then(function(t){1!==a.pageNo&&(a.previousData=e.itemCommentsList.data),e.itemCommentsList=t.data,1!==a.pageNo&&(e.itemCommentsList.data=a.previousData.concat(e.itemCommentsList.data)),e.itemCommentsList.sum=e.itemCommentsList.totalQuantity,e.itemCommentsList.isReceivedSum=e.itemCommentsList.totalIsReceived},function(t){1===a.pageNo?e.gettingItemCommentsErr=t.data:e.gettingMoreItemCommentsErr=t.data}).finally(function(){e.gettingItemComments=!1,e.gettingMoreItemComments=!1})},e.addedItemCommentsObj=function(t){if(e.itemCommentsList.currentUserJieLong=t,""===t.parent_id)e.itemCommentsList.data.unshift(t),e.itemCommentsList.total=1*e.itemCommentsList.total+1;else{var n={};angular.forEach(e.itemCommentsList.data,function(a,i){a.id===t.root_id&&(e.itemCommentsList.data[i].replys||(e.itemCommentsList.data[i].replys=[]),n.index=i,e.itemCommentsList.data[i].replys.unshift(t))}),n.index&&n.index>0&&e.itemCommentsList.data.splice(0,0,e.itemCommentsList.data.splice(n.index,1)[0])}},e.getItemPropertyTypes=function(t){n.getPropertyTypes().then(function(n){"function"==typeof t&&(e.itemPropertyTypes=n.data,e.maxItemLimitTypeId=_.where(e.itemPropertyTypes,{name:"Item Max Join Limit"})[0].id,t(n.data))},function(e){}).finally(function(){})},e.formatItemProperties=function(){e.itemPropertiesCount=0,e.itemProperties={},e.item&&e.item.properties&&e.itemPropertyTypes&&angular.forEach(e.itemPropertyTypes,function(t){e.item.properties[t.id]>0&&(e.itemPropertiesCount=1*e.itemPropertiesCount+1,e.itemProperties[t.id]={name:t.name.toUpperCase(),value:e.item.properties[t.id]})})},e.canCreateComments=!1,e.item&&e.item.id&&(e.getItemPropertyTypes(function(){e.formatItemProperties()}),e.getItemComments()),e.totalNumber=0,e.currentNumber=0;for(var s=0;s<e.item.children.length;s++)e.totalNumber+=parseInt(e.item.children[s].totalNum),e.currentNumber+=parseInt(e.item.children[s].currentNum);e.toggleTitle=function(e){e.showFullTitle=!0!==e.showFullTitle},i(function(){if(e.item.children.length>0){var t=angular.element(r).find(".right-detail-section"),n=(t[0].offsetWidth,
        t[0].offsetHeight,angular.element(r).find(".child-title-ellipsis"));angular.forEach(n,function(t,n){var a=(t.offsetWidth,t.offsetHeight);angular.forEach(e.item.children,function(e){t.id===e.id&&(e.ifEllipsis=!1,38===a&&(e.ifEllipsis=!0))})})}},100),e.$watch("previewBtn",function(t){e.previewBtn=t})}}};angular.module("shmApp.directives").directive("itemJieLongCommentsList",["appConf","ItemService","CompanyService","$timeout",t])}(),function(){"use strict";var e,t,n,a,i,r=function(e){var t={};t.imgs=[e],WeixinJSBridge.invoke("imagePreview",{current:t.imgs[0],urls:t.imgs})},o=function(n,o,c){a=this,a.$uibModalInstance=n,a.viewRootDir=e.viewRootDir,a.item=o,a.url=c.href("mixAuth.jieLongCheckIn",{itemId:o.id},{absolute:!0}),a.cancel=function(){a.$uibModalInstance.dismiss("cancel")},a.genQRCode=function(){a.generatingQR=!0,a.generatingQRErr=void 0,t.generateCheckinPoster(a.item.id,a.url).then(function(e){i.openInDesktop()?window.open(e.data.url)?a.cancel():a.browserBlocked=!0:(r(e.data.url),a.cancel())},function(e){a.generatingQRErr=e.data}).finally(function(){a.generatingQR=!1})},a.genQRCode()},c=function(t){n.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/genCheckinPoster.html",controller:["$uibModalInstance","item","$state",o],controllerAs:"mdCtrl",size:void 0,appendTo:void 0,resolve:{item:function(){return t}}})},s=function(a,r,o,s){return e=a,t=r,n=o,i=s,{restrict:"A",scope:{item:"<",seller:"<"},link:function(e,t,n){t.on("click",function(){c(e.item)})}}};angular.module("shmApp.directives").directive("genCheckinPoster",["appConf","ItemService","$uibModal","WeChatService",s])}(),function(){"use strict";var e,t,n,a,i,r=function(e){var t={};t.imgs=[e],WeixinJSBridge.invoke("imagePreview",{current:t.imgs[0],urls:t.imgs})},o=function(n,o,c){a=this,a.$uibModalInstance=n,a.viewRootDir=e.viewRootDir,a.item=o,a.url=c.href("mixAuth.jieLongCheckIn",{itemId:o.id},{absolute:!0}),a.cancel=function(){a.$uibModalInstance.dismiss("cancel")},a.genQRCode=function(){a.generatingQR=!0,a.generatingQRErr=void 0,t.generateCheckinQRCode(a.item.id,a.url).then(function(e){i.openInDesktop()?window.open(e.data.url)?a.cancel():a.browserBlocked=!0:(r(e.data.url),a.cancel())},function(e){a.generatingQRErr=e.data}).finally(function(){a.generatingQR=!1})},a.genQRCode()},c=function(t){n.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/genCheckinQRCode.html",controller:["$uibModalInstance","item","$state",o],controllerAs:"mdCtrl",size:void 0,appendTo:void 0,resolve:{item:function(){return t}}})},s=function(a,r,o,s){return e=a,t=r,n=o,i=s,{restrict:"A",scope:{item:"<",seller:"<"},link:function(e,t,n){t.on("click",function(){c(e.item)})}}};angular.module("shmApp.directives").directive("genCheckinQRCode",["appConf","ItemService","$uibModal","WeChatService",s])}(),function(){"use strict";var e,t,n=function(n,a){return e=n,t=a,{restrict:"AE",scope:{passInValue:"<",predefinedTagId:"=",appUser:"=",hasResult:"=?",data:"<ngModel",callback:"&?"},templateUrl:e.viewRootDir+"directives/item/IncomingJielongList.html",link:function(e,n,a){if(e.getItems=function(n){var a={};a.pageNo=n||1,e.passInValue.page=a.pageNo,1===a.pageNo?(e.gettingItems=!0,e.gettingItemsErr=void 0):(e.gettingMoreItems=!0,e.gettingMoreItemsErr=void 0),t.searchItemsUnderCommunity(e.predefinedTagId,e.passInValue).then(function(t){a.pageNo>1&&(a.previousData=e.itemList.data),e.itemList=t.data,a.pageNo>1&&(e.itemList.data=a.previousData.concat(e.itemList.data)),e.hasResult=t.data&&t.data.total>0,e.callback&&"function"==typeof e.callback&&e.callback()({incomingJielongList:e.itemList})},function(t){1===a.pageNo?e.gettingItemsErr=t.data:e.gettingMoreItemsErr=t.data}).finally(function(){e.gettingItems=!1,e.gettingMoreItems=!1})},e.data&&e.data.data)return void(e.itemList=e.data);e.getItems()}}};angular.module("shmApp.directives").directive("incomingJielongList",["appConf","ItemService",n])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s,m,u,l,p=function(t,n,a,i,r,c){o.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/addJieLongModal.html",controller:"JieLongAddModalCtrl",controllerAs:"ctrl",size:void 0,appendTo:void 0,resolve:{jieLongComment:function(){return t},succCallbackFunc:function(){return n},typeName:function(){return a},item:function(){return i},company:function(){return r},isJielongUser:function(){return c}}}).result.then({},function(e){"cancel"!=e&&"backdrop click"!=e||n()()})},d=function(e){return e>0&&Math.floor(e)===e},g=function(e,a,o,p,g,f,h,y,v,I,C,A,S){var b={};if(i=this,i.$uibModalInstance=e,i.typeName=p,i.item=g,i.company=f,i.jielongWaitingImgSrc=h.imagesRootDir+"jielong_waiting.png",i.jielongFailedImgSrc=h.imagesRootDir+"jielong_cry.png",i.isjielongUser=v,i.$translate=I,i.paymentMethod=1,i.isShowPayUrl=!1,i.succCallbackFunc=o,i.surchargeRate=1.5,i.defaultItemImageUrl=h.imagesRootDir+"item_default.png",i.location="",i.item&&i.item.config&&"null"!=i.item.config){var U=JSON.parse(i.item.config);i.showName=!!U.name&&U.name,i.showPhone=!!U.phone&&U.phone,i.showEmail=!!U.email&&U.email,i.showAddress=!!U.address&&U.address,i.showCompany=!!U.company&&U.company}if(A.$on("modal.closing",function(e,t,n){"backdrop click"===t&&!0===i.chosenLocationError&&(i.chosenLocationError=!1,e.preventDefault())}),y.getPropertyTypes().then(function(e){i.maxItemLimitTypeId=_.where(e.data,{name:"Item Max Join Limit"})[0].id,i.maxIndItemLimitTypeId=_.where(e.data,{name:"Join Limit"})[0].id},function(e){}).finally(function(){}),i.item.children&&i.item.children.length>0&&angular.forEach(i.item.children,function(e){e.display=!0}),i.isUpdate=!!a,i.item.company_id&&i.item.company&&C.getCompanyPickupLocations(i.item.company_id).then(function(e){i.isUpdate||(i.locations=e.data,e.data.length>0&&1===e.data.length&&(i.location=e.data[0].id,i.chosenLocationId=e.data[0].id)),e.data.length>0&&i.item.children&&i.item.children.length>0&&angular.forEach(i.item.children,function(e){e.locationMap=[],e.locationIds=[],angular.forEach(e.locations,function(t){e.locationMap[t.id]=t,e.locationIds.push(t.id)})})}),i.isUpdate){if(i.jieLongComment=a,i.jieLongComment.location){i.location=i.jieLongComment.location.id,i.chosenLocationId=i.jieLongComment.location.id;var E=[];E.push(i.jieLongComment.location),i.locations=E,angular.forEach(i.item.children,function(e){e.display=!1,angular.forEach(e.locations,function(t){t.id===i.location&&(e.display=!0)})})}if(i.jieLongComment.config){var U=JSON.parse(i.jieLongComment.config);i.name=U.name?U.name:"",i.phone=U.phone?U.phone:"",i.email=U.email?U.email:"",i.address=U.address?U.address:"",i.company=U.company?U.company:""}r.item.children.length>0&&angular.forEach(i.jieLongComment.children,function(e){angular.forEach(i.item.children,function(t){t.quantity||(t.quantity=0),e.item_id===t.id&&(t.quantity=e.quantity)})})}else r.item.children.length>0?(angular.forEach(i.item.children,function(e){e.quantity=0}),i.jieLongComment={comments:""}):i.jieLongComment={quantity:0,comments:""};i.updateIsAllNumZero=function(){i.isAllNumZero=!0,r.item.children.length>0?angular.forEach(i.item.children,function(e){e.quantity>0&&(i.isAllNumZero=!1)}):i.jieLongComment.quantity>0&&(i.isAllNumZero=!1)},i.checkItemLocation=function(e){var t=[];if(i.locations&&i.locations.length>0){var t=[];angular.forEach(i.locations,function(n){angular.forEach(e.locations,function(e){n.id===e.id&&t.push(n)})}),i.locations=t,angular.forEach(i.item.children,function(e){e.display=!1,angular.forEach(i.locations,function(t){_.has(e.locationMap,t.id)&&(e.display=!0)})})}},i.reductCheckItemLocation=function(e){i.locations&&i.locations.length>0&&C.getCompanyPickupLocations(i.item.company_id).then(function(e){for(var t=e.data,n=[],a=[],r=0;r<i.item.children.length;r++)i.item.children[r].quantity>0&&a.push(i.item.children[r]);a.length>0&&(n=a[0].locationIds);for(var o=1;o<a.length;o++)n=_.intersection(n,a[o].locationIds);var c=[];angular.forEach(n,function(e){angular.forEach(t,function(t){e===t.id&&c.push(t)})}),c.length>0?i.locations=c:(i.locations=t,angular.forEach(i.item.children,function(e){e.display=!0}))})},i.reChooseLocation=function(e){i.chosenLocationId=e},i.reset=function(){i.chosenLocationId="",i.location="",i.fetchLocation(),i.totalItemPrice=0,angular.forEach(i.item.children,function(e){e.quantity=0,e.totalNum=0,e.display=!0}),i.updateIsAllNumZero()},i.cancelChosenLocation=function(){i.chosenLocationError=!1},i.changeLocation=function(e){e&&(i.chosenLocationId=e,angular.forEach(i.item.children,function(t){t.display=!1;var n=!1;t.locations&&t.locations.length>0&&angular.forEach(t.locations,function(t){e===t.id&&(n=!0)}),!0===n&&(t.display=!0)})),i.updateIsAllNumZero()},i.fetchLocation=function(){C.getCompanyPickupLocations(i.item.company_id).then(function(e){i.locations=e.data})},i.toggleTitle=function(e){e.showFullTitle=!0!==e.showFullTitle},i.choosePaypal=function(){i.paymentMethod=1},i.chooseWeiChat=function(){i.paymentMethod=2},i.chooseAliPay=function(){i.paymentMethod=3},i.calculateTotalPrice=function(){if(i.totalItemPrice=0,i.item&&i.item.children&&i.item.children.length>0)for(var e=0;e<i.item.children.length;e++){var t=i.item.children[e].price*i.item.children[e].quantity;i.totalItemPrice+=t}else i.totalItemPrice=i.item.price*i.jieLongComment.quantity;var n=1===i.paymentMethod?i.getPaypalSurchargeRate(i.totalItemPrice):i.surchargeRate;i.totalSurchargePrice=!0!==i.item.include_surcharge?i.totalItemPrice*(n/100):0,i.totalTotalPrice=i.totalItemPrice+i.totalSurchargePrice},i.getPaypalSurchargeRate=function(e){return 100*(.31/e+.034)},i.calculateTotalPrice(),i.generatePaymentUrl=function(e){i.generatePaymentUrlFail=!1,i.retryGenPayUrlTimes||(i.retryGenPayUrlTimes=1),b.params={redirect_url:l.href("mixAuth.itemDetails",{itemId:r.item.id},{absolute:!0}),item_comment_id:e.id,payment_method:i.paymentMethod},s.generateOmiPayURL(b.params).then(function(e){i.retryGenPayUrlTimes=void 0,!0===m.openedInWeChat()&&!1===m.openInWindowsWechat()?2==i.paymentMethod?u.location.href=e.data.pay_url:3==i.paymentMethod&&(i.forceCloseModal(),i.pay_qr_img_url=e.data.qr_pay_url,l.go("mixAuth.alipayWithQR",{alipay_qr_url:e.data.qr_pay_url,itemId:r.item.id},{reload:!0})):(!0===m.openedInWeChat()&&!0===m.openInWindowsWechat()||!1===m.openedInWeChat())&&(u.location.href=e.data.pc_pay_url_processed)},function(t){i.retryGenPayUrlTimes<3?(i.retryGenPayUrlTimes+=1,i.generatePaymentUrl(e)):(i.errorMsg=t.data,i.generatePaymentUrlFail=!0,i.retryGenPayUrlTimes=void 0)})},i.generatePaypalPaymentUrl=function(e){i.generatePaymentUrlFail=!1,i.retryGenPayUrlTimes||(i.retryGenPayUrlTimes=1),b.params={redirect_url:l.href("mixAuth.itemDetails",{itemId:r.item.id},{absolute:!0}),item_comment_id:e.id,payment_method:i.paymentMethod},s.generatePaypalUrl(b.params).then(function(e){u.location.href=e.data.redirect_url},function(t){i.retryGenPayUrlTimes<3?(i.retryGenPayUrlTimes+=1,i.generatePaypalPaymentUrl(e)):(i.errorMsg=t.data,i.generatePaymentUrlFail=!0,i.retryGenPayUrlTimes=void 0)})},i.save=function(){i.sendingItemComment=!0,i.sendingItemCommentErr=void 0,i.participateJielongSuccess=!1,i.errorMsg=void 0;var e={name:i.name,phone:i.phone,email:i.email,address:i.address,company:i.company};i.config=JSON.stringify(e);var a={};if(i.locations&&i.locations.length>0&&(!i.chosenLocationId||!i.location))return i.sendingItemComment=!1,void(i.chosenLocationError=!0);if(r.item.children.length>0){if(b.childrenQuantityArray=[],b.totalQuantity=0,b.quantityIsInteger=!0,angular.forEach(i.item.children,function(e){d(e.quantity)||0===e.quantity?(b.totalQuantity+=e.quantity,b.childrenQuantityArray.push({item_id:e.id,quantity:e.quantity,price:e.price})):b.quantityIsInteger=!1}),!1===b.quantityIsInteger&&0===b.totalQuantity)return i.quantityIntError=!0,void(i.sendingItemComment=!1);b.params={config:i.config,comments:i.jieLongComment.comments,quantity:b.childrenQuantityArray,state_redirect_obj:r.stateRedirectObj,wechat_auth_url:m.getAuthPageUrl(),item_url:l.href("mixAuth.itemDetails",{itemId:r.item.id},{absolute:!0}),voucher_base_url:l.href("mixAuth.voucherCheckIn",{voucherId:"VOUCHERID"},{absolute:!0}),is_private:i.jieLongComment.is_private},i.chosenLocationId&&(b.params.location=i.chosenLocationId),a=i.isUpdate?c.updateJielongToAnItemWithKids(i.jieLongComment.id,b.params):c.addJielongToAnItemWithKids(r.item.id,b.params),console.log(r.item.id),console.log(b.params)}else b.params={config:i.config,comments:i.jieLongComment.comments,quantity:i.jieLongComment.quantity,state_redirect_obj:r.stateRedirectObj,wechat_auth_url:m.getAuthPageUrl(),item_url:l.href("mixAuth.itemDetails",{itemId:r.item.id},{absolute:!0}),voucher_base_url:l.href("mixAuth.voucherCheckIn",{voucherId:"VOUCHERID"},{absolute:!0}),is_private:i.jieLongComment.is_private},a=i.isUpdate?c.updateComment(i.jieLongComment.id,b.params):c.addCommentToAnItem(r.item.id,b.params);i.paticipateInJielongFail=!1,r.item.online_payment?a.then(function(e){i.currentJielongCommment=e.data,1==i.paymentMethod?i.generatePaypalPaymentUrl(e.data):2!=i.paymentMethod&&3!=i.paymentMethod||i.generatePaymentUrl(e.data)},function(e){i.paticipateInJielongFail=!0,i.errorMsg=e.data}):a.then(function(e){if(e.data.auth_url)return void(u.location.href=e.data.auth_url);i.participateJielongSuccess=!0;var a={voucher_base_url:l.href("mixAuth.voucherCheckIn",{voucherId:"VOUCHERID"},{absolute:!0}),is_update:i.isUpdate,item_url:l.href("mixAuth.itemDetails",{itemId:r.item.id},{absolute:!0})};c.createVoucherForJielong(e.data.id,a).then(function(e){i.forceCloseModal(),S.go("mixAuth.itemDetails",{itemId:r.item.id},{reload:!0});var a=e.data.url;if(a)if(!0===m.openedInWeChat()&&!1===m.openInWindowsWechat()){var o={};o.imgs=[a],wx.previewImage({current:a,urls:o.imgs})}else weui.gallery(a);i.sendingItemComment=!1,t.id&&void 0!==t.wechat_is_subscriber&&1!==parseInt(t.wechat_is_subscriber)&&!1===n.isFromFacebook()&&n.displaySubscribeModal(i.typeName),n.checkJielongBonusStatus(i.item,t,"TYPE_JIELONG")},function(e){}).finally(function(){})},function(e){i.sendingItemCommentErr=e.data,i.sendingItemComment=!1}).finally(function(){})},i.cancel=function(){i.$uibModalInstance.dismiss("cancel")},i.forceCloseModal=function(){i.$uibModalInstance.dismiss("")},i.updateIsAllNumZero()},f=function(e,t){r=e,r.item=e.item,r.stateRedirectObj=t.current,r.stateRedirectObj.params=t.params,r.succCallbackFunc=e.succCallbackFunc},h=function(i,r,d,g,h,y,v,I,C){return e=i,n=r,c=h,s=y,m=v,a=d,o=g,u=I,l=C,{restrict:"A",scope:{item:"<",appUser:"<?",jieLongComment:"<?",company:"<?",succCallbackFunc:"&?",isJielongUser:"<?"},template:"",controller:["$scope","$state",f],link:function(e,a,i){t=e.appUser;var r=angular.copy(e.item),o=e.item&&e.item.type&&e.item.type.id?e.item.type.name:"DEFAULT";angular.element(a).click(function(){if(e.appUser&&e.appUser.id)p(e.jieLongComment,e.succCallbackFunc,o,r,e.company,e.isJielongUser);else if(e.isOpenInWeChat=m.openedInWeChat(),e.appUser||!0!==e.isOpenInWeChat)e.appUser||(n.storeRedirectUrl("mixAuth.itemDetails",{itemId:e.item.id},{reload:!0}),m.loginAndRedirect(l.current));else{var t=l.current;t.params=l.params,m.loginAndRedirect(t)}})}}};angular.module("shmApp.directives").controller("JieLongAddModalCtrl",["$uibModalInstance","jieLongComment","succCallbackFunc","typeName","item","company","appConf","ItemService","isJielongUser","$translate","CompanyService","$scope","$state",g]).directive("jieLongAddBtn",["appConf","UtilsService","$translate","$uibModal","ItemService","PaymentService","WeChatService","$window","$state",h])}(),function(){"use strict";var e,t,n=function(e,t,n,a){var i=this;i.save=function(){i.cancellingJielong=!0,n.setCommentsDeactivate(e.id,{item_url:a.href("mixAuth.itemDetails",{itemId:e.item_id},{absolute:!0})}).then(function(n){i.cancellingJielong=!1,a.go("mixAuth.itemDetails",{itemId:e.item_id},{reload:!0}),t.dismiss("cancel")},function(e){i.cancelJielongErr=e.data})},i.cancel=function(){t.dismiss("cancel")}},a=function(a,i){return e=a,t=i,{restrict:"A",scope:{jieLongComment:"=?"},link:function(a,i,r){i.on("click",function(){t.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/cancelJieLongModal.html",controller:["jieLongComment","$uibModalInstance","ItemService","$state",n],controllerAs:"ctrl",resolve:{jieLongComment:function(){return a.jieLongComment},succCallbackFunc:function(){return a.succCallbackFunc}}})})}}};angular.module("shmApp.directives").directive("jieLongCancelBtn",["appConf","$uibModal",a])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s,m,u=function(t,n){r.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/addJieLongCheckinModal.html",controller:"JieLongCheckinModalCtrl",controllerAs:"ctrl",size:void 0,appendTo:void 0,resolve:{jieLongCheckin:function(){return t},succCallbackFunc:function(){return n}}})},l=function(e,t,n){var i={};a=this,a.quantity=1,a.$uibModalInstance=e,a.jieLongCheckinItem=t,a.jieLongCheckinItem.hasChildren=t.children&&t.children.length>0,a.jieLongCheckin={quantity:a.jieLongCheckinItem.quantity,comments:""},a.save=function(){i.params={comments:a.comments,quantity:a.jieLongCheckin.quantity,wechat_auth_url:c.getAuthPageUrl(),item_url:m.href("mixAuth.jieLongResult",{itemId:a.jieLongCheckinItem.item_id},{absolute:!0}),reply_to_comment_id:a.jieLongCheckinItem.id,is_private:!1},a.sendingCheckin=!0,a.sendingCheckinErr=void 0,o.addCommentToAnItem(a.jieLongCheckinItem.item_id,i.params).then(function(e){if(e.data.auth_url)return void(s.location.href=e.data.auth_url);n({respComment:e.data}),a.sendingCheckin=!1,a.$uibModalInstance.dismiss("cancel")},function(e){a.sendingCheckinErr=e.data,a.sendingCheckin=!1}).finally(function(){})},a.cancel=function(){a.$uibModalInstance.dismiss("cancel")}},p=function(e){i=e,i.succCallbackFunc=e.succCallbackFunc},d=function(a,i,l,d,g,f,h,y){return e=a,t=i,o=g,c=f,n=l,r=d,s=h,m=y,{restrict:"A",scope:{succCallbackFunc:"&?",jieLongCheckin:"=?"},template:"",controller:["$scope",p],link:function(e,t,n){angular.element(t).click(function(){u(e.jieLongCheckin,e.succCallbackFunc)})}}};angular.module("shmApp.directives").controller("JieLongCheckinModalCtrl",["$uibModalInstance","jieLongCheckin","succCallbackFunc",l]).directive("jieLongCheckinBtn",["appConf","UtilsService","$translate","$uibModal","ItemService","WeChatService","$window","$state",d])}(),function(){"use strict";var e,t,n,a,i,r=function(t){i.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/JieLongCheckinDetailsModal.html",controller:"JieLongCheckinDetailModalCtrl",controllerAs:"ctrl",size:void 0,appendTo:void 0,resolve:{jieLongCheckinDetail:function(){return t}}})},o=function(e,t){n=this,n.$uibModalInstance=e,n.jieLongCheckinDetailItem=t,n.cancel=function(){n.$uibModalInstance.dismiss("cancel")}},c=function(e){a=e},s=function(n,a){return e=n,i=a,{restrict:"A",scope:{jieLongCheckinDetail:"=?"},template:"",controller:["$scope",c],link:function(e,n,a){t=e.appUser,angular.element(n).click(function(){r(e.jieLongCheckinDetail)})}}};angular.module("shmApp.directives").controller("JieLongCheckinDetailModalCtrl",["$uibModalInstance","jieLongCheckinDetail",o]).directive("jieLongCheckinDetailsBtn",["appConf","$uibModal",s])}(),function(){"use strict";var e,t,n,a,i,r=function(t,n){a.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/JieLongRefundModal.html",controller:["$uibModalInstance","jieLongRefund","callback","$state",o],controllerAs:"ctrl",size:void 0,appendTo:void 0,resolve:{jieLongRefund:function(){return t},callback:function(){return n}}})},o=function(e,n,a){var r={};t=this,t.$uibModalInstance=e,t.jieLongRefund=n,t.save=function(){r.params={commentId:t.jieLongRefund.id},t.sendingCheckin=!0,i.companyPaymentRefund(t.jieLongRefund.id,r.params).then(function(e){t.sendingCheckin=!1,t.$uibModalInstance.dismiss("cancel"),a()()},function(e){t.sendingPaymentRefundErr=e.data,t.sendingCheckin=!1}).finally(function(){})},t.cancel=function(){t.$uibModalInstance.dismiss("cancel")}},c=function(e){n=e},s=function(t,n,o){return e=t,a=n,i=o,{restrict:"A",scope:{jieLongRefund:"=?",callback:"&"},template:"",controller:["$scope",c],link:function(e,t,n){angular.element(t).click(function(){r(e.jieLongRefund,e.callback)})}}};angular.module("shmApp.directives").controller("JieLongRefundModalCtrl",["$uibModalInstance","jieLongRefund",o]).directive("jieLongRefundBtn",["appConf","$uibModal","PaymentService",s])}(),function(){"use strict";var e,t,n,a,i=function(n,i,r){a=this,a.$uibModalInstance=n,a.viewRootDir=e.viewRootDir,a.item=i,a.url=r.href("mixAuth.jieLongCheckIn",{itemId:i.id},{absolute:!0}),a.cancel=function(){a.$uibModalInstance.dismiss("cancel")},a.submitExportJielongReport=function(e){a.exportingReport=!0,a.exportingSucc=!1,a.exportingReportErr=void 0;var n={email:e};t.genJielongReportEmail(a.item.id,n).then(function(e){a.exportingSucc=!0},function(e){a.generatingQRErr=e.data}).finally(function(){a.exportingReport=!1})}},r=function(t){n.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/exportReport.html",controller:["$uibModalInstance","item","$state",i],controllerAs:"mdCtrl",size:void 0,appendTo:void 0,resolve:{item:function(){return t}}})},o=function(a,i,o){return e=a,t=i,n=o,{restrict:"A",scope:{item:"<"},link:function(e,t,n){t.on("click",function(){r(e.item)})}}};angular.module("shmApp.directives").directive("exportReport",["appConf","ItemService","$uibModal",o])}(),function(){"use strict";var e,t,n,a,i=function(i,r,o,c){return n=i,e=r,a=c,t=o,{scope:{id:"<",item:"<"},templateUrl:n.viewRootDir+"directives/item/jielongReportList.html",link:function(n,a,i){n.location="all",n.getCompanyLocations=function(){n.item.company_id&&n.item.company&&t.getCompanyPickupLocations(n.item.company_id).then(function(e){n.locations=e.data})},n.getJielongByLocation=function(t){e.updateJielongReportLocationData(n.id,t).then(function(e){n.itemCommentsList.totalQuantity=e.data.totalQuantity,n.itemCommentsList.totalIsReceived=e.data.totalIsReceived,n.itemCommentsList.totalUserCount=e.data.totalUserCount})},n.getCompanyLocations(),n.jielongStatusOptions=["ALL","CHECKED","UNCHECKED"],n.filter=n.jielongStatusOptions[0],n.searchItemComments=function(t,a,i,r){var o={};o.pageNo=t||1,n.gettingMoreItemComments=!0,e.getCommentsForAnItem(n.id,{page:o.pageNo,keyword:a,withoutComments:!0,filter:i,is_paid:r}).then(function(e){1!==o.pageNo?(o.previousData=n.itemCommentsList.data,n.itemCommentsList=e.data,n.itemCommentsList.data=o.previousData.concat(n.itemCommentsList.data)):n.itemCommentsList=e.data,angular.forEach(n.itemCommentsList.data,function(e){e.display=!0}),n.calculatePrice(n.itemCommentsList.data),n.itemCommentsList.hasMore=n.itemCommentsList.to<n.itemCommentsList.total},function(e){n.searchingCommentsErr=e.data}).finally(function(){n.searchingComments=!1,n.gettingMoreItemComments=!1})},n.toggleJielongInfor=function(e){angular.forEach(n.itemCommentsList.data,function(t,n){t.id==e&&(t.showDetails=1!=t.showDetails)})},n.changeLocation=function(e){"all"===e?n.searchItemComments():(n.locationId=n.locations[e].id,n.locationId&&n.getJielongByLocation(n.locationId),angular.forEach(n.itemCommentsList.data,function(t){t.display=!1;var a=!1;t.location.id===n.locations[e].id&&(a=!0),!0===a&&(t.display=!0)}))},n.calculatePrice=function(e){e.forEach(function(e){if(e.config){var t=JSON.parse(e.config);e.name=t.name?t.name:"",e.phone=t.phone?t.phone:"",e.email=t.email?t.email:"",e.address=t.address?t.address:"",e.company=t.company?t.company:""}if(e.children.length>0){var a=0;e.children.forEach(function(e){e.price=e.quantity*e.item.price,a+=e.price}),e.totalPrice=a}0===e.children.length&&(e.totalPrice=n.item.price*e.quantity)})},n.updateListSuccFun=function(e){var t=n.itemCommentsList.totalIsReceived;n.itemCommentsList.totalIsReceived=e.totalIsReceived;var a=n.itemCommentsList.totalIsReceived-t;n.itemCommentsList.data.checkinNum=e.totalIsReceived,angular.forEach(n.itemCommentsList.data,function(t){t.id===e.parent_id&&(t.checkinNum=t.checkinNum+a,t.replys.unshift(e),t.is_checkedin=!0)})},n.currentPage=1,n.keyword="",n.searchItemComments()}}};angular.module("shmApp.directives").directive("jielongReportList",["appConf","ItemService","CompanyService","$state",i])}(),function(){"use strict";var e,t,n,a,i,r,o=function(t,n,i){a.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/JieLongBlacklistDetailsModal.html",controller:"jieLongBlacklistDetailsModalCtrl",controllerAs:"ctrl",size:void 0,appendTo:void 0,resolve:{targetUser:function(){return t},companyId:function(){return n},userId:function(){return i}}})},c=function(e,n,a,o){t=this,t.$uibModalInstance=e,t.targetUserItem=n,t.companyId=a,t.userId=o,t.cancel=function(){t.$uibModalInstance.dismiss("cancel")},t.goToItemDetailsPage=function(e){t.$uibModalInstance.dismiss("cancel"),r.go("mixAuth.itemDetails",{itemId:e})},t.getTargetuserDetails=function(e){var n={};n.pageNo=e||1,t.gettingTargetuserDetailsErr=void 0,t.gettingMoreTargetuserDetailsErr=void 0,1===n.pageNo?t.gettingTargetuserDetails=!0:t.gettingMoreTargetuserDetails=!0,i.getBlackListDetails({page:n.pageNo,companyId:t.companyId,targetUser:t.targetUserItem,userId:t.userId}).then(function(e){1!==n.pageNo?(n.previousData=t.targetuserDetails.data,t.targetuserDetails=e.data,t.targetuserDetails.data=n.previousData.concat(t.targetuserDetails.data)):t.targetuserDetails=e.data,t.targetuserDetails.hasMore=t.targetuserDetails.to<t.targetuserDetails.total},function(e){t.gettingTargetuserDetailsErr=e.data,1===n.pageNo?t.gettingTargetuserDetailsErr=e.data:t.gettingMoreTargetuserDetailsErr=e.data}).finally(function(){t.gettingTargetuserDetails=!1,t.gettingMoreTargetuserDetails=!1})},t.getTargetuserDetails()},s=function(e){n=e},m=function(t,n,c,m){return e=t,a=n,i=c,r=m,{restrict:"A",scope:{targetUser:"<",companyId:"<",userId:"<"},template:"",controller:["$scope",s],link:function(e,t,n){angular.element(t).click(function(){o(e.targetUser,e.companyId,e.userId)})}}};angular.module("shmApp.directives").controller("jieLongBlacklistDetailsModalCtrl",["$uibModalInstance","targetUser","companyId","userId",c]).directive("jieLongBlacklistDetailsBtn",["appConf","$uibModal","ItemService","$state",m])}(),function(){"use strict";var e,t,n=function(n,a){return e=n,t=a,{restrict:"AE",scope:{passInValue:"<",predefinedTagId:"=",hasResult:"=?",data:"<ngModel",callback:"&?"},templateUrl:e.viewRootDir+"directives/item/ongoingJielongList.html",link:function(e,n,a){if(e.getItems=function(n){var a={};a.pageNo=n||1,a.pageNo>1?(e.passInValue.page=a.pageNo,e.passInValue["page-size"]=12,e.gettingMoreItems=!0,e.gettingMoreItemsErr=void 0):(e.passInValue.page=a.pageNo,e.passInValue["page-size"]=12,e.gettingItems=!0,e.gettingItemsErr=void 0),t.searchItemsUnderCommunity(e.predefinedTagId,e.passInValue).then(function(t){a.pageNo>1&&(a.previousData=e.itemList.data),e.itemList=t.data,e.itemList.data=e.itemList.data,a.pageNo>1&&(e.itemList.data=a.previousData.concat(e.itemList.data)),e.hasResult=t.data&&t.data.total>0,e.callback&&"function"==typeof e.callback&&e.callback()({ongoingJielongList:e.itemList})},function(t){1===a.pageNo?e.gettingItemsErr=t.data:e.gettingMoreItemsErr=t.data}).finally(function(){e.gettingItems=!1,e.gettingMoreItems=!1})},e.data&&e.data.data)return void(e.itemList=e.data);e.getItems()}}};angular.module("shmApp.directives").directive("ongoingJielongList",["appConf","ItemService",n])}(),function(){"use strict";var e,t,n,a,i,r=function(n,i,r){a=this,a.$uibModalInstance=n,a.viewRootDir=e.viewRootDir,a.item=i,a.url=r.href("mixAuth.itemDetails",{itemId:i.id},{absolute:!0}),a.terminateSucc=!1,a.isTerminatingChecking=!1,a.cancel=function(){a.$uibModalInstance.dismiss("cancel")},a.terminateCheckin=function(){a.terminateSucc=!1,a.isTerminatingChecking=!0,t.terminateJielong(i.id,{item_url:a.url,comments:a.comments}).then(function(e){a.terminateSucc=!0},function(e){a.terminateFail=e.data}).finally(function(e){a.isTerminatingChecking=!1})},a.refreshJielongList=function(){a.$uibModalInstance.dismiss("cancel"),r.go("mixAuth.jieLongResult",{itemId:a.item.id},{reload:!0})}},o=function(t){n.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/terminateCheckin.html",controller:["$uibModalInstance","item","$state",r],controllerAs:"mdCtrl",size:void 0,appendTo:void 0,resolve:{item:function(){return t}}})},c=function(a,r,c,s){return e=a,t=r,n=c,i=s,{restrict:"A",scope:{item:"<",seller:"<"},link:function(e,t,n){t.on("click",function(){o(e.item)})}}};angular.module("shmApp.directives").directive("terminateCheckin",["appConf","ItemService","$uibModal","WeChatService",c])}(),function(){"use strict";var e,t,n,a,i=function(n,i,r,o){a=this,a.$uibModalInstance=n,a.viewRootDir=e.viewRootDir,a.jielong=i,a.cancel=function(){a.$uibModalInstance.dismiss("cancel")},a.save=function(){a.cancellingJielong=!0,t.setCommentsDeactivate(i.id,{item_url:o.href("mixAuth.itemDetails",{itemId:i.item_id},{absolute:!0})}).then(function(e){a.cancel(),r()()},function(e){a.cancelJielongError=e.data}).finally(function(){a.cancellingJielong=!1})}},r=function(t,a){n.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/cancelOthersJieLongModal.html",controller:["$uibModalInstance","jielong","callback","$state",i],controllerAs:"mdCtrl",resolve:{jielong:function(){return t},callback:function(){return a}}})},o=function(a,i,o){return e=a,t=i,n=o,{restrict:"A",scope:{jielong:"<ngModel",callback:"&"},link:function(e,t,n){t.on("click",function(){r(e.jielong,e.callback)})}}};angular.module("shmApp.directives").directive("cancelJielong",["appConf","ItemService","$uibModal",o])}(),function(){"use strict";var e,t,n=function(n,a){return e=n,t=a,{restrict:"AE",scope:{item:"<",seller:"<",appUser:"<",cbForCommentsAdded:"&?",isShowQr:"<?"},templateUrl:e.viewRootDir+"directives/item/navPanels/itemDetailsBtns.html",link:function(e,n,a){e.UtilsService=t,e.addedItemCommentsObj=function(t){"function"==typeof e.cbForCommentsAdded&&"function"==typeof e.cbForCommentsAdded()&&e.cbForCommentsAdded()(t)},e.item&&e.item.id&&(e.canAsk=1!==parseInt(e.item.is_expired)&&1!==parseInt(e.item.is_sold)&&1===parseInt(e.item.active),e.communityName=t.returnCommunityNameFromItem(e.item))}}};angular.module("shmApp.directives").directive("itemDetailsBtns",["appConf","UtilsService",n])}(),function(){"use strict";var e,t,n,a=function(a,i,r){return e=a,t=i,n=r,{restrict:"AE",scope:{item:"<",seller:"<",appUser:"<",cbForCommentsAdded:"&?",cbForCurrentUserJieLong:"&?"},templateUrl:e.viewRootDir+"directives/item/navPanels/itemJieLongDetailsBtns.html",link:function(e,a,i){e.current_user_has_check_in_available=void 0,e.current_user_can_participate=void 0,e.UtilsService=n,e.addedItemCommentsObj=function(t){"function"==typeof e.cbForCommentsAdded&&"function"==typeof e.cbForCommentsAdded()&&e.cbForCommentsAdded()(t)},e.getIsInJieLong=function(){return e.gettingIsCurrentUserJielongItemCommentsObj=!0,e.gettingIsCurrentUserJielongItemCommentsObjErr=void 0,t.getIsInJielong(e.item.id).then(function(t){t.data.currentUserJieLong&&""!==t.data.currentUserJieLong.id?(t.data.currentUserJieLong.quantity-t.data.currentUserJieLong.checkinNum>0&&(!1===e.item.online_payment||!0===e.item.online_payment&&!t.data.currentUserJieLong.voucher)?e.current_user_has_check_in_available=!0:e.current_user_has_check_in_available=!1,e.current_user_can_participate=e.item.multi_participations,e.currentUserJieLongCommentsOjb=t.data.currentUserJieLong,
    "function"==typeof e.cbForCurrentUserJieLong&&"function"==typeof e.cbForCurrentUserJieLong()&&e.cbForCurrentUserJieLong()(e.currentUserJieLongCommentsOjb)):(e.current_user_has_check_in_available=!1,e.current_user_can_participate=!0)},function(t){e.gettingIsCurrentUserJielongItemCommentsObjErr=t.data}).finally(function(){e.gettingIsCurrentUserJielongItemCommentsObj=void 0}),e},e.item&&e.item.id&&e.getIsInJieLong()}}};angular.module("shmApp.directives").directive("itemJieLongDetailsBtns",["appConf","ItemService","UtilsService",a])}(),function(){"use strict";var e,t,n,a=function(a,i,r){return e=a,t=i,n=r,{restrict:"AE",scope:{item:"<",seller:"<",appUser:"<",dropDownPosition:"<?"},templateUrl:e.viewRootDir+"directives/item/navPanels/itemNavBtns.html",link:function(e,a,i){if(e.ifCanEditItem=!0,0===e.item.images.length&&(e.dropDownPosition=!0),e.item.company&&e.item.company.id){var r=n.ifCompanyCanCreateFeaturedItem(e.item.company,e.item.predefinedTags[1]);e.ifCanEditItem=r.ifCanCreate,e.appUser&&e.appUser.is_admin&&(e.ifCanEditItem=!0),e.popPaidServiceModal=function(){n.displaySubscribeModal("PAID FEATURE",r.message)}}if(e.item.company_id&&e.item.company&&e.item.company.admin_config){var o=JSON.parse(e.item.company.admin_config);o.facebookPageId&&o.facebookPageToken&&(e.facebookAllowed=!0),o.wpLoginName&&o.wpPassword&&o.wpUrl&&(e.wordpressAllowed=!0)}e.appUser.isCompanyAdmin=e.appUser&&_.contains(e.appUser.adminOfCompanyIds,e.item.company_id),e.consultation=t.returnConsultation()}}};angular.module("shmApp.directives").directive("itemNavBtns",["appConf","ItemService","UtilsService",a])}(),function(){"use strict";var e,t,n=function(e,t,n,a,i){var r=this,o=i;return r.item=a,r.$uibModalInstance=n,r.cancel=function(){r.$uibModalInstance.dismiss("cancel"),r.updateAssetCommentErr={}},r.updateComment=function(e,t){o.updateAssetComment(e,{comment:t}).then(function(e){r.cancel()},function(e){r.updateAssetCommentErr=e.data})},r},a=function(a,i){return t=i,e=a,{restrict:"A",scope:{item:"="},link:function(a,i,r){i.on("click",function(){t.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/updateAssetComment.html",controllerAs:"ctrl",controller:["$state","$translate","$uibModalInstance","item","AssetService",n],resolve:{item:function(){return a.item}}})})}}};angular.module("shmApp.directives").directive("editImgCaption",["appConf","$uibModal",a])}(),function(){"use strict";var e,t=function(t){return e=t,{restrict:"AE",scope:{item:"<",countDownFinishCallbackFunc:"&?"},templateUrl:e.viewRootDir+"directives/item/itemCountAddressInfo.html",link:function(e){e.datePublish=moment(moment.utc(e.item.date_publish)).local().format("YYYY-MM-DD")}}};angular.module("shmApp.directives").directive("itemCountAddressInfo",["appConf",t])}(),function(){"use strict";var e,t,n=function(n,a){return e=n,t=a,{restrict:"AE",scope:{item:"<"},templateUrl:e.viewRootDir+"directives/item/itemDefaultImage.html",link:function(n,a,i){n.item&&n.item.images_in_diff_sizes&&(n.imgSrc=t.getItemDefaultThumbnailUrl(n.item)),n.item&&"App\\Modules\\Platform\\Models\\CompanyVoucherGroup"===n.item.entityName&&(n.imgSrc=n.item.entity.images&&0!==n.item.entity.images.length?n.item.entity.images[0].url:t.getAppAbsUrlRoot(e.imagesRootDir+"default_voucher_logo.png")),n.item&&n.item.itemType&&"jielong_voucher_group"===n.item.itemType&&(n.imgSrc=n.item.images&&0!==n.item.images.length?n.item.images[0].url:t.getAppAbsUrlRoot(e.imagesRootDir+"default_voucher_logo.png"))}}};angular.module("shmApp.directives").directive("itemDefaultImage",["appConf","UtilsService",n])}(),function(){"use strict";var e,t,n,a=function(a,i,r){return e=a,t=i,n=r,{restrict:"AE",scope:{modelList:"=",gettingItems:"=?",gettingItemsErr:"=?",gettingMoreItems:"=?",gettingMoreItemsErr:"=?",itemsPerRow:"<?",showMoreBtn:"<?",topRightFieldName:"@?",getItemsFunc:"&?",isInfiniteScroll:"<?",homeJielongSection:"<?",homeRecommendationSection:"<?"},templateUrl:e.viewRootDir+"directives/item/common/grid.html",link:function(e,a,i){e.itemsPerRow=angular.isDefined(e.itemsPerRow)?e.itemsPerRow:2,e.showMoreBtn=!0===e.showMoreBtn,e.refreshLazyImg=function(){t(function(){n.$emit("lazyImg:refresh")},100)},e.refreshLazyImg(),e.getGridCssClass=function(){return"grid-column-"+e.itemsPerRow},e.hasGetItemsFunc="function"==typeof e.getItemsFunc&&"function"==typeof e.getItemsFunc()}}};angular.module("shmApp.directives").directive("itemGrid",["appConf","$timeout","$rootScope",a])}(),function(){"use strict";var e,t=function(t){return e=t,{restrict:"AE",scope:{modelList:"=",gettingItems:"=?",gettingItemsErr:"=?",gettingMoreItems:"=?",gettingMoreItemsErr:"=?",showMoreBtn:"<?",showFavBtn:"<?",appUser:"<?",getItemsFunc:"&?",isInfiniteScroll:"<?",ifConsultation:"<"},templateUrl:e.viewRootDir+"directives/item/common/list.html",link:function(e,t,n){e.showMoreBtn=!0===e.showMoreBtn,e.hasGetItemsFunc="function"==typeof e.getItemsFunc&&"function"==typeof e.getItemsFunc()}}};angular.module("shmApp.directives").directive("itemList",["appConf",t])}(),function(){"use strict";var e,t,n=function(n,a){return e=n,t=a,{restrict:"AE",scope:{item:"<",appUser:"<?",showFavBtn:"<?",ifConsultation:"<"},templateUrl:e.viewRootDir+"directives/item/common/listItem.html",link:function(e,n,a){e.showRight=!1,!0===e.showFavBtn&&(e.showRight=!0),e.itemStatusName=t.getItemStatusName(e.item).toLowerCase(),!e.ifConsultation&&e.item&&e.item.tags&&e.item.tags.length>0&&(e.tagName=e.item.tags[0].name,"CONSULTATION"===e.tagName&&(e.ifConsultation=!0)),t.getItemDetails(e.item.id).then(function(t){e.visit_times=t.data.visit_times,e.publishTime_local=moment(moment.utc(e.item.date_publish)).local().format("YYYY-MM-DD")})}}};angular.module("shmApp.directives").directive("itemListItem",["appConf","ItemService",n])}(),function(){"use strict";var e,t,n,a,i=function(i,r,o,c){return e=i,t=r,n=o,a=c,{restrict:"AE",scope:{item:"<"},templateUrl:e.viewRootDir+"directives/item/itemImageSlider.html",link:function(e,i,r){e.$watch("item",function(t){e.sliderImgArray=[],a(function(){e.item&&e.item.images.length>0?(e.sliderImgArray=n.getImgArray(e.item.images_in_diff_sizes,"MID"),e.videoPoster=n.getItemDefaultThumbnailUrl(e.item)):e.sliderImgArray=[{mime_type:"image",url:n.getItemDefaultImageUrl(e.item)}]},500)}),e.showItemImgs=function(n){if(!0===t.openedInWeChat()){var a={};a.index=n||0,a.imgs=[],angular.forEach(e.item.images,function(e){a.imgs.push(e.url)}),t.runWhenWXReady(function(){wx.previewImage({current:a.imgs[a.index],urls:a.imgs})})}else window.open(e.item.images[n].url)},e.sliderIndexChange=function(t){e.sliderIndex=t.element.currentSlide}}}};angular.module("shmApp.directives").directive("itemImageSlider",["appConf","WeChatService","UtilsService","$timeout",i])}(),function(){"use strict";var e,t,n=function(n,a){return e=n,t=a,{restrict:"AE",templateUrl:e.viewRootDir+"directives/item/RelatedItemsPanel/list.html",scope:{item:"<"},link:function(e,n,a){e.getRelatedItems=function(n){e.gettingItems=!0,e.gettingItemsErr=void 0,t.searchItems({related_to_item_id:n.id,"page-size":4,tags:n.predefinedTags}).then(function(t){e.itemList=t.data},function(t){e.gettingItemsErr=t.data}).finally(function(){e.gettingItems=!1})},e.item&&e.item.id&&e.getRelatedItems(e.item)}}};angular.module("shmApp.directives").directive("itemRelatedItemsList",["appConf","ItemService",n])}(),function(){"use strict";var e,t=function(t){return e=t,{restrict:"AE",scope:{item:"<",ifConsultationPage:"<",appUser:"<"},templateUrl:e.viewRootDir+"directives/item/RelatedItemsPanel/panel.html",link:function(e,t,n){if(e.ifDisplayCompanyJielong=!1,e.item&&!e.item.company_id&&(e.ifDisplayCompanyJielong=!0),e.item&&e.item.company&&e.item.company.admin_config){!0===JSON.parse(e.item.company.admin_config).display_jielong&&(e.ifDisplayCompanyJielong=!0)}}}};angular.module("shmApp.directives").directive("itemRelatedItemsPanel",["appConf",t])}(),function(){"use strict";var e,t,n=function(n,a){return e=n,t=a,{restrict:"AE",scope:{item:"<"},templateUrl:e.viewRootDir+"directives/item/tagListPanel.html",link:function(e,t,n){}}};angular.module("shmApp.directives").directive("itemTagsListPanel",["appConf","UtilsService",n])}(),function(){"use strict";var e,t,n,a,i,r=function(r,o,c,s,m){return e=r,t=o,n=c,a=s,i=m,{restrict:"AE",scope:{item:"<",topRightFieldName:"@?",refreshLazyimgCallback:"&?"},templateUrl:e.viewRootDir+"directives/item/common/thumbLink.html",link:function(e,n,r){e.itemStatusName=t.getItemStatusName(e.item).toLowerCase(),e.item.safeTitle=a.getUrlSafeString(e.item.title),i(function(){e.isShowBlock=!0,"function"==typeof e.refreshLazyimgCallback&&e.refreshLazyimgCallback()()},50)}}};angular.module("shmApp.directives").directive("itemThumbLink",["appConf","ItemService","$state","UtilsService","$timeout",r])}(),function(){"use strict";var e,t,n,a,i,r=function(r,o,c,s,m){return e=r,t=o,n=c,a=s,i=m,{restrict:"AE",scope:{item:"<",topRightFieldName:"@?",refreshLazyimgCallback:"&?"},templateUrl:e.viewRootDir+"directives/item/common/thumbLinkNew.html",link:function(e,n,i){e.itemStatusName=t.getItemStatusName(e.item).toLowerCase(),e.item.safeTitle=a.getUrlSafeString(e.item.title),e.isNumber=!!(e.item.price&&e.item.price>0)}}};angular.module("shmApp.directives").directive("itemThumbLinkNew",["appConf","ItemService","$state","UtilsService","$timeout",r])}(),function(){"use strict";var e,t,n=function(n,a){return e=n,t=a,{restrict:"AE",scope:{item:"<"},templateUrl:e.viewRootDir+"directives/item/itemThumbnail.html",link:function(e,n,a){e.item&&e.item.images_in_diff_sizes&&(e.imgSrc=t.getItemDefaultThumbnailUrl(e.item))}}};angular.module("shmApp.directives").config(["lazyImgConfigProvider",function(e){e.setOptions({successClass:"lazy-img-success"})}]).directive("itemThumbnail",["appConf","UtilsService",n])}(),function(){"use strict";var e,t=function(t){return e=t,{restrict:"AE",scope:{forItem:"<",callbackFunc:"&?"},templateUrl:e.viewRootDir+"directives/item/showTimer.html",link:function(e,t,n){e.isShow=!0,e.isFutureItem=!1,e.finished=function(t){"function"==typeof e.callbackFunc&&"function"==typeof e.callbackFunc()&&e.callbackFunc()()},e.compareTime=function(t){var n={};n.now=moment(),n.date_expiry_local=moment.utc(t.date_expiry).local(),n.date_publish_local=moment.utc(t.date_publish).local(),e.date_publish_local=moment(moment.utc(e.forItem.date_publish)).local().format("YYYY-MM-DD"),n.date_publish_local.isAfter(n.now)?(e.endTime=n.date_publish_local,e.isFutureItem=!0):n.date_expiry_local.isAfter(n.now)?e.endTime=n.date_expiry_local:e.isShow=!1},e.forItem&&e.compareTime(e.forItem)}}};angular.module("shmApp.directives").directive("showTimer",["appConf",t])}(),function(){"use strict";var e,t,n,a,i=function(i,r,o,c){return e=i,t=o,n=r,a=c,{restrict:"AE",scope:{children:"=",propertyTypes:"<?",currentItem:"=",ifAddChildren:"<?",ifOnlinePayment:"<",formObj:"=",isEditMode:"<",companyId:"<?"},templateUrl:e.viewRootDir+"directives/item/subItemContent.html",link:function(e,n,i){e.getCompanyDetails=function(){t.getCompanyDetails(e.companyId).then(function(t){var n=t.data;e.isActivatedMultiPickup=a.ifCompanyCanCreateFeaturedItem(n,"MULTIPLE PICKUP").ifCanCreate})},e.setChildrenOrder=function(){var t=[];angular.forEach(e.children,function(e){if(e.price=parseFloat(e.price),e.config){var n=JSON.parse(e.config);e.order=n.order?n.order:0,e.origPrice=n.origPrice?n.origPrice:"",t[e.order]=e}}),t.length>0&&(e.children=t)},e.setChildrenOrder(),e.addMoreProduct=function(){e.children?e.children.push({}):e.children=[{}]},e.deleteThisProduct=function(t){e.children&&e.children.splice(t,1)},e.moveUp=function(t){if(t>0){var n=angular.copy(e.children[t]),a=angular.copy(e.children[t-1]);e.children[t]=a,e.children[t-1]=n}},e.moveDown=function(t){if(t<e.children.length-1){var n=angular.copy(e.children[t]),a=angular.copy(e.children[t+1]);e.children[t]=a,e.children[t+1]=n}},e.getCompanyLocations=function(){t.getCompanyPickupLocations(e.companyId).then(function(t){e.locations=t.data})},e.companyId&&e.getCompanyLocations(),e.$watch("companyId",function(t){t?(e.getCompanyLocations(t),e.getCompanyDetails()):e.locations=[]}),e.prevetEvent=function(e){13===e.keyCode&&(e.preventDefault(),e.stopPropagation())},e.selectLocation=function(t,n){if("all"!==n)if(e.children[t].locations){var a=!0;angular.forEach(e.children[t].locations,function(t){t.id===e.locations[n].id&&(a=!1)}),!0===a&&e.children[t].locations.push(e.locations[n])}else e.children[t].locations=[],e.children[t].locations.push(e.locations[n])},e.deleteLocation=function(t,n){e.children[n].locations.splice(t,1)}}}};angular.module("shmApp.directives").directive("subItemContent",["appConf","$translate","CompanyService","UtilsService",i])}(),function(){"use strict";var e,t,n,a=function(a,i,r){return e=a,t=i,n=r,{scope:{data:"=ngModel"},templateUrl:e.viewRootDir+"directives/item/meiPianStyleEditor.html",link:function(e,t,a){e.addNewOnlyText=function(t){e.data.splice(t+1,0,{text:"",onlyText:"true"})},e.addVideo=function(t,n){e.data.splice(n+1,0,{videoArray:[t]})},e.addEachImg=function(t,n,a){var i=n+a;e.data.splice(i+1,0,{singleImg:"",imgArray:[t]})},e.remove=function(t){e.data.splice(t,1)},e.moveUp=function(t){if(t>0){var n=angular.copy(e.data[t]),a=angular.copy(e.data[t-1]);e.data[t]=a,e.data[t-1]=n}},e.moveDown=function(t){if(t<e.data.length-1){var n=angular.copy(e.data[t]),a=angular.copy(e.data[t+1]);e.data[t]=a,e.data[t+1]=n}},e.sortableOptions={handle:".myHandle",stop:function(t,n){e.data=angular.copy(e.data)}},e.openInIphone=n.openInIphone()}}};angular.module("shmApp.directives").directive("meiPianStyleEditor",["appConf","$timeout","WeChatService",a])}(),function(){"use strict";var e,t,n=function(n,a){return e=n,t=a,{scope:{htmlContent:"=ngModel",callback:"&ngChange",firstText:"<?",isEditMode:"="},template:'<div class="panel panel-default"><div class="panel-heading"><button class=" btn btn-primary btn-lg btn-block " ng-click="isEditMode = false;mapArrayToHtml()">{{ "SAVE" | translate }}</button></div><div class="panel-body"><mei-pian-style-editor ng-model="meiPianArray" ></mei-pian-style-editor></div><div class="panel-footer"><button class=" btn btn-primary btn-lg btn-block" ng-click="isEditMode = false;mapArrayToHtml()">{{ "SAVE" | translate }}</button></div></div>',link:function(e,n,a){e.refreshContent=function(t){var n=angular.element(t),a=n.find("div.row");e.meiPianArray=[],angular.forEach(a,function(t){var n=angular.element(t),a={};if(n.find("div[meipian-style-para]").html()&&(a.text=n.find("div[meipian-style-para]").html(),a.onlyText=!0),n.find("img[meipian-style-img]").attr("src")&&(a.img=n.find("img[meipian-style-img]").attr("src")),n.find("source[meipian-style-video]").length>0){a.videoArray=[];var i={};n.find("video[meipian-style-video-control]").length>0&&(i.posterUrl=n.find("video[meipian-style-video-control]")[0].poster),i.url=n.find("source[meipian-style-video]")[0].src,a.videoArray.push(i)}a=={}&&(a.text=n.unwrap().html()),e.meiPianArray.push(a)}),0===e.meiPianArray.length&&e.meiPianArray.push({text:t})},e.mapArrayToHtml=function(){var t=angular.element("<div meipian-style></div>");angular.forEach(e.meiPianArray,function(e){var n=angular.element('<div class="row"></div>');if(e.img){var a=angular.element('<img width="100%" meipian-style-img src="'+e.img+'"/>');n.append(a)}if(e.videoArray&&e.videoArray.length>0&&e.videoArray[0]&&(e.videoArray[0].video_thumbnail_asset&&e.videoArray[0].video_thumbnail_asset.id||e.videoArray[0].posterUrl&&e.videoArray[0].url))e.videoArray[0].video_thumbnail_asset&&e.videoArray[0].video_thumbnail_asset.id?(i=angular.element('<video meipian-style-video-control poster="'+e.videoArray[0].video_thumbnail_asset.url+'" playsinline width="100%" height="240" controls><source meipian-style-video src="'+e.videoArray[0].url+'" type="video/mp4"></video>'),n.append(i)):e.videoArray[0].posterUrl&&e.videoArray[0].url&&(i=angular.element('<video meipian-style-video-control poster="'+e.videoArray[0].posterUrl+'" playsinline width="100%" height="240" controls><source meipian-style-video src="'+e.videoArray[0].url+'" type="video/mp4"></video>'),n.append(i));else if(e.video){var i={};i=angular.element('<video meipian-style-video-control playsinline width="100%" height="240" controls><source meipian-style-video src="'+e.video+'" type="video/mp4"></video>'),n.append(i)}if(e.text){var r=angular.element("<div meipian-style-para>"+e.text+"</div>");n.append(r)}t.append(n)}),e.htmlContent=t[0].outerHTML,e.callback()},e.setInterval=t(function(){e.mapArrayToHtml()},4e3),e.$on("$destroy",function(){t.cancel(e.setInterval)}),e.refreshContent(e.htmlContent)}}};angular.module("shmApp.directives").directive("itemDescEditor",["appConf","$interval",n])}(),function(){"use strict";var e,t,n=function(n,a){return e=n,t=a,{scope:{htmlContent:"=ngModel",callback:"&ngChange",isEditMode:"="},template:'<div class="desc-previewer"><div class="preview-content" ng-bind-html="trustContent"></div><div class="edit-icon" ng-click="isEditMode = true"><i class="fa fa-pencil"></i>{{ "EDIT" | translate }}</div></div>',link:function(e,n,a){e.$watch("htmlContent",function(n){e.trustContent=t.trustAsHtml(n)})}}};angular.module("shmApp.directives").directive("itemDescEditorPreviewer",["appConf","$sce",n])}(),function(){"use strict";var e,t,n,a,i=function(i,r,o,c){return e=i,t=r,n=o,a=c,{restrict:"AE",scope:{},templateUrl:e.viewRootDir+"directives/item/consultationExpiredPage.html",link:function(e,t,i){e.itemId=n.params.itemId,e.getRelevantItem=function(){a.getItemDetails(e.itemId).then(function(t){e.item=t.data},function(e){})},e.getRelevantItem()}}};angular.module("shmApp.directives").directive("consultationItemExpiredPage",["appConf","$translate","$state","ItemService",i])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s=function(e,t){c=this,c.$uibModalInstance=e,c.cancel=function(){c.$uibModalInstance.dismiss("cancel")}},m=function(c,m,u,l,p,d,g){return e=c,t=m,n=u,a=l,i=p,r=d,o=g,{restrict:"AE",scope:{item:"<",appUser:"<",seller:"<",canManageItem:"<"},templateUrl:e.viewRootDir+"directives/item/itemSignupDetails.html",link:function(e,c,m){if(e.language=o.localStorage.getItem("language"),i.hideContactUsQr=!0,e.item&&e.item.config){var u=JSON.parse(e.item.config);e.showName=!!u.name&&u.name,e.showPhone=!!u.phone&&u.phone,e.showEmail=!!u.email&&u.email,e.showAddress=!!u.address&&u.address,e.showCompany=!!u.company&&u.company}e.minusQty=function(e){e.quantity=e.quantity>1?1*e.quantity-1:1},e.plusQty=function(e){e.quantity=e.quantity>0?1*e.quantity+1:1},e.jieLongComment||(e.jieLongComment={}),e.getCurrentUserAllJielong=function(){e.tmpJielongObj={},e.currentUserAllJielong={},t.getAllJielong(e.item.id).then(function(t){if(e.currentUserAllJielong=t.data,e.currentUserAllJielong.length>0?e.jieLongComment=e.currentUserAllJielong[0]:e.jieLongComment={},angular.forEach(e.item.children,function(e){e.quantity=0}),e.jieLongComment&&e.jieLongComment.config){var n=JSON.parse(e.jieLongComment.config);e.tmpJielongObj.name=n.name?n.name:"",e.tmpJielongObj.phone=n.phone?n.phone:"",e.tmpJielongObj.email=n.email?n.email:"",e.tmpJielongObj.address=n.address?n.address:"",e.tmpJielongObj.company=n.company?n.company:""}e.item.children.length>0&&angular.forEach(e.jieLongComment.children,function(t){angular.forEach(e.item.children,function(e){e.quantity||(e.quantity=0),t.item_id===e.id&&(e.quantity=t.quantity)})})})},e.update=function(){e.save(!0)},e.save=function(i){e.sendingItemComment=!0,e.sendingItemCommentErr=void 0,e.errorMsg=void 0;var r={name:e.tmpJielongObj.name,phone:e.tmpJielongObj.phone,email:e.tmpJielongObj.email,address:e.tmpJielongObj.address,company:e.tmpJielongObj.company};e.config=JSON.stringify(r);var c={},s={};!0!==i&&(i=!1),e.item.children.length>0?(s.childrenQuantityArray=[],s.totalQuantity=0,s.quantityIsInteger=!0,angular.forEach(e.item.children,function(e){s.totalQuantity+=e.quantity,s.childrenQuantityArray.push({item_id:e.id,quantity:e.quantity,price:e.price})}),s.params={config:e.config,comments:e.jieLongComment.comments,quantity:s.childrenQuantityArray,state_redirect_obj:e.stateRedirectObj,wechat_auth_url:n.getAuthPageUrl(),item_url:a.href("mixAuth.itemDetails",{itemId:e.item.id},{absolute:!0}),voucher_base_url:a.href("mixAuth.voucherCheckIn",{voucherId:"VOUCHERID"},{absolute:!0}),is_private:e.jieLongComment.is_private},c=i?t.updateJielongToAnItemWithKids(e.jieLongComment.id,s.params):t.addJielongToAnItemWithKids(e.item.id,s.params)):(s.params={config:e.config,comments:e.jieLongComment.comments,quantity:e.jieLongComment.quantity,state_redirect_obj:e.stateRedirectObj,wechat_auth_url:n.getAuthPageUrl(),item_url:a.href("mixAuth.itemDetails",{itemId:e.item.id},{absolute:!0}),voucher_base_url:a.href("mixAuth.voucherCheckIn",{voucherId:"VOUCHERID"},{absolute:!0}),is_private:e.jieLongComment.is_private},c=i?t.updateComment(e.jieLongComment.id,s.params):t.addCommentToAnItem(e.item.id,s.params)),e.paticipateInJielongFail=!1,c.then(function(t){if(t.data.auth_url)return void(o.location.href=t.data.auth_url);var a=t.data.voucher.img_url;if(a)if(!0===n.openedInWeChat()&&!1===n.openInWindowsWechat()){var i={};i.imgs=[a],WeixinJSBridge.invoke("imagePreview",{current:a,urls:i.imgs})}else window.open(a);e.sendingItemComment=!1},function(t){e.sendingItemCommentErr=t.data,e.sendingItemComment=!1}).finally(function(){e.sendingItemComment=!1,e.getCurrentUserAllJielong()})},e.showContactQr=function(){r.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",template:'<div class="modal-header"><span class="modal-title contact-qr-font-size" translate = "CONTACT_QR"></span><i ng-click="mdCtrl.cancel()" class="fa fa-window-close fa-2x pull-right " aria-hidden="true"></i></div><div class="modal-body"><div class="row text-center"><img class = "text-center" src="/app/images/kefu_new_1.png"/><br/><br/><br/><img class = "text-center" src="/app/images/kefu_new_4.png"/></div></div>',controller:["$uibModalInstance",s],controllerAs:"mdCtrl",size:"lg",appendTo:void 0})},e.getCurrentUserAllJielong()}}};angular.module("shmApp.directives").directive("itemSignupDetails",["appConf","ItemService","WeChatService","$state","$rootScope","$uibModal","$window",m])}(),function(){"use strict";var e,t,n,a,i,r=function(r,o,c,s,m){return e=r,t=o,n=c,a=s,i=m,{restrict:"AE",scope:{currentItem:"=",appUser:"<"},templateUrl:e.viewRootDir+"directives/item/itemHistoryRollback.html",link:function(e,r,o){"simplified-chinese"===t.use()?i.moment.locale("cn"):i.moment.locale("en"),e.getItemHistories=function(t,a){var i={};i.pageNo=a||1,i.params={"page-size":4},n.getItemHistories(t,i.params).then(function(t){e.itemHistories=t.data;var n={};n.content=JSON.stringify(e.currentItem),e.itemHistories.data.unshift(n),e.itemHistories.data[0].selected=!0})},e.getItemHistories(e.currentItem.id),e.rollBackTOHistory=function(t){if(angular.forEach(e.itemHistories.data,function(e,n){e.selected=t===n}),e.currentItem=JSON.parse(e.itemHistories.data[t].content),e.currentItem.children&&e.currentItem.children.length>=1&&angular.forEach(e.currentItem.children,function(e){e.display=!0}),e.currentItem.config){var a=JSON.parse(e.currentItem.config);e.currentItem.ifUseSignupTpl=!!a.ifUseSignupTpl&&a.ifUseSignupTpl}else e.currentItem.ifUseSignupTpl=!1;var i=Object.keys(e.currentItem.predefinedTags).map(function(t){return e.currentItem.predefinedTags[t]});e.currentItem.isConsultationPage=!(!e.currentItem||!e.currentItem.predefinedTags)&&i[0]==n.returnConsultation(),e.currentItem.tagNames=[],angular.forEach(e.currentItem.tags,function(t){""==t.type_id.trim()&&e.currentItem.tagNames.push(t.name)}),e.currentItem.special_tags&&e.currentItem.special_tags.length>0&&angular.forEach(e.currentItem.special_tags,function(t){e.currentItem.tagNames.push(t)}),e.currentItem.date_expiry_local=moment(moment.utc(e.currentItem.date_expiry)).local(),e.currentItem.date_publish_local=moment(moment.utc(e.currentItem.date_publish)).local()},e.preSubmit=function(){var n=t.instant("ITEM.PAGE.DETAILS.HISTORY.ASK_TITLE");weui.confirm(n,function(){e.submit()},function(){})},e.submit=function(){e.submitting=!0,e.currentItem.item_url=a.href("mixAuth.itemDetails",{itemId:e.currentItem.id},{absolute:!0}),e.currentItem.tagNames=_.difference(e.currentItem.tagNames,e.currentItem.special_tags),e.currentItem.predefinedTags&&angular.forEach(e.currentItem.predefinedTags,function(t){e.currentItem.tagNames||(e.currentItem.tagNames=[]),0!=t&&e.currentItem.tagNames.push(t)}),n.updateItem(e.currentItem.id,e.currentItem).then(function(t){e.submitting=!1,e.getItemHistories(t.data.id),e.confirmUpdating=void 0}).finally(function(){weui.toast(t.instant("ITEM.PAGE.DETAILS.HISTORY.CONFIRM_TITLE"),3e3)})}}}};angular.module("shmApp.directives").directive("itemHistoryRollback",["appConf","$translate","ItemService","$state","$window",r])}(),function(){"use strict";var e,t,n,a,i,r=function(r,o,c,s,m){return e=r,t=o,n=c,a=s,i=m,{restrict:"AE",scope:{currentItem:"=",fromDetailPage:"<?",appUser:"<"},templateUrl:e.viewRootDir+"directives/item/itemHistoryRollbackEdit.html",link:function(e,r,o){"simplified-chinese"===t.use()?i.moment.locale("cn"):i.moment.locale("en"),e.getItemHistories=function(t,a){var i={};i.pageNo=a||1,i.params={"page-size":4},n.getItemHistories(t,i.params).then(function(t){e.itemHistories=t.data;var n={};n.content=JSON.stringify(e.currentItem),e.itemHistories.data.unshift(n),e.itemHistories.data[0].selected=!0})},e.getItemHistories(e.currentItem.id),e.rollBackTOHistory=function(t){if(angular.forEach(e.itemHistories.data,function(e,n){e.selected=t===n}),e.currentItem=JSON.parse(e.itemHistories.data[t].content),e.currentItem.config){var a=JSON.parse(e.currentItem.config);e.currentItem.ifUseSignupTpl=!!a.ifUseSignupTpl&&a.ifUseSignupTpl}else e.currentItem.ifUseSignupTpl=!1;var i=Object.keys(e.currentItem.predefinedTags).map(function(t){return e.currentItem.predefinedTags[t]});e.currentItem.isConsultationPage=!(!e.currentItem||!e.currentItem.predefinedTags)&&i[0]==n.returnConsultation(),e.currentItem.tagNames=[],angular.forEach(e.currentItem.tags,function(t){""==t.type_id.trim()&&e.currentItem.tagNames.push(t.name)}),e.currentItem.date_expiry_local=moment(moment.utc(e.currentItem.date_expiry)).local(),e.currentItem.date_publish_local=moment(moment.utc(e.currentItem.date_publish)).local()},e.preSubmit=function(){var n=t.instant("ITEM.PAGE.DETAILS.HISTORY.ASK_TITLE");weui.confirm(n,function(){e.submit()},function(){})},e.submit=function(){e.submitting=!0,e.currentItem.item_url=a.href("mixAuth.itemDetails",{itemId:e.currentItem.id},{absolute:!0}),e.currentItem.predefinedTags&&angular.forEach(e.currentItem.predefinedTags,function(t){e.currentItem.tagNames||(e.currentItem.tagNames=[]),0!=t&&e.currentItem.tagNames.push(t)}),n.updateItem(e.currentItem.id,e.currentItem).then(function(t){e.submitting=!1,e.getItemHistories(t.data.id),e.confirmUpdating=void 0}).finally(function(){weui.toast(t.instant("ITEM.PAGE.DETAILS.HISTORY.CONFIRM_TITLE"),3e3)})}}}};angular.module("shmApp.directives").directive("itemHistoryRollbackEdit",["appConf","$translate","ItemService","$state","$window",r])}(),function(){"use strict";var e,t,n=function(n,a){return e=n,t=a,{restrict:"AE",scope:{},templateUrl:e.viewRootDir+"directives/item/recentCompanyJielong.html",link:function(e,n,a){e.predefinedTagId="552a8c864c2628440e4d85d935b669af",e.paramsOngoingJielong={"order-by":{"items.date_start":"desc"},page:1,"page-size":6,published:1,expired:0,sold:0,draft:0,"is-company":1},e.getItems=function(n){var a={};a.pageNo=n||1,a.pageNo>1?(e.gettingMoreItems=!0,e.gettingMoreItemsErr=void 0):(e.gettingItems=!0,e.gettingItemsErr=void 0),t.searchItemsUnderCommunity(e.predefinedTagId,e.paramsOngoingJielong).then(function(t){a.pageNo>1&&(a.previousData=e.itemList.data),e.itemList=t.data,e.itemList.data=e.itemList.data,a.pageNo>1&&(e.itemList.data=a.previousData.concat(e.itemList.data)),e.hasResult=t.data&&t.data.total>0,e.callback&&"function"==typeof e.callback&&e.callback()({ongoingJielongList:e.itemList})},function(t){1===a.pageNo?e.gettingItemsErr=t.data:e.gettingMoreItemsErr=t.data}).finally(function(){e.gettingItems=!1,e.gettingMoreItems=!1})},e.getItems()}}};angular.module("shmApp.directives").directive("recentCompanyJielong",["appConf","ItemService",n])}(),function(){"use strict";var e,t,n,a,i,r,o,c=function(c,s,m,u,l,p,d){return e=c,t=s,n=m,a=u,i=l,r=p,o=d,{restrict:"AE",scope:{appUser:"<",urlHouseFilter:"<?",updateShareUrlCallback:"&?",communityImgSrc:"<"},templateUrl:e.viewRootDir+"directives/item/navPanels/rentFilter.html",link:function(e,c,s){a.getMe().then(function(t){var n=t.data;if(""==n.config)e.isReceiveRental=!1;else{var a=JSON.parse(n.config);e.isReceiveRental=a.isReceiveRental}}),e.saveHouseFilter=function(){e.formatFilter();var a=e.houseFilter;n.updateMe({houseFilter:a}).then(function(e){weui.toast(t.instant("ITEM.PAGE.LIST.RENT.SAVE.NOTIFICATION"),1e3)},function(e){})},e.formatFilter=function(){var t={};t.params={suburb:e.suburb,amount_range:e.rent,rent_type:e.type,gender_prefer:e.gender,bed_num:e.bedroom,bath_num:e.bathroom,park_num:e.car,allow_pet:e.pet,property_type:e.propertyType},e.houseFilter=t.params},e.getRentSuburbs=function(e){return r.getRentSuburbs(e).then(function(e){return e.data})},e.refreshSearch=function(){o.transitionTo(o.current.name,{suburb:e.suburb,amount:e.rent,type:e.type,bed:e.bedroom,bath:e.bathroom,gender:e.gender,car:e.car,pet:e.pet,propertyType:e.propertyType,expand:!1},{location:!0,inherit:!0,relative:o.$current})},e.toggleSwitch=function(){e.expand=!e.expand,e.updateShareUrlCallback()(e.expand)},e.clearFilter=function(){e.rent="",e.type="",e.gender="",e.bedroom="",e.bathroom="",e.car="",e.suburb="",e.pet="",e.propertyType=""},e.setRentNotification=function(t){n.updateMe({isReceiveRental:t}).then(function(n){e.saveHouseFilter(),1==t&&void 0!==e.appUser.wechat_is_subscriber&&1!==parseInt(e.appUser.wechat_is_subscriber)&&i.displaySubscribeModal("RENTING PROPERTY")},function(e){})};var m=!0;angular.forEach(e.urlHouseFilter,function(e,t){""!==e&&(m=!1)}),m?e.appUser&&e.appUser.houseFilter&&e.appUser.houseFilter.id?(e.houseFilter=e.appUser.houseFilter,e.rent=e.houseFilter.amount_range,e.type=e.houseFilter.rent_type,e.gender=e.houseFilter.gender_prefer,e.bedroom=e.houseFilter.bed_num,e.bathroom=e.houseFilter.bath_num,e.car=e.houseFilter.park_num,e.suburb=e.houseFilter.suburb,e.pet=e.houseFilter.allow_pet,e.propertyType=e.houseFilter.property_type,e.expand="true"===e.houseFilter.expand,e.refreshSearch()):(e.expand=!1,e.rent="",e.type="",e.gender="",e.bedroom="",e.bathroom="",e.car="",e.suburb="",e.pet="",e.propertyType=""):(e.rent=e.urlHouseFilter.amount_range,e.type=e.urlHouseFilter.rent_type,e.gender=e.urlHouseFilter.gender_prefer,e.bedroom=e.urlHouseFilter.bed_num,e.bathroom=e.urlHouseFilter.bath_num,e.car=e.urlHouseFilter.park_num,e.suburb=e.urlHouseFilter.suburb,e.pet=e.urlHouseFilter.allow_pet,e.propertyType=e.urlHouseFilter.property_type,e.expand="true"===e.urlHouseFilter.expand)}}};angular.module("shmApp.directives").directive("rentFilter",["appConf","$translate","UserService","AuthService","UtilsService","ItemService","$state",c])}(),function(){"use strict";var e,t,n,a,i,r=function(r,o,c,s,m){return e=r,t=o,n=c,a=s,i=m,{restrict:"AE",scope:{item:"<",topRightFieldName:"@?",refreshLazyimgCallback:"&?",thumbLinkType:"<?"},templateUrl:e.viewRootDir+"directives/item/common/thumbLinkJielong.html",link:function(e,n,r){if(e.showLocationTitle=!1,e.itemStatusName=t.getItemStatusName(e.item).toLowerCase(),e.item.safeTitle=a.getUrlSafeString(e.item.title),i(function(){e.isShowBlock=!0,"function"==typeof e.refreshLazyimgCallback&&e.refreshLazyimgCallback()()},50),e.item&&e.item.images_in_diff_sizes&&(e.imgSrc=a.getItemDefaultThumbnailUrl(e.item)),e.item.config&&"null"!==e.item.config){var o=JSON.parse(e.item.config);e.item.discountPercentage=o.max_discount?100*o.max_discount+"%":void 0}e.toggleText=function(){
        e.showTruncatedText=void 0===e.showTruncatedText||!e.showTruncatedText}}}};angular.module("shmApp.directives").config(["lazyImgConfigProvider",function(e){e.setOptions({successClass:"lazy-img-success"})}]).directive("thumbLinkJielong",["appConf","ItemService","$state","UtilsService","$timeout",r])}(),function(){"use strict";var e,t,n,a=function(a,i,r){return e=a,t=i,n=r,{restrict:"AE",scope:{item:"<ngModel"},templateUrl:e.viewRootDir+"directives/item/tpl/grid/JielongGridItem.html",link:function(e,a,i){var r=0,o=0,c=[];angular.forEach(e.item.extra_json.top_avatars,function(e){var t=-2*o;c.push({url:e,style:"position:relative; right:"+r+"px; top:"+t+"em"}),r+=12,o+=1}),e.item&&e.item.visit_stat&&e.item.visit_stat&&e.item.visit_stat.value&&(e.newVisitValue=t.showSimplifiedNumber(e.item.visit_stat.value)),e.itemStatusName=n.getItemStatusName(e.item).toLowerCase(),e.item.avatarStyleArray=c}}};angular.module("shmApp.directives").directive("jielongGridItem",["appConf","UtilsService","ItemService",a])}(),function(){"use strict";var e,t=function(t){return e=t,{restrict:"AE",template:"<a href='{{redirectUrl}}'>Click to Redirect</a>",link:function(t,n,a){e.getPreAuthorizationUrl().then(function(e){t.redirectUrl=e.data.url})}}};angular.module("shmApp.directives").directive("openPlatformPreauth",["WeChatService",t])}(),function(){"use strict";var e,t,n,a=function(a,i,r){return e=a,t=i,n=r,{restrict:"AE",templateUrl:n.viewRootDir+"directives/openPlatform/openPlatformBindCompany.html",link:function(n,a,i){n.companyId=t.params.companyId,n.authCode=t.params.auth_code,n.success=!1,n.submittingBind=!0;var r={company_id:n.companyId,auth_code:n.authCode};e.bindCompanyWithAppId(r).then(function(e){n.success=!0},function(){n.success=!1}).finally(function(){n.submittingBind=!1})}}};angular.module("shmApp.directives").directive("openPlatformBindCompany",["WeChatService","$state","appConf",a])}(),function(){"use strict";var e,t=function(t){return e=t,{restrict:"AE",scope:{seller:"<",appUser:"<"},templateUrl:e.viewRootDir+"directives/user/sellerBanner.html",link:function(e,t,n){}}};angular.module("shmApp.directives").directive("sellerBanner",["appConf",t])}(),function(){"use strict";var e,t=function(t){return e=t,{restrict:"AE",scope:{appUser:"<",showHomeBtn:"<?",showVoucherBtns:"<?",communityName:"<?"},templateUrl:e.viewRootDir+"directives/user/UserNavBtns.html",link:function(e,t,n){e.showHomeBtn=!1!==e.showHomeBtn,e.showVoucherBtns=!1!==e.showVoucherBtns}}};angular.module("shmApp.directives").directive("userNavBtns",["appConf",t])}(),function(){"use strict";var e,t,n=function(n,a){return e=n,t=a,{restrict:"AE",scope:{user:"<",showAsLink:"=?",extraStyle:"@?",isRound:"@"},templateUrl:e.viewRootDir+"directives/user/avatar-div.html",link:function(e,n,a){e.roundStyle="true"===e.isRound?"border-radius: 50%":"",e.$watch("user",function(n){e.imgSrc=t.getUserAvatarImageUrl(e.user)},!0)}}};angular.module("shmApp.directives").directive("showUserAvatar",["appConf","UtilsService",n])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s=function(n){t.open({animation:!0,templateUrl:e.viewRootDir+"directives/user/selectLanguage.html",controller:["$state","$translate","$uibModalInstance","callBack","$window",m],controllerAs:"ctrl",size:void 0,appendTo:void 0,resolve:{callBack:function(){return n}}})},m=function(e,t,n,o,c){var s=this;return s.$uibModalInstance=n,s.selectLanguage=function(e){t.use(e),c.localStorage.setItem("language",e),i.getMe().then(function(t){var n=t.data;n.id&&s.updateLanguage(n,e)}),o&&"function"==typeof o&&o()(e),s.$uibModalInstance.dismiss("cancel")},s.updateLanguage=function(e,t){r.getLanguageByName(t).then(function(t){e.language_id=t.data.id,a.updateUserLanguage(e.id,e)})},s},u=function(m,u,l,p,d,g,f,h){return e=m,t=u,n=l,i=d,a=p,r=g,o=f,c=h,{restrict:"A",scope:{isDetectLang:"<?",callBack:"&?"},link:function(e,t,a){angular.element(t).click(function(){s(e.callBack)}),c(function(){!0!==e.isDetectLang||o.localStorage.getItem("language")?!0===e.isDetectLang&&o.localStorage.getItem("language")&&n.use(o.localStorage.getItem("language")):s()},1e3)}}};angular.module("shmApp.directives").directive("selectLanguage",["appConf","$uibModal","$translate","UserService","AuthService","LanguageService","$window","$timeout",u])}(),function(){"use strict";var e,t,n,a,i,r,o=function(){t.open({animation:!0,templateUrl:e.viewRootDir+"directives/user/generateLoginCode.html",controller:["$state","$translate","$uibModalInstance",c],controllerAs:"ctrl",size:void 0,appendTo:void 0})},c=function(e,t,n){var i=this;return i.$uibModalInstance=n,i.gettingData=!1,i.generateLoginCode=function(){i.gettingItemsErr="",i.gettingData=!0,a.generateLoginCode().then(function(e){i.loginCode=e.data.login_code},function(e){i.gettingItemsErr=e.data}).finally(function(){i.gettingData=!1})},i.cancel=function(){i.$uibModalInstance.close("cancel")},i},s=function(c,s,m,u,l,p){return e=c,t=s,n=m,i=l,a=u,r=p,{restrict:"A",scope:{},link:function(e,t,n){angular.element(t).click(function(){o()})}}};angular.module("shmApp.directives").directive("generateLoginCode",["appConf","$uibModal","$translate","UserService","AuthService","LanguageService",s])}(),function(){"use strict";var e,t,n,a,i,r,o,c=function(){t.open({animation:!0,templateUrl:e.viewRootDir+"directives/user/validateLoginCode.html",controller:["$state","$translate","$uibModalInstance","$window",s],controllerAs:"ctrl",size:void 0,appendTo:void 0,resolve:{$window:function(){return o}}})},s=function(e,t,n,i){var r=this;return r.$uibModalInstance=n,r.gettingData=!1,r.validateLoginCode=function(){r.gettingItemsErr="",r.gettingData=!0;var t={};t.params={login_code:r.loginCode},a.validateLoginCode(t.params).then(function(t){if(r.gettingData=!1,t.data.return_code){var n=t.data.return_code;if(i.localStorage.setItem("satellizer_token",n),r.$uibModalInstance.close("cancel"),i.localStorage.getItem("SHM_redirect_url")){var a=JSON.parse(i.localStorage.getItem("SHM_redirect_url"),!0);i.localStorage.removeItem("SHM_redirect_url"),e.go(a.state,a.params,a.reload)}else e.go("mixAuth.community",{},{reload:!0})}},function(e){r.gettingItemsErr=e.data}).finally(function(){r.gettingData=!1})},r.cancel=function(){r.$uibModalInstance.close("cancel")},r},m=function(s,m,u,l,p,d,g){return e=s,t=m,n=u,i=p,a=l,r=d,o=g,{restrict:"A",scope:{},link:function(e,t,n){angular.element(t).click(function(){c()})}}};angular.module("shmApp.directives").directive("validateLoginCode",["appConf","$uibModal","$translate","UserService","AuthService","LanguageService","$window",m])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s=function(n){t.open({animation:!0,templateUrl:e.viewRootDir+"directives/user/signOut.html",controller:["$state","$translate","$uibModalInstance","appUser",m],controllerAs:"ctrl",size:void 0,appendTo:void 0,resolve:{appUser:function(){return n}}})},m=function(e,t,n,a){var i=this;return i.appUser=a,i.$uibModalInstance=n,i.cancel=function(){i.$uibModalInstance.close("cancel")},i.confirm=function(){o.localStorage.removeItem("satellizer_token"),o.localStorage.removeItem("SHM_redirect_url"),e.go("mixAuth.community",{},{reload:!0}),i.$uibModalInstance.close("cancel"),weui.toast(t.instant("LOGIN_OUT_SUCCESSFUL"),1500)},i},u=function(m,u,l,p,d,g,f,h){return e=m,t=u,n=l,i=d,a=p,r=g,o=f,c=h,{restrict:"A",scope:{appUser:"<?"},link:function(e,t,n){angular.element(t).click(function(){s(e.appUser)})}}};angular.module("shmApp.directives").directive("signOut",["appConf","$uibModal","$translate","UserService","AuthService","LanguageService","$window","$state",u])}(),function(){"use strict";var e,t,n,a,i,r=function(r,o,c,s,m){return e=r,t=o,n=c,a=s,i=m,{restrict:"AE",scope:{isFromFacebook:"<?"},templateUrl:e.viewRootDir+"directives/user/socialLoginBtns.html",link:function(t,r,o){var c=t;c.appConf=e,c.openedInWeChat=i.openedInWeChat(),c.login=function(e){n.getSocialMediaLoginRedirectUrl(e).then(function(e){a.location.href=e.data.url})},!0===c.isFromFacebook&&c.login("facebook")}}};angular.module("shmApp.directives").directive("socialLoginBtns",["appConf","$stateParams","AuthService","$window","WeChatService",r])}(),function(){"use strict";var e,t,n,a,i,r,o=function(o,c,s,m,u,l){return e=o,t=c,n=s,a=m,i=u,r=l,{restrict:"AE",scope:{},templateUrl:e.viewRootDir+"directives/user/userCallback.html",link:function(o,c,s){o.appConf=e,n.getSocialMediaUserFromCode(t.name,t.code).then(function(e){if(a.setToken(e.data.token),r.localStorage.getItem("SHM_redirect_url")){var t=JSON.parse(r.localStorage.getItem("SHM_redirect_url"),!0);r.localStorage.removeItem("SHM_redirect_url"),i.go(t.state,t.params,t.reload)}else i.go("mixAuth.itemList",{},{reload:!0})})}}};angular.module("shmApp.directives").directive("socialCallback",["appConf","$stateParams","AuthService","$auth","$state","$window",o])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s=function(s,m,u,l,p,d,g,f){return e=s,t=m,n=u,a=l,i=p,r=d,o=g,c=f,{restrict:"AE",scope:{appUser:"<?"},templateUrl:e.viewRootDir+"directives/user/facebookBindCallback.html",link:function(a,s,m){o.hideContactUsQr=!0;var u=a;u.appUser||alert(c.instant("ITEM.PAGE.DETAILS.FACEBOOK_BIND.FAIL_LOGIN")),u.appConf=e,u.userCompany=u.appUser.userCompany,(!u.userCompany||!u.userCompany.length||!u.userCompany.length>=1)&&alert(c.instant("ITEM.PAGE.DETAILS.FACEBOOK_BIND.FAIL_NO_COMPANY")),u.selectedCompanyId=u.userCompany[0].id;var l=JSON.parse(t.state);n.facebookPageBindWithCode(t.code,l.companyId).then(function(e){u.facebookPageList=e.data,u.selectedPageId=u.facebookPageList[0].id},function(e){alert(c.instant("ITEM.PAGE.DETAILS.FACEBOOK_BIND.FAIL_FETCH_PAGE_LIST")),i.go("mixAuth.companyEdit",{companyId:u.selectedCompanyId},{reload:!0})}),u.bindCompanyWithPage=function(e,t){var n=e,a=t,o="";if(angular.forEach(u.facebookPageList,function(e){e.id==t&&(o=e.access_token)}),!o)return alert(c.instant("ITEM.PAGE.DETAILS.FACEBOOK_BIND.FAIL_FETCH_PAGE_TOKEN")),void i.go("mixAuth.companyEdit",{companyId:e},{reload:!0});var s={companyId:n,facebookPageId:a,facebookPageToken:o};r.bindFacebookWithPage(s).then(function(e){alert(c.instant("ITEM.PAGE.DETAILS.FACEBOOK_BIND.SUCCESS")),i.go("mixAuth.companyEdit",{companyId:n},{reload:!0})})}}}};angular.module("shmApp.directives").directive("facebookPageCallback",["appConf","$stateParams","AuthService","$auth","$state","CompanyService","$rootScope","$translate",s])}(),function(){"use strict";var e,t=function(t){return e=t,{restrict:"AE",scope:{user:"<"},templateUrl:e.viewRootDir+"directives/user/UserContact.html",link:function(e,t,n){e.authorName=e.user.nick_name;var a=e.user&&e.user.config?angular.fromJson(e.user.config):{};e.authorPhone=a&&a.mobile?a.mobile:"",e.authorEmail=a&&a.email?a.email:"",e.authorWechat=a&&a.wechat?a.wechat:"",e.authorQq=a&&a.qq?a.qq:""}}};angular.module("shmApp.directives").directive("userContact",["appConf",t])}(),function(){"use strict";var e,t,n,a,i,r=function(r,o,c,s,m,u){return e=r,t=o,n=c,a=s,i=u,{restrict:"AE",scope:{item:"<",seller:"<"},templateUrl:e.viewRootDir+"directives/payment/paymentSuccess.html",link:function(e,t,n){var a=m.params.itemCommentId;i.validatePayment(a,{voucher_base_url:m.href("mixAuth.voucherCheckIn",{voucherId:"VOUCHERID"},{absolute:!0})}).then(function(e){alert(e.data.result_code)},function(){})}}};angular.module("shmApp.directives").directive("paymentSuccess",["appConf","ItemService","$uibModal","WeChatService","$state","PaymentService",r])}(),function(){"use strict";var e,t,n,a,i,r,o,c=function(c,s,m,u,l,p,d){return e=c,n=m,a=u,t=s,i=l,r=p,o=d,{restrict:"AE",scope:{appUser:"<",vendorPayments:"=",companyId:"<"},templateUrl:e.viewRootDir+"directives/payment/paymentCleared.html",link:function(e,t,n){_.isEmpty(e.vendorPayments)&&(e.noReceiptList=!0)}}};angular.module("shmApp.directives").directive("paymentCleared",["appConf","$translate","CompanyService","WeChatService","$state","UtilsService","PaymentService",c])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s=function(s,m,u,l,p,d,g,f){return e=s,n=u,a=l,t=m,i=p,r=d,o=g,c=f,{restrict:"AE",scope:{appUser:"<",receiptList:"=",companyId:"<",callBack:"&?"},templateUrl:e.viewRootDir+"directives/payment/paymentUncleared.html",link:function(e,t,n){_.isEmpty(e.receiptList)&&(e.noReceiptList=!0),e.price=0,e.companyChange=function(){e.price=0,angular.forEach(e.receiptList,function(t){angular.forEach(t.companies,function(t){1==t.flag&&angular.forEach(t.items,function(t){angular.forEach(t.receipts,function(t){e.price+=t.amount})})})})},e.preview=function(){e.previewList={},angular.forEach(e.receiptList,function(t){angular.forEach(t.companies,function(t,n){1==t.flag&&(e.previewList[n]||(e.previewList[n]=_.omit(t,"items")),e.previewList[n].items||(e.previewList[n].items={}),angular.forEach(t.items,function(t,a){e.previewList[n].items[a]||(e.previewList[n].items[a]=_.omit(t,"receipts")),e.previewList[n].items[a].receipts||(e.previewList[n].items[a].receipts={}),angular.forEach(t.receipts,function(t,i){e.previewList[n].items[a].receipts[i]||(e.previewList[n].items[a].receipts[i]=t)})}))})}),e.ifPreview=!0},e.back=function(){e.ifPreview=!1},e.submit=function(){var t={company_receipt_ids:{}};angular.forEach(e.receiptList,function(e){angular.forEach(e.companies,function(e){1==e.flag&&angular.forEach(e.items,function(n){angular.forEach(n.receipts,function(a){t.company_receipt_ids[n.company.id]||(t.company_receipt_ids[n.company.id]=[]),t.company_receipt_ids[e.id].push(a.id)})})})}),e.fetching=!0,r.generateABA(t).then(function(t){t.data&&(e.pageUrl=t.data.aba_file_url)},function(t){e.gettingItemsErr=t.data}).finally(function(){e.fetching=!1})}}}};angular.module("shmApp.directives").directive("paymentUncleared",["appConf","$translate","CompanyService","WeChatService","$state","PaymentService","ItemService","$window",s])}(),function(){"use strict";var e,t,n,a=function(a,i,r){return e=a,t=i,n=r,{restrict:"AE",scope:{},templateUrl:e.viewRootDir+"directives/payment/payWithAlipayQr.html",link:function(e,a,i){e.alipayQRUrl=t.params.alipay_qr_url,e.itemId=t.params.itemId,e.$translate=n}}};angular.module("shmApp.directives").directive("payWithAlipayQr",["appConf","$state","$translate",a])}(),function(){"use strict";var e,t,n,a,i=function(t){a.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/payment/receiptDetail.html",controller:"paymentReceiptCtrl",controllerAs:"ctrl",size:void 0,appendTo:void 0,resolve:{receipt:function(){return t}}})},r=function(e,n){t=this,t.$uibModalInstance=e,t.receipt=n,t.cancel=function(){t.$uibModalInstance.dismiss("cancel")}},o=function(e){n=e},c=function(t,n){return e=t,a=n,{restrict:"A",scope:{receipt:"=?"},template:"",controller:["$scope",o],link:function(e,t,n){angular.element(t).click(function(){i(e.receipt)})}}};angular.module("shmApp.directives").controller("paymentReceiptCtrl",["$uibModalInstance","receipt",r]).directive("paymentReceiptDetailBtn",["appConf","$uibModal",c])}(),function(){"use strict";var e,t,n,a,i,r,o,c=function(c,s,m,u,l,p,d){return e=c,n=m,a=u,t=s,i=l,r=p,o=d,{restrict:"AE",scope:{appUser:"<",vendorPayments:"=",callBack:"&"},templateUrl:e.viewRootDir+"directives/payment/adminPaymentCleared.html",link:function(e,t,n){_.isEmpty(e.vendorPayments)&&(e.noReceiptList=!0),e.generateABA=function(t){var n={vendor_payment_id:{},payment_group_id:t};angular.forEach(e.vendorPayments,function(e){angular.forEach(e.payments,function(e){angular.forEach(e.vendors,function(e){e.vendor_payment_group_id==t&&(n.vendor_payment_id[e.company.id]||(n.vendor_payment_id[e.company.id]=[]),n.vendor_payment_id[e.company.id].push(e.id))})})}),e.fetching=!0,o.reGenerateABA(n).then(function(t){t.data&&(e.pageUrl=t.data.aba_file_url)},function(t){e.gettingItemsErr=t.data}).finally(function(){e.fetching=!1})}}}};angular.module("shmApp.directives").directive("adminPaymentCleared",["appConf","$translate","CompanyService","WeChatService","$state","UtilsService","PaymentService",c])}(),function(){"use strict";var e,t,n,a,i=function(i,r,o,c){return e=i,t=r,n=o,a=c,{restrict:"AE",scope:{},templateUrl:e.viewRootDir+"directives/payment/paypalValidationUrl.html",link:function(e,n,i){var r=t.params.PayerID;e.gettingData=!0,e.paypalComplete=function(){var n={};n.params={payer_id:r,token:t.params.token},a.paypalCompleteCheckout(n.params).then(function(n){e.gettingData=!1;var a=n.data;t.go("mixAuth.itemDetails",{itemId:a.id},{reload:!0})},function(n){e.gettingUsersErr=n.data,t.go("mixAuth.itemDetails",{itemId:n.data.errors.item_id},{reload:!0})}).finally(function(){e.gettingUsers=void 0,e.gettingData=!1})},e.paypalComplete()}}};angular.module("shmApp.directives").directive("paypalValidationUrl",["appConf","$state","$translate","PaymentService",i])}(),function(){"use strict";var e,t,n,a,i,r=function(r,o,c,s,m){return e=r,t=o,n=c,a=s,i=m,{restrict:"AE",scope:{},templateUrl:e.viewRootDir+"directives/payment/paymentValidationPage.html",link:function(n,r,o){i.detectIfUseTemplate(!0),n.gettingData=!0,n.kefu_1=e.imagesRootDir+"kefu_new_1.png",n.kefu_4=e.imagesRootDir+"kefu_new_4.png",n.paymentComplete=function(){var e={};e.params=t.params,a.paymentCompleteCheckout(e.params).then(function(e){if(n.gettingData=!1,n.source=e.data.source,!0===e.data.success){n.receiptNum=e.data.receipt_num;var t={transaction_id:e.data.transaction_id};n.finalizePayment(t,n.source)}!1===e.data.success&&(n.result=e.data)},function(e){n.gettingErr=e.data})},n.finalizePayment=function(e,t){"new_company"==t&&a.completeApplyCompany(e).then(function(e){n.result=e.data},function(e){n.gettingErr=e.data}),"existing_company"==t&&a.completeExtendCompany(e).then(function(e){n.result=e.data,n.amount=n.result.info.amount,n.extendDuration=n.result.info.extendDuration,n.currency=n.result.info.currency,n.companyName=n.result.info.companyName,n.companyId=n.result.companyId,n.currentPackageExpireDate_local=moment(moment.utc(n.result.info.currentPackageExpireDate)).local().format("YYYY-MM-DD HH:mm:ss")},function(e){n.gettingErr=e.data})},n.paymentComplete()}}};angular.module("shmApp.directives").directive("paymentValidationPage",["appConf","$state","$translate","PaymentService","$rootScope",r])}(),function(){"use strict";var e,t,n,a,i,r=function(r,o,c,s,m){return e=r,t=o,n=c,a=s,i=m,{restrict:"AE",scope:{model:"=ngModel"},templateUrl:e.viewRootDir+"directives/item/voucherDetail.html",link:function(e,r,o){e.showItemImg=function(e){if(!n.isUrl(e))return alert(a.instant("IMG_PROCESSING")),void i.reload();if(!0===t.openedInWeChat()&&!1===t.openInWindowsWechat()){var r={};r.imgs=[e],WeixinJSBridge.invoke("imagePreview",{current:e,urls:r.imgs})}else weui.gallery(e)}}}};angular.module("shmApp.directives").directive("voucherDetail",["appConf","WeChatService","UtilsService","$translate","$state",r])}(),function(){"use strict";var e,t,n,a,i,r=function(r,o,c,s,m){return e=r,t=o,n=c,a=s,i=m,{restrict:"AE",scope:{},templateUrl:e.viewRootDir+"directives/item/voucherList.html",link:function(e,i,r){e.voucherType=a.params.voucherType?a.params.voucherType:void 0,e.fetchVoucherList=function(i,r){var o={};switch(o.pageNo=r||1,1===o.pageNo?(e.gettingVouchers=!0,e.gettingVouchersErr=void 0):(e.gettingMoreVouchers=!0,e.gettingMoreVouchersErr=void 0),o.params={page:o.pageNo,"page-size":6},e.currentFilter=i,i){case"ACTIVE":o.params.ACTIVE=1;break;case"REDEEMED":o.params.REDEEMED=1;break;case"EXPIRED":o.params.EXPIRED=1}switch(e.voucherType){case"JIELONG":o.params.JIELONG=1;break;case"DRAWN":o.params.DRAWN=1}t.getMyVouchers(o.params).then(function(t){t.data&&t.data.auth_url?n.loginAndRedirect(a.current):o.pageNo>1?(o.previousData=e.voucherList.data,e.voucherList=t.data,e.voucherList.data=o.previousData.concat(e.voucherList.data)):e.voucherList=t.data},function(t){1===o.page?e.gettingVouchersErr=t.data:e.gettingMoreVouchersErr=t.data}).finally(function(){e.gettingVouchers=void 0,e.gettingMoreVouchers=void 0})},e.fetchVoucherList("ACTIVE",1)}}};angular.module("shmApp.directives").directive("voucherList",["appConf","ItemService","WeChatService","$state","UtilsService",r])}(),function(){"use strict";var e,t=function(t){return e=t,{restrict:"AE",scope:{voucherGroup:"<ngModel"},templateUrl:e.viewRootDir+"directives/voucher/voucherListItem.html"}};angular.module("shmApp.directives").directive("voucherListItem",["appConf",t])}(),function(){"use strict";var e,t,n,a,i,r=function(e,a,r,o,c){i=this,i.$uibModalInstance=e,i.companyId=a,i.callbackSave=o,i.selectedVoucherGroups=r||[],i.editMode=!1,i.expand=!(i.selectedVoucherGroups.length>0),i.cancel=function(){i.$uibModalInstance.close("cancel")},i.getVoucherGroupsUnderCompany=function(e,n){var a={};a.params={},a.params.page=n||1,a.params.available=1,i.keyword&&(a.params["key-word"]=i.keyword),t.getVoucherGroupsUnderCompany(e,a.params).then(function(e){n&&n>1?i.tmpUnSelectedVoucherGroups=i.unSelectedVoucherGroups.concat(e.data.data):(i.tmpUnSelectedVoucherGroups=e.data.data,i.totalPageNo=e.data.last_page),i.currentPageNo=e.data.current_page,i.gettingData=!1,i.unSelectedVoucherGroups=_.filter(i.tmpUnSelectedVoucherGroups,function(e){return!_.findWhere(i.selectedVoucherGroups,{id:e.id})})})},i.addGroup=function(e){i.selectedVoucherGroups.push(e),i.saveSelectedVoucherGroups(i.selectedVoucherGroups)},i.deleteGroup=function(e){i.unSelectedVoucherGroups.push(e),i.selectedVoucherGroups=_.without(i.selectedVoucherGroups,e),i.expand=!0},i.clearSelectedGroups=function(){i.selectedVoucherGroups=[]},i.saveSelectedVoucherGroups=function(e){i.callbackSave(e),weui.toast(n.instant("ITEM.PAGE.DETAILS.JIELONG.SAVE.SUCCESS"),1e3),i.cancel()},i.expandCompanyVoucherList=function(){i.expand=!i.expand},i.getVoucherGroupsUnderCompany(i.companyId)},o=function(t,n,i){a.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/voucherJielongSelector.html",controller:["$uibModalInstance","companyId","selectedVoucherGroups","callbackSave","$state",r],controllerAs:"ctrl",size:void 0,appendTo:void 0,resolve:{companyId:function(){return t},selectedVoucherGroups:function(){return n},callbackSave:function(){return i}}})},c=function(i,r,c,s){return e=i,t=r,n=c,a=s,{restrict:"AE",scope:{companyId:"<?",selectedVoucherGroups:"=?"},link:function(e,t,n){e.callbackSave=function(t){e.selectedVoucherGroups=t},angular.element(t).click(function(){o(e.companyId,e.selectedVoucherGroups,e.callbackSave)})}}};angular.module("shmApp.directives").directive("voucherJielongSelector",["appConf","CompanyService","$translate","$uibModal",c])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s,m,u=function(u,l,p,d,g,f,h,y,v,I){return e=u,t=l,n=p,a=d,i=g,r=f,o=h,c=y,s=v,m=I,{restrict:"AE",scope:!0,require:"^overlayModalCustom",templateUrl:e.viewRootDir+"directives/item/voucherHomeRewardModal.html",link:function(a,c,s,m){a.isPreHomeShare=!1,a.isPreHomeDraw=!1,a.isPostHomeShare=!1,a.targetModelId=s.targetModelId,a.close=m.close,a.showTopCloseBtn=m.showTopCloseBtn,a.hideTopCloseBtn=m.hideTopCloseBtn,a.fetchingVoucher=!1,a.switchMode=function(e){switch(e){case"isPreHomeShare":a.isPreHomeShare=!0,a.isPreHomeDraw=!1,a.isPostHomeShare=!1,a.hideTopCloseBtn();break;case"isPreHomeDraw":a.isPreHomeShare=!1,a.isPreHomeDraw=!0,a.isPostHomeShare=!1,a.showTopCloseBtn();break;case"isPostHomeShare":a.isPreHomeShare=!1,a.isPreHomeDraw=!1,a.isPostHomeShare=!0,a.showTopCloseBtn()}},a.switchMode("isPreHomeShare"),a.loadWeChatShare=function(){var t={};t.title=""+r.instant("COMMUNITY.TITLE"),t.shareTitle=""+r.instant("COMMUNITY.SHARE_TITLE"),i.setWebTitle(t.title),t.desc=""+r.instant("COMMUNITY.DESC"),t.listUrl=n.href(n.current.name,{},{absolute:!0}),t.imgUrl=i.getAppAbsUrlRoot(e.imagesRootDir+"community_logo.png"),o.runWhenWXReady(function(){wx.onMenuShareAppMessage({title:t.shareTitle,desc:t.desc,link:t.listUrl,imgUrl:t.imgUrl,success:function(){a.switchMode("isPreHomeDraw"),a.$apply()}}),wx.onMenuShareTimeline({title:t.shareTitle,link:t.listUrl,imgUrl:t.imgUrl,success:function(){a.switchMode("isPreHomeDraw"),a.$apply()}})})},a.loadWeChatShare(),a.getVoucherFromVoucherGroup=function(){a.fetchingVoucher=!0,t.obtainRandomVoucherUnderCampaign(a.targetModelId).then(function(e){a.fetchingVoucher=!1;var n=e.data.voucher.company_voucher_group;n.card_id&&o.runWhenWXReady(function(){t.assignCard(n.card_id).then(function(e){wx.addCard({cardList:e.data,success:function(e){}})})}),weui.toast(r.instant("COMPANY.VOUCHER.DRAWN.SUCCESS.TOAST"),1e3),!0===i.isFromFacebook()&&weui.gallery(e.data.voucher.img_url),t.saveHomeVoucherDraw({entity_name:"VoucherCampaign",entity_id:a.targetModelId}).then(function(e){t.showTodayDrawLeft().then(function(e){a.leftTimes=e.data.remainLimit,a.switchMode("isPostHomeShare")})})})}}}};angular.module("shmApp.directives").directive("voucherHomeRewardModal",["appConf","CompanyService","$state","$uibModal","UtilsService","$translate","WeChatService","$window","ItemService","UserService",u])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s,m,u=function(u,l,p,d,g,f,h,y,v,I){return e=u,t=l,n=p,a=d,i=g,r=f,o=h,c=y,s=v,m=I,{restrict:"AE",scope:{appUser:"<",item:"<?",fetchType:"<?",callBackClose:"&?"},templateUrl:e.viewRootDir+"directives/item/voucherJielongRewardModal.html",link:function(a,c,u){if(a.getVoucherFromVoucherGroup=function(){a.isSubscribed||!0===i.isFromFacebook()?(a.isDrawing=!0,t.obtainVoucherOwnership(a.voucherGroup.id).then(function(e){a.drawnSuccess=!0,a.isDrawing=!1,a.voucherGroup.card_id&&o.runWhenWXReady(function(){t.assignCard(a.voucherGroup.card_id).then(function(e){wx.addCard({cardList:e.data,success:function(e){}})})}),weui.toast(r.instant("COMPANY.VOUCHER.DRAWN.SUCCESS.TOAST"),1e3),!0===i.isFromFacebook()&&weui.gallery(e.data.img_url),a.updateUserBonusStatus()},function(e){a.isDrawing=!1,a.gettingVoucherErr=e.data})):(a.isDrawing=!1,a.showSubscribeQr=!0)},a.updateUserBonusStatus=function(){var e={};e.params={fetch_type:a.fetchType,item_id:a.item.id},s.updateJielongParticipatorBonusStatus(e.params).then(function(e){},function(e){a.gettingUpdateErr=e.data})},a.storeCurrentState=function(e,t){var i={},r=n.href("mixAuth.companyVoucherReleased",{voucherGroupId:n.params.voucherGroupId},{absolute:!0});i.param={current_state:r,img_url:t,title:e.title,model_name:"CompanyVoucherGroup",model_id:a.voucherGroup.id},m.storeCurrentState(i.param)},a.isSubscribed=a.appUser&&a.appUser.wechat_is_subscriber,a.fetchType&&"TYPE_JIELONG"===a.fetchType){var l=a.item.jielong_success_entities;l[0]&&"App\\Modules\\Platform\\Models\\CompanyVoucherGroup"===l[0].entity_name&&(a.voucherGroup=l[0].entity,a.voucherGroup.itemType="jielong_voucher_group"),l[0]&&"App\\Modules\\Platform\\Models\\VoucherCampaign"===l[0].entity_name&&(a.voucherCampaign=l[0].entity)}if(a.fetchType&&"TYPE_SHARE"===a.fetchType){var p=a.item.wxshare_success_entities;p[0]&&"App\\Modules\\Platform\\Models\\CompanyVoucherGroup"===p[0].entity_name&&(a.voucherGroup=p[0].entity,a.voucherGroup.itemType="jielong_voucher_group"),p[0]&&"App\\Modules\\Platform\\Models\\VoucherCampaign"===p[0].entity_name&&(a.voucherCampaign=p[0].entity)}if(a.fetchType&&"TYPE_JIELONG_SHARE"===a.fetchType){var l=a.item.jielong_wxshare_success_entities;l[0]&&"App\\Modules\\Platform\\Models\\CompanyVoucherGroup"===l[0].entity_name&&(a.voucherGroup=l[0].entity,a.voucherGroup.itemType="jielong_voucher_group"),l[0]&&"App\\Modules\\Platform\\Models\\VoucherCampaign"===l[0].entity_name&&(a.voucherCampaign=l[0].entity)}a.voucherGroup&&(a.itemImg=a.voucherGroup.images&&a.voucherGroup.images[0]?a.voucherGroup.images[0].url:i.getAppAbsUrlRoot(e.imagesRootDir+"default_voucher_logo.png"),a.storeCurrentState(a.voucherGroup,a.itemImg))}}};angular.module("shmApp.directives").directive("voucherJielongRewardModal",["appConf","CompanyService","$state","$uibModal","UtilsService","$translate","WeChatService","$window","ItemService","UserService",u])}(),function(){"use strict";var e,t,n,a,i,r=function(r,o,c,s,m){return e=r,t=o,n=c,a=s,i=m,{restrict:"AE",scope:{},templateUrl:e.viewRootDir+"directives/voucher/publicVoucherList.html",link:function(e,n,a){e.getTagList=function(){t.getTagsList().then(function(t){e.tagList=[{name:"å…¨éƒ¨",selected:!0}],angular.forEach(t.data,function(t){e.tagList.push({name:t,selected:!1})})})},e.getTagList(),e.fetchVoucherList=function(n){var a={};a.pageNo=n||1,a.params={page:a.pageNo,"page-size":6,tag:e.targetTag},e.gettingData=!0,t.getPublicVoucherGroupList(a.params).then(function(t){a.pageNo>1&&(a.previousData=e.voucherList.data),e.voucherList=t.data,a.pageNo>1&&(e.voucherList.data=a.previousData.concat(e.voucherList.data)),e.gettingData=!1})},e.fetchVoucherList(),e.switchTab=function(t){e.voucherList={},angular.forEach(e.tagList,function(n,a){n.selected=t===a,t===a&&(e.targetTag=0!==t?n.name:"")}),e.fetchVoucherList()}}}};angular.module("shmApp.directives").directive("publicVoucherList",["appConf","CompanyService","WeChatService","$state","UtilsService",r])}(),function(){"use strict";var e,t=function(t){return e=t,{restrict:"AE",scope:{companyId:"<"},template:'<voucher-list-item ng-model="voucherGroup" ng-repeat="voucherGroup in voucherList.data"></voucher-list-item><loading-bar ng-if="gettingData === true"/><div class="more-btn-wrapper" ng-if="(voucherList.current_page <  voucherList.last_page)"><button class="btn btn-default"ladda="gettingData === true"data-spinner-color="#777"ng-click="fetchVoucherList(voucherList.current_page * 1 + 1)"><i class="fa fa-arrow-down"></i><span translate="ITEM.PAGE.LIST.SELLER.GET_MORE_BTN"></span></button></div><div class="flat-divider" ng-if="scope.voucherList && scope.voucherList.length > 0"></div>',link:function(t){t.fetchVoucherList=function(n){var a={};a.pageNo=n||1,a.params={page:a.pageNo,"page-size":6,tag:t.targetTag,available:!0},t.gettingData=!0,e.getVoucherGroupsUnderCompany(t.companyId,a.params).then(function(e){a.pageNo>1&&(a.previousData=t.voucherList.data),t.voucherList=e.data,a.pageNo>1&&(t.voucherList.data=a.previousData.concat(t.voucherList.data)),t.gettingData=!1})},t.fetchVoucherList()}}};angular.module("shmApp.directives").directive("companyVoucherList",["CompanyService",t])}(),function(){"use strict";var e=function(){return{restrict:"AE",scope:{myAddress:"=address"},template:"{{myAddress.suburb | uppercase | translate }}, {{myAddress.state | uppercase | translate }} {{myAddress.country | uppercase | translate }} {{myAddress.postcode}}"}};angular.module("shmApp.directives").directive("addressStringify",e)}(),function(){"use strict";var e=function(e){return{restrict:"AE",scope:{},template:'<a ui-sref="home" class="back-to-home-btn"><i class="fa fa-home" aria-hidden="true"></i><span translate="HOME_PAGE"></span></a>',link:function(t,n,a){t.appConf=e}}};angular.module("shmApp.directives").directive("backToHomeBtn",["appConf",e])}(),function(){"use strict";var e=function(e,t,n){return{restrict:"AE",scope:{companyid:"<",companytitle:"<"},templateUrl:e.viewRootDir+"directives/item/toCompanyBtn.html",link:function(a,i,r){t.getCompanyDetails(a.companyid).then(function(e){a.companytitle=e.data.name,a.companySafeTitle=n.getUrlSafeString(a.companytitle)}),a.appConf=e}}};angular.module("shmApp.directives").directive("toCompanyBtn",["appConf","CompanyService","UtilsService",e])}(),function(){"use strict";var e,t,n=function(n,a){return e=n,t=a,{restrict:"AE",scope:{asset:"=ngModel"},transclude:!0,templateUrl:e.viewRootDir+"directives/fileUpload/classicImgUpload.html",link:function(e,n,a){e.upload=function(n){e.asset={},n&&(e.isUploading=!0,t.upload({url:"/api/asset",file:n}).then(function(t){e.asset=t.data},function(t){e.uploadingErr=t.data},function(t){e.uploadingProgress=parseInt(100*t.loaded/t.total)}).finally(function(){e.isUploading=!1}))}}}};angular.module("shmApp.directives").directive("classicImgUpload",["appConf","Upload",n])}(),function(){"use strict";var e=function(){return{restrict:"AE",template:"<div class='text-center' ui-sref='cms.termsOfUse'><h5 ><span ng-bind-html=\"('ITEM.PAGE.DETAILS.COMMENTS.POLICY' | translate)\"></span><a class='pull-right'><i class='fa fa-chevron-right' aria-hidden='true'></i></a></h5></div>"}}
;angular.module("shmApp.directives").directive("commentsPolicy",e)}(),function(){"use strict";var e,t=function(t){return e=t,{restrict:"AE",scope:{media:"<ngModel",fullScreenWhenPlay:"<?",poster:"<?"},template:'<video ng-if="fullScreenWhenPlay !== true" id="{{media.id}}" class="video-js" poster="{{defaultPoster}}" ng-src="{{media.url}}" controls></video><video ng-if="fullScreenWhenPlay === true" id="{{media.id}}" class="video-js" poster="{{defaultPoster}}" ng-src="{{media.url}}"></video><video-play-pause-btn class="video-play-btn" target-id="media.id" full-screen-when-play="fullScreenWhenPlay"></video-play-pause-btn>',link:function(t,n,a){t.defaultPoster=t.poster&&""!==t.poster?t.poster:e.imagesRootDir+"logo.png",t.fullScreenWhenPlay=t.fullScreenWhenPlay||!1}}};angular.module("shmApp.directives").directive("customVideoPlayer",["appConf",t])}(),function(){"use strict";var e,t,n,a,i,r=function(r,o,c,s,m){return e=r,t=o,n=c,a=s,i=m,{restrict:"AE",templateUrl:e.viewRootDir+"directives/item/favList.html",scope:{appUser:"<"},controller:["$scope",function(e){e.getItems=function(t){var r={};r.page=t||1,1===r.page?(e.gettingItems=!0,e.gettingItemsErr=void 0):(e.gettingMoreItems=!0,e.gettingMoreItemsErr=void 0),n.getFavItems({page:r.page}).then(function(t){t.data&&t.data.auth_url?a.loginAndRedirect(i.current):(r.page>1&&(r.previousData=e.itemList.data),e.itemList=t.data,r.page>1&&(e.itemList.data=r.previousData.concat(e.itemList.data)))},function(t){1===r.page?e.gettingItemsErr=t.data:e.gettingMoreItemsErr=t.data}).finally(function(){e.gettingItems=void 0,e.gettingMoreItems=void 0})},e.getItems()}]}};angular.module("shmApp.directives").directive("favItemListPanel",["appConf","$translate","ItemService","WeChatService","$state",r])}(),function(){"use strict";var e,t,n,a,i,r=function(e){var t={};t.imgs=[e],WeixinJSBridge.invoke("imagePreview",{current:t.imgs[0],urls:t.imgs})},o=function(n,o,c){a=this,a.$uibModalInstance=n,a.viewRootDir=e.viewRootDir,a.item=o,a.url=c.href("mixAuth.itemDetails",{itemId:o.id},{absolute:!0}),a.cancel=function(){a.$uibModalInstance.dismiss("cancel")},a.genPoster=function(e){a.generatingPoster=!0,a.generatingPosterErr=void 0,t.generateItemPoster(a.item.id,a.url,e).then(function(e){i.openInDesktop()?window.open(e.data.url)?a.cancel():a.browserBlocked=!0:(r(e.data.url),a.cancel())},function(e){a.generatingPosterErr=e.data}).finally(function(){a.generatingPoster=!1})}},c=function(t){n.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:e.viewRootDir+"directives/item/gen-poster.html",controller:["$uibModalInstance","item","$state",o],controllerAs:"mdCtrl",size:void 0,appendTo:void 0,resolve:{item:function(){return t}}})},s=function(a,r,o,s){return e=a,t=r,n=o,i=s,{restrict:"A",scope:{item:"<",seller:"<"},link:function(e,t,n){t.on("click",function(){c(e.item)})}}};angular.module("shmApp.directives").directive("genItemPoster",["appConf","ItemService","$uibModal","WeChatService",s])}(),function(){"use strict";var e,t=function(t){return e=t,{restrict:"E",scope:{location:"="},template:"<h3>{{alertMsg}}</h3>",link:function(e,t,n){t.ready(function(){var t={};navigator.geolocation?navigator.geolocation.getCurrentPosition(function(n){alert("position"),alert(JSON.stringify(n,null,4)),t.latlng={lat:parseFloat(n.coords.latitude),lng:parseFloat(n.coords.longitude)},t.geocoder=new google.maps.Geocoder,t.geocoder.geocode({location:t.latlng},function(t,n){alert(JSON.stringify(t,null,4)),e.location=t[0]})},function(e){switch(e.code){case e.PERMISSION_DENIED:case e.POSITION_UNAVAILABLE:case e.TIMEOUT:case e.UNKNOWN_ERROR:}}):e.alertMsg="ELSE Geolocation is not supported by this browser."})}}};angular.module("shmApp.directives").directive("getGeolocation",["$http",t])}(),function(){"use strict";var e,t=function(t){return e=t,{restrict:"A",scope:{addressString:"=ngModel",addressObj:"="},link:function(t,n,a){var i={};e.then(function(){i.input=document.getElementById("googlePlacesAutoCompleteTextField"),i.searchBox=new google.maps.places.SearchBox(i.input),i.searchBox.addListener("places_changed",function(){i.places=i.searchBox.getPlaces(),t.addressObj=i.places[0],t.addressString=t.addressObj.formatted_address,t.$apply()})},function(){})}}};angular.module("shmApp.directives").directive("googlePlacesAutoComplete",["loadGoogleMapLib",t])}(),function(){"use strict";var e,t,n=function(n,a){return e=n,t=a,{restrict:"AE",scope:{data:"<ngModel",callback:"&?"},templateUrl:e.viewRootDir+"directives/item/guessYourLike.html",link:function(e,n,a){if(e.getItems=function(n){e.gettingItems=!0,e.gettingItemsErr=void 0,t.guessCurrentUserLike({"order-by":{"items.date_start":"desc"},"page-size":6,page:n||1}).then(function(t){e.itemList=t.data,e.callback&&"function"==typeof e.callback&&e.callback()({guessYouLikeSections:e.itemList})},function(t){e.gettingItemsErr=t.data}).finally(function(){e.gettingItems=!1})},e.data&&e.data.data)return void(e.itemList=e.data);e.getItems()}}};angular.module("shmApp.directives").directive("guessYouLikeSection",["appConf","ItemService",n])}(),function(){"use strict";var e,t,n=function(n,a){return e=n,t=a,{restrict:"AE",scope:{itemId:"<"},templateUrl:e.viewRootDir+"directives/item/guessYourLikeByTags.html",link:function(e,n,a){e.getItems=function(n){var a={};a.pageNo=n||1,a.pageNo>1?(e.gettingMoreItems=!0,e.gettingMoreItemsErr=void 0):(e.gettingItems=!0,e.gettingItemsErr=void 0),t.guessUserLikeByTags(e.itemId,{"page-size":6,page:n||1}).then(function(t){1!==a.pageNo?(a.previousData=e.itemList.data,e.itemList=t.data,e.itemList.data=a.previousData.concat(e.itemList.data)):e.itemList=t.data,e.itemList.hasMore=e.itemList.to<e.itemList.total},function(t){1===a.pageNo?e.gettingItemsErr=t.data:e.gettingMoreItemsErr=t.data}).finally(function(){e.gettingItems=!1,e.gettingMoreItems=!1})},e.getItems()}}};angular.module("shmApp.directives").directive("guessYouLikeByTags",["appConf","ItemService",n])}(),function(){"use strict";var e,t,n=function(n,a){return e=n,t=a,{restrict:"A",scope:{},transclude:!0,template:'<ng-transclude ng-if="isInView === true"></ng-transclude>',link:function(e,n,a){e.onResize=function(t){e.$broadcast("lazyLoad::scroll")},e.cleanUp=function(){angular.element(t).off("resize",e.onResize)},e.checkInView=function(e){var n={};return n.window=angular.element(t),n.viewport={top:n.window.scrollTop(),left:n.window.scrollLeft()},n.viewport.right=n.viewport.left+n.window.width(),n.viewport.bottom=n.viewport.top+n.window.height(),n.element=angular.element(e),n.bounds=angular.element(e).offset(),n.bounds.right=n.bounds.left+n.element.outerWidth(),n.bounds.bottom=n.bounds.top+n.element.outerHeight(),!(n.viewport.right<n.bounds.left||n.viewport.left>n.bounds.right||n.viewport.bottom<n.bounds.top||n.viewport.top>n.bounds.bottom)},e.render=function(){!0!==e.isInView&&(e.isInView=e.checkInView(n))},angular.element(t).on("scroll",function(){e.render()}),angular.element(t).on("resize",e.onResize),e.$on("$destroy",e.cleanUp)}}};angular.module("shmApp.directives").directive("lazyLoad",["appConf","$window",n])}(),function(){"use strict";var e=function(){return{restrict:"AE",scope:{},template:'<div class="text-center loading-bar-color"><i class="fa fa-cog fa-spin fa-3x fa-fw" style="height: 80px; width: 80px;"></i></div>'}};angular.module("shmApp.directives").directive("loadingBar",e)}(),function(){"use strict";var e=function(e){return{restrict:"AE",scope:{seller:"<",appUser:"<"},templateUrl:e.viewRootDir+"directives/pageBottom/pageBottom.html",link:function(t,n,a){t.appConf=e}}};angular.module("shmApp.directives").directive("pageBottom",["appConf",e])}(),function(){"use strict";var e,t,n,a=function(e){n.go("mixAuth.communityItemSearch",{keyWord:e},{reload:!0})},i=function(e){return e.gettingTags=!0,e.gettingTagsErr=void 0,t.getPopularTags({page:1,"page-size":10}).then(function(t){e.tagList=t.data},function(t){e.gettingTagsErr=t.data}).finally(function(){e.gettingTags=!1}),e},r=function(r,o,c){return e=r,t=o,n=c,{restrict:"AE",scope:{},templateUrl:e.viewRootDir+"directives/tag/popular.html",link:function(e,t,n){e.goTo=a,i(e)}}};angular.module("shmApp.directives").directive("popularTags",["appConf","TagService","$state",r])}(),function(){"use strict";var e,t,n,a=function(a,i,r){return e=a,n=i,t=r,{restrict:"A",scope:{currentPageUrl:"<"},template:"",link:function(e,t,a){t.hide(),n.loadWeChatJsConf(e.currentPageUrl,{loaded:function(e){n.openedInWeChat()&&t.show(),t.on("click",function(){wx.scanQRCode({needResult:0,scanType:["qrCode","barCode"],success:function(e){}})})}})}}};angular.module("shmApp.directives").directive("qrCodeScanBtn",["appConf","WeChatService","$translate",a])}(),function(){"use strict";var e,t=function(t){return e=t,{restrict:"AE",scope:{errorObj:"=errorObj",msgOnly:"=?msgOnly",hideCloseBtn:"=?"},templateUrl:e.viewRootDir+"directives/showErrorFromJson/showErrorFromJson.html"}};angular.module("shmApp.directives").directive("showErrorFromJson",["appConf",t])}(),function(){var e=function(){return{restrict:"AE",scope:{succObj:"=succObj",hideCloseBtn:"=?"},template:"<div class='alert alert-success text-left' ng-if='succObj'><a href='#' class='close' data-dismiss='alert' aria-label='close' ng-hide='hideCloseBtn===true'>&times;</a>{{ succObj }}</div>"}};angular.module("shmApp.directives").directive("showSuccessFromJson",e)}(),function(){"use strict";var e,t,n,a=function(e){t=this,e.openInDesktop()||e.openInWindowsWechat()?t.tinymceOptions={plugins:["link","fullscreen","textcolor","paste"],menubar:!1,convert_urls:0,toolbar:"undo redo | sizeselect | bold italic | removeformat | fontselect |  fontsizeselect | forecolor backcolor | alignleft aligncenter alignright | link | fullscreen",theme:"modern",branding:!1,content_style:'body.mce-content-body p {font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; line-height: 1.5em; } body.mce-content-body img{width:100%}',setup:function(e){e.on("change",function(){n.change()})}}:t.tinymceOptions={toolbar:"fullscreen link bold italic styleselect removeformat forecolor",statusbar:!1,menubar:!1,branding:!1,plugins:["link","fullscreen","textcolor","paste"],convert_urls:0,theme:"modern",content_style:'body.mce-content-body p {font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; line-height: 1.5em; } body.mce-content-body img{width:100%}',setup:function(e){e.on("change",function(){n.change()})}}},i=function(e,a,i){n=e,e.model&&""!==e.model.trim()||(t.isEditingDesc=!0)},r=function(t){return e=t,{restrict:"AE",templateUrl:e.viewRootDir+"directives/textEditor/textareaEditor.html",scope:{model:"=ngModel",change:"&ngChange"},controller:["WeChatService",a],controllerAs:"ctrl",link:i}};angular.module("shmApp.directives").directive("textareaEditor",["appConf",r])}(),function(){"use strict";var e,t,n,a,i,r,o=function(o,c,s,m,u){return t=o,a=c,n=s,i=m,r=u,{restrict:"AE",scope:{content:"=",consultationDetailedPage:"<?",item:"<",isShowAll:"<?",appUser:"<"},template:'<img src="/app/images/item_expired.png" ng-if="consultationDetailedPage && item.is_expired === true" class="img-responsive consultation-img-style"/><p ng-if="trustContent" ng-class="{\'limit-height\': loadAll === false,\'consultation-special\':consultationDetailedPage == true,\'item-desc\':consultationDetailedPage == false}" bind-html-compile="trustContent"></p><div ng-show="loadAll === false" class="fadeout"></div><a ng-show="loadAll === false" class="btn btn-primary show-more-link" ng-click="loadAll = true"><b>{{ \'LOAD_MORE\' | translate }}</b><br/><i class="fa fa-arrow-down" aria-hidden="true"></i></a>',link:function(a,o,c){e=a,e.loadAll=!0,e.show=function(e){if(!0===i.openedInWeChat()){var t={};t.imgs=[e],WeixinJSBridge.invoke("imagePreview",{current:t.imgs[0],urls:t.imgs})}else r.open(e)},e.$watch("content",function(i){i?(i=i.replace(/<img([^>]*)\ssrc=['"]([^"\s]+)['"]([^>]*)>/g,"<img width=\"100%\" lazy-img='$2' ng-click=\"show('$2')\"/>"),a.trustContent="<div lazy-img-container>"+i+"</div>",t(function(){n.returnConsultation();if(!1===e.consultationDetailedPage){$(".item-desc").height()/14>12&&!0!==e.isShowAll?e.loadAll=!1:e.loadAll=!0}},500)):(e.trustContent=i,e.loadAll=!0)})}}};angular.module("shmApp.directives").directive("textHtmlEllipsis",["$timeout","$sce","ItemService","WeChatService","$window",o])}(),function(){"use strict";var e=function(){return{restrict:"AE",scope:{text:"<",withExpendBtn:"<?"},template:'<div ng-class="{\'truncate-with-expend-btn\': (withExpendBtn === true), \'show-truncated-text\':(showTruncatedText === true)}"><div class="truncate" ng-click="toggleText()">{{ text }}</div><a class="expend-btn" ng-click="toggleText()" ng-if="withExpendBtn === true"><i ng-if="text" class="fa ng-class:{\'fa-caret-down\': (showTruncatedText !== true), \'fa-caret-up\': (showTruncatedText === true)}"></i></a></div>',link:function(e,t,n){e.withExpendBtn=!!angular.isDefined(e.withExpendBtn)&&e.withExpendBtn,e.toggleText=function(){!0===e.withExpendBtn&&(e.showTruncatedText=void 0===e.showTruncatedText||!e.showTruncatedText)}}}};angular.module("shmApp.directives").directive("textTruncateDisplay",e)}(),function(){"use strict";var e,t,n,a,i,r,o,c,s,m={width:1200,height:8e3,quality:.8},u=function(u,l,p,d,g,f,h,y,v){return e=u,t=l,n=p,a=d,i=g,r=f,o=h,c=y,s=v,{restrict:"AE",scope:{chosenUploadFiles:"=ngModel",pageUrl:"=",change:"&ngChange",isHideEditTitle:"=?",isHideVideo:"=?",maxImgQuantity:"=?",isHideImg:"=?",ifCreateConsultationItem:"<?",eachCallback:"&?",forItemSave:"<?",isStable:"<?"},templateUrl:e.viewRootDir+"directives/item/uploadImg.html",controller:function(){this.sortableOptions={handle:".myHandle"}},controllerAs:"ctrl",link:function(e,n,r){e.validateExistVideo=function(t){var n={};n.foundVideoIndex=_.findIndex(t,function(e){if(e.mime_type)return!0===e.mime_type.toLowerCase().startsWith("video")}),e.isContainVideo=n.foundVideoIndex>=0},e.consultation=s.returnConsultation(),e.uploadedFiles={},e.openInWechat=a.openedInWeChat(),e.openInWindowsWechat=a.openInWindowsWechat(),e.wechatJsLoading=!0,e.uploadingImg=!1,e.isUploadingVideo=!1,e.isContainVideo=!1,e.isShowVideo=!0!==e.isHideVideo,e.isShowImg=!0!==e.isHideImg,e.isStable=!0===e.isStable,e.overMaxImgs=!1,e.checkMaxImgs=function(t){void 0===e.chosenUploadFiles?e.chosenUploadFiles=[]:e.maxImgQuantity&&e.chosenUploadFiles.length>=e.maxImgQuantity&&e.chosenUploadFiles.length>0?e.overMaxImgs=!0:e.overMaxImgs=!1},e.$watch("chosenUploadFiles",function(t){e.validateExistVideo(t),e.checkMaxImgs(t)}),a.runWhenWXReady(function(){e.wechatJsLoading=!1,e.uploadingImg=!1,e.isUploadingVideo=!1}),e.upload=function(t,n){e.uploadingMediaErr=void 0,t&&t.length>0&&e.uploadFromWeb(t,n)},e.uploadFromWeb=function(n,a){angular.forEach(n,function(n){var r={};if(!0===a?e.isUploadingVideo=!0:e.uploadingImg=!0,n.size/1e6>30)return void(e.uploadingMediaErr={message:c.instant("ITEM.PAGE.CREATE.VIDEO.OVER_SIZE",{size:"30MB"}),errors:{}});var o={uploading:!0};o.file=n,e.chosenUploadFiles.push(o),t.resize(n,m).then(function(t){i.uploadAsset(t).then(function(t){var n=t.data;e.eachCallback&&"function"==typeof e.eachCallback&&counter>1?e.eachCallback()(n):(o.uploading=!1,o=_.extend(o,n)),e.maxImgQuantity&&e.chosenUploadFiles.length>=e.maxImgQuantity&&(e.overMaxImgs=!0),e.validateExistVideo(e.chosenUploadFiles),e.change()},function(e){},function(t){!0===a&&(e.uploadingVideoProgress=parseInt(100*t.loaded/t.total))}).finally(function(){e.uploadingImg=!1,e.uploadedFiles[r.key].uploading=!1,!0===a&&(e.isUploadingVideo=!1,e.uploadingVideoProgress=void 0)})})})},e.remove=function(t){if(!0===confirm(c.instant("ITEM.PAGE.CREATE.IMAGE.CONFIRM_DELETE"))){for(var n=0;n<e.chosenUploadFiles.length;n++)e.chosenUploadFiles[n]===t&&e.chosenUploadFiles.splice(n,1);e.maxImgQuantity&&e.chosenUploadFiles.length>=e.maxImgQuantity?e.overMaxImgs=!0:e.overMaxImgs=!1,e.validateExistVideo(e.chosenUploadFiles)}},e.syncUpload=function(t,n){var a=t.shift(),r={uploading:!0};r.file=a,e.chosenUploadFiles.push(r),wx.uploadImage({localId:a,isShowProgressTips:1,success:function(c){c.serverId;e.uploadingMeida=!0,e.uploadingMediaErr=void 0,wx.getLocalImgData({localId:a,success:function(t){var a=t.localData;a=window.__wxjs_is_wkwebview?a.replace("jgp","jpeg"):"data:image/jpeg;base64,"+a,i.uploadBase64Asset({file:a,file_name:"wx_upload_img"}).then(function(t){var a=t.data;e.eachCallback&&"function"==typeof e.eachCallback&&!1===n?e.eachCallback()(a):(r.uploading=!1,r=_.extend(r,a)),e.maxImgQuantity&&e.chosenUploadFiles.length>=e.maxImgQuantity&&(e.overMaxImgs=!0)},function(t){e.uploadingMediaErr=t.data}).finally(function(){e.uploadingMeida=!1})}}),t.length>0&&o(function(){e.syncUpload(t,!1)},1e3)}})},e.wxChooseImg=function(){a.runWhenWXReady(function(){e.maxImgQuantity?wx.chooseImage({count:e.maxImgQuantity<9?e.maxImgQuantity:9,sizeType:["compressed"],sourceType:["album","camera"],success:function(t){e.localIds=t.localIds,e.syncUpload(e.localIds,!0)}}):wx.chooseImage({count:9,sizeType:["compressed"],sourceType:["album","camera"],success:function(t){e.localIds=t.localIds,e.syncUpload(e.localIds,!0)}})})},e.showItemImgs=function(t){var n={};n.index=0,n.imgs=[];var i=0;angular.forEach(e.chosenUploadFiles,function(e){n.imgs.push(e.url),e.url===t&&(n.index=i),i++}),a.runWhenWXReady(function(){wx.previewImage({current:n.imgs[n.index],urls:n.imgs})})},e.playVideo=function(e){var t={};t.targetVideo=document.getElementById(e),t.targetVideo.paused?t.targetVideo.play():t.targetVideo.pause()}}}};angular.module("shmApp.directives").directive("uploadImg",["appConf","Upload","md5","WeChatService","AssetService","$http","$timeout","$translate","ItemService",u])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s,m,u={width:1200,height:8e3,quality:.8},l=function(l,p,d,g,f,h,y,v,I,C){return e=l,t=p,n=d,a=g,i=f,r=h,o=y,c=v,s=I,m=C,{restrict:"AE",scope:{chosenUploadFiles:"=ngModel",isHideVideo:"=?",maxImgQuantity:"=?",isHideImg:"=?",eachCallback:"&?",videoCallback:"&?",index:"<?"},templateUrl:e.viewRootDir+"directives/item/uploadImgForEditor.html",link:function(e,r,s){var l=0;e.validateExistVideo=function(t){var n={};n.foundVideoIndex=_.findIndex(t,function(e){if(e.mime_type)return!0===e.mime_type.toLowerCase().startsWith("video")}),e.isContainVideo=n.foundVideoIndex>=0},e.uploadedFiles={},e.openInWechat=a.openedInWeChat(),e.openInWindowsWechat=a.openInWindowsWechat(),e.wechatJsLoading=!0,e.uploadingImg=!1,e.isUploadingVideo=!1,e.isContainVideo=!1,e.isShowVideo=!0!==e.isHideVideo,e.isShowImg=!0!==e.isHideImg,e.overMaxImgs=!1,e.checkMaxImgs=function(t){void 0===e.chosenUploadFiles?e.chosenUploadFiles=[]:e.maxImgQuantity&&e.chosenUploadFiles.length>=e.maxImgQuantity&&(e.overMaxImgs=!0)},e.$watch("chosenUploadFiles",function(t){e.validateExistVideo(t),e.checkMaxImgs(t)}),a.runWhenWXReady(function(){e.wechatJsLoading=!1,e.uploadingImg=!1,e.isUploadingVideo=!1}),e.upload=function(a,r){if(e.uploadingMediaErr=void 0,a){var o=0,s=[],l=[];angular.forEach(a,function(a){var i={};if(!0===r?e.isUploadingVideo=!0:e.uploadingImg=!0,a.size/1e6>20)return void(e.uploadingMediaErr={message:c.instant("ITEM.PAGE.CREATE.VIDEO.OVER_SIZE",{size:"20MB"}),errors:{}});i.key=n.createHash(a.name+(new Date).toUTCString()),e.uploadedFiles[i.key]={file:a,uploadingProgress:0,uploading:!0},s.push(t.resize(a,u))}),m.all(s).then(function(t){angular.forEach(t,function(e){l.push(i.uploadAsset(e))}),m.all(l).then(function(t){e.uploadingImg=!1,e.isUploadingVideo=!1,angular.forEach(t,function(t){var n=t.data;e.eachCallback&&"function"==typeof e.eachCallback&&e.eachCallback()(n,e.index,o),o++,e.maxImgQuantity&&e.chosenUploadFiles.length>=e.maxImgQuantity&&(e.overMaxImgs=!0),e.validateExistVideo(e.chosenUploadFiles),e.videoCallback&&"function"==typeof e.videoCallback&&e.videoCallback()(n,e.index)})})})}},e.syncUpload=function(t,n){var a=t.shift();wx.uploadImage({localId:a,isShowProgressTips:1,success:function(n){var a=n.serverId;e.uploadingMeida=!0,e.uploadingMediaErr=void 0,i.uploadThoughWechat({mediaId:a}).then(function(t){var n=t.data;e.eachCallback&&"function"==typeof e.eachCallback&&e.eachCallback()(n,e.index,l),l++,e.videoCallback&&"function"==typeof e.videoCallback&&e.videoCallback()(n,e.index),e.maxImgQuantity&&e.chosenUploadFiles.length>=e.maxImgQuantity&&(e.overMaxImgs=!0)},function(t){e.uploadingMediaErr=t.data}).finally(function(){e.uploadingMeida=!1}),t.length>0&&o(function(){e.syncUpload(t,!1)},1e3)}})},e.wxChooseImg=function(){a.runWhenWXReady(function(){e.maxImgQuantity?wx.chooseImage({count:e.maxImgQuantity<9?e.maxImgQuantity:9,sizeType:["compressed"],sourceType:["album","camera"],success:function(t){e.localIds=t.localIds,e.syncUpload(e.localIds,!0)}}):wx.chooseImage({count:9,sizeType:["compressed"],sourceType:["album","camera"],success:function(t){e.localIds=t.localIds,e.syncUpload(e.localIds,!0)}})})}}}};angular.module("shmApp.directives").directive("uploadImgForEditor",["appConf","Upload","md5","WeChatService","AssetService","$http","$timeout","$translate","ItemService","$q",l])}(),function(){"use strict";var e=function(){return{restrict:"AE",scope:{targetId:"<",fullScreenWhenPlay:"<?"},template:'<div class="video-play-pause-btn" ng-click="playVideo(targetId)"><i ng-if="isPaused === true" class="fa fa-play-circle fa-3x"></i><i ng-if="isPaused === false && fullScreenWhenPlay === true" class="fa fa-pause-circle fa-3x"></i></div>',link:function(e,t,n){e.isPaused=!0,e.fullScreenWhenPlay=e.fullScreenWhenPlay||!1,e.playVideo=function(t){var n=document.getElementById(t);n.paused?(n.play(),e.isPaused=!1):(n.pause(),e.isPaused=!0)}}}};angular.module("shmApp.directives").directive("videoPlayPauseBtn",e)}(),function(){"use strict";var e,t,n,a,i,r,o,c,s,m,u=function(e){var t={};t.index=0,t.imgs=[];var n=0;angular.forEach(c.chosenUploadFiles,function(a){t.imgs.push(a.asset.url),a.asset.url===e&&(t.index=n),n++}),a.runWhenWXReady(function(){wx.previewImage({current:t.imgs[t.index],urls:t.imgs})})},l=function(l,p,d,g,f,h,y,v,I){return e=l,t=p,n=d,a=g,i=f,r=h,o=y,s=v,m=I,{restrict:"AE",scope:{chosenUploadFiles:"=ngModel",companyId:"=",succCallbackFunc:"&?"},templateUrl:e.viewRootDir+"directives/banner/bannerImg.html",link:function(e,t,r){c=e,e.uploadedFiles={},e.openInWechat=a.openedInWeChat(),e.openInWindowsWechat=a.openInWindowsWechat(),e.wechatJsLoading=!0,e.uploadingImg=!0,e.overMaxImgs=!1,void 0===e.chosenUploadFiles?e.chosenUploadFiles=[]:e.maxImgQuantity&&e.chosenUploadFiles.length>=e.maxImgQuantity&&(e.overMaxImgs=!0),e.getBanners=function(){e.gettingbanners=!0,e.gettingbannersErr=void 0,e.companyId?o.getCompanyBanners(e.companyId).then(function(t){e.chosenUploadFiles=t.data},function(t){e.gettingbannersErr=t.data}).finally(function(){e.gettingbanners=!1}):o.getBanners().then(function(t){e.chosenUploadFiles=t.data},function(t){e.gettingbannersErr=t.data}).finally(function(){e.gettingbanners=!1})},e.getBanners(),a.runWhenWXReady(function(){e.wechatJsLoading=!1,e.uploadingImg=!1}),e.save=function(t){e.companyId?o.createCompanyBanner(e.companyId,e.chosenUploadFiles).then(function(t){m.go("mixAuth.companyItemSearch",{companyId:e.companyId},{reload:!0,inherit:!1}),"function"==typeof c.succCallbackFunc()&&c.succCallbackFunc()()},function(t){e.savingBannerErr=t.data}).finally(function(){}):o.createBanner(e.chosenUploadFiles).then(function(e){m.go("mixAuth.community")},function(t){e.savingBannerErr=t.data}).finally(function(){})},e.upload=function(t){e.uploadingMediaErr=void 0,t&&angular.forEach(t,function(t){var a={};if(t.size/1e6>20)return void(e.uploadingMediaErr={message:s.instant("banner.PAGE.CREATE.VIDEO.OVER_SIZE",{size:"20MB"}),errors:{}});a.key=n.createHash(t.name+(new Date).toUTCString()),e.uploadedFiles[a.key]={file:t,uploadingProgress:0,uploading:!0},i.uploadAsset(t).then(function(n){var a=n.data;a.file=t,e.chosenUploadFiles.push({asset:a,link_to:""}),e.maxImgQuantity&&e.chosenUploadFiles.length>=e.maxImgQuantity&&(e.overMaxImgs=!0)},function(e){},function(e){}).finally(function(){e.uploadedFiles[a.key].uploading=!1})})},e.remove=function(t){for(var n=0;n<e.chosenUploadFiles.length;n++)e.chosenUploadFiles[n]===t&&e.chosenUploadFiles.splice(n,1);e.maxImgQuantity&&e.chosenUploadFiles.length>=e.maxImgQuantity?e.overMaxImgs=!0:e.overMaxImgs=!1},e.syncUpload=function(t){var n=t.shift();wx.uploadImage({localId:n,isShowProgressTips:1,success:function(n){var a=n.serverId;e.uploadingMeida=!0,e.uploadingMediaErr=void 0,i.uploadThoughWechat({mediaId:a}).then(function(t){var n=t.data;e.chosenUploadFiles.push({asset:n,link_to:""}),e.maxImgQuantity&&e.chosenUploadFiles.length>=e.maxImgQuantity&&(e.overMaxImgs=!0)},function(t){e.uploadingMediaErr=t.data}).finally(function(){e.uploadingMeida=!1}),t.length>0&&e.syncUpload(t)}})},e.wxChooseImg=function(){a.runWhenWXReady(function(){e.maxImgQuantity?wx.chooseImage({count:e.maxImgQuantity<9?e.maxImgQuantity:9,sizeType:["compressed"],sourceType:["album","camera"],success:function(t){e.localIds=t.localIds,e.syncUpload(e.localIds)}}):wx.chooseImage({count:9,sizeType:["compressed"],sourceType:["album","camera"],success:function(t){e.localIds=t.localIds,e.syncUpload(e.localIds)}})})},e.moveDown=function(t){for(var n=0;n<e.chosenUploadFiles.length;n++)e.chosenUploadFiles[n]===t&&(e.chosenUploadFiles.splice(n,1),n+=1,c.chosenUploadFiles.splice(n,0,t))},e.moveUp=function(t){for(var n=0;n<e.chosenUploadFiles.length;n++)e.chosenUploadFiles[n]===t&&(e.chosenUploadFiles.splice(n,1),c.chosenUploadFiles.splice(n-1,0,t))},e.showbannerImgs=u}}};angular.module("shmApp.directives").directive("uploadBannerImg",["appConf","Upload","md5","WeChatService","AssetService","$http","BannerService","$translate","$state",l])}(),function(){"use strict";var e,t,n,a,i=function(i,r,o,c){return e=i,t=r,n=c,a=o,{restrict:"AE",scope:{appUser:"<",companyId:"<?",targerUser:"<?"},templateUrl:e.viewRootDir+"directives/item/blackList.html",link:function(e,i,r){e.searchBlackList=function(n,a){var i={};i.pageNo=n||1,1===i.pageNo?e.gettingBlackList=!0:e.gettingMoreBlackList=!0,e.gettingBlackListErr=void 0,t.searchBlackList({page:i.pageNo,keyword:a,companyId:e.companyId,user:e.targerUser}).then(function(t){1!==i.pageNo?(i.previousData=e.BlackList.data,e.BlackList=t.data,e.BlackList.data=i.previousData.concat(e.BlackList.data)):e.BlackList=t.data,e.BlackList.hasMore=e.BlackList.to<e.BlackList.total},function(t){e.gettingBlackListErr=t.data,1===i.pageNo?e.gettingBlackListErr=t.data:e.gettingMoreBlackListErr=t.data}).finally(function(){e.gettingBlackList=!1,e.gettingMoreBlackList=!1})},e.adminCompanyList=function(){e.userCompany=e.appUser.userCompany,angular.forEach(e.userCompany,function(t){_.contains(e.appUser.adminOfCompanyIds,t.id)?t.isAdmin=!0:t.isAdmin=!1}),console.log(e.userCompany)},e.getAllCompanies=function(){a.getAllCompanies().then(function(t){e.allCompaniesMap=t.data},function(t){e.gettingAllCompaniesErr=t.data}).finally(function(){})},e.companyChange=function(e){n.go("mixAuth.blackList",{companyId:e},{reload:!0})},e.currentPage=1,e.keyword="",e.searchBlackList(),e.adminCompanyList(),e.appUser.is_admin&&e.getAllCompanies()}}};angular.module("shmApp.directives").directive("blackList",["appConf","ItemService","CompanyService","$state",i])}(),function(){"use strict";var e=function(){return{restrict:"AE",scope:{data:"=ngModel",title:"<"},template:'<span>{{title}}</span><div class="form-group"><tags-input class="tags-input" ng-model="data" enable-editing-last-tag="true" allow-leftover-text="true" use-strings="true" enable-editing-last-tag="false" add-on-space="true" min-length="1"></tags-input></div>'}};angular.module("shmApp.directives").directive("inputTags",e)}();!function(){"use strict";var e=function(){return{restrict:"AE",scope:{data:"=ngModel",title:"<",inputId:"<"},template:'<div class="input-group"><label for="{{inputId}}">{{title}}:</label><input type="text" class="form-control" id="{{inputId}}" ng-model="data"/></div>'}};angular.module("shmApp.directives").directive("inputText",e)}(),function(){"use strict";var e=function(){return{restrict:"AE",scope:{data:"=ngModel",title:"<",inputId:"<"},template:'<div class="numInput"><div class="input-group pull-right"><div class="input-group-btn"><button type="button" class="btn btn-default btn-sm"ng-if="data >= 1" ng-click="minus()"><i class="fa fa-minus"></i></button></div><input class="form-control" name="{{title}}" min="0" ng-model="data" type="number" save="" oninput="validity.valid ? this.save = value : value = this.save;" placeholder="{{ \'ITEM_ADD_JIELONG_MODAL.RESERVE.NO.LIMIT\' | translate }}"/><div class="input-group-btn"><button type="button" class="btn btn-success btn-sm"ng-click="add()"><i class = "fa fa-plus"></i></button></div></div></div>',link:function(e,t,n){e.minus=function(){e.data=e.data-1==0?"":e.data-1},e.add=function(){e.data=e.data?e.data+1:1}}}};angular.module("shmApp.directives").directive("inputNumber",e)}(),function(){"use strict";var e=function(){return{restrict:"E",scope:{ngModel:"=",ngChange:"&",ngDisabled:"<"},template:'<label class="switch pull-right"><input type="checkbox" ng-disabled="ngDisabled" ng-model="ngModel" ng-click="ngChange()"><span class="slider round"></span></label>'}};angular.module("shmApp.directives").directive("toggleSwitch",e)}(),function(){"use strict";var e,t,n=function(e,n){t=this,t.$uibModalInstance=e,t.cancel=function(){t.$uibModalInstance.dismiss("cancel")}},a=function(t,a){return e=t,{restrict:"AE",template:'<div id="contact-us-box" ng-click="showContactQr()"><div class="qr-btn qr-btn"><img class = "text-center" src="/app/images/customer_service.svg"/></div></div>',link:function(t,i,r){t.$translate=a,t.showContactQr=function(){e.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",template:'<div class="modal-header"><span class="modal-title contact-qr-font-size" translate = "CONTACT_QR"></span><i ng-click="mdCtrl.cancel()" class="fa fa-window-close fa-2x pull-right " aria-hidden="true"></i></div><div class="modal-body"><div class="row text-center"><img class = "text-center" src="/app/images/kefu_new_1.png"/><br/><br/><br/><img class = "text-center" src="/app/images/kefu_new_4.png"/></div></div>',controller:["$uibModalInstance",n],controllerAs:"mdCtrl",size:"lg",appendTo:void 0})}}}};angular.module("shmApp.directives").directive("contactUsQr",["$uibModal","$translate",a])}(),function(){"use strict";var e,t=function(t){return e=t,{restrict:"AE",scope:!0,templateUrl:e.viewRootDir+"directives/modal/overlay.html",link:function(e,t){e.close=function(){t.remove()}}}};angular.module("shmApp.directives").directive("overlayModal",["appConf",t])}(),function(){"use strict";var e,t,n,a,i=function(i,r,o){return e=i,t=r,n=o,{restrict:"AE",scope:!0,transclude:!0,templateUrl:e.viewRootDir+"directives/modal/overlayCustom.html",link:function(e,t){a.isShowTopCloseBtn=!1,a.close=function(){t.remove()},a.showTopCloseBtn=function(){a.isShowTopCloseBtn=!0},a.hideTopCloseBtn=function(){a.isShowTopCloseBtn=!1},e.$on("$stateChangeSuccess",function(){a.close()})},controller:["$scope",function(e){a=this}],controllerAs:"ctrl"}};angular.module("shmApp.directives").directive("overlayModalCustom",["appConf","$sce","$compile",i])}(),function(){"use strict";var e=function(e){return{restrict:"A",link:function(t,n,a){t.$watch(function(){return t.$eval(a.bindHtmlCompile)},function(i){n.html(i&&i.toString());var r=t;a.bindHtmlScope&&(r=t.$eval(a.bindHtmlScope)),e(n.contents())(r)})}}};angular.module("shmApp.directives").directive("bindHtmlCompile",["$compile",e])}(),function(){"use strict";var e=function(){return{restrict:"AE",scope:{url:"<",width:"@?",height:"@?"},template:'<iframe ng-src="{{url | trustAsResourceUrl}}" width="{{width}}" height="{{height}}" frameborder="0" style="border:0" allowfullscreen></iframe>',link:function(e,t,n){}}};angular.module("shmApp.directives").directive("googleMapEmbedded",e)}(),function(){"use strict";var e=function(){return{restrict:"AE",
    template:'<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"><\/script><script>(adsbygoogle = window.adsbygoogle || []).push({google_ad_client: "ca-pub-9542338108488881", enable_page_level_ads: true});<\/script>'}};angular.module("shmApp.directives").directive("googleAdsense",e)}(),function(){"use strict";var e=function(){return{restrict:"AE",template:'<div id="loadingToast"><div class="weui-mask_transparent"></div><div class="weui-toast"><i class="weui-loading weui-icon_toast"></i><p class="weui-toast__content">{{ "DATA_LOADING" | translate }}</p></div></div>'}};angular.module("shmApp.directives").directive("wechatLoading",e)}(),function(){"use strict";var e=function(e){return function(t){return e.trustAsResourceUrl(t)}};angular.module("shmApp.filters").filter("trustAsResourceUrl",["$sce",e])}(),function(){"use strict";var e=function(e){return e.stripHtmlTags};angular.module("shmApp.filters").filter("stripHtmlTags",["UtilsService",e])}(),function(){"use strict";var e=function(){return function(e,t){return _.uniq(e,function(e){return e[t]})}};angular.module("shmApp.filters").filter("unique",e)}(),function(){"use strict";var e=/(http|ftp|https):\/\/(www\.showmine\.top)\/([\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/gi,t=function(){return function(t){return t.replace(e,'<a target="_blank" href="$&">$&</a>')}};angular.module("shmApp.filters").filter("parseUrlFilter",t)}(),function(){"use strict";var e=function(){return function(e){return e/1e8}};angular.module("shmApp.filters").filter("currencyRateString",[e])}(),function(){"use strict";var e=function(){return function(e){return e/100}};angular.module("shmApp.filters").filter("currencyAmountString",[e])}(),function(){"use strict";var e,t={},n=function(n,a){return t=n,e=a,{}};angular.module("shmApp.services").service("AddressService",["$http","appConf",n])}(),function(){"use strict";var e,t={},n=function(n){return t.post(e.apiUrl+"user/login",n)},a=function(){return t.get(e.apiUrl+"user/me")},i=function(n,a){return t.get(e.apiUrl+"wechat/getUser",{params:{code:n,state:a}})},r=function(n){return t.post(e.apiUrl+"wechat/web/connect/url",n)},o=function(n,a){return t.get(e.apiUrl+"wechat/web/getUser",{params:{code:n,state:a}})},c=function(e){localStorage.setItem("WechatAuthString",e)},s=function(){return localStorage.getItem("WechatAuthString")},m=function(n){return t.get(e.apiUrl+"social-login/"+n)},u=function(n,a){return t.get(e.apiUrl+"social-login/"+n+"/callback",{params:{code:a}})},l=function(n){return t.get(e.apiUrl+"social-login/facebook/companyRedirect",{params:n})},p=function(n){return t.get(e.apiUrl+"social-login/facebook/companyFacebookRedirect",{params:n})},d=function(n,a){return t.get(e.apiUrl+"social-login/facebook/companyBind",{params:{companyId:a,code:n}})},g=function(g,f){return t=g,e=f,{login:n,getWechatLoginUrl:r,getWechatUserFromCode:i,getWechatWebUserFromCode:o,getMe:a,setAuthString:c,getAuthString:s,getSocialMediaLoginRedirectUrl:m,getSocialMediaUserFromCode:u,facebookPageCompanyRedirect:l,facebookPageBindWithCode:d,companyFacebookRedirect:p}};angular.module("shmApp.services").service("AuthService",["$http","appConf",g])}(),function(){"use strict";var e,t,n={},a=function(e,a){return n.get(t.apiUrl+"item/seller/"+e,{params:a})},i=function(e){return n.get(t.apiUrl+"item/"+e)},r=function(e){return n.post(t.apiUrl+"item",e)},o=function(e,a){return n.put(t.apiUrl+"item/"+e,a)},c=function(e){return n.post(t.apiUrl+"payment/receipt",e)},s=function(e,a){return n.post(t.apiUrl+"comment/item/"+e,a)},m=function(e,a){return n.post(t.apiUrl+"jielong/"+e+"/subitems",a)},u=function(e,a){return n.post(t.apiUrl+"jielong/voucher/"+e,a)},l=function(e,a){return n.put(t.apiUrl+"jielong/"+e+"/subitems",a)},p=function(e,a){return n.get(t.apiUrl+"comment/item/"+e,{params:a})},d=function(e,a){return n.get(t.apiUrl+"jielong/isInJielong/"+e,a)},g=function(e,a){return n.get(t.apiUrl+"jielong/getAllJielong/"+e,a)},f=function(e,a){return n.put(t.apiUrl+"comment/"+e,a)},h=function(e,a){return n.get(t.apiUrl+"comment/"+e,a)},y=function(e,a){return n.delete(t.apiUrl+"comment/"+e,{params:a})},v=function(e){return n.get(t.apiUrl+"item/search",{params:e})},I=function(e,a){return n.get(t.apiUrl+"item/community/"+e,{params:a})},C=function(e,a){return n.get(t.apiUrl+"item/company/"+e,{params:a})},A=function(e,a){return n.get(t.apiUrl+"item/company/"+e+"/onlinePayment",{params:a})},S=function(e,a){return n.get(t.apiUrl+"item/company/"+e+"/consultation",{params:a})},_=function(e,a){return n.get(t.apiUrl+"item/company/"+e+"/nonConsultation",{params:a})},b=function(e,a){return n.get(t.apiUrl+"item/company/"+e+"/jielong",{params:a})},U=function(e,a){return n.put(t.apiUrl+"item/"+e+"/end",a)},E=function(e,a){return n.put(t.apiUrl+"item/"+e+"/sold",a)},w=function(e,a){return n.delete(t.apiUrl+"item/"+e,a)},T=function(e,a){return n.post(t.apiUrl+"item/"+e+"/abuse",a)},L=function(e,a){return n.get(t.apiUrl+"item/"+e+"/pushTimes",a)},M=function(e,a){return n.put(t.apiUrl+"item/"+e+"/push",a)},D=function(){return n.get(t.apiUrl+"tag/predefined")},k=function(e){return n.get(t.apiUrl+"jielong/blacklist",{params:e})},P=function(e){return n.get(t.apiUrl+"jielong/blacklist/blacklistdetails",{params:e})},R=function(e){return n.get(t.apiUrl+"utils/places-overseas",e)},N=function(e){return n.get(t.apiUrl+"utils/geoip/isFromChina",e)},O=function(e,a,i){return n.post(t.apiUrl+"item/poster/"+e,{url:a,is_showing_all_imgs:i})},x=function(e,a){return n.post(t.apiUrl+"item/checkinqr/"+e,{url:a})},$=function(e,a){return n.post(t.apiUrl+"item/checkin/"+e,{url:a})},G=function(e,a){return n.put(t.apiUrl+"item/"+e+"/seller",{seller_id:a})},W=function(e,a){return n.get(t.apiUrl+"item/"+e+"/guessYouLikeByTags",{params:a})},B=function(e){return n.get(t.apiUrl+"item/guessYouLike",{params:e})},F=function(e){return n.get(t.apiUrl+"item/history",{params:e})},V=function(e){return n.post(t.apiUrl+"item/clone/"+e)},j=function(e,a){var i=a||{};return i.item_id=e,n.post(t.apiUrl+"item/fav",i)},J=function(e,a){var i=a||{};return i.item_id=e,n.delete(t.apiUrl+"item/fav",{params:i})},H=function(e){return n.get(t.apiUrl+"item/fav",{params:e})},Y=function(e){return n.get(t.apiUrl+"item/propertytype",{params:e})},z=function(e){return n.get(t.apiUrl+"comment/voucher/"+e)},Q=function(e){return n.get(t.apiUrl+"comment/voucher/"+e+"/validate")},q=function(e,a){return n.post(t.apiUrl+"comment/voucher/"+e,a)},K=function(e,a){return n.post(t.apiUrl+"comment/voucher/"+e+"/subitems",a)},X=function(e){return n.get(t.apiUrl+"comment/voucher",{params:e})},Z=function(e,a){return n.put(t.apiUrl+"jielong/checkin/finish/"+e,a)},ee=function(e){return n.get(t.apiUrl+"item/topVisited",{params:e})},te=function(e){return n.get(t.apiUrl+"item/getItemsWithSpeicalTags",{params:e})},ne=function(e,a){return n.get(t.apiUrl+"item/company/getItemsWithCompanyTags/"+e,{params:a})},ae=function(e,a){return n.post(t.apiUrl+"/jielong/"+e+"/genReportEmail",a)},ie=function(e,a,i){return n.get(t.apiUrl+"comment/item/"+e+"/"+a,{params:i})},re=function(e,a){return n.post(t.apiUrl+"item/"+e+"/facebook",{params:a})},oe=function(e,a){return n.post(t.apiUrl+"item/"+e+"/wordpress",{params:a})},ce=function(e,a){return n.get(t.apiUrl+"jielong/bonus/isUserIn/"+e,{params:a})},se=function(e){return n.post(t.apiUrl+"jielong/bonus",e)},me=function(e){return e&&e.id?1!==parseInt(e.active)?"DEACTIVATED":!0===e.is_sold?"SOLD":!0===e.is_expired?"EXPIRED":!0===e.is_ended?"ENDED":!0!==e.is_published?"NOT_STARTED":"ACTIVE":""},ue=function(){return"CONSULTATION"},le=function(e,a){return n.get(t.apiUrl+"item/company/validateItemLimit/"+e,{params:a})},pe=function(e,a){return n.get(t.apiUrl+"item/"+e+"/history",{params:a})},de=function(e){return n.get(t.apiUrl+"item/rentSuburb",{params:e})},ge=function(e){return n.get(t.apiUrl+"comment/voucher/detailsFromWxCard",{params:e})},fe=function(fe,he,ye){return n=fe,e=he,t=ye,{getItemsForASeller:a,searchItems:v,searchItemsUnderCommunity:I,searchItemsUnderCompany:C,addCommentToAnItem:s,createItem:r,updateItem:o,createReceipt:c,getCommentsForAnItem:p,getItemDetails:i,reportItemAbuse:T,getLeftPushTimes:L,pushItem:M,markItemEnd:U,markItemSold:E,markItemDeactivate:w,getPredefinedTags:D,getPlacesOverseas:R,generateItemPoster:O,getIsFromChina:N,guessCurrentUserLike:B,guessUserLikeByTags:W,updateComment:f,getComment:h,setCommentsDeactivate:y,getMyHistory:F,getFavItems:H,cloneItem:V,markAsFavourite:j,removeAsFavourite:J,updateSeller:G,getIsInJielong:d,getAllJielong:g,generateCheckinQRCode:x,generateCheckinPoster:$,getPropertyTypes:Y,getVoucherDetails:z,checkinVoucher:q,checkinVoucherWithSubItems:K,getMyVouchers:X,terminateJielong:Z,getTopVisitItemsList:ee,addJielongToAnItemWithKids:m,updateJielongToAnItemWithKids:l,getItemStatusName:me,returnConsultation:ue,searchItemsUnderCompanyOnlyForProduct:_,searchItemsUnderCompanyOnlyForJielong:b,searchBlackList:k,getItemsWithSpeicalTags:te,getBlackListDetails:P,getItemsWithCompanyTags:ne,checkIfComanyUpperTheItemLimit:le,searchItemsUnderCompanyWithOnlinePayment:A,validateVoucherWhenNoUser:Q,genJielongReportEmail:ae,searchItemsUnderCompanyOnlyForConsultation:S,getItemHistories:pe,updateJielongReportLocationData:ie,pushToFacebook:re,pushToWordpress:oe,getRentSuburbs:de,createVoucherForJielong:u,getVoucherFromCardRedirection:ge,checkJielongBonusStatus:ce,updateJielongParticipatorBonusStatus:se}};angular.module("shmApp.services").service("ItemService",["$http","$base64","appConf",fe])}(),function(){"use strict";var e={NORMAL:0,JIE_LONG:1,TU_CAO:2},t=function(t){return{TYPE_CONSTS:e}};angular.module("shmApp.services").service("ItemTypeService",["appConf",t])}(),function(){"use strict";var e,t={},n=function(n){return t.get(e.apiUrl+"user/"+n)},a=function(n,a){return a.keyword=n,t.get(e.apiUrl+"user/search",{params:a})},i=function(n,a){return t.put(e.apiUrl+"user/"+n,a)},r=function(n){return t.post(e.apiUrl+"user/generateLoginCode",n)},o=function(n){return t.post(e.apiUrl+"user/validateLoginCode",n)},c=function(n){return t.post(e.apiUrl+"user/storeCurrentState",n)},s=function(n){return t.put(e.apiUrl+"user/me",n)},m=function(n){return t.post(e.apiUrl+"statistics/saveVisitSource",n)},u=function(n){return t.get(e.apiUrl+"statistics/visitSourceCount",{params:n})},l=function(n){return t.post(e.apiUrl+"statistics/saveShareSource",n)},p=function(p,d){return t=p,e=d,{getUser:n,searchUser:a,updateUserLanguage:i,generateLoginCode:r,validateLoginCode:o,updateMe:s,storeCurrentState:c,saveWeChatVisitSource:m,getWeChatVisitSourceCount:u,saveWeChatShareSource:l}};angular.module("shmApp.services").service("UserService",["$http","appConf",p])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s,m,u,l,p,d=function(n){e.hash(n),t()},g=function(n,a){t.yOffset=a,e.hash(n),t()},f=function(n){e.hash(n),setTimeout(function(){t()},500)},h=function(){d("app-top")},y=function(e){return/^((http[s]?|ftp):\/)?\/?([^:\/\s]+)((\/\w+)*\/)([\w\-\.]+[^#?\s]+)(.*)?(#[\w\-]+)?$/.test(e)},v=function(e){return new RegExp("^data:image/","i").test(e)},I=function(e){return/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(e)},C=function(e){return v(e)||y(e)},A=function(e){var t={};return t.imgSrc=!0===e.is_rent?r.getAppAbsUrlRoot(i.imagesRootDir+"rent_default.png"):r.getAppAbsUrlRoot(i.imagesRootDir+"item_default.png"),e.thumbnailArray=r.getImgArray(e.images_in_diff_sizes),e&&e.thumbnailArray&&e.thumbnailArray[0]&&!0===C(e.thumbnailArray[0].url)&&(t.imgSrc=e.images[0].url),t.imgSrc},S=function(e){var t={};return t.imgSrc=e.logo_img.url?r.getAppAbsUrlRoot(i.imagesRootDir+"rent_default.png"):r.getAppAbsUrlRoot(i.imagesRootDir+"item_default.png"),e&&e.logo_img&&!0===C(e.logo_img.url)&&(t.imgSrc=e.logo_img.url),t.imgSrc},b=function(e,t){var n={};return n.size_name=t||"LARGE",n.imgDefaultSrc=!0===e.is_rent?r.getAppAbsUrlRoot(i.imagesRootDir+"rent_default.png"):r.getAppAbsUrlRoot(i.imagesRootDir+"item_default.png"),e.thumbnailArray=r.getImgArray(e.images_in_diff_sizes,n.size_name),n.imgSrc=U(e.thumbnailArray,0),null===n.imgSrc?n.imgDefaultSrc:n.imgSrc},U=function(e,t){return e[t]?!0===e[t].mime_type.toLowerCase().startsWith("image")?e[t].url:U(e,1*t+1):null},E=function(e,t,n){return _.contains(e,t)||n},w=function(e){var t={};return t.imgSrc=r.getAppAbsUrlRoot()+"/app/images/default-avatar.png",e&&e.avatar_img&&!0===C(e.avatar_img)&&(t.imgSrc=e.avatar_img),t.imgSrc},T=function(e){return/^\s*$/.test(e)},L=function(e){T(e),n.pageTitle=e},M=function(e){n.pageDescription=e},D=function(t){var n={};return n.relative_path=void 0===t?"":"/"+t,e.protocol()+"://"+e.host()+":"+e.port()+n.relative_path},k=function(t){var n={};return n.exclude_hash=void 0===t||t,!0===n.exclude_hash?e.absUrl().split("#")[0]:e.absUrl()},P=function(t){var n={};if(n.url=c.href(t.name?t.name:t.current.name,t.params,{absolute:!0}),n.queryParams=e.search(),n.queryParams&&Object.keys(n.queryParams).length>0){if(n.parsedUrl=new URL(n.url),n.missingParams={},angular.forEach(n.queryParams,function(e,t){n.parsedUrl.searchParams.has(t)||(n.missingParams[t]=e)}),!(Object.keys(n.missingParams).length>0))return n.url;!0===n.url.includes("?")?n.url=n.url+"&"+s(n.missingParams):n.url=n.url+"?"+s(n.missingParams)}return n.url},R=function(e){var t=/((<style>)|(<style type=.+))((\s+)|(\S+)|(\r+)|(\n+))(.+)((\s+)|(\S+)|(\r+)|(\n+))(<\/style>)/g;return e?String(e).replace(t,"").replace(/&nbsp;/gi,"").replace(/<[^>]+>/gm,""):""},N=function(e){var t=e.replace(/[^a-z0-9\u4e00-\u9eff]/gi,"").toLowerCase();return(t=t.length>40?t.substr(1,37)+"...":t)||""},O=function(e){var t={addressMap:{}};for(t.i=0;t.i<e.address_components.length;t.i++)t.addressType=e.address_components[t.i].types[0],t.addressMap[t.addressType]=e.address_components[t.i].long_name;return t.address={street:(t.addressMap.street_number?t.addressMap.street_number+" ":"")+(t.addressMap.route?t.addressMap.route:""),suburb:t.addressMap.locality?t.addressMap.locality:t.addressMap.colloquial_area?t.addressMap.colloquial_area:"",state:t.addressMap.administrative_area_level_1?t.addressMap.administrative_area_level_1:"",country:t.addressMap.country?t.addressMap.country:"",postcode:t.addressMap.postal_code?t.addressMap.postal_code:""},e.geometry&&e.geometry.location&&(t.address.latitude=e.geometry.location.lat,t.address.longitude=e.geometry.location.lng),t.address},x=function(e){return{formatted_address:(e.street?e.street+", ":"")+(e.suburb?e.suburb+", ":"")+(e.state?e.state+", ":"")+(e.country?e.country+", ":""),address_components:[{long_name:e.street,short_name:e.street,types:["route"]},{long_name:e.suburb,short_name:e.suburb,types:["locality"]},{long_name:e.state,short_name:e.state,types:["administrative_area_level_1"]},{long_name:e.country,short_name:e.country,types:["country"]},{long_name:e.postal_code,short_name:e.postal_code,types:["postcode"]}],geometry:{location:{lat:function(){return e.latitude},lng:function(){return e.longitude}}}}},$=function(e){var t=n.$new(!0),a=angular.element(document.body),i=u("<overlay-modal-custom>"+e+"</overlay-modal-custom>")(t);a.append(i)},G=function(e,t){t||(t=""),e||(e="DEFAULT");var a=n.$new(!0),i={overlayModalWording:t,overlayModalType:e};angular.extend(a,angular.copy(i),{});var r=angular.element(document.body),o=u("<overlay-modal></overlay-modal>")(a);r.append(o)},W=function(e,t){var n={};return n.imgArray=[],n.targetSize=void 0===t?"MID":t,e.origImages?(angular.forEach(e.origImages,function(t,a){if("MID"===n.targetSize)n.midImg=e.midImages[a],n.targetImg=n.midImg?n.midImg:t;else if("SMALL"===n.targetSize)n.smallImg=e.smallImages[a],n.targetImg=n.smallImg?n.smallImg:t;else{if("LARGE"!==n.targetSize)return;n.largeImg=e.largeImages[a],n.targetImg=n.largeImg?n.largeImg:t}n.targetImg.comment=t.comment,n.imgArray.push(n.targetImg)}),n.imgArray):n.imgArray},B=function(e){return o.createHash(e)},F=function(e){try{if(e=e||"",""==e.trim())return!0;return void 0!==angular.element(e).attr("meipian-style")}catch(e){return!1}},V=function(e){var t=_.where(e.tags,{type_id:"b6ff88cde7078468bf1da52e5517d548"});return t&&t.length>0?t[0].name:""},j=function(e){var t={};return angular.forEach(e,function(e){var n=moment(moment.utc(e.payment_date)).local().format("YYYY-MM-DD");t[n]||(t[n]={}),t[n].payments||(t[n].payments={}),angular.forEach(e.receipts,function(a){t[n].payments[e.id]||(t[n].payments[e.id]=_.omit(e,"receipts"),t[n].payments[e.id].company=a.item.company),t[n].payments[e.id].items||(t[n].payments[e.id].items={}),t[n].payments[e.id].items[a.item_id]||(t[n].payments[e.id].items[a.item_id]=a.item),t[n].payments[e.id].items[a.item_id].receipts||(t[n].payments[e.id].items[a.item_id].receipts={}),t[n].payments[e.id].items[a.item_id].receipts[a.id]||(t[n].payments[e.id].items[a.item_id].receipts[a.id]=_.omit(a,"item"))})}),t},J=function(e){var t={};return angular.forEach(e,function(e){var n=moment(moment.utc(e.trans_date)).local().format("YYYY-MM-DD");t[n]||(t[n]={}),t[n].items&&t[n].items[e.item_id]||(t[n].items={},t[n].items[e.item_id]=e.item),t[n].items[e.item_id].receipts&&t[n].items[e.item_id].receipts[e.id]||(t[n].items[e.item_id].receipts={},t[n].items[e.item_id].receipts[e.id]=_.omit(e,"item"))}),t},H=function(e){var t={};return angular.forEach(e,function(e){var n=moment(moment.utc(e.trans_date)).local().format("YYYY-MM-DD");t[n]||(t[n]={}),t[n].items||(t[n].items={}),t[n].items[e.item_id]||(t[n].items[e.item_id]=e.item),t[n].items[e.item_id].receipts||(t[n].items[e.item_id].receipts={}),t[n].items[e.item_id].receipts[e.id]||(t[n].items[e.item_id].receipts[e.id]=_.omit(e,"item"))}),t},Y=function(e){var t={};return angular.forEach(e,function(e){if(e.item&&e.item.company_id){var n=moment(moment.utc(e.trans_date)).local().format("YYYY-MM-DD");t[n]||(t[n]={}),t[n].companies||(t[n].companies={}),t[n].companies[e.item.company.id]||(t[n].companies[e.item.company.id]=e.item.company),t[n].companies[e.item.company.id].items||(t[n].companies[e.item.company.id].items={}),t[n].companies[e.item.company.id].items[e.item_id]||(t[n].companies[e.item.company.id].items[e.item_id]=e.item),t[n].companies[e.item.company.id].items[e.item_id].receipts||(t[n].companies[e.item.company.id].items[e.item_id].receipts={}),t[n].companies[e.item.company.id].items[e.item_id].receipts[e.id]||(t[n].companies[e.item.company.id].items[e.item_id].receipts[e.id]=_.omit(e,"item"))}}),t},z=function(e){var t={};return angular.forEach(e,function(e){var n=moment(moment.utc(e.payment_date)).local().format("YYYY-MM-DD");t[n]||(t[n]={}),t[n].payments||(t[n].payments={}),t[n].payments[e.vendor_payment_group_id]||(t[n].payments[e.vendor_payment_group_id]=e.vendor_payment_group),t[n].payments[e.vendor_payment_group_id].vendors||(t[n].payments[e.vendor_payment_group_id].vendors={}),angular.forEach(e.receipts,function(a){t[n].payments[e.vendor_payment_group_id].vendors[e.id]||(t[n].payments[e.vendor_payment_group_id].vendors[e.id]=_.omit(e,"receipts"),t[n].payments[e.vendor_payment_group_id].vendors[e.id].company=a.item.company),t[n].payments[e.vendor_payment_group_id].vendors[e.id].items||(t[n].payments[e.vendor_payment_group_id].vendors[e.id].items={}),t[n].payments[e.vendor_payment_group_id].vendors[e.id].items[a.item_id]||(t[n].payments[e.vendor_payment_group_id].vendors[e.id].items[a.item_id]=a.item),t[n].payments[e.vendor_payment_group_id].vendors[e.id].items[a.item_id].receipts||(t[n].payments[e.vendor_payment_group_id].vendors[e.id].items[a.item_id].receipts={}),t[n].payments[e.vendor_payment_group_id].vendors[e.id].items[a.item_id].receipts[a.id]||(t[n].payments[e.vendor_payment_group_id].vendors[e.id].items[a.item_id].receipts[a.id]=_.omit(a,"item"))})}),t},Q=function(e,t){var n=e.suburb?"https://www.google.com/maps/embed/v1/place?key=AIzaSyC54M7x-ybIYncE4hLfAMIzkDAiCKhfQ6M&q="+e.suburb:"";return"<style>#house-info,#user-info {padding: 1em 0.5em;}#user-info {display: flex; align-items: center;}#user-info ul {margin: 0}#house-info ul li, #user-info ul li {display: inline-block; padding: 0em 0.25em;}#house-info .address {font-size: 1.5em;}#house-info .amount {font-size: 1.2em;}#google-map {margin: 1em 0;}</style><div user-contact user='item.seller'></div><div id='house-info'><div class='col-xs-6 no-padding'><ul>"+(e.bed_num>0?'<li><i class="fa fa-bed" aria-hidden="true"></i> '+e.bed_num+"</li>":"")+(e.bath_num>0?'<li><i class="fa fa-bath" aria-hidden="true"></i> '+e.bath_num+"</li>":"")+(e.park_num>0?'<li><i class="fa fa-car" aria-hidden="true"></i> '+e.park_num+"</li>":"")+(e.property_type?" | "+X(e.property_type?e.property_type:""):"")+(e.rent_type?" | "+q(e.rent_type?e.rent_type:""):"")+(e.allow_pet?" | "+Z(e.allow_pet?e.allow_pet:""):"")+"</ul></div><div class='col-xs-6 no-padding'>"+(e.amount_range?'<div class="pull-right amount"><strong>'+ee(e.amount_range?e.amount_range:"")+m.instant("RENT.PERWEEK")+"</strong></div>":"")+'</div><div class="clearfix"></div><div class="address">'+e.suburb+"</div>"+(n?'<iframe id="google-map" src="'+n+'" width="100%" height="200" frameborder="0" style="border:0" allowfullscreen></iframe>':"")+"</div>"+t},q=function(e){switch(e){case"single":return m.instant("RENT.SINGLE");case"entire":return m.instant("RENT.ENTIRE")}},K=function(e){return e.replace(/\s+/g,"")},X=function(e){switch(e){case"apartment":return m.instant("ITEM.PAGE.LIST.RENT.PROPERTY.TYPE.APARTMENT");case"house":return m.instant("ITEM.PAGE.LIST.RENT.PROPERTY.TYPE.HOUSE")}},Z=function(e){switch(e){case"yes":return m.instant("ITEM.PAGE.LIST.RENT.ALLOW.PET")+m.instant("ITEM.PAGE.LIST.RENT.PET.NAME");case"no":return m.instant("ITEM.PAGE.LIST.RENT.NOT.ALLOW.PET")+m.instant("ITEM.PAGE.LIST.RENT.PET.NAME")}},ee=function(e){switch(e){case"150less":return m.instant("RENT.LESSTHAN150");case"900more":return m.instant("RENT.MORETHAN900");default:return"AU$"+e}},te=function(e,t,n){var a=[];return n&&n.id&&n.is_admin?!0:angular.forEach(t,function(t){if(t.name==e)if(t.isPaidFeature){if(n&&n.id&&n.adminOfCompanyIds&&n.adminOfCompanyIds.length>0){var i=[];angular.forEach(n.userCompany,function(e){_.contains(n.adminOfCompanyIds,e.id)&&i.push(e)}),angular.forEach(i,function(e){r.ifCompanyCanCreateFeaturedItem(e,t.name).ifCanCreate&&a.push(e)})}}else a=n.userCompany}),a},ne=function(e,t){var n=!1,a="",i={};if(e&&e.id&&e.admin_config){var r=JSON.parse(e.admin_config);if(r.currentPackageExpireDate)var o=moment().format("YYYY-MM-DD HH:mm"),c=moment(moment.utc(r.currentPackageExpireDate)).local(),s=!!moment(c).isAfter(o);if(s){switch(t){case"JIE LONG":!!r.is_allow_create_jielong&&(n=!0);break;case"CONSULTATION":!!r.is_allow_create_news&&(n=!0);break;case"VOUCHER GROUP":!!r.is_allow_create_voucher&&(n=!0);break;case"SYNC TO WECHAT":!!r.is_allow_syn_to_wechat&&(n=!0);break;case"MULTIPLE PICKUP":!!r.is_allow_multi_pickup&&(n=!0);break;default:n=!0}a=n?void 0:m.instant("ITEM.PAGE.PAID.POP.MODAL.MESSAGE")}else a=m.instant("ITEM.PAGE.PACKAGE.EXPIRED,MESSAGE");i={ifCanCreate:n&&s,message:a}}return i},ae=function(e,t,n){var i={};i.params={fetch_type:n},l.checkJielongBonusStatus(e.id,i.params).then(function(i){if("TYPE_SHARE"===n&&e.wxshare_success_entities.length>0)var r=e.wxshare_success_entities[0].entity;if("TYPE_JIELONG"===n&&e.jielong_success_entities.length>0)var r=e.jielong_success_entities[0].entity;if("TYPE_JIELONG_SHARE"===n&&e.jielong_wxshare_success_entities.length>0)var r=e.jielong_wxshare_success_entities[0].entity;var o=!!r&&r.allow_participated;if(!i.data.isUserInBonus&&o)a.open({animation:!0,template:'<voucher-jielong-reward-modal  app-user="jrCtrl.appUser" item="jrCtrl.item" call-back-close="jrCtrl.cancel" fetch-type="jrCtrl.fetchType">',controller:["$uibModalInstance","appUser","item","fetchType",function(e,t,n,a){var i=this;i.$uibModalInstance=e,i.appUser=t,i.item=n,i.fetchType=a,i.cancel=function(){i.$uibModalInstance.close("cancel")}}],controllerAs:"jrCtrl",size:"lg",appendTo:void 0,resolve:{appUser:function(){return t},item:function(){return e},fetchType:function(){return n}}});else if(i.data.isUserInBonus&&"TYPE_JIELONG_SHARE"===n){ae(e,t,"TYPE_SHARE")}})},ie=function(){var e=navigator.userAgent||navigator.vendor||window.opera;return e.indexOf("FBAN")>-1||e.indexOf("FBAV")>-1},re=function(e,t,n){var a={state:e,params:t,reload:n};p.localStorage.setItem("SHM_redirect_url",JSON.stringify(a))},oe=function(e){if(e&&e>=1e3){return(e/1e3).toFixed(1)+"K+"}return e},ce=function(_,U,q,X,Z,ee,ce,se,me,ue,le,pe){return r=this,r.now=moment(),e=_,t=U,n=q,a=X,i=Z,o=ee,c=ce,s=se,m=me,u=ue,l=le,p=pe,r.isUrl=y,r.isDataUrl=v,r.isEmail=I,r.isImageUrl=C,r.getItemDefaultImageUrl=A,r.getCompanyDefaultImageUrl=S,r.getUserAvatarImageUrl=w,r.scrollToTop=h,r.scrollTo=d,r.scrollToWithOffset=g,r.delayScrollTo=f,r.setWebTitle=L,r.setWebDescription=M,r.getAppAbsUrlRoot=D,r.getCurrentUrl=k,r.getCurrentUrlFromPageState=P,r.stripHtmlTags=R,r.isBlank=T,r.mapGoogleMapToAddressObj=O,r.buildGooglePlacesResult=x,r.displayOverlayModal=$,r.displaySubscribeModal=G,r.getImgArray=W,r.getItemDefaultThumbnailUrl=b,r.md5Hash=B,r.isConvertableToMeiPianStyleHtml=F,r.returnCommunityNameFromItem=V,r.getUrlSafeString=N,r.adminOfCompany=E,r.processMulvendorPayment=j,r.processReceipt=J,r.processAllReceipt=H,r.processAllReceiptAllCompanies=Y,r.processVendorPaymentWithGroupId=z,r.addInfoForRent=Q,r.getAccessibleCompanies=te,r.ifCompanyCanCreateFeaturedItem=ne,r.checkJielongBonusStatus=ae,r.removeWhitespaceFromAString=K,r.isFromFacebook=ie,r.storeRedirectUrl=re,r.showSimplifiedNumber=oe,r};angular.module("shmApp.services").service("UtilsService",["$location","$anchorScroll","$rootScope","$uibModal","appConf","md5","$state","$httpParamSerializer","$translate","$compile","ItemService","$window",ce])}(),function(){"use strict";var e,t,n,a,i,r,o,c,s={},m=function(e){return s.get(o.apiUrl+"wechat/js/conf",{params:e})},u=function(e,t){wx&&"function"==typeof wx.config&&(wx.config(t),f(e,t))},l=function(t){return e.md5Hash(t)},p=function(e,t){var a=c.getItem("wx");return a||(a={}),a[l(e)]=t,c.setItem("wx",a),n},d=function(e){var t=c.getItem("wx");return t?t[l(e)]:null},g=function(e){var t={};if(t.stored_config=d(e),"object"==typeof t.stored_config&&t.stored_config&&""!==t.stored_config.timestamp&&(t.now_unix_timestamp=Math.floor(Date.now()/1e3),1*t.now_unix_timestamp-1*t.stored_config.timestamp<=7e3))return t.stored_config},f=function(e,t){return p(e,t),n},h=function(e,t){var a=g(e);return a?(u(e,a),t&&t.loaded&&t.loaded(),n):(n.loadingWechatJsConf=!0,n.loadingWechatJsConfErr=void 0,m({url:e}).then(function(n){n.data&&n.data.js&&(u(e,n.data.js),void 0!==t&&v(t))},function(e){n.loadingWechatJsConfErr=e.data}).finally(function(){n.loadingWechatJsConf=!1}),n)},y=function(e){wx&&"function"==typeof wx.ready&&"function"==typeof e&&wx.ready(function(){e()})},v=function(e){jQuery(document).ready(function(){r(function(){wx.ready(function(t){n.weChatJsLoaded=!0,e.menuShareAppMessage&&wx.onMenuShareAppMessage(e.menuShareAppMessage),e.menuShareTimeline&&wx.onMenuShareTimeline(e.menuShareTimeline),e.getLocation&&wx.getLocation({type:"wgs84",success:function(t){"function"==typeof e.getLocation.success&&e.getLocation.success(t)},fail:function(t){"function"==typeof e.getLocation.fail&&e.getLocation.fail(t)}}),e.loaded&&"function"==typeof e.loaded&&e.loaded(t)})},500)})},I=function(){var e={};return e.userAgent=t.navigator.userAgent.toLowerCase(),!!e.userAgent.match(/MicroMessenger/i)},C=function(){var e={};return e.userAgent=t.navigator.userAgent,!!e.userAgent.match(/(iPad|iPhone|iPod)/g)},A=function(){var e={};return e.userAgent=t.navigator.userAgent,!e.userAgent.match(/(iPad)|(iPhone)|(iPod)|(android)|(webOS)/i)},S=function(){var e={};return e.userAgent=t.navigator.userAgent.toLowerCase(),!!e.userAgent.match(/WindowsWechat/i)},_=function(){var e={};return e.userAgent=t.navigator.userAgent.toLowerCase(),!!e.userAgent.match(/Chrome/i)},b=function(){return o.webMainUrl+a.href("auth.getWechatUser",{domain:encodeURIComponent(location.origin),origurl:encodeURIComponent(location.href)},{absolute:!1})},U=function(e){return s.post(o.apiUrl+"wechat/me",{state_redirect_obj:e,wechat_auth_url:b()})},E=function(e){return U(e).then(function(e){if(e.data.auth_url)return void(t.location.href=e.data.auth_url)}),n},w=function(e){return s.post(o.apiUrl+"wechat/open-platform/generatePreAuthorizationUrl",e)},T=function(e){return s.post(o.apiUrl+"wechat/open-platform/bindCompanyWithAppId",e)},L=function(e,t){return s.get(o.apiUrl+"wechat/card/getUserCard/"+e,{params:t})},M=function(m,u,l,p,d,g,f,v){return s=m,t=u,e=l,a=p,i=d,r=g,o=f,c=v,n=this,n.loadWeChatJsConf=h,n.openedInWeChat=I,n.getAuthPageUrl=b,n.loginAndRedirect=E,n.openInIphone=C,n.openInDesktop=A,n.openInWindowsWechat=S,n.openInGoogleChrome=_,n.runWhenWXReady=y,n.getPreAuthorizationUrl=w,n.bindCompanyWithAppId=T,n.getUserCardByCardId=L,n};angular.module("shmApp.services").service("WeChatService",["$http","$window","UtilsService","$state","$auth","$timeout","appConf","StorageService",M])}(),function(){"use strict";var e,t={},n=function(n){return t.get(e.apiUrl+"community/areaList",{params:n})},a=function(n){return t.get(e.apiUrl+"community",{params:n})},i=function(i,r){return t=i,e=r,{getAreaList:n,getCommunityTagList:a}};angular.module("shmApp.services").service("CommunityService",["$http","appConf",i])}(),function(){"use strict";var e,t,n=function(){var e=document.createElement("script");e.src="https://ditu.google.cn/maps/api/js?libraries=places&key=AIzaSyC7TkwBa6hrQAE9mu6s88oIxV70JKsTIXM&callback=initialize",e.async="",e.defer="",document.body.appendChild(e)},a=function(a,i){e=a,t=i;var r=t.defer();return e.initialize=function(){r.resolve()},n(),r.promise};angular.module("shmApp.services").service("loadGoogleMapLib",["$window","$q",a])}(),function(){"use strict";var e,t,n,a=function(a,i){return e.localStorage.setItem(t.localStorageKeyPrefix+a,angular.toJson(i)),n},i=function(n){var a=e.localStorage.getItem(t.localStorageKeyPrefix+n);return angular.fromJson(a)},r=function(a){return e.localStorage.removeItem(t.localStorageKeyPrefix+a),n},o=function(o,c){return e=o,t=c,n=this,n.setItem=a,n.getItem=i,n.removeItem=r,n};angular.module("shmApp.services").service("StorageService",["$window","appConf",o])}(),function(){"use strict";var e,t,n={},a=function(e){return n.post(t.apiUrl+"asset/wechat",e)},i=function(e,a){return n.put(t.apiUrl+"asset/"+e+"/comment",a)},r=function(n){return e.upload({url:t.apiUrl+"asset",file:n})},o=function(e){return n.post(t.apiUrl+"asset/based64",e)},c=function(c,s,m){return n=c,t=m,e=s,{uploadThoughWechat:a,updateAssetComment:i,uploadAsset:r,uploadBase64Asset:o}};angular.module("shmApp.services").service("AssetService",["$http","Upload","appConf",c])}(),function(){"use strict";var e,t={},n=function(n){return t.post(e.apiUrl+"company",n)},a=function(n){return t.post(e.apiUrl+"company/createCompanyByNormalUser",n)},i=function(n,a){return t.put(e.apiUrl+"company/"+n,a)},r=function(n){return t.get(e.apiUrl+"company/"+n)},o=function(n){return t.get(e.apiUrl+"company",{params:n})},c=function(n,a){return t.get(e.apiUrl+"company/user/"+n,{params:a})},s=function(n,a,i){return t.post(e.apiUrl+"company/user/"+n+"/"+a,i)},m=function(n,a){return t.delete(e.apiUrl+"company/user/"+n+"/"+a)},u=function(n,a,i){return t.put(e.apiUrl+"company/user/"+n+"/"+a,i)},l=function(n,a){return t.post(e.apiUrl+"company/messages/"+n,a)},p=function(n,a){return t.put(e.apiUrl+"company/messages/"+n,a)},d=function(n,a){return t.delete(e.apiUrl+"company/messages/"+n,a)},g=function(n,a){return t.get(e.apiUrl+"company/messages/"+n,{params:a})},f=function(n,a){return t.get(e.apiUrl+"company/messages/list/"+n,{params:a})},h=function(n){return t.post(e.apiUrl+"company/fav",{company_id:n})},y=function(n){return t.delete(e.apiUrl+"company/fav",{params:{company_id:n}})},v=function(n){return t.get(e.apiUrl+"company/fav",{params:n})},I=function(n){return t.get(e.apiUrl+"company/section/"+n)},C=function(n,a){return t.post(e.apiUrl+"company/section/"+n,{companySection:a})},A=function(n,a){
    return t.put(e.apiUrl+"company/display/"+n,a)},S=function(n,a){return t.post(e.apiUrl+"company/sendMessage/"+n,a)},_=function(n){return t.post(e.apiUrl+"company/apply",n)},b=function(n){return t.post(e.apiUrl+"domain",{domain:n})},U=function(n,a){return t.post(e.apiUrl+"company/broadcastArticles/"+n,a)},E=function(n){return t.post(e.apiUrl+"company/bindFacebook",n)},w=function(n,a){return t.post(e.apiUrl+"company/captcha/"+n,a)},T=function(n){return t.get(e.apiUrl+"company/location/"+n)},L=function(n,a){return t.post(e.apiUrl+"company/location/"+n,a)},M=function(n,a,i){return t.put(e.apiUrl+"company/location/"+n+"/"+a,i)},D=function(n,a){return t.delete(e.apiUrl+"company/location/"+n+"/"+a)},k=function(n){return t.get(e.apiUrl+"company/voucher-group/publicList",{params:n})},P=function(n,a){return t.get(e.apiUrl+"company/voucher-group/company/"+n,{params:a})},R=function(n){return t.get(e.apiUrl+"company/voucher-group/"+n)},N=function(n){return t.post(e.apiUrl+"company/voucher-group",n)},O=function(n,a){return t.put(e.apiUrl+"comment/voucher/"+n+"/markSent",a)},x=function(n){return t.post(e.apiUrl+"company/voucher-group/"+n+"/obtainOwnership")},$=function(){return t.post(e.apiUrl+"company/voucher-group/fetchVoucherRandomly")},G=function(n){return t.post(e.apiUrl+"company/voucher-campaign",n)},W=function(n){return t.get(e.apiUrl+"company/voucher-campaign/"+n)},B=function(n,a){return t.put(e.apiUrl+"company/voucher-campaign/"+n,a)},F=function(n,a){return t.get(e.apiUrl+"company/voucher-campaign/company/"+n,{params:a})},V=function(n){return t.get(e.apiUrl+"company/voucher-campaign",{params:n})},j=function(n){return t.post(e.apiUrl+"company/voucher-campaign/"+n+"/fetchVoucherRandomly")},J=function(n,a){return t.get(e.apiUrl+"company/voucher-campaign/"+n+"/voucherUsersUnderCampaign",{params:a})},H=function(n){return t.get(e.apiUrl+"company/voucher-group/companies",{params:n})},Y=function(n,a){return t.put(e.apiUrl+"company/voucher-group/"+n,a)},z=function(n){return t.get(e.apiUrl+"company/paid/companies",{params:n})},Q=function(n){return t.post(e.apiUrl+"company/voucher-group/preview",n)},q=function(n,a){return t.get(e.apiUrl+"wechat/card/assignCard/"+n,{params:a})},K=function(n,a){return t.put(e.apiUrl+"company/voucher-group/cancel/"+n+"/"+a)},X=function(n){return t.post(e.apiUrl+"company/voucher-group/share/"+n)},Z=function(n){return t.post(e.apiUrl+"utils/recordCreationSource",n)},ee=function(n,a){return t.post(e.apiUrl+"company/addSales/"+n,a)},te=function(n,a){return t.post(e.apiUrl+"company/setRedeemDesc/"+n,a)},ne=function(n,a){return t.post(e.apiUrl+"company/"+n+"/approveCompanyStaff",a)},ae=function(n,a){return t.post(e.apiUrl+"company/"+n+"/genAddUserQRCode",a)},ie=function(){return t.get(e.apiUrl+"company/tags/list")},re=function(){return t.get(e.apiUrl+"home/voucherTarget")},oe=function(n){return t.post(e.apiUrl+"home/log/saveDraw",n)},ce=function(n){return t.get(e.apiUrl+"home/log/drawLeftToday")},se=function(n){return t.get(e.apiUrl+"company/recommend")},me=function(me,ue){return t=me,e=ue,{updateInfo:i,createInfo:n,getCompanyDetails:r,createNewCompanyUser:s,getUserList:c,deleteCompanyUser:m,updateCompanyUser:u,getAllCompanies:o,updateComment:p,addCommentToAnCompany:l,deleteCompanyComment:d,getCompanyComments:f,markAsFavourite:h,removeAsFavourite:y,getFavCompanies:v,getACompanyComment:g,getCompanySections:I,createCompanySections:C,displayCompanyItems:A,applyCompany:_,getByDomain:b,broadcastItemsToWechat:U,bindFacebookWithPage:E,sendMessageToCompany:S,createCaptcha:w,getCompanyPickupLocations:T,createCompanyPickupLocation:L,updateCompanyPickupLocation:M,deleteCompanyPickupLocation:D,getPublicVoucherGroupList:k,getVoucherGroupsUnderCompany:P,getVoucherGroupById:R,createCompanyVoucherGroup:N,markVoucherSent:O,obtainVoucherOwnership:x,obtainRandomVoucherOwnership:$,createCompanyVoucherCampaign:G,getCompanyVoucherCampaignDetails:W,updateCompanyVoucherCampaignDetails:B,getCompanyCampaignList:F,getAllCampaignList:V,obtainRandomVoucherUnderCampaign:j,getCampaignUsersLists:J,getCompaniesWithVoucherGroups:H,updateCompanyVoucherGroup:Y,getPaidCompanies:z,previewVoucher:Q,assignCard:q,cancelCompanyVoucherGroup:K,sendWeChatNewsOfVoucherGroup:X,createCompanyByNormalUser:a,recordCreationSource:Z,addSales:ee,setRedeemDesc:te,approveCompanyStaff:ne,genAddUserQRCode:ae,getTagsList:ie,getHomeVoucherTarget:re,saveHomeVoucherDraw:oe,showTodayDrawLeft:ce,getRecommendCompany:se}};angular.module("shmApp.services").service("CompanyService",["$http","appConf",me])}(),function(){"use strict";var e,t={},n=function(n){return t.get(e.apiUrl+"tag/popular",{params:n})},a=function(a,i){return t=a,e=i,{getPopularTags:n}};angular.module("shmApp.services").service("TagService",["$http","appConf",a])}(),function(){"use strict";var e,t={},n=function(){return t.get(e.apiUrl+"banner")},a=function(n){return t.post(e.apiUrl+"banner",{banners:n})},i=function(n){return t.get(e.apiUrl+"banner/company/"+n)},r=function(n,a){return t.post(e.apiUrl+"banner/company/"+n,{banners:a})},o=function(o,c){return t=o,e=c,{getBanners:n,createBanner:a,getCompanyBanners:i,createCompanyBanner:r}};angular.module("shmApp.services").service("BannerService",["$http","appConf",o])}(),function(){"use strict";var e,t={},n=function(n){return t.get(e.apiUrl+"language/id/"+n)},a=function(n){return t.get(e.apiUrl+"language/name/"+n)},i=function(i,r){return t=i,e=r,{getLanguageById:n,getLanguageByName:a}};angular.module("shmApp.services").service("LanguageService",["$http","appConf",i])}(),function(){"use strict";var e,t={},n=function(n){return t.post(e.apiUrl+"payment/generateOmiPayURL",n)},a=function(n,a){return t.get(e.apiUrl+"payment/validatePayment/"+n,{params:a})},i=function(n){return t.post(e.apiUrl+"payment/receipt",n)},r=function(n){return t.get(e.apiUrl+"payment/companies/unpaid",{params:n})},o=function(n){return t.get(e.apiUrl+"payment/companies/paid",{params:n})},c=function(n,a){return t.get(e.apiUrl+"payment/companies/"+n+"/unpaid",{params:a})},s=function(n,a){return t.get(e.apiUrl+"payment/companies/"+n+"/paid",{params:a})},m=function(n){return t.post(e.apiUrl+"payment/generateABA",n)},u=function(n){return t.delete(e.apiUrl+"jielong/"+n+"/refund")},l=function(n){return t.post(e.apiUrl+"payment/reGenerateABA",n)},p=function(n){return t.post(e.apiUrl+"payment/paypal/generatePaymentUrl",n)},d=function(n){return t.post(e.apiUrl+"payment/paypal/completeCheckout",n)},g=function(n){return t.post(e.apiUrl+"generalpayment/pay",n)},f=function(n){return t.post(e.apiUrl+"generalpayment/complete",n)},h=function(n){return t.post(e.apiUrl+"generalpayment/completeApplyCompany",n)},y=function(n){return t.post(e.apiUrl+"generalpayment/completeExtendCompany",n)},v=function(n){return t.get(e.apiUrl+"generalpayment/transactions",{params:n})},I=function(I,C){return t=I,e=C,{generateOmiPayURL:n,createReceipt:i,validatePayment:a,getUnpaidCompanyReceipts:r,generateABA:m,getPaidCompanyReceipts:o,getUnpaidReceiptsForACompany:c,getPaidVendorPaymentsForACompany:s,companyPaymentRefund:u,reGenerateABA:l,paypalCompleteCheckout:d,generatePaypalUrl:p,generalpaymentUrl:g,paymentCompleteCheckout:f,completeApplyCompany:h,completeExtendCompany:y,packagePaymentList:v}};angular.module("shmApp.services").service("PaymentService",["$http","appConf",I])}(),function(){"use strict";var e,t={},n=function(n){return t.get(e.apiUrl+"specialTags",{params:n})},a=function(n){return t.post(e.apiUrl+"specialTags",{specialTags:n})},i=function(i,r){return t=i,e=r,{getSpecialTags:n,createSpecialTags:a}};angular.module("shmApp.services").service("TagsSectionService",["$http","appConf",i])}();